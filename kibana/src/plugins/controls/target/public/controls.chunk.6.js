(window.controls_bundle_jsonpfunction=window.controls_bundle_jsonpfunction||[]).push([[6],{85:function(e,t,i){"use strict";i.r(t),i.d(t,"providers",(function(){return g})),i.d(t,"registry",(function(){return h}));var r=i(2),n=i(18),s=i(16),o=i(8),a=i(1),c=i.n(a),l=i(33),u=i.n(l),d=i(39);class options_list_OptionsListService{constructor(e){c()(this,"data",void 0),c()(this,"http",void 0),c()(this,"getRoundedTimeRange",(e=>({from:u.a.parse(e.from).startOf("minute").toISOString(),to:u.a.parse(e.to).endOf("minute").toISOString()}))),c()(this,"optionsListCacheResolver",(e=>{const{query:t,filters:i,timeRange:r,searchString:n,runPastTimeout:s,selectedOptions:o,field:{name:a},dataView:{title:c}}=e;return[...r?JSON.stringify(this.getRoundedTimeRange(r)):[],Math.floor(Date.now()/1e3/60),null==o?void 0:o.join(","),JSON.stringify(i),JSON.stringify(t),s,c,n,a].join("|")})),c()(this,"cachedOptionsListRequest",Object(s.memoize)((async(e,t)=>{const i=e.dataView.title,r=this.getRequestBody(e);return await this.http.fetch(`/api/kibana/controls/optionsList/${i}`,{body:JSON.stringify(r),signal:t,method:"POST"})}),this.optionsListCacheResolver)),c()(this,"getRequestBody",(e=>{var t;const i=this.data.query.timefilter.timefilter,{query:r,filters:n,dataView:s,timeRange:o,field:a,...c}=e,l=o?i.createFilter(s,o):void 0,u=[...null!=n?n:[],...l?[l]:[]];return{...c,filters:[Object(d.b)(s,null!=r?r:[],null!=u?u:[])],fieldName:a.name,fieldSpec:null===(t=a.toSpec)||void 0===t?void 0:t.call(a),textFieldName:a.textFieldName}})),c()(this,"runOptionsListRequest",(async(e,t)=>{try{return await this.cachedOptionsListRequest(e,t)}catch(t){return this.cachedOptionsListRequest.cache.delete(this.optionsListCacheResolver(e)),{}}})),({data:this.data,http:this.http}=e)}}const g={http:new r.PluginServiceProvider((({coreStart:e})=>{const{http:{fetch:t}}=e;return{fetch:t}})),data:new r.PluginServiceProvider((({startPlugins:e})=>{const{data:{query:t,search:i}}=e,{data:r}=e,n=async(e,t,i)=>{const{ignoreParentSettings:n,query:a,timeRange:c}=i;let{filters:l=[]}=i;const u=e.getFieldByName(t);if(!u)throw new Error("Field Missing Error");if(c){const t=r.query.timefilter.timefilter.createFilter(e,c);t&&(l=l.concat(t))}const d=await r.search.searchSource.create();d.setField("size",0),d.setField("index",e);const g=(e=>{const t={};return e&&(e.scripted?t.script={source:e.script,lang:e.lang}:t.field=e.name),{maxAgg:{max:t},minAgg:{min:t}}})(u);d.setField("aggs",g),d.setField("filter",null!=n&&n.ignoreFilters?[]:l),d.setField("query",null!=n&&n.ignoreQuery?void 0:a);const h=await Object(o.lastValueFrom)(d.fetch$()),m=Object(s.get)(h,"rawResponse.aggregations.minAgg.value",void 0),f=Object(s.get)(h,"rawResponse.aggregations.maxAgg.value",void 0);return{min:null===m?void 0:m,max:null===f?void 0:f}};return{fetchFieldRange:n,fetchFieldRange$:(e,t,i)=>Object(o.from)(n(e,t,i)),getDataView:r.dataViews.get,getDataView$:e=>Object(o.from)(r.dataViews.get(e)),query:t,searchSource:i.searchSource,timefilter:t.timefilter.timefilter}})),unifiedSearch:new r.PluginServiceProvider((({startPlugins:e})=>{const{unifiedSearch:{autocomplete:t}}=e;return{autocomplete:t}})),overlays:new r.PluginServiceProvider((({coreStart:e})=>{const{overlays:{openFlyout:t,openConfirm:i}}=e;return{openFlyout:t,openConfirm:i}})),dataViews:new r.PluginServiceProvider((({startPlugins:e})=>{const{dataViews:{get:t,getIdsWithTitle:i,getDefaultId:r}}=e;return{get:t,getDefaultId:r,getIdsWithTitle:i}})),settings:new r.PluginServiceProvider((({coreStart:e})=>({getDateFormat:()=>e.uiSettings.get("dateFormat","MMM D, YYYY @ HH:mm:ss.SSS"),getTimezone:()=>e.uiSettings.get("dateFormat:tz","Browser")}))),theme:new r.PluginServiceProvider((({coreStart:e})=>{const{theme:{theme$:t}}=e;return{theme$:t}})),optionsList:new r.PluginServiceProvider(((e,t)=>new options_list_OptionsListService(t)),["data","http"]),controls:new r.PluginServiceProvider(n.b)},h=new r.PluginServiceRegistry(g)}}]);