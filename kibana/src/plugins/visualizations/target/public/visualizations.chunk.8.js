(window.visualizations_bundle_jsonpfunction=window.visualizations_bundle_jsonpfunction||[]).push([[8,17],{190:function(t,e,i){"use strict";i.r(e),i.d(e,"VisualizeEmbeddable",(function(){return visualize_embeddable_VisualizeEmbeddable}));var s=i(0),n=i.n(s),r=i(6),a=i.n(r),o=i(2),d=i(9),u=i.n(d),l=i(17),h=i(10),c=i(87),p=i(15),v=i(12),b=i(89),f=i(4);const g=({error:t,application:e,viewMode:i,renderMode:s})=>{var n;const{management:r}=e.capabilities.navLinks,a=e.capabilities.management.kibana.indexPatterns,d=null===(n=e.capabilities.visualize)||void 0===n?void 0:n.save;return Object(f.jsx)(h.EuiEmptyPrompt,{iconType:"alert",iconColor:"danger","data-test-subj":"visualization-missed-data-view-error",actions:"edit"===s&&r&&a?Object(f.jsx)(b.a,{navigateToUrl:e.navigateToUrl},Object(f.jsx)("a",{href:e.getUrlForApp("management",{path:"/kibana/indexPatterns/create"}),"data-test-subj":"configuration-failure-reconfigure-indexpatterns"},o.i18n.translate("visualizations.missedDataView.dataViewReconfigure",{defaultMessage:"Recreate it in the data view management page"}))):null,body:Object(f.jsx)(u.a.Fragment,null,Object(f.jsx)("p",null,o.i18n.translate("visualizations.missedDataView.errorMessage",{defaultMessage:"Could not find the data view: {id}",values:{id:t.savedObjectId}})),"edit"===i&&"edit"!==s&&d?Object(f.jsx)("p",null,o.i18n.translate("visualizations.missedDataView.editInVisualizeEditor",{defaultMessage:"Edit in Visualize editor to fix the error"})):null)})};var m=i(93),j=i(16),y=i(1),O=i(33),x=i(8),C=i(54),T=i(55);class visualize_embeddable_VisualizeEmbeddable extends v.Embeddable{constructor(t,{vis:e,editPath:i,editUrl:s,indexPatterns:r,deps:d,capabilities:u},l,h,c){if(super(l,{defaultTitle:e.title,editPath:i,editApp:"visualize",editUrl:s,indexPatterns:r,visTypeName:e.type.name},c),n()(this,"handler",void 0),n()(this,"timefilter",void 0),n()(this,"timeRange",void 0),n()(this,"query",void 0),n()(this,"filters",void 0),n()(this,"searchSessionId",void 0),n()(this,"syncColors",void 0),n()(this,"syncTooltips",void 0),n()(this,"embeddableTitle",void 0),n()(this,"visCustomizations",void 0),n()(this,"subscriptions",[]),n()(this,"expression",void 0),n()(this,"vis",void 0),n()(this,"domNode",void 0),n()(this,"type",j.a),n()(this,"abortController",void 0),n()(this,"deps",void 0),n()(this,"inspectorAdapters",void 0),n()(this,"attributeService",void 0),n()(this,"getInspectorAdapters",(()=>{if(this.handler&&(!this.inspectorAdapters||Object.keys(this.inspectorAdapters).length))return this.handler.inspect()})),n()(this,"openInspector",(()=>{if(!this.handler)return;const t=this.handler.inspect();return t?this.deps.start().plugins.inspector.open(t,{title:this.getTitle()||o.i18n.translate("visualizations.embeddable.inspectorTitle",{defaultMessage:"Inspector"})}):void 0})),n()(this,"hasInspector",(()=>Boolean(this.getInspectorAdapters()))),n()(this,"onContainerLoading",(()=>{this.renderComplete.dispatchInProgress(),this.updateOutput({loading:!0,error:void 0})})),n()(this,"onContainerRender",(()=>{this.renderComplete.dispatchComplete(),this.updateOutput({loading:!1,error:void 0})})),n()(this,"onContainerError",(t=>{this.abortController&&this.abortController.abort(),this.renderComplete.dispatchError(),this.updateOutput({loading:!1,error:t})})),n()(this,"reload",(async()=>{await this.handleVisUpdate()})),n()(this,"handleVisUpdate",(async()=>{this.handleChanges(),await this.updateHandler()})),n()(this,"uiStateChangeHandler",(()=>{this.updateInput({...this.vis.uiState.toJSON()})})),n()(this,"inputIsRefType",(t=>{if(!this.attributeService)throw new Error("AttributeService must be defined for getInputAsRefType");return this.attributeService.inputIsRefType(t)})),n()(this,"getInputAsValueType",(async()=>{const t={savedVis:this.vis.serialize()};return delete t.savedVis.id,a.a.unset(t,"savedVis.title"),new Promise((e=>{e({...t})}))})),n()(this,"getInputAsRefType",(async()=>{const{savedObjectsClient:t,data:e,spaces:i,savedObjectsTaggingOss:s}=await this.deps.start().plugins,n=await Object(x.e)({savedObjectsClient:t,search:e.search,dataViews:e.dataViews,spaces:i,savedObjectsTagging:null==s?void 0:s.getTaggingApi()});if(!n)throw new Error("Error creating a saved vis object");if(!this.attributeService)throw new Error("AttributeService must be defined for getInputAsRefType");const r=this.getTitle()?this.getTitle():o.i18n.translate("visualizations.embeddable.placeholderTitle",{defaultMessage:"Placeholder Title"}),a={savedVis:n,vis:this.vis,title:this.vis.title};return this.attributeService.getInputAsRefType({id:this.id,attributes:a},{showSaveModal:!0,saveModalTitle:r})})),this.deps=d,this.timefilter=t,this.syncColors=this.input.syncColors,this.syncTooltips=this.input.syncTooltips,this.searchSessionId=this.input.searchSessionId,this.query=this.input.query,this.embeddableTitle=this.getTitle(),this.vis=e,this.vis.uiState.on("change",this.uiStateChangeHandler),this.vis.uiState.on("reload",this.reload),this.attributeService=h,this.attributeService){const t=!this.inputIsRefType(l),e=u.visualizeSave||t&&u.dashboardSave;this.updateOutput({...this.getOutput(),editable:e})}this.subscriptions.push(this.getInput$().subscribe((()=>{this.handleChanges()&&this.handler&&this.updateHandler()})));const p=this.vis.type.inspectorAdapters;p&&(this.inspectorAdapters="function"==typeof p?p():p)}getDescription(){return this.vis.description}transferCustomizationsToUiState(){const t={vis:this.input.vis,table:this.input.table};var e;t.vis||t.table?a.a.isEqual(t,this.visCustomizations)||(this.visCustomizations=t,this.vis.uiState.off("change",this.uiStateChangeHandler),this.vis.uiState.clearAllKeys(),t.vis&&(this.vis.uiState.set("vis",t.vis),(e=t,Object.keys(e)).forEach((e=>{this.vis.uiState.set(e,t[e])}))),t.table&&this.vis.uiState.set("table",t.table),this.vis.uiState.on("change",this.uiStateChangeHandler)):this.parent&&this.vis.uiState.clearAllKeys()}handleChanges(){this.transferCustomizationsToUiState();let t=!1;return a.a.isEqual(this.input.timeRange,this.timeRange)||(this.timeRange=a.a.cloneDeep(this.input.timeRange),t=!0),Object(c.c)(this.input.filters,this.filters)||(this.filters=this.input.filters,t=!0),a.a.isEqual(this.input.query,this.query)||(this.query=this.input.query,t=!0),this.searchSessionId!==this.input.searchSessionId&&(this.searchSessionId=this.input.searchSessionId,t=!0),this.syncColors!==this.input.syncColors&&(this.syncColors=this.input.syncColors,t=!0),this.syncTooltips!==this.input.syncTooltips&&(this.syncTooltips=this.input.syncTooltips,t=!0),this.embeddableTitle!==this.getTitle()&&(this.embeddableTitle=this.getTitle(),t=!0),this.vis.description&&this.domNode&&this.domNode.setAttribute("data-description",this.vis.description),t}async render(t){this.timeRange=a.a.cloneDeep(this.input.timeRange),this.transferCustomizationsToUiState();const e=document.createElement("div");e.className="visualize panel-content panel-content--fullWidth",t.appendChild(e),this.domNode=e,super.render(this.domNode),Object(l.render)(Object(f.jsx)(p.KibanaThemeProvider,{theme$:Object(y.m)().theme$},Object(f.jsx)("div",{className:"visChart__spinner"},Object(f.jsx)(h.EuiLoadingChart,{mono:!0,size:"l"}))),this.domNode);const i=Object(y.g)();this.handler=await i.loader(this.domNode,void 0,{renderMode:this.input.renderMode||"view",onRenderError:(t,e)=>{this.onContainerError(e)}}),this.subscriptions.push(this.handler.events$.subscribe((async t=>{if("bounds"!==t.name){if(!this.input.disableTriggers){const s=Object(r.get)(O.a,t.name,O.a.filter);let n;var e,i;n=s===O.a.applyFilter?{embeddable:this,timeFieldName:null===(e=this.vis.data.indexPattern)||void 0===e?void 0:e.timeFieldName,...t.data}:{embeddable:this,data:{timeFieldName:null===(i=this.vis.data.indexPattern)||void 0===i?void 0:i.timeFieldName,...t.data}},Object(y.q)().getTrigger(s).exec(n)}}else{const e=this.vis.data.aggs.aggs.find((t=>"geohash_grid"===Object(r.get)(t,"type.dslName")));(e&&e.params.precision!==t.data.precision||e&&!a.a.isEqual(e.params.boundingBox,t.data.boundingBox))&&(e.params.boundingBox=t.data.boundingBox,e.params.precision=t.data.precision,this.reload())}}))),this.vis.description&&e.setAttribute("data-description",this.vis.description),e.setAttribute("data-test-subj","visualizationLoader"),e.setAttribute("data-shared-item",""),this.subscriptions.push(this.handler.loading$.subscribe(this.onContainerLoading)),this.subscriptions.push(this.handler.render$.subscribe(this.onContainerRender)),this.subscriptions.push(this.getOutput$().subscribe((({error:t})=>{var e,i;t&&(t.original&&Object(x.g)(t.original)?Object(l.render)(Object(f.jsx)(g,{viewMode:null!==(e=this.input.viewMode)&&void 0!==e?e:v.ViewMode.VIEW,renderMode:null!==(i=this.input.renderMode)&&void 0!==i?i:"view",error:t.original,application:Object(y.b)()}),this.domNode):Object(l.render)(Object(f.jsx)(m.default,{error:t}),this.domNode))}))),await this.updateHandler()}destroy(){super.destroy(),this.subscriptions.forEach((t=>t.unsubscribe())),this.vis.uiState.off("change",this.uiStateChangeHandler),this.vis.uiState.off("reload",this.reload),this.handler&&(this.handler.destroy(),this.handler.getElement().remove())}async updateHandler(){var t,e;const i={...(null===(t=this.parent)||void 0===t?void 0:t.getInput().executionContext)||Object(y.f)().get(),child:{type:"visualization",name:this.vis.type.name,id:null!==(e=this.vis.id)&&void 0!==e?e:"new",description:this.vis.title||this.input.title||this.vis.type.name,url:this.output.editUrl}},s={searchContext:{timeRange:this.timeRange,query:this.input.query,filters:this.input.filters},variables:{embeddableTitle:this.getTitle()},searchSessionId:this.input.searchSessionId,syncColors:this.input.syncColors,syncTooltips:this.input.syncTooltips,uiState:this.vis.uiState,interactive:!this.input.disableTriggers,inspectorAdapters:this.inspectorAdapters,executionContext:i};this.abortController&&this.abortController.abort(),this.abortController=new AbortController;const n=this.abortController;try{this.expression=await(async(t,e)=>{const{savedSearchId:i,searchSource:s}=t.data,n=null==s?void 0:s.getField("query");let r=null==s?void 0:s.getField("filter");"function"==typeof r&&(r=r());const a=Object(C.buildExpressionFunction)("kibana",{}),o=Object(C.buildExpressionFunction)("kibana_context",{q:n&&Object(T.queryToAst)(n),filters:r&&Object(T.filtersToAst)(r),savedSearchId:i}),d=Object(C.buildExpression)([a,o]).toAst();if(!t.type.toExpressionAst)throw new Error("Visualization type definition should have toExpressionAst function defined");const u=await t.type.toExpressionAst(t,e);return d.chain.push(...u.chain),d})(this.vis,{timefilter:this.timefilter,timeRange:this.timeRange,abortSignal:this.abortController.signal})}catch(t){this.onContainerError(t)}this.handler&&!n.signal.aborted&&await this.handler.update(this.expression,s)}supportedTriggers(){var t,e,i;return null!==(t=null===(e=(i=this.vis.type).getSupportedTriggers)||void 0===e?void 0:e.call(i,this.vis.params))&&void 0!==t?t:[]}}},59:function(t,e,i){t.exports=i(38)(6)},60:function(t,e,i){t.exports=i(38)(3)},63:function(t,e,i){"use strict";i.d(e,"c",(function(){return h})),i.d(e,"a",(function(){return p})),i.d(e,"b",(function(){return c}));var s=i(9),n=i.n(s),r=i(10),a=i(4),o={name:"1azakc",styles:"text-align:center"},d=function(){var t=o;return Object(a.jsx)("div",{css:t},Object(a.jsx)(r.EuiLoadingSpinner,null))},u=i(60),l=i.n(u),h=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(a.jsx)(d,null);return n.a.forwardRef((function(i,n){return Object(a.jsx)(r.EuiErrorBoundary,null,Object(a.jsx)(s.Suspense,{fallback:e},Object(a.jsx)(t,l()({},i,{ref:n}))))}))},c=function(t){return t.metaKey||t.altKey||t.ctrlKey||t.shiftKey},p=function(t,e){var i=t;do{var s,n;if("a"===(null===(s=i)||void 0===s?void 0:s.tagName.toLowerCase()))return i;var r=null===(n=i)||void 0===n?void 0:n.parentElement;if(!r||r===document.body||r===e)break;i=r}while(parent||parent!==document.body||parent!==e)}},67:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(42),n=i(9),r=s.__importDefault(i(76));e.default=function(t,e){var i=n.useState(e),s=i[0],a=i[1];return r.default((function(){var e=t.subscribe(a);return function(){return e.unsubscribe()}}),[t]),s}},76:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(9),n="undefined"!=typeof window?s.useLayoutEffect:s.useEffect;e.default=n},89:function(t,e,i){"use strict";i.d(e,"a",(function(){return C}));var s=i(59),n=i.n(s),r=i(60),a=i.n(r),o=i(9),d=i.n(o),u=i(61),l=i.n(u),h=i(67),c=i.n(h),p=i(4),v=["children"],b=d.a.createContext(null),f=function(t){var e=t.children,i=n()(t,v);return Object(p.jsx)(b.Provider,{value:l()({},i)},e)},g=function(t){var e=t.children,i=t.coreStart.application,s=i.navigateToUrl,n=i.currentAppId$,r=c()(n,void 0);return Object(p.jsx)(b.Provider,{value:{navigateToUrl:s,currentAppId:r}},e)},m=i(63),j=["children","navigateToUrl","currentAppId"],y=function(t){var e=t.children,i=t.navigateToUrl,s=t.currentAppId,r=n()(t,j),d=Object(o.useRef)(null),u=Object(o.useCallback)((function(t){return function(t){var e=t.event,i=t.container,s=t.navigateToUrl;if(i&&t.currentAppId){var n=e.target,r=Object(m.a)(n,i);if(r){var a=r.href,o=""===r.target||"_self"===r.target,d=0===e.button;a&&o&&d&&!e.defaultPrevented&&!Object(m.b)(e)&&(e.preventDefault(),s(r.href))}}}({event:t,currentAppId:s,navigateToUrl:i,container:d.current})}),[s,i]);return Object(p.jsx)("div",a()({},r,{ref:d,onClick:u}),e)},O=function(t){return Object(p.jsx)(y,a()({},function(){var t=Object(o.useContext)(b);if(!t)throw new Error("RedirectAppLinksContext is missing.  Ensure your component or React root is wrapped with RedirectAppLinksProvider.");return t}(),t))},x=["children"],C=function(t){var e=t.children,i=n()(t,x),s=Object(p.jsx)(O,null,e);return function(t){return void 0!==t.coreStart}(i)?Object(p.jsx)(g,i,s):Object(p.jsx)(f,i,s)}},93:function(t,e,i){"use strict";i.r(e),i.d(e,"VisualizationError",(function(){return VisualizationError}));var s=i(10),n=i(9),r=i.n(n),a=i(4);class VisualizationError extends r.a.Component{render(){return Object(a.jsx)(s.EuiEmptyPrompt,{iconType:"alert",iconColor:"danger","data-test-subj":"visualization-error",body:Object(a.jsx)(s.EuiText,{size:"xs"},"string"==typeof this.props.error?this.props.error:this.props.error.message)})}componentDidMount(){this.afterRender()}componentDidUpdate(){this.afterRender()}afterRender(){this.props.onInit&&this.props.onInit()}}e.default=VisualizationError}}]);