!function(e){function t(t){for(var i,r,n=t[0],s=t[1],o=0,u=[];o<n.length;o++)r=n[o],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&u.push(a[r][0]),a[r]=0;for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i]);for(c&&c(t);u.length;)u.shift()()}var i={},a={3:0};function r(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.e=function(e){var t=[],i=a[e];if(0!==i)if(i)t.push(i[2]);else{var n=new Promise((function(t,r){i=a[e]=[t,r]}));t.push(i[2]=n);var s,o=document.createElement("script");o.charset="utf-8",o.timeout=120,r.nc&&o.setAttribute("nonce",r.nc),o.src=function(e){return r.p+"visualizations.chunk."+e+".js"}(e);var c=new Error;s=function(t){o.onerror=o.onload=null,clearTimeout(u);var i=a[e];if(0!==i){if(i){var r=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+r+": "+n+")",c.name="ChunkLoadError",c.type=r,c.request=n,i[1](c)}a[e]=void 0}};var u=setTimeout((function(){s({type:"timeout",target:o})}),12e4);o.onerror=o.onload=s,document.head.appendChild(o)}return Promise.all(t)},r.m=e,r.c=i,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(i,a,function(t){return e[t]}.bind(null,a));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.oe=function(e){throw console.error(e),e};var n=window.visualizations_bundle_jsonpfunction=window.visualizations_bundle_jsonpfunction||[],s=n.push.bind(n);n.push=t,n=n.slice();for(var o=0;o<n.length;o++)t(n[o]);var c=s;r(r.s=40)}([function(e,t,i){e.exports=i(38)(2)},function(e,t,i){"use strict";i.d(t,"p",(function(){return r})),i.d(t,"J",(function(){return n})),i.d(t,"m",(function(){return s})),i.d(t,"G",(function(){return o})),i.d(t,"c",(function(){return c})),i.d(t,"u",(function(){return u})),i.d(t,"i",(function(){return d})),i.d(t,"B",(function(){return l})),i.d(t,"h",(function(){return p})),i.d(t,"A",(function(){return g})),i.d(t,"b",(function(){return f})),i.d(t,"t",(function(){return v})),i.d(t,"e",(function(){return m})),i.d(t,"x",(function(){return h})),i.d(t,"j",(function(){return b})),i.d(t,"D",(function(){return S})),i.d(t,"o",(function(){return _})),i.d(t,"I",(function(){return y})),i.d(t,"d",(function(){return O})),i.d(t,"w",(function(){return j})),i.d(t,"n",(function(){return E})),i.d(t,"H",(function(){return T})),i.d(t,"k",(function(){return A})),i.d(t,"E",(function(){return w})),i.d(t,"r",(function(){return P})),i.d(t,"L",(function(){return x})),i.d(t,"g",(function(){return I})),i.d(t,"z",(function(){return D})),i.d(t,"q",(function(){return z})),i.d(t,"K",(function(){return L})),i.d(t,"a",(function(){return C})),i.d(t,"s",(function(){return N})),i.d(t,"C",(function(){return M})),i.d(t,"v",(function(){return R})),i.d(t,"f",(function(){return G})),i.d(t,"y",(function(){return B})),i.d(t,"l",(function(){return U})),i.d(t,"F",(function(){return F}));var a=i(3);const[r,n]=Object(a.createGetterSetter)("UISettings"),[s,o]=Object(a.createGetterSetter)("Theme"),[c,u]=Object(a.createGetterSetter)("Capabilities"),[d,l]=Object(a.createGetterSetter)("Http"),[p,g]=Object(a.createGetterSetter)("Field Formats"),[f,v]=Object(a.createGetterSetter)("Application"),[m,h]=Object(a.createGetterSetter)("Embeddable"),[b,S]=Object(a.createGetterSetter)("SavedObjects"),[_,y]=Object(a.createGetterSetter)("Types"),[O,j]=Object(a.createGetterSetter)("DocLinks"),[E,T]=Object(a.createGetterSetter)("TimeFilter"),[A,w]=Object(a.createGetterSetter)("Search"),[P,x]=Object(a.createGetterSetter)("UsageCollection",!1),[I,D]=Object(a.createGetterSetter)("Expressions"),[z,L]=Object(a.createGetterSetter)("UiActions"),[C,N]=Object(a.createGetterSetter)("AggConfigs"),[V,M]=Object(a.createGetterSetter)("Overlays"),[k,R]=Object(a.createGetterSetter)("Chrome"),[G,B]=Object(a.createGetterSetter)("ExecutionContext"),[U,F]=Object(a.createGetterSetter)("Spaces",!1)},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t,i){i.r(t);var a=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t,i){"use strict";i.r(t),i.d(t,"VISUALIZE_ENABLE_LABS_SETTING",(function(){return a})),i.d(t,"SAVED_OBJECTS_LIMIT_SETTING",(function(){return r})),i.d(t,"SAVED_OBJECTS_PER_PAGE_SETTING",(function(){return n})),i.d(t,"VISUALIZE_EMBEDDABLE_TYPE",(function(){return s})),i.d(t,"STATE_STORAGE_KEY",(function(){return o})),i.d(t,"GLOBAL_STATE_STORAGE_KEY",(function(){return c})),i.d(t,"VISUALIZE_APP_NAME",(function(){return u})),i.d(t,"VisualizeConstants",(function(){return d})),i.d(t,"LegendSize",(function(){return l})),i.d(t,"LegendSizeToPixels",(function(){return p})),i.d(t,"DEFAULT_LEGEND_SIZE",(function(){return g}));const a="visualize:enableLabs",r="savedObjects:listingLimit",n="savedObjects:perPage",s="visualization",o="_a",c="_g",u="visualize",d={VISUALIZE_BASE_PATH:"/app/visualize",LANDING_PAGE_PATH:"/",WIZARD_STEP_1_PAGE_PATH:"/new",WIZARD_STEP_2_PAGE_PATH:"/new/configure",CREATE_PATH:"/create",EDIT_PATH:"/edit",EDIT_BY_VALUE_PATH:"/edit_by_value",APP_ID:"visualize"};let l;!function(e){e.AUTO="auto",e.SMALL="small",e.MEDIUM="medium",e.LARGE="large",e.EXTRA_LARGE="xlarge"}(l||(l={}));const p={[l.AUTO]:void 0,[l.SMALL]:80,[l.MEDIUM]:130,[l.LARGE]:180,[l.EXTRA_LARGE]:230},g=l.MEDIUM},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t,i){i.r(t);var a=__kbnBundles__.get("plugin/data/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t,i){"use strict";i.d(t,"d",(function(){return h})),i.d(t,"h",(function(){return b})),i.d(t,"b",(function(){return S})),i.d(t,"a",(function(){return _})),i.d(t,"c",(function(){return y})),i.d(t,"e",(function(){return O})),i.d(t,"f",(function(){return j})),i.d(t,"g",(function(){return E}));var a=i(6),r=i.n(a),n=i(3),s=i(7),o=i(2);const c=o.i18n.translate("visualizations.overwriteRejectedDescription",{defaultMessage:"Overwrite confirmation was rejected"}),u=o.i18n.translate("visualizations.saveDuplicateRejectedDescription",{defaultMessage:"Save with duplicate title confirmation was rejected"});i(9);var d=i(10),l=i(15),p=i(4);function g(e="",t="",i="",a){return new Promise(((r,n)=>{const s=o.i18n.translate("visualizations.confirmModal.cancelButtonLabel",{defaultMessage:"Cancel"}),c=a.openModal(Object(l.toMountPoint)(Object(p.jsx)(d.EuiConfirmModal,{onCancel:()=>{c.close(),n()},onConfirm:()=>{c.close(),r(!0)},confirmButtonText:i,cancelButtonText:s,title:t},e)))}))}var f=i(23),v=i(13);const m="visualization";function h(e){return`/app/visualize#/edit/${e}`}function b(e){return`#/edit/${encodeURIComponent(e)}`}const S=e=>{const{id:t,title:i,description:a,visState:r,uiStateJSON:n,searchSourceFields:s}=e,o=s&&s.index?r.aggs||[]:r.aggs;return{id:t,title:i,type:r.type,description:a,params:r.params,uiState:JSON.parse(n||"{}"),data:{aggs:o,searchSource:s,savedSearchId:e.savedSearchId}}},_=e=>({id:e.id,title:e.title,description:e.description,visState:{title:e.title,type:e.type,aggs:e.data.aggs,params:e.params},uiStateJSON:JSON.stringify(e.uiState),searchSourceFields:e.data.searchSource,savedSearchId:e.data.savedSearchId});async function y(e,t,i,a,n){const s=t.getAliases().map((e=>{var t;return null===(t=e.appExtensions)||void 0===t?void 0:t.visualizations})).filter(Boolean),o=s.reduce(((e,t)=>t.docTypes.reduce(((i,a)=>(e[a]=t,e)),e)),{}),c=(e,...t)=>r()(s).map(e).concat(t).compact().flatten().uniq().value(),u={type:c("docTypes","visualization"),searchFields:c("searchFields","title^3","description"),search:i?`${i}*`:void 0,perPage:a,page:1,defaultSearchOperator:"AND",hasReference:n},{total:d,savedObjects:l}=await e.find(u);return{total:d,hits:l.map((e=>{const i=o[e.type];return i?{...i.toListItem(e),references:e.references}:function(e,{attributes:t,id:i,references:a,updatedAt:r}){var n,s,o;const c={id:i,references:a,url:b(i),updatedAt:r,...t};let u=t.typeName;if(t.visState)try{u=JSON.parse(String(t.visState)).type}catch(e){}return u&&e.get(u)?(c.type=e.get(u),c.savedObjectType="visualization",c.icon=null===(n=c.type)||void 0===n?void 0:n.icon,c.image=null===(s=c.type)||void 0===s?void 0:s.image,c.typeTitle=null===(o=c.type)||void 0===o?void 0:o.title,c.editUrl=`/edit/${i}`,c):(c.error="Unknown visualization type",c)}(t,e)}))}}async function O(e,t){"object"!=typeof t&&(t={id:t});const i=t.id||"",a={id:i,migrationVersion:t.migrationVersion,displayName:m,getEsType:()=>m,getDisplayName:()=>m,searchSource:t.searchSource?e.search.searchSource.createEmpty():void 0},o=(e=>({title:"",visState:e.type?{type:e.type}:null,uiStateJSON:"{}",description:"",savedSearchId:e.savedSearchId,version:1}))(t);if(!i)return Object.assign(a,o),a;const{saved_object:c,outcome:u,alias_target_id:d,alias_purpose:l}=await e.savedObjectsClient.resolve(m,i);if(!c._version)throw new n.SavedObjectNotFound(m,i||"");const p=r.a.cloneDeep(c.attributes);p.visState&&"string"==typeof p.visState&&(p.visState=JSON.parse(p.visState)),r.a.defaults(p,o),Object.assign(a,p),a.lastSavedTitle=a.title,a.sharingSavedObjectProps={aliasTargetId:d,outcome:u,aliasPurpose:l,errorJSON:"conflict"===u&&e.spaces?JSON.stringify({targetType:m,sourceId:i,targetSpace:(await e.spaces.getActiveSpace()).id}):void 0};const g=p.kibanaSavedObjectMeta||{};if(g.searchSourceJSON)try{let i=Object(s.parseSearchSourceJSON)(g.searchSourceJSON);t.searchSource?(i=Object(s.injectSearchSourceReferences)(i,c.references),a.searchSource=await e.search.searchSource.create(i)):a.searchSourceFields=i}catch(e){throw e}return c.references&&c.references.length>0&&Object(v.e)(a,c.references),e.savedObjectsTagging&&(a.tags=e.savedObjectsTagging.ui.getTagIdsFromReferences(c.references)),a.visState=await Object(f.a)(a.visState),a}async function j(e,{confirmOverwrite:t=!1,isTitleDuplicateConfirmed:i=!1,onTitleDuplicate:r,copyOnSave:n=!1},d){const l=e.id;n&&delete e.id;const p={visState:JSON.stringify(e.visState),title:e.title,uiStateJSON:e.uiStateJSON,description:e.description,savedSearchId:e.savedSearchId,version:e.version};let f=[];if(e.searchSource){const{searchSourceJSON:t,references:i}=e.searchSource.serialize();p.kibanaSavedObjectMeta={searchSourceJSON:t},f.push(...i)}if(e.searchSourceFields){const[t,i]=Object(s.extractSearchSourceReferences)(e.searchSourceFields),a=JSON.stringify(t);p.kibanaSavedObjectMeta={searchSourceJSON:a},f.push(...i)}d.savedObjectsTagging&&(f=d.savedObjectsTagging.ui.updateTagsReferences(f,e.tags||[]));const h=Object(v.b)({attributes:p,references:f});if(!h.references)throw new Error("References not returned from extractReferences");try{await async function(e,t,i,a){const{savedObjectsClient:r,overlays:n}=a;if(t)return!0;if(e.title===e.lastSavedTitle&&!e.copyOnSave)return!0;const s=await async function(e,t,i){if(i)return(await e.find({type:t,perPage:10,search:`"${i}"`,searchFields:["title"],fields:["title"]})).savedObjects.find((e=>e.get("title").toLowerCase()===i.toLowerCase()))}(r,e.getEsType(),e.title);return!s||s.id===e.id||(i?(i(),Promise.reject(new Error(u))):function(e,t){const i=o.i18n.translate("visualizations.confirmModal.saveDuplicateConfirmationMessage",{defaultMessage:"A {name} with the title '{title}' already exists. Would you like to save anyway?",values:{title:e.title,name:e.getDisplayName()}}),a=o.i18n.translate("visualizations.confirmModal.saveDuplicateButtonLabel",{defaultMessage:"Save {name}",values:{name:e.getDisplayName()}});try{return g(i,"",a,t)}catch{return Promise.reject(new Error(u))}}(e,n))}({...e,copyOnSave:n},i,r,d);const s={id:e.id,migrationVersion:e.migrationVersion,references:h.references},l=t?await async function(e,t,i,r){const{savedObjectsClient:n,overlays:s}=r;try{return await n.create(t.getEsType(),e,i)}catch(r){return 409===Object(a.get)(r,"res.status")?g(o.i18n.translate("visualizations.confirmModal.overwriteConfirmationMessage",{defaultMessage:"Are you sure you want to overwrite {title}?",values:{title:t.title}}),o.i18n.translate("visualizations.confirmModal.overwriteTitle",{defaultMessage:"Overwrite {name}?",values:{name:t.displayName}}),o.i18n.translate("visualizations.confirmModal.overwriteButtonLabel",{defaultMessage:"Overwrite"}),s).then((()=>n.create(t.getEsType(),e,{overwrite:!0,...i}))).catch((()=>Promise.reject(new Error(c)))):await Promise.reject(r)}}(p,e,s,d):await d.savedObjectsClient.create(m,h.attributes,{...s,overwrite:!0});return e.id=l.id,e.lastSavedTitle=e.title,e.id}catch(t){return e.id=l,t&&[c,u].includes(t.message)?"":Promise.reject(t)}}const E=e=>e instanceof n.SavedObjectNotFound&&"data view"===e.savedObjectType},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"c",(function(){return n})),i.d(t,"g",(function(){return s})),i.d(t,"b",(function(){return o})),i.d(t,"e",(function(){return c})),i.d(t,"d",(function(){return u})),i.d(t,"f",(function(){return d}));var a=i(2);const r=(e,t)=>{const i="number"==typeof e?((e,t)=>t.length>e?e:void 0)(e,t):((e,t)=>t.find((t=>t.id===e)))(e,t);if(void 0===i)throw new Error(a.i18n.translate("visualizations.function.findAccessorOrFail.error.accessor",{defaultMessage:"Provided column name or index is invalid: {accessor}",values:{accessor:e}}));return i},n=(e,t)=>{if(!d(e))return e;const i=e.accessor;return"number"==typeof i?t[i].id:i.id},s=(e,t)=>{e&&"string"==typeof e&&r(e,t)};function o(e){return"string"==typeof e?e:e.accessor}function c(e,t,i){var a;return"string"==typeof e?(null===(a=u(e,t))||void 0===a?void 0:a.meta.params)||i:e.format||i}const u=(e,t=[])=>{if("string"==typeof e)return t.find((({id:t})=>e===t));const i=e.accessor;return"number"==typeof i?t[i]:t.find((({id:e})=>i.id===e))};function d(e){return"string"!=typeof e&&void 0!==e}},function(e,t,i){i.r(t);var a=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"d",(function(){return s})),i.d(t,"c",(function(){return d})),i.d(t,"f",(function(){return l})),i.d(t,"b",(function(){return g})),i.d(t,"e",(function(){return f}));var a=i(25);const r=e=>"input_control_vis"===e,n=(e,t,i=[],n="control")=>{var s;r(e)&&(null!==(s=null==t?void 0:t.controls)&&void 0!==s?s:[]).forEach(((e,t)=>{e.indexPattern&&(e.indexPatternRefName=`${n}_${t}_index_pattern`,i.push({name:e.indexPatternRefName,type:a.DATA_VIEW_SAVED_OBJECT_TYPE,id:e.indexPattern}),delete e.indexPattern)}))},s=(e,t,i)=>{var a;r(e)&&(null!==(a=t.controls)&&void 0!==a?a:[]).forEach((e=>{if(!e.indexPatternRefName)return;const t=i.find((t=>t.name===e.indexPatternRefName));if(!t)throw new Error(`Could not find index pattern reference "${e.indexPatternRefName}"`);e.indexPattern=t.id,delete e.indexPatternRefName}))},o="_ref_name",c=e=>"metrics"===e,u=(e,t)=>{e(t,"index_pattern"),t.series.forEach((t=>{t.override_index_pattern&&e(t,"series_index_pattern")})),t.annotations&&t.annotations.forEach((t=>{e(t,"index_pattern")}))},d=(e,t,i=[],r="metrics")=>{let n=0;c(e)&&u(((e,t)=>{if(e[t]&&e[t].id){const s=`${r}_${n++}_index_pattern`;e[t+o]=s,i.push({name:s,type:a.DATA_VIEW_SAVED_OBJECT_TYPE,id:e[t].id}),delete e[t]}}),t)},l=(e,t,i)=>{c(e)&&u(((e,t)=>{const a=t+o;if(e[a]){const r=i.find((t=>t.name===e[a]));r&&(e[t]={id:r.id}),delete e[a]}}),t)};var p=i(7);function g({attributes:e,references:t=[]}){const i={...e},a=[...t];if(i.searchSourceFields){const[e,t]=Object(p.extractSearchSourceReferences)(i.searchSourceFields);i.searchSourceFields=e,t.forEach((e=>a.push(e)))}if(i.savedSearchId&&(a.push({name:"search_0",type:"search",id:String(i.savedSearchId)}),delete i.savedSearchId,i.savedSearchRefName="search_0"),i.visState){const e=JSON.parse(String(i.visState));e.type&&e.params&&(n(e.type,e.params,a),d(e.type,e.params,a)),i.visState=JSON.stringify(e)}return{references:a,attributes:i}}function f(e,t){var i;if(e.searchSourceFields&&(e.searchSourceFields=Object(p.injectSearchSourceReferences)(e.searchSourceFields,t)),e.savedSearchRefName){const i=t.find((t=>t.name===e.savedSearchRefName));if(!i)throw new Error(`Could not find saved search reference "${e.savedSearchRefName}"`);e.savedSearchId=i.id,delete e.savedSearchRefName}const{type:a,params:r}=null!==(i=e.visState)&&void 0!==i?i:{};a&&r&&(s(a,r,t),l(a,r,t))}},function(e,t){e.exports=__kbnSharedDeps__.KbnI18nReact},function(e,t,i){i.r(t);var a=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t,i){"use strict";var a=i(5);i.d(t,"a",(function(){return a.VISUALIZE_EMBEDDABLE_TYPE}))},function(e,t){e.exports=__kbnSharedDeps__.ReactDom},function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return r})),i.d(t,"a",(function(){return n}));const a="VISUALIZE_EDITOR_TRIGGER",r={id:a,title:"Convert legacy visualizations to Lens",description:"Triggered when user navigates from a legacy visualization to Lens."},n="ACTION_CONVERT_TO_LENS"},function(e,t){e.exports=__kbnSharedDeps__.RxjsOperators},function(e,t,i){"use strict";let a;i.d(t,"a",(function(){return a})),function(e){e.PROMOTED="promoted",e.TOOLS="tools",e.AGGBASED="aggbased"}(a||(a={}))},function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var a=i(2),r=i(11);const n=()=>({name:"visdimension",help:a.i18n.translate("visualizations.function.visDimension.help",{defaultMessage:"Generates visConfig dimension object"}),type:"vis_dimension",inputTypes:["datatable"],args:{accessor:{types:["string","number"],aliases:["_"],help:a.i18n.translate("visualizations.function.visDimension.accessor.help",{defaultMessage:"Column in your dataset to use (either column index or column name)"})},format:{types:["string"],help:a.i18n.translate("visualizations.function.visDimension.format.help",{defaultMessage:"Format"})},formatParams:{types:["string"],help:a.i18n.translate("visualizations.function.visDimension.formatParams.help",{defaultMessage:"Format params"})}},fn:(e,t)=>{const i=Object(r.a)(t.accessor,e.columns),a=("number"==typeof i?e.columns[i]:i).meta.params;return{type:"vis_dimension",accessor:i,format:t.format||t.formatParams||!a?{id:t.format||"string",params:JSON.parse(t.formatParams||"{}")}:a}}})},function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var a=i(2);const r=()=>({name:"range",help:a.i18n.translate("visualizations.function.range.help",{defaultMessage:"Generates range object"}),type:"range",args:{from:{types:["number"],help:a.i18n.translate("visualizations.function.range.from.help",{defaultMessage:"Start of range"}),required:!0},to:{types:["number"],help:a.i18n.translate("visualizations.function.range.to.help",{defaultMessage:"End of range"}),required:!0}},fn:(e,t)=>({type:"range",from:t.from,to:t.to})})},function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var a=i(29),r=i(6),n=i.n(r);const s=e=>{if(!e)return e;const t=n.a.cloneDeep(e);return function(e){e.aggs&&e.aggs.forEach((e=>{"terms"===e.type&&e.params&&"_term"===e.params.orderBy&&(e.params.orderBy="_key")}))}(t),function(e){"boolean"==typeof n.a.get(e,"params.showMeticsAtAllLevels")&&(e.params.showMetricsAtAllLevels=e.params.showMeticsAtAllLevels,delete e.params.showMeticsAtAllLevels)}(t),function(e){e.aggs&&e.aggs.forEach((e=>{"date_histogram"===e.type&&e.params&&"auto"!==e.params.interval&&void 0===e.params.scaleMetricValues&&(e.params.scaleMetricValues=!0)}))}(t),e.params&&["line","area","histogram"].includes(e.params.type)&&function(e){if(e.params.seriesParams)return;const t=e.params.setYExtents,i=e.params.defaultYExtents,a=["stacked","overlap"].includes(e.params.mode)?"normal":e.params.mode||"normal";e.params.valueAxes&&e.params.valueAxes.length||(e.params.valueAxes=[{id:"ValueAxis-1",name:"LeftAxis-1",type:"value",position:"left",show:!0,style:{},scale:{type:"linear",mode:"normal"},labels:{show:!0,rotate:0,filter:!1,truncate:100},title:{text:"Count"}}]),e.params.valueAxes[0].scale={...e.params.valueAxes[0].scale,type:e.params.scale||"linear",setYExtents:e.params.setYExtents||!1,defaultYExtents:e.params.defaultYExtents||!1,boundsMargin:i?e.params.boundsMargin:0,min:t?e.params.yAxis.min:void 0,max:t?e.params.yAxis.max:void 0,mode:a};const r=e.params.smoothLines?"cardinal":e.params.interpolate,n=["stacked","percentage","wiggle","silhouette"].includes(e.params.mode);e.params.seriesParams=[{show:!0,type:e.params.type||"line",mode:n?"stacked":"normal",interpolate:r,drawLinesBetweenPoints:e.params.drawLinesBetweenPoints,showCircles:e.params.showCircles,radiusRatio:e.params.radiusRatio,data:{label:"Count",id:"1"},lineWidth:2,valueAxis:"ValueAxis-1"}]}(t),e.params&&"metrics"===e.type&&function(e){e.params.series&&e.params.series.forEach((e=>{const t=e.id,i=e.metrics;isNaN(t)||(e.id=`x${t}`),null==i||i.forEach((e=>{const t=e.id;isNaN(t)||(e.id=`x${t}`)}))}))}(t),"gauge"===e.type&&e.fontSize&&(delete t.fontSize,Object(a.set)(t,"gauge.style.fontSize",e.fontSize)),["gauge","metric"].includes(e.type)&&"Metric"===n.a.get(e.params,"gauge.gaugeType",null)?(t.type="metric",t.params.addLegend=!1,t.params.type="metric",t.params.metric=t.params.gauge,delete t.params.gauge,delete t.params.metric.gaugeType,delete t.params.metric.gaugeStyle,delete t.params.metric.backStyle,delete t.params.metric.scale,delete t.params.metric.type,delete t.params.metric.orientation,delete t.params.metric.verticalSplit,delete t.params.metric.autoExtend,t.params.metric.metricColorMode=t.params.metric.gaugeColorMode,delete t.params.metric.gaugeColorMode):"metric"===e.type&&"Metric"!==n.a.get(e.params,"gauge.gaugeType","Metric")&&(t.type="gauge",t.params.type="gauge"),function(e){const t=void 0!==n.a.get(e,"params.valueAxes[0].labels.overwriteColor");if("heatmap"===e.type&&e.params&&!t){const t=n.a.get(e,"params.valueAxes[0].labels.show",!1),i=n.a.get(e,"params.valueAxes[0].labels.color","#555");Object(a.set)(e,"params.valueAxes[0].labels.overwriteColor",t&&"#555"!==i)}}(t),t}},function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var a=i(9),r=i(17),n=i.n(r),s=i(10),o=i(14),c=i(15),u=i(1),d=i(4);const l=Object(a.lazy)((()=>i.e(5).then(i.bind(null,188))));function p({editorParams:e=[],onClose:t,originatingApp:i,outsideVisualizeApp:r,showAggsSelection:p,selectedVisType:g}={}){const f=document.createElement("div");let v=!1;const m=()=>{v||(n.a.unmountComponentAtNode(f),document.body.removeChild(f),t&&t(),v=!0)};document.body.appendChild(f);const h=Object(d.jsx)(c.KibanaThemeProvider,{theme$:Object(u.m)().theme$},Object(d.jsx)(o.I18nProvider,null,Object(d.jsx)(a.Suspense,{fallback:Object(d.jsx)(s.EuiPortal,null,Object(d.jsx)(s.EuiProgress,{size:"xs",position:"fixed"}))},Object(d.jsx)(l,{isOpen:!0,onClose:m,originatingApp:i,stateTransfer:Object(u.e)().getStateTransfer(),outsideVisualizeApp:r,editorParams:e,visTypesRegistry:Object(u.o)(),addBasePath:Object(u.i)().basePath.prepend,uiSettings:Object(u.p)(),savedObjects:Object(u.j)(),usageCollection:Object(u.r)(),application:Object(u.b)(),docLinks:Object(u.d)(),showAggsSelection:p,selectedVisType:g}))));return n.a.render(h,f),()=>m()}},function(e,t,i){i.r(t);var a=__kbnBundles__.get("plugin/dataViews/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t,i){"use strict";i.r(t);var a=i(22);i.d(t,"range",(function(){return a.a}));var r=i(21);i.d(t,"visDimension",(function(){return r.a}))},function(e,t,i){"use strict";i.r(t),i.d(t,"prepareLogTable",(function(){return s})),i.d(t,"findAccessorOrFail",(function(){return o.a})),i.d(t,"getAccessorByDimension",(function(){return o.c})),i.d(t,"validateAccessor",(function(){return o.g})),i.d(t,"getColumnByAccessor",(function(){return o.d})),i.d(t,"isVisDimension",(function(){return o.f})),i.d(t,"getAccessor",(function(){return o.b})),i.d(t,"getFormatByAccessor",(function(){return o.e}));const a=(e,t,i)=>"string"==typeof i?i===e.id:"number"==typeof i?i===t:i.id===e.id,r=e=>"string"==typeof e?e:e.accessor,n=(e,t,i)=>{for(const s of i){var n;if(null!==(n=s[0])&&void 0!==n&&n.find((i=>a(e,t,r(i)))))return s[1]}},s=(e,t,i=!1)=>({...e,columns:e.columns.map(((e,i)=>({...e,meta:{...e.meta,dimensionName:n(e,i,t)}}))).filter((e=>!i||e.meta.dimensionName))});var o=i(11)},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));const a=async(e,t={})=>{await i.e(10).then(i.t.bind(null,52,7));const{Vis:a}=await i.e(15).then(i.bind(null,56)),r=new a(e,t);return await r.setState(t),r}},function(e,t){e.exports=__kbnSharedDeps__.SaferLodashSet},function(e,t){e.exports=__kbnSharedDeps__.Classnames},function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t,i){i.r(t);var a=__kbnBundles__.get("plugin/savedObjects/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var a=i(37),r=i(7),n=i(12);const s={applyFilter:r.APPLY_FILTER_TRIGGER,brush:n.SELECT_RANGE_TRIGGER,filter:n.VALUE_CLICK_TRIGGER,tableRowContextMenuClick:a.ROW_CLICK_TRIGGER}},function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return VisualizeLocatorDefinition}));var a=i(0),r=i.n(a);const n="VISUALIZE_APP_LOCATOR";class VisualizeLocatorDefinition{constructor(){r()(this,"id",n)}async getLocation(e){const{getLocation:t}=await Promise.all([i.e(0),i.e(12)]).then(i.bind(null,50));return t(e)}}},function(e,t){e.exports=__kbnSharedDeps__.History},function(e,t,i){i.r(t);var a=__kbnBundles__.get("entry/core/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t,i){i.r(t);var a=__kbnBundles__.get("plugin/uiActions/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,i){"use strict";i.r(t),i.d(t,"plugin",(function(){return te})),i.d(t,"TypesService",(function(){return types_service_TypesService})),i.d(t,"VISUALIZE_EMBEDDABLE_TYPE",(function(){return k.a})),i.d(t,"VIS_EVENT_TO_TRIGGER",(function(){return H.a})),i.d(t,"VisualizationContainer",(function(){return q})),i.d(t,"getVisSchemas",(function(){return Q})),i.d(t,"VisGroups",(function(){return j.a})),i.d(t,"updateOldState",(function(){return X.a})),i.d(t,"VISUALIZE_ENABLE_LABS_SETTING",(function(){return F.VISUALIZE_ENABLE_LABS_SETTING})),i.d(t,"SAVED_OBJECTS_LIMIT_SETTING",(function(){return F.SAVED_OBJECTS_LIMIT_SETTING})),i.d(t,"SAVED_OBJECTS_PER_PAGE_SETTING",(function(){return F.SAVED_OBJECTS_PER_PAGE_SETTING})),i.d(t,"LegendSize",(function(){return F.LegendSize})),i.d(t,"LegendSizeToPixels",(function(){return F.LegendSizeToPixels})),i.d(t,"DEFAULT_LEGEND_SIZE",(function(){return F.DEFAULT_LEGEND_SIZE})),i.d(t,"prepareLogTable",(function(){return ee.prepareLogTable})),i.d(t,"urlFor",(function(){return B.h})),i.d(t,"getFullPath",(function(){return B.d})),i.d(t,"VISUALIZE_EDITOR_TRIGGER",(function(){return l.b})),i.d(t,"ACTION_CONVERT_TO_LENS",(function(){return l.a}));var a=i(0),r=i.n(a),n=i(2),s=i(19),o=i(35),c=i(31),u=i(36),d=i(3),l=i(18);const p="default";var g=i(24),f=i(34);const v=()=>({name:"xydimension",help:n.i18n.translate("visualizations.function.xydimension.help",{defaultMessage:"Generates xy dimension object"}),type:"xy_dimension",args:{visDimension:{types:["vis_dimension"],help:n.i18n.translate("visualizations.function.xyDimension.visDimension.help",{defaultMessage:"Dimension object config"}),required:!0},label:{types:["string"],help:n.i18n.translate("visualizations.function.xyDimension.label.help",{defaultMessage:"Label"})},aggType:{types:["string"],help:n.i18n.translate("visualizations.function.xyDimension.aggType.help",{defaultMessage:"Aggregation type"})},params:{types:["string"],default:'"{}"',help:n.i18n.translate("visualizations.function.xyDimension.params.help",{defaultMessage:"Params"})}},fn:(e,t)=>({type:"xy_dimension",label:t.label,aggType:t.aggType,params:JSON.parse(t.params),accessor:t.visDimension.accessor,format:t.visDimension.format})});var m=i(21),h=i(22);let b=[];const S=[],_={get:()=>[...b],add:e=>{if(b.find((t=>t.name===e.name)))throw new Error(`${e.name} already registered`);S.some((t=>t===e.name))||b.push(e)},remove:e=>{b.find((t=>t.name===e))?b=b.filter((t=>t.name!==e)):S.push(e)}};var y=i(6),O=i.n(y),j=i(20),E=i(7);let T,A;T=E.AggGroupNames.Buckets,A=E.AggGroupNames.Metrics;class schemas_Schemas{constructor(e){r()(this,"all",[]),r()(this,T,[]),r()(this,A,[]),O()(e||[]).chain().map((e=>{if(!e.name)throw new Error("all schema must have a unique name");return"split"===e.name&&(e.params=[{name:"row",default:!0}]),Object(y.defaults)(e,{min:0,max:1/0,group:E.AggGroupNames.Buckets,title:e.name,aggFilter:"*",params:[]}),e})).tap((e=>{this.all=e})).groupBy("group").forOwn(((e,t)=>{this[t]=e})).commit()}}const w={showTimePicker:!0,showQueryBar:!0,showFilterBar:!0,showIndexSelection:!0,showQueryInput:!0,hierarchicalData:!1};class base_vis_type_BaseVisType{constructor(e){var t,i,a,n,s,o,c,u,d,l,p;if(r()(this,"name",void 0),r()(this,"title",void 0),r()(this,"description",void 0),r()(this,"note",void 0),r()(this,"getSupportedTriggers",void 0),r()(this,"navigateToLens",void 0),r()(this,"icon",void 0),r()(this,"image",void 0),r()(this,"stage",void 0),r()(this,"isDeprecated",void 0),r()(this,"group",void 0),r()(this,"titleInWizard",void 0),r()(this,"options",void 0),r()(this,"visConfig",void 0),r()(this,"editorConfig",void 0),r()(this,"hidden",void 0),r()(this,"requiresSearch",void 0),r()(this,"hierarchicalData",void 0),r()(this,"setup",void 0),r()(this,"getUsedIndexPattern",void 0),r()(this,"inspectorAdapters",void 0),r()(this,"toExpressionAst",void 0),r()(this,"getInfoMessage",void 0),r()(this,"updateVisTypeOnParamsChange",void 0),r()(this,"schemas",void 0),!e.icon&&!e.image)throw new Error("vis_type must define its icon or image");this.name=e.name,this.description=null!==(t=e.description)&&void 0!==t?t:"",this.note=null!==(i=e.note)&&void 0!==i?i:"",this.getSupportedTriggers=e.getSupportedTriggers,this.navigateToLens=e.navigateToLens,this.title=e.title,this.icon=e.icon,this.image=e.image,this.visConfig=Object(y.defaultsDeep)({},e.visConfig,{defaults:{}}),this.editorConfig=Object(y.defaultsDeep)({},e.editorConfig,{collections:{}}),this.options=Object(y.defaultsDeep)({},e.options,w),this.stage=null!==(a=e.stage)&&void 0!==a?a:"production",this.isDeprecated=null!==(n=e.isDeprecated)&&void 0!==n&&n,this.group=null!==(s=e.group)&&void 0!==s?s:j.a.AGGBASED,this.titleInWizard=null!==(o=e.titleInWizard)&&void 0!==o?o:"",this.hidden=null!==(c=e.hidden)&&void 0!==c&&c,this.requiresSearch=null!==(u=e.requiresSearch)&&void 0!==u&&u,this.setup=e.setup,this.hierarchicalData=null!==(d=e.hierarchicalData)&&void 0!==d&&d,this.getUsedIndexPattern=e.getUsedIndexPattern,this.inspectorAdapters=e.inspectorAdapters,this.toExpressionAst=e.toExpressionAst,this.getInfoMessage=e.getInfoMessage,this.updateVisTypeOnParamsChange=e.updateVisTypeOnParamsChange,this.schemas=new schemas_Schemas(null!==(l=null===(p=this.editorConfig)||void 0===p?void 0:p.schemas)&&void 0!==l?l:[])}}class types_service_TypesService{constructor(){r()(this,"types",{}),r()(this,"unregisteredHiddenTypes",[])}registerVisualization(e){if(this.unregisteredHiddenTypes.includes(e.name)&&(e.hidden=!0),this.types[e.name])throw new Error("type already exists!");this.types[e.name]=e}setup(){return{createBaseVisualization:e=>{const t=new base_vis_type_BaseVisType(e);this.registerVisualization(t)},registerAlias:_.add,hideTypes:e=>{e.forEach((e=>{this.types[e]?this.types[e].hidden=!0:this.unregisteredHiddenTypes.push(e)}))}}}start(){return{get:e=>this.types[e],all:()=>[...Object.values(this.types)],getAliases:_.get,unRegisterAlias:_.remove,getByGroup:e=>Object.values(this.types).filter((t=>t.group===e))}}stop(){}}var P=i(9),x=i(17),I=i.n(x),D=i(15),z=i(12),L=i(14),C=i(10),N=i(1),V=i(4);function M({title:e}){const t=Object(N.d)().links.management.visualizationSettings;return Object(V.jsx)(L.I18nProvider,null,Object(V.jsx)(C.EuiEmptyPrompt,{titleSize:"xs",title:Object(V.jsx)("h6",null,Object(V.jsx)(L.FormattedMessage,{id:"visualizations.disabledLabVisualizationTitle",defaultMessage:"{title} is a lab visualization.",values:{title:e}})),iconType:"beaker",body:Object(V.jsx)(L.FormattedMessage,{id:"visualizations.disabledLabVisualizationMessage",defaultMessage:"Please turn on lab-mode in the advanced settings to see lab visualizations."}),actions:Object(V.jsx)(C.EuiLink,{target:"_blank",external:!0,href:t},Object(V.jsx)(L.FormattedMessage,{id:"visualizations.disabledLabVisualizationLink",defaultMessage:"Read documentation"}))}))}var k=i(16);class disabled_lab_embeddable_DisabledLabEmbeddable extends z.Embeddable{constructor(e,t){super(t,{title:e}),r()(this,"domNode",void 0),r()(this,"type",k.a),this.title=e}reload(){}render(e){this.title&&(this.domNode=e,I.a.render(Object(V.jsx)(D.KibanaThemeProvider,{theme$:Object(N.m)().theme$},Object(V.jsx)(M,{title:this.title})),e))}destroy(){this.domNode&&I.a.unmountComponentAtNode(this.domNode)}}var R=i(32),G=i(28),B=i(8),U=i(13),F=i(5);const J=e=>async(t,a,r,n)=>{try{var s;const o=t.id,c=o?Object(B.h)(o):"#/edit_by_value",u=o?Object(N.i)().basePath.prepend(`/app/visualize${Object(B.h)(o)}`):"";if(!Object(N.p)().get(F.VISUALIZE_ENABLE_LABS_SETTING)&&"experimental"===t.type.stage)return new disabled_lab_embeddable_DisabledLabEmbeddable(t.title,a);let d=[];if(t.type.getUsedIndexPattern)try{d=await t.type.getUsedIndexPattern(t.params)}catch(e){}else t.data.indexPattern&&(d=[t.data.indexPattern]);const l={visualizeSave:Boolean(Object(N.c)().visualize.save),dashboardSave:Boolean(null===(s=Object(N.c)().dashboard)||void 0===s?void 0:s.showWriteControls)};return(async(...e)=>{const[{VisualizeEmbeddable:t}]=await Promise.all([Promise.all([i.e(0),i.e(8)]).then(i.bind(null,190)),i.e(9).then(i.t.bind(null,184,7))]);return new t(...e)})(Object(N.n)(),{vis:t,indexPatterns:d,editPath:c,editUrl:u,deps:e,capabilities:l},a,r,n)}catch(e){return console.error(e),new z.ErrorEmbeddable(e,a,n)}};class visualize_embeddable_factory_VisualizeEmbeddableFactory{constructor(e){r()(this,"type",k.a),r()(this,"attributeService",void 0),r()(this,"savedObjectMetaData",{name:n.i18n.translate("visualizations.savedObjectName",{defaultMessage:"Visualization"}),includeFields:["visState"],type:"visualization",getIconForSavedObject:e=>{var t;return(null===(t=Object(N.o)().get(JSON.parse(e.attributes.visState).type))||void 0===t?void 0:t.icon)||"visualizeApp"},getTooltipForSavedObject:e=>{var t;return`${e.attributes.title} (${null===(t=Object(N.o)().get(JSON.parse(e.attributes.visState).type))||void 0===t?void 0:t.title})`},showSavedObject:e=>{try{const t=JSON.parse(e.attributes.visState).type,i=Object(N.o)().get(t);return!(!i||!Object(N.p)().get(F.VISUALIZE_ENABLE_LABS_SETTING)&&"experimental"===i.stage)}catch{return!1}},getSavedObjectSubType:e=>JSON.parse(e.attributes.visState).type}),this.deps=e}async isEditable(){return Object(N.c)().visualize.save}getDisplayName(){return n.i18n.translate("visualizations.displayName",{defaultMessage:"Visualization"})}async getCurrentAppId(){return await this.deps.start().core.application.currentAppId$.pipe(Object(s.first)()).toPromise()}async getAttributeService(){return this.attributeService||(this.attributeService=await this.deps.start().plugins.embeddable.getAttributeService(this.type,{saveMethod:this.saveMethod.bind(this),checkForDuplicateTitle:this.checkTitle.bind(this)})),this.attributeService}async createFromSavedObject(e,t,i){const a=await this.deps.start();try{var r,s;const c=await Object(B.e)({savedObjectsClient:a.core.savedObjects.client,search:a.plugins.data.search,dataViews:a.plugins.data.dataViews,spaces:a.plugins.spaces,savedObjectsTagging:null===(r=a.plugins.savedObjectsTaggingOss)||void 0===r?void 0:r.getTaggingApi()},e);var o;if("conflict"===(null===(s=c.sharingSavedObjectProps)||void 0===s?void 0:s.outcome))return new z.ErrorEmbeddable(n.i18n.translate("visualizations.embeddable.legacyURLConflict.errorMessage",{defaultMessage:"This visualization has the same URL as a legacy alias. Disable the alias to resolve this error : {json}",values:{json:null===(o=c.sharingSavedObjectProps)||void 0===o?void 0:o.errorJSON}}),t,i);const u=Object(B.b)(c),d=await Object(G.a)(c.visState.type,u);return J(this.deps)(d,t,await this.getAttributeService(),i)}catch(e){return console.error(e),new z.ErrorEmbeddable(e,t,i)}}async create(e,t){if(e.savedVis){const i=e.savedVis,a=await Object(G.a)(i.type,i);return J(this.deps)(a,e,await this.getAttributeService(),t)}Object(g.a)({originatingApp:await this.getCurrentAppId(),outsideVisualizeApp:!0})}async saveMethod(e){try{var t,i;const{title:a,savedVis:r}=e,s=e.vis;if(!r)throw new Error("No Saved Vis");const o={confirmOverwrite:!1,returnToOrigin:!0,isTitleDuplicateConfirmed:!0,copyOnSave:!1};r.title=a,r.description="",r.searchSourceFields=null==s||null===(t=s.data.searchSource)||void 0===t?void 0:t.getSerializedFields(),r.savedSearchId=null==s?void 0:s.data.savedSearchId;const c=s.serialize(),{params:u,data:d}=c;r.visState={title:a,type:c.type,params:u,aggs:d.aggs},s&&(r.uiStateJSON=null==s?void 0:s.uiState.toString());const{core:l,plugins:p}=await this.deps.start(),g=await Object(B.f)(r,o,{savedObjectsClient:l.savedObjects.client,overlays:l.overlays,savedObjectsTagging:null===(i=p.savedObjectsTaggingOss)||void 0===i?void 0:i.getTaggingApi()});if(!g||""===g)throw new Error(n.i18n.translate("visualizations.savingVisualizationFailed.errorMsg",{defaultMessage:"Saving a visualization failed"}));return l.chrome.recentlyAccessed.add(Object(B.d)(g),r.title,String(g)),{id:g}}catch(e){throw e}}async checkTitle(e){const t=await this.deps.start().core.savedObjects.client,i=await this.deps.start().core.overlays;return Object(R.checkForDuplicateTitle)({title:e.newTitle,copyOnSave:!1,lastSavedTitle:"",getEsType:()=>this.type,getDisplayName:this.getDisplayName||(()=>this.type)},e.isTitleDuplicateConfirmed,e.onTitleDuplicate,{savedObjectsClient:t,overlays:i})}inject(e,t){var i,a;let r=e;const{type:n,params:s}=null!==(i=r.savedVis)&&void 0!==i?i:{};if(n&&s&&(Object(U.d)(n,s,t),Object(U.f)(n,s,t)),null!==(a=r.savedVis)&&void 0!==a&&a.data.searchSource){var o,c;let e=null===(o=r.savedVis)||void 0===o?void 0:o.data.searchSource;"indexRefName"in r.savedVis.data.searchSource||(e=Object(E.extractSearchSourceReferences)(e)[0]);const i=Object(E.injectSearchSourceReferences)(e,t);r={...r,savedVis:{...r.savedVis,data:{...r.savedVis.data,searchSource:i,savedSearchId:null===(c=t.find((e=>"search_0"===e.name)))||void 0===c?void 0:c.id}}}}return r}extract(e){var t,i,a;let r=e;const n=[];if(null!==(t=r.savedVis)&&void 0!==t&&t.data.savedSearchId&&n.push({name:"search_0",type:"search",id:String(r.savedVis.data.savedSearchId)}),null!==(i=r.savedVis)&&void 0!==i&&i.data.searchSource){const[e,t]=Object(E.extractSearchSourceReferences)(r.savedVis.data.searchSource);n.push(...t),r={...r,savedVis:{...r.savedVis,data:{...r.savedVis.data,searchSource:e,savedSearchId:void 0}}}}const{type:s,params:o}=null!==(a=r.savedVis)&&void 0!==a?a:{};return s&&o&&(Object(U.a)(s,o,n,`control_${r.id}`),Object(U.c)(s,o,n,`metrics_${r.id}`)),{state:r,references:n}}}var H=i(33);class plugin_VisualizationsPlugin{constructor(e){r()(this,"types",new types_service_TypesService),r()(this,"appStateUpdater",new c.BehaviorSubject((()=>({})))),r()(this,"stopUrlTracking",void 0),r()(this,"currentHistory",void 0),r()(this,"isLinkedToOriginatingApp",void 0),this.initializerContext=e}setup(e,{expressions:t,embeddable:a,usageCollection:r,data:c,home:g,urlForwarding:b,share:S,uiActions:_}){const{appMounted:y,appUnMounted:O,stop:j,setActiveUrl:E,restorePreviousUrl:T}=Object(d.createKbnUrlTracker)({baseUrl:e.http.basePath.prepend(F.VisualizeConstants.VISUALIZE_BASE_PATH),defaultSubUrl:"#/",storageKey:`lastUrl:${e.http.basePath.get()}:visualize`,navLinkUpdater$:this.appStateUpdater,toastNotifications:e.notifications.toasts,stateParams:[{kbnUrlKey:"_g",stateUpdate$:c.query.state$.pipe(Object(s.filter)((({changes:e})=>!!(e.globalFilters||e.time||e.refreshInterval))),Object(s.map)((({state:e})=>({...e,filters:c.query.filterManager.getGlobalFilters()}))))}],getHistory:()=>this.currentHistory,onBeforeNavLinkSaved:t=>{var i;return null!==(i=this.isLinkedToOriginatingApp)&&void 0!==i&&i.call(this)?e.http.basePath.prepend(F.VisualizeConstants.VISUALIZE_BASE_PATH):t}});this.stopUrlTracking=()=>{j()};const A=Object(d.createStartServicesGetter)(e.getStartServices),w=(()=>{const e=new Map;return{registerDefault:t=>{e.set(p,t)},register:(t,i)=>{t&&e.set(t,i)},get:t=>e.get(t||p)}})();e.application.register({id:F.VisualizeConstants.APP_ID,title:"Visualize Library",order:8e3,euiIconType:"logoKibana",defaultPath:"#/",category:u.DEFAULT_APP_CATEGORIES.kibana,updater$:this.appStateUpdater.asObservable(),mount:async t=>{var a;const[r,n]=await e.getStartServices();this.currentHistory=t.history,this.isLinkedToOriginatingApp=()=>{var e;return Boolean(null===(e=n.embeddable.getStateTransfer().getIncomingEditorState(F.VisualizeConstants.APP_ID))||void 0===e?void 0:e.originatingApp)},n.dataViews.clearCache(),y();const s=t.history.listen((()=>{window.dispatchEvent(new HashChangeEvent("hashchange"))})),u=Object(o.createHashHistory)(),l={...r,history:u,kbnUrlStateStorage:Object(d.createKbnUrlStateStorage)({history:u,useHash:r.uiSettings.get("state:storeInSessionStorage"),...Object(d.withNotifyOnErrors)(r.notifications.toasts)}),urlForwarding:n.urlForwarding,pluginInitializerContext:this.initializerContext,chrome:r.chrome,data:n.data,core:r,dataViewEditor:n.dataViewEditor,dataViews:n.dataViews,localStorage:new d.Storage(localStorage),navigation:n.navigation,share:n.share,toastNotifications:r.notifications.toasts,visualizeCapabilities:r.application.capabilities.visualize,dashboardCapabilities:r.application.capabilities.dashboard,embeddable:n.embeddable,stateTransferService:n.embeddable.getStateTransfer(),setActiveUrl:E,createVisEmbeddableFromObject:J({start:A}),scopedHistory:t.history,restorePreviousUrl:T,setHeaderActionMenu:t.setHeaderActionMenu,savedObjectsTagging:null===(a=n.savedObjectsTaggingOss)||void 0===a?void 0:a.getTaggingApi(),presentationUtil:n.presentationUtil,usageCollection:n.usageCollection,getKibanaVersion:()=>this.initializerContext.env.packageInfo.version,spaces:n.spaces,visEditorsRegistry:w};t.element.classList.add("visAppWrapper");const{renderApp:p}=await Promise.all([i.e(0),i.e(4)]).then(i.bind(null,187));n.screenshotMode.isScreenshotMode()&&(t.element.classList.add("visEditorScreenshotModeActive"),await i.e(11).then(i.t.bind(null,183,7)));const g=p(t,l);return()=>{c.search.session.clear(),t.element.classList.remove("visAppWrapper"),s(),g(),O()}}}),b.forwardApp("visualize","visualize"),g&&g.featureCatalogue.register({id:"visualize",title:"Visualize Library",description:n.i18n.translate("visualizations.visualizeDescription",{defaultMessage:"Create visualizations and aggregate data stores in your Elasticsearch indices."}),icon:"visualizeApp",path:`/app/visualize#${F.VisualizeConstants.LANDING_PAGE_PATH}`,showOnHomePage:!1,category:"data"}),S&&S.url.locators.create(new f.b),Object(N.J)(e.uiSettings),Object(N.L)(r),Object(N.G)(e.theme),t.registerFunction(h.a),t.registerFunction(m.a),t.registerFunction(v),_.registerTrigger(l.c);const P=new visualize_embeddable_factory_VisualizeEmbeddableFactory({start:A});return a.registerEmbeddableFactory(k.a,P),{...this.types.setup(),visEditorsRegistry:w}}start(e,{data:t,expressions:i,uiActions:a,embeddable:r,savedObjects:n,spaces:s,savedObjectsTaggingOss:o,usageCollection:c,fieldFormats:u}){const d=this.types.start();return Object(N.I)(d),Object(N.x)(r),Object(N.t)(e.application),Object(N.u)(e.application.capabilities),Object(N.B)(e.http),Object(N.D)(e.savedObjects),Object(N.w)(e.docLinks),Object(N.E)(t.search),Object(N.z)(i),Object(N.K)(a),Object(N.H)(t.query.timefilter.timefilter),Object(N.s)(t.search.aggs),Object(N.C)(e.overlays),Object(N.y)(e.executionContext),Object(N.v)(e.chrome),Object(N.A)(u),s&&Object(N.F)(s),{...d,showNewVisModal:g.a}}stop(){this.types.stop(),this.stopUrlTracking&&this.stopUrlTracking()}}var $=i(30),Z=i.n($);const K=Object(P.lazy)((()=>i.e(18).then(i.bind(null,185)))),Y=Object(P.lazy)((()=>i.e(17).then(i.bind(null,93)))),q=({"data-test-subj":e="",className:t,children:i,handlers:a,showNoResult:r=!1,error:n})=>{const s=Z()("visualization",t),o=Object(V.jsx)("div",{className:"visChart__spinner"},Object(V.jsx)(C.EuiLoadingChart,{mono:!0,size:"l"}));return Object(V.jsx)("div",{"data-test-subj":e,className:s},Object(V.jsx)(P.Suspense,{fallback:o},n?Object(V.jsx)(Y,{onInit:()=>a.done(),error:n}):r?Object(V.jsx)(K,{onInit:()=>a.done()}):i))},{isDateHistogramBucketAggConfig:W}=E.search.aggs,Q=(e,{timeRange:t,timefilter:i})=>{const a=(e,a)=>{if(W(a)){a.params.timeRange=t;const e=a.params.timeRange&&a.fieldIsTimeField()?i.calculateBounds(a.params.timeRange):void 0;a.buckets.setBounds(e),a.buckets.setInterval(a.params.interval)}const r=["derivative","moving_avg","serial_diff","cumulative_sum","sum_bucket","avg_bucket","min_bucket","max_bucket"].includes(a.type.name)?a.params.customMetric||a.aggConfigs.getRequestAggById(a.params.metricAgg):a,n={};"geohash_grid"===a.type.name&&(n.precision=a.params.precision,n.useGeocentroid=a.params.useGeocentroid);const s=a.makeLabel&&a.makeLabel();return{accessor:e,format:r.toSerializedFieldFormat(),params:n,label:s,aggType:a.type.name}};let r=0;const n={metric:[]};if(!e.data.aggs)return n;const s=e.data.aggs.getResponseAggs().filter((e=>e.enabled)),o=e.isHierarchical(),c=s.filter((e=>"metrics"===e.type.type));return s.forEach((t=>{let i=!1,u=t.schema;if(!u){if("geo_centroid"!==t.type.name)return void r++;u="geo_centroid"}"split"===u&&(u="split_"+(e.params.row?"row":"column"),i=s.length-c.length>1),n[u]||(n[u]=[]),o&&"metrics"===t.type.type||n[u].push(a(r++,t)),!o||"metrics"===t.type.type&&c.length!==s.length||c.forEach((e=>{const t=a(r++,e);i||n.metric.push(t)}))})),n};var X=i(23),ee=i(27);function te(e){return new plugin_VisualizationsPlugin(e)}i(26)},function(e,t,i){i(41),__kbnBundles__.define("plugin/visualizations/public",i,39),__kbnBundles__.define("plugin/visualizations/common/constants",i,5),__kbnBundles__.define("plugin/visualizations/common/utils",i,27),__kbnBundles__.define("plugin/visualizations/common/expression_functions",i,26)},function(e,t,i){i.p=window.__kbnPublicPath__.visualizations},function(e,t){e.exports=__kbnSharedDeps__.TsLib},function(e,t){e.exports=__kbnSharedDeps__.ReactRouterDom},function(e,t){e.exports=__kbnSharedDeps__.KbnAnalytics},function(e,t,i){i.r(t);var a=__kbnBundles__.get("plugin/kibanaUtils/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t,i){i.r(t);var a=__kbnBundles__.get("plugin/discover/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t){e.exports=__kbnSharedDeps__.Moment},function(e,t,i){i.r(t);var a=__kbnBundles__.get("plugin/presentationUtil/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t){e.exports=__kbnSharedDeps__.MomentTimezone},,function(e,t){e.exports=__kbnSharedDeps__.RisonNode},,function(e,t,i){i.r(t);var a=__kbnBundles__.get("plugin/dataViews/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t,i){i.r(t);var a=__kbnBundles__.get("plugin/expressions/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t,i){i.r(t);var a=__kbnBundles__.get("plugin/data/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))}]);