!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=27)}([function(e,t,n){e.exports=n(9)(2)},function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t){e.exports=__kbnSharedDeps__.RxjsOperators},function(e,t){e.exports=__kbnSharedDeps__.KbnI18nReact},function(e,t,n){"use strict";n.r(t),n.d(t,"REPORT_INTERVAL_MS",(function(){return r})),n.d(t,"OPT_IN_POLL_INTERVAL_MS",(function(){return s})),n.d(t,"LOCALSTORAGE_KEY",(function(){return i})),n.d(t,"PATH_TO_ADVANCED_SETTINGS",(function(){return a})),n.d(t,"PAYLOAD_CONTENT_ENCODING",(function(){return o})),n.d(t,"ENDPOINT_VERSION",(function(){return c})),n.d(t,"ENDPOINT_STAGING",(function(){return l})),n.d(t,"ENDPOINT_PROD",(function(){return u})),n.d(t,"TELEMETRY_CHANNELS",(function(){return h}));const r=864e5,s=1e4,i="telemetry.data",a="/app/management/kibana/settings",o="aes256gcm",c="v2",l="https://telemetry-staging.elastic.co/",u="https://telemetry.elastic.co/",h={SNAPSHOT_CHANNEL:"xpack",OPT_IN_STATUS_CHANNEL:"opt_in_status"}},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t,n){e.exports=n(9)(2567)},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,n){e.exports=n(9)(13)},function(e,t,n){e.exports=n(9)(15)},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t,n){e.exports=n(9)(518)},function(e,t,n){n.r(t);var r=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},function(e,t,n){e.exports=n(9)(919)},function(e,t){const n=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:n,MAX_SAFE_COMPONENT_LENGTH:16}},function(e,t,n){const{MAX_SAFE_COMPONENT_LENGTH:r}=n(16),s=n(18),i=(t=e.exports={}).re=[],a=t.src=[],o=t.t={};let c=0;const l=(e,t,n)=>{const r=c++;s(r,t),o[e]=r,a[r]=t,i[r]=new RegExp(t,n?"g":void 0)};l("NUMERICIDENTIFIER","0|[1-9]\\d*"),l("NUMERICIDENTIFIERLOOSE","[0-9]+"),l("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),l("MAINVERSION",`(${a[o.NUMERICIDENTIFIER]})\\.(${a[o.NUMERICIDENTIFIER]})\\.(${a[o.NUMERICIDENTIFIER]})`),l("MAINVERSIONLOOSE",`(${a[o.NUMERICIDENTIFIERLOOSE]})\\.(${a[o.NUMERICIDENTIFIERLOOSE]})\\.(${a[o.NUMERICIDENTIFIERLOOSE]})`),l("PRERELEASEIDENTIFIER",`(?:${a[o.NUMERICIDENTIFIER]}|${a[o.NONNUMERICIDENTIFIER]})`),l("PRERELEASEIDENTIFIERLOOSE",`(?:${a[o.NUMERICIDENTIFIERLOOSE]}|${a[o.NONNUMERICIDENTIFIER]})`),l("PRERELEASE",`(?:-(${a[o.PRERELEASEIDENTIFIER]}(?:\\.${a[o.PRERELEASEIDENTIFIER]})*))`),l("PRERELEASELOOSE",`(?:-?(${a[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${a[o.PRERELEASEIDENTIFIERLOOSE]})*))`),l("BUILDIDENTIFIER","[0-9A-Za-z-]+"),l("BUILD",`(?:\\+(${a[o.BUILDIDENTIFIER]}(?:\\.${a[o.BUILDIDENTIFIER]})*))`),l("FULLPLAIN",`v?${a[o.MAINVERSION]}${a[o.PRERELEASE]}?${a[o.BUILD]}?`),l("FULL",`^${a[o.FULLPLAIN]}$`),l("LOOSEPLAIN",`[v=\\s]*${a[o.MAINVERSIONLOOSE]}${a[o.PRERELEASELOOSE]}?${a[o.BUILD]}?`),l("LOOSE",`^${a[o.LOOSEPLAIN]}$`),l("GTLT","((?:<|>)?=?)"),l("XRANGEIDENTIFIERLOOSE",`${a[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),l("XRANGEIDENTIFIER",`${a[o.NUMERICIDENTIFIER]}|x|X|\\*`),l("XRANGEPLAIN",`[v=\\s]*(${a[o.XRANGEIDENTIFIER]})(?:\\.(${a[o.XRANGEIDENTIFIER]})(?:\\.(${a[o.XRANGEIDENTIFIER]})(?:${a[o.PRERELEASE]})?${a[o.BUILD]}?)?)?`),l("XRANGEPLAINLOOSE",`[v=\\s]*(${a[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[o.XRANGEIDENTIFIERLOOSE]})(?:${a[o.PRERELEASELOOSE]})?${a[o.BUILD]}?)?)?`),l("XRANGE",`^${a[o.GTLT]}\\s*${a[o.XRANGEPLAIN]}$`),l("XRANGELOOSE",`^${a[o.GTLT]}\\s*${a[o.XRANGEPLAINLOOSE]}$`),l("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),l("COERCERTL",a[o.COERCE],!0),l("LONETILDE","(?:~>?)"),l("TILDETRIM",`(\\s*)${a[o.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",l("TILDE",`^${a[o.LONETILDE]}${a[o.XRANGEPLAIN]}$`),l("TILDELOOSE",`^${a[o.LONETILDE]}${a[o.XRANGEPLAINLOOSE]}$`),l("LONECARET","(?:\\^)"),l("CARETTRIM",`(\\s*)${a[o.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",l("CARET",`^${a[o.LONECARET]}${a[o.XRANGEPLAIN]}$`),l("CARETLOOSE",`^${a[o.LONECARET]}${a[o.XRANGEPLAINLOOSE]}$`),l("COMPARATORLOOSE",`^${a[o.GTLT]}\\s*(${a[o.LOOSEPLAIN]})$|^$`),l("COMPARATOR",`^${a[o.GTLT]}\\s*(${a[o.FULLPLAIN]})$|^$`),l("COMPARATORTRIM",`(\\s*)${a[o.GTLT]}\\s*(${a[o.LOOSEPLAIN]}|${a[o.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",l("HYPHENRANGE",`^\\s*(${a[o.XRANGEPLAIN]})\\s+-\\s+(${a[o.XRANGEPLAIN]})\\s*$`),l("HYPHENRANGELOOSE",`^\\s*(${a[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${a[o.XRANGEPLAINLOOSE]})\\s*$`),l("STAR","(<|>)?=?\\s*\\*"),l("GTE0","^\\s*>=\\s*0.0.0\\s*$"),l("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},function(e,t,n){(function(t){const n="object"==typeof t&&Object({IS_KIBANA_DISTRIBUTABLE:"true"})&&Object({IS_KIBANA_DISTRIBUTABLE:"true"}).NODE_DEBUG&&/\bsemver\b/i.test(Object({IS_KIBANA_DISTRIBUTABLE:"true"}).NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=n}).call(this,n(29))},function(e,t){const n=["includePrerelease","loose","rtl"];e.exports=e=>e?"object"!=typeof e?{loose:!0}:n.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{}},function(e,t,n){e.exports=n(9)(18)},function(e,t,n){e.exports=n(9)(2564)},function(e,t,n){e.exports=n(9)(2572)},function(e,t,n){e.exports=n(9)(9)},function(e,t,n){e.exports=n(9)(23)},function(e,t,n){n.r(t);var r=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},function(e,t,n){const{MAX_LENGTH:r}=n(16),{re:s,t:i}=n(17),a=n(30),o=n(19);e.exports=(e,t)=>{if(t=o(t),e instanceof a)return e;if("string"!=typeof e)return null;if(e.length>r)return null;if(!(t.loose?s[i.LOOSE]:s[i.FULL]).test(e))return null;try{return new a(e,t)}catch(e){return null}}},function(e,t,n){n(28),__kbnBundles__.define("plugin/telemetry/public",n,32),__kbnBundles__.define("plugin/telemetry/common/constants",n,6)},function(e,t,n){n.p=window.__kbnPublicPath__.telemetry},function(e,t,n){e.exports=n(9)(656)},function(e,t,n){const r=n(18),{MAX_LENGTH:s,MAX_SAFE_INTEGER:i}=n(16),{re:a,t:o}=n(17),c=n(19),{compareIdentifiers:l}=n(31);class SemVer{constructor(e,t){if(t=c(t),e instanceof SemVer){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>s)throw new TypeError(`version is longer than ${s} characters`);r("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?a[o.LOOSE]:a[o.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<i)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(r("SemVer.compare",this.version,this.options,e),!(e instanceof SemVer)){if("string"==typeof e&&e===this.version)return 0;e=new SemVer(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof SemVer||(e=new SemVer(e,this.options)),l(this.major,e.major)||l(this.minor,e.minor)||l(this.patch,e.patch)}comparePre(e){if(e instanceof SemVer||(e=new SemVer(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],s=e.prerelease[t];if(r("prerelease compare",t,n,s),void 0===n&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===n)return-1;if(n!==s)return l(n,s)}while(++t)}compareBuild(e){e instanceof SemVer||(e=new SemVer(e,this.options));let t=0;do{const n=this.build[t],s=e.build[t];if(r("prerelease compare",t,n,s),void 0===n&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===n)return-1;if(n!==s)return l(n,s)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}e.exports=SemVer},function(e,t){const n=/^[0-9]+$/,r=(e,t)=>{const r=n.test(e),s=n.test(t);return r&&s&&(e=+e,t=+t),e===t?0:r&&!s?-1:s&&!r?1:e<t?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},function(e,t,n){"use strict";n.r(t),n.d(t,"plugin",(function(){return X}));var r=n(0),s=n.n(r),i=n(8),a=n.n(i),o=n(15),c=n.n(o),l=n(10),u=n.n(l),h=n(11),p=n.n(h),d=n(13),m=n.n(d),E=n(2),I=n(20),f=n.n(I),g=n(21),O=n.n(g),y=n(22),S=function(e){f()(n,e);var t=O()(n);function n(e,r){var s;return u()(this,n),(s=t.call(this,e)).code=r,s}return p()(n)}(n.n(y)()(Error));function v(e){return"".concat(e.map((function(e){return JSON.stringify(e)})).join("\n"),"\n")}var N,b=n(23),T=n.n(b),C=n(4);function R(e){return e.reduce((function(e,t){return e[t.event_type]?e[t.event_type]+=1:e[t.event_type]=1,e}),{})}!function(e){e.enqueued="enqueued",e.sent_to_shipper="sent_to_shipper",e.succeeded="succeeded",e.failed="failed",e.dropped="dropped"}(N||(N={})),n(24);var _=function(){function e(t,n){var r,i,a,o,c;u()(this,e),s()(this,"telemetryCounter$",new E.Subject),s()(this,"reportTelemetryCounters",(i=this.telemetryCounter$,a=e.shipperName,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.type,r=t.code,s=t.error,o=R(e);Object.entries(o).forEach((function(e){var t,o=T()(e,2),c=o[0],l=o[1];i.next({source:a,type:null!=n?n:s?N.failed:N.succeeded,code:null!==(t=null!=r?r:null==s?void 0:s.message)&&void 0!==t?t:"OK",count:l,event_type:c})}))})),s()(this,"url",void 0),s()(this,"internalQueue$",new E.Subject),s()(this,"isOptedIn$",new E.BehaviorSubject(void 0)),s()(this,"clusterUuid","UNKNOWN"),s()(this,"licenseId",void 0),this.options=t,this.initContext=n,this.setUpInternalQueueSubscriber(),this.url=(c=(o={sendTo:null!==(r=t.sendTo)&&void 0!==r?r:n.sendTo,channelName:t.channelName}).channelName,"".concat("production"===o.sendTo?"https://telemetry.elastic.co":"https://telemetry-staging.elastic.co","/v3/send/").concat(c))}var t,n;return p()(e,[{key:"extendContext",value:function(e){e.cluster_uuid&&(this.clusterUuid=e.cluster_uuid),e.license_id&&(this.licenseId=e.license_id)}},{key:"optIn",value:function(e){this.isOptedIn$.next(e)}},{key:"reportEvents",value:function(e){var t=this;e.forEach((function(e){t.internalQueue$.next(e)}))}},{key:"shutdown",value:function(){this.internalQueue$.complete()}},{key:"setUpInternalQueueSubscriber",value:function(){var e=this;this.internalQueue$.pipe(Object(E.bufferWhen)((function(){return Object(E.interval)(1e3).pipe(Object(E.skipWhile)((function(){return void 0===e.isOptedIn$.value})))})),Object(E.skipWhile)((function(){return!1===e.isOptedIn$.value})),Object(E.filter)((function(e){return e.length>0})),Object(E.concatMap)(function(){var t=c()(m.a.mark((function t(n){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.sendEvents(n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())).subscribe()}},{key:"sendEvents",value:(n=c()(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.makeRequest(t);case 3:n=e.sent,this.reportTelemetryCounters(t,{code:n}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.reportTelemetryCounters(t,{code:e.t0.code,error:e.t0});case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e){return n.apply(this,arguments)})},{key:"makeRequest",value:(t=c()(m.a.mark((function t(n){var r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(this.url,a()(a()({method:"POST",body:v(n),headers:(s=this.clusterUuid,i=this.options.version,o=this.licenseId,a()({"content-type":"application/x-ndjson","x-elastic-cluster-id":s,"x-elastic-stack-version":i},o&&{"x-elastic-license-id":o}))},this.options.debug&&{query:{debug:!0}}),{},{keepalive:!0}));case 2:if(r=t.sent,!this.options.debug){t.next=11;break}return t.t0=this.initContext.logger,t.t1="[".concat(e.shipperName,"]: ").concat(r.status," - "),t.next=8,r.text();case 8:t.t2=t.sent,t.t3=t.t1.concat.call(t.t1,t.t2),t.t0.debug.call(t.t0,t.t3);case 11:if(r.ok){t.next=20;break}return t.t4=S,t.t5="".concat(r.status," - "),t.next=16,r.text();case 16:throw t.t6=t.sent,t.t7=t.t5.concat.call(t.t5,t.t6),t.t8="".concat(r.status),new t.t4(t.t7,t.t8);case 20:return t.abrupt("return","".concat(r.status));case 21:case"end":return t.stop()}var s,i,o}),t,this)}))),function(e){return t.apply(this,arguments)})}]),e}();s()(_,"shipperName","elastic_v3_browser");var L=n(25),j=n(6);function A(e){return!e||isNaN(e)||Date.now()-e>j.REPORT_INTERVAL_MS}class telemetry_sender_TelemetrySender{static getRetryDelay(e){return 1e3*Math.min(Math.pow(2,e),64)*60}constructor(e,t){s()(this,"lastReported",void 0),s()(this,"storage",void 0),s()(this,"sendIfDue$",void 0),s()(this,"retryCount",0),s()(this,"updateLastReported",(e=>{this.lastReported=e,this.storage.set(j.LOCALSTORAGE_KEY,{lastReport:`${this.lastReported}`})})),s()(this,"isReportDue",(async()=>{if(!A(this.lastReported))return!1;const e=await this.telemetryService.fetchLastReported();return e&&this.updateLastReported(e),A(e)})),s()(this,"isActiveWindow",(()=>document.hasFocus())),s()(this,"shouldSendReport",(async()=>!!(this.isActiveWindow()&&this.telemetryService.canSendTelemetry()&&await this.isReportDue())&&(await this.refreshConfig(),this.telemetryService.canSendTelemetry()))),s()(this,"sendIfDue",(async()=>{await this.shouldSendReport()&&(this.updateLastReported(Date.now()),this.retryCount=0,await this.sendUsageData())})),s()(this,"sendUsageData",(async()=>{try{const e=this.telemetryService.getTelemetryUrl(),t=await this.telemetryService.fetchTelemetry();await Promise.all(t.map((async({clusterUuid:t,stats:n})=>await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-Elastic-Stack-Version":this.telemetryService.currentKibanaVersion,"X-Elastic-Cluster-ID":t,"X-Elastic-Content-Encoding":j.PAYLOAD_CONTENT_ENCODING},body:n})))),await this.telemetryService.updateLastReported().catch((()=>{}))}catch(e){this.retryCount=this.retryCount+1,this.retryCount<20?window.setTimeout(this.sendUsageData,telemetry_sender_TelemetrySender.getRetryDelay(this.retryCount)):console.warn(`TelemetrySender.sendUsageData exceeds number of retry attempts with ${e.message}`)}})),s()(this,"startChecking",(()=>{this.sendIfDue$||(this.sendIfDue$=Object(E.merge)(Object(E.interval)(6e4),Object(E.fromEvent)(window,"focus")).pipe(Object(C.exhaustMap)(this.sendIfDue)).subscribe())})),s()(this,"stop",(()=>{var e;null===(e=this.sendIfDue$)||void 0===e||e.unsubscribe()})),this.telemetryService=e,this.refreshConfig=t,this.storage=new L.Storage(window.localStorage);const n=this.storage.get(j.LOCALSTORAGE_KEY);n&&(this.lastReported=parseInt(n.lastReport,10))}}var w=n(12),$=n(26),x=n.n($);function D(e){try{return x()(e)}catch(e){return null}}function P({channelName:e,env:t}){const n=function(e){switch(e){case"prod":return j.ENDPOINT_PROD;case"staging":return j.ENDPOINT_STAGING;default:throw new Error(`Unknown telemetry endpoint env ${e}.`)}}(t),r=function(e){switch(e){case"snapshot":return j.TELEMETRY_CHANNELS.SNAPSHOT_CHANNEL;case"optInStatus":return j.TELEMETRY_CHANNELS.OPT_IN_STATUS_CHANNEL;default:throw new Error(`Unknown telemetry channel ${e}.`)}}(e);return`${n}${r}/${j.ENDPOINT_VERSION}/send`}class telemetry_service_TelemetryService{constructor({config:e,http:t,isScreenshotMode:n,notifications:r,currentKibanaVersion:i,reportOptInStatusChange:a=!0}){s()(this,"http",void 0),s()(this,"reportOptInStatusChange",void 0),s()(this,"notifications",void 0),s()(this,"defaultConfig",void 0),s()(this,"isScreenshotMode",void 0),s()(this,"updatedConfig",void 0),s()(this,"currentKibanaVersion",void 0),s()(this,"getCanChangeOptInStatus",(()=>this.config.allowChangingOptInStatus)),s()(this,"getOptInStatusUrl",(()=>{const{sendUsageTo:e}=this.config;return P({channelName:"optInStatus",env:e})})),s()(this,"getTelemetryUrl",(()=>{const{sendUsageTo:e}=this.config;return P({channelName:"snapshot",env:e})})),s()(this,"getIsOptedIn",(()=>this.isOptedIn)),s()(this,"canSendTelemetry",(()=>!this.isScreenshotMode&&this.getIsOptedIn())),s()(this,"fetchLastReported",(async()=>{const e=await this.http.get("/api/telemetry/v2/last_reported");return null==e?void 0:e.lastReported})),s()(this,"updateLastReported",(async()=>this.http.put("/api/telemetry/v2/last_reported"))),s()(this,"fetchExample",(async()=>await this.fetchTelemetry({unencrypted:!0,refreshCache:!0}))),s()(this,"fetchTelemetry",(async({unencrypted:e=!1,refreshCache:t=!1}={})=>this.http.post("/api/telemetry/v2/clusters/_stats",{body:JSON.stringify({unencrypted:e,refreshCache:t})}))),s()(this,"setOptIn",(async e=>{if(!this.getCanChangeOptInStatus())return!1;try{const t=await this.http.post("/api/telemetry/v2/optIn",{body:JSON.stringify({enabled:e})});this.reportOptInStatusChange&&await this.reportOptInStatus(t),this.isOptedIn=e}catch(e){return this.notifications.toasts.addError(e,{title:w.i18n.translate("telemetry.optInErrorToastTitle",{defaultMessage:"Error"}),toastMessage:w.i18n.translate("telemetry.optInErrorToastText",{defaultMessage:"An error occurred while trying to set the usage statistics preference."})}),!1}return!0})),s()(this,"setUserHasSeenNotice",(async()=>{try{await this.http.put("/api/telemetry/v2/userHasSeenNotice"),this.userHasSeenOptedInNotice=!0}catch(e){this.notifications.toasts.addError(e,{title:w.i18n.translate("telemetry.optInNoticeSeenErrorTitle",{defaultMessage:"Error"}),toastMessage:w.i18n.translate("telemetry.optInNoticeSeenErrorToastText",{defaultMessage:"An error occurred dismissing the notice"})}),this.userHasSeenOptedInNotice=!1}})),s()(this,"reportOptInStatus",(async e=>{const t=this.getOptInStatusUrl();try{await Promise.all(e.map((async({clusterUuid:e,stats:n})=>await fetch(t,{method:"POST",headers:{"Content-Type":"application/json","X-Elastic-Stack-Version":this.currentKibanaVersion,"X-Elastic-Cluster-ID":e,"X-Elastic-Content-Encoding":j.PAYLOAD_CONTENT_ENCODING},body:n}))))}catch(e){}})),this.defaultConfig=e,this.isScreenshotMode=n,this.reportOptInStatusChange=a,this.notifications=r,this.currentKibanaVersion=i,this.http=t}set config(e){this.updatedConfig=e}get config(){return{...this.defaultConfig,...this.updatedConfig}}get isOptedIn(){return Boolean(this.config.optIn)}set isOptedIn(e){this.config={...this.config,optIn:e}}get userHasSeenOptedInNotice(){return this.config.telemetryNotifyUserAboutOptInDefault}set userHasSeenOptedInNotice(e){this.config={...this.config,telemetryNotifyUserAboutOptInDefault:e}}getUserShouldSeeOptInNotice(){var e;return null!==(e=!this.config.hidePrivacyStatement&&this.config.telemetryNotifyUserAboutOptInDefault&&this.config.userCanChangeSettings)&&void 0!==e&&e}get userCanChangeSettings(){var e;return null!==(e=this.config.userCanChangeSettings)&&void 0!==e&&e}set userCanChangeSettings(e){this.config={...this.config,userCanChangeSettings:e}}}var M=n(7),k=n.n(M),U=n(14),F=n(3),B=n(5),G=n(1);class opted_in_notice_banner_OptedInNoticeBanner extends M.PureComponent{render(){const{onSeenBanner:e,http:t,telemetryConstants:n}=this.props,r=t.basePath.get(),s=w.i18n.translate("telemetry.telemetryOptedInNoticeTitle",{defaultMessage:"Help us improve the Elastic Stack"});return Object(G.jsx)(F.EuiCallOut,{title:s},Object(G.jsx)(B.FormattedMessage,{id:"telemetry.telemetryOptedInNoticeDescription",defaultMessage:"To learn about how usage data helps us manage and improve our products and services, see our {privacyStatementLink}. To stop collection, {disableLink}.",values:{privacyStatementLink:Object(G.jsx)(F.EuiLink,{onClick:e,href:n.getPrivacyStatementUrl(),target:"_blank",rel:"noopener"},Object(G.jsx)(B.FormattedMessage,{id:"telemetry.telemetryOptedInPrivacyStatement",defaultMessage:"Privacy Statement"})),disableLink:Object(G.jsx)(F.EuiLink,{href:`${r}${j.PATH_TO_ADVANCED_SETTINGS}`,onClick:e},Object(G.jsx)(B.FormattedMessage,{id:"telemetry.telemetryOptedInDisableUsage",defaultMessage:"disable usage data here"}))}}),Object(G.jsx)(F.EuiSpacer,{size:"s"}),Object(G.jsx)(F.EuiButton,{size:"s",onClick:e},Object(G.jsx)(B.FormattedMessage,{id:"telemetry.telemetryOptedInDismissMessage",defaultMessage:"Dismiss"})))}}class opt_in_message_OptInMessage extends M.PureComponent{render(){return Object(G.jsx)(M.Fragment,null,Object(G.jsx)(B.FormattedMessage,{id:"telemetry.telemetryBannerDescription",defaultMessage:"Want to help us improve the Elastic Stack? Data usage collection is currently disabled. Enabling data usage collection helps us manage and improve our products and services. See our {privacyStatementLink} for more details.",values:{privacyStatementLink:Object(G.jsx)(F.EuiLink,{href:this.props.telemetryConstants.getPrivacyStatementUrl(),target:"_blank",rel:"noopener"},Object(G.jsx)(B.FormattedMessage,{id:"telemetry.welcomeBanner.telemetryConfigDetailsDescription.telemetryPrivacyStatementLinkText",defaultMessage:"Privacy Statement"}))}}))}}class opt_in_banner_OptInBanner extends M.PureComponent{render(){const{onChangeOptInClick:e,telemetryConstants:t}=this.props,n=Object(G.jsx)(B.FormattedMessage,{id:"telemetry.welcomeBanner.title",defaultMessage:"Help us improve the Elastic Stack"});return Object(G.jsx)(F.EuiCallOut,{iconType:"questionInCircle",title:n},Object(G.jsx)(opt_in_message_OptInMessage,{telemetryConstants:t}),Object(G.jsx)(F.EuiSpacer,{size:"s"}),Object(G.jsx)(F.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(G.jsx)(F.EuiFlexItem,{grow:!1},Object(G.jsx)(F.EuiButton,{size:"s","data-test-subj":"enable",onClick:()=>e(!0)},Object(G.jsx)(B.FormattedMessage,{id:"telemetry.welcomeBanner.enableButtonLabel",defaultMessage:"Enable"}))),Object(G.jsx)(F.EuiFlexItem,{grow:!1},Object(G.jsx)(F.EuiButton,{size:"s","data-test-subj":"disable",onClick:()=>e(!1)},Object(G.jsx)(B.FormattedMessage,{id:"telemetry.welcomeBanner.disableButtonLabel",defaultMessage:"Disable"})))))}}class telemetry_notifications_TelemetryNotifications{constructor({http:e,overlays:t,telemetryService:n,telemetryConstants:r}){s()(this,"http",void 0),s()(this,"overlays",void 0),s()(this,"telemetryConstants",void 0),s()(this,"telemetryService",void 0),s()(this,"optedInNoticeBannerId",void 0),s()(this,"optInBannerId",void 0),s()(this,"shouldShowOptedInNoticeBanner",(()=>{const e=this.telemetryService.getUserShouldSeeOptInNotice();return!(void 0!==this.optedInNoticeBannerId)&&e})),s()(this,"renderOptedInNoticeBanner",(()=>{const e=function({onSeen:e,overlays:t,http:n,telemetryConstants:r}){const s=Object(U.toMountPoint)(Object(G.jsx)(opted_in_notice_banner_OptedInNoticeBanner,{onSeenBanner:e,http:n,telemetryConstants:r}));return t.banners.add(s,1e4)}({http:this.http,onSeen:this.setOptedInNoticeSeen,overlays:this.overlays,telemetryConstants:this.telemetryConstants});this.optedInNoticeBannerId=e})),s()(this,"shouldShowOptInBanner",(()=>{const e=this.telemetryService.getIsOptedIn();return!(void 0!==this.optInBannerId)&&null===e})),s()(this,"renderOptInBanner",(()=>{const e=function({setOptIn:e,overlays:t,telemetryConstants:n}){const r=Object(U.toMountPoint)(Object(G.jsx)(opt_in_banner_OptInBanner,{onChangeOptInClick:e,telemetryConstants:n}));return t.banners.add(r,1e4)}({setOptIn:this.onSetOptInClick,overlays:this.overlays,telemetryConstants:this.telemetryConstants});this.optInBannerId=e})),s()(this,"onSetOptInClick",(async e=>{this.optInBannerId&&(this.overlays.banners.remove(this.optInBannerId),this.optInBannerId=void 0),await this.telemetryService.setOptIn(e)})),s()(this,"setOptedInNoticeSeen",(async()=>{this.optedInNoticeBannerId&&(this.overlays.banners.remove(this.optedInNoticeBannerId),this.optedInNoticeBannerId=void 0),await this.telemetryService.setUserHasSeenNotice()})),this.telemetryService=n,this.http=e,this.overlays=t,this.telemetryConstants=r}}function V(e){return{getPrivacyStatementUrl:()=>e.links.legal.privacyStatement}}class plugin_TelemetryPlugin{constructor(e){s()(this,"currentKibanaVersion",void 0),s()(this,"config",void 0),s()(this,"telemetrySender",void 0),s()(this,"telemetryNotifications",void 0),s()(this,"telemetryService",void 0),s()(this,"canUserChangeSettings",!0),s()(this,"savedObjectsClient",void 0),this.currentKibanaVersion=e.env.packageInfo.version,this.config=e.config.get()}setup({analytics:e,http:t,notifications:n,getStartServices:r},{screenshotMode:s,home:i}){const a=this.config,o=this.currentKibanaVersion;let c;return this.telemetryService=new telemetry_service_TelemetryService({config:a,isScreenshotMode:s.isScreenshotMode(),http:t,notifications:n,currentKibanaVersion:o}),r().then((([{docLinks:e}])=>{c=V(e)})),e.registerShipper(_,{channelName:"kibana-browser",version:o,sendTo:"prod"===a.sendUsageTo?"production":"staging"}),this.telemetrySender=new telemetry_sender_TelemetrySender(this.telemetryService,(async()=>{await this.refreshConfig(),e.optIn({global:{enabled:this.telemetryService.isOptedIn}})})),i&&!this.config.hidePrivacyStatement&&(i.welcomeScreen.registerOnRendered((()=>{var e,t;null!==(e=this.telemetryService)&&void 0!==e&&e.userCanChangeSettings&&(null===(t=this.telemetryNotifications)||void 0===t||t.setOptedInNoticeSeen())})),i.welcomeScreen.registerTelemetryNoticeRenderer((()=>function(e,t,n){return Object(G.jsx)(k.a.Fragment,null,Object(G.jsx)(F.EuiTextColor,{className:"euiText--small",color:"subdued"},Object(G.jsx)(B.FormattedMessage,{id:"telemetry.dataManagementDisclaimerPrivacy",defaultMessage:"To learn about how usage data helps us manage and improve our products and services, see our "}),Object(G.jsx)(F.EuiLink,{href:n.getPrivacyStatementUrl(),target:"_blank",rel:"noopener"},Object(G.jsx)(B.FormattedMessage,{id:"telemetry.dataManagementDisclaimerPrivacyLink",defaultMessage:"Privacy Statement."})),function(e,t){return e.userCanChangeSettings&&e.getCanChangeOptInStatus()?e.getIsOptedIn()?Object(G.jsx)(k.a.Fragment,null,Object(G.jsx)(B.FormattedMessage,{id:"telemetry.dataManagementDisableCollection",defaultMessage:" To stop collection, "}),Object(G.jsx)(F.EuiLink,{href:t("management/kibana/settings")},Object(G.jsx)(B.FormattedMessage,{id:"telemetry.dataManagementDisableCollectionLink",defaultMessage:"disable usage data here."}))):Object(G.jsx)(k.a.Fragment,null,Object(G.jsx)(B.FormattedMessage,{id:"telemetry.dataManagementEnableCollection",defaultMessage:" To start collection, "}),Object(G.jsx)(F.EuiLink,{href:t("management/kibana/settings")},Object(G.jsx)(B.FormattedMessage,{id:"telemetry.dataManagementEnableCollectionLink",defaultMessage:"enable usage data here."}))):null}(e,t)),Object(G.jsx)(F.EuiSpacer,{size:"xs"}))}(this.telemetryService,t.basePath.prepend,c)))),{telemetryService:this.getTelemetryServicePublicApis()}}start({analytics:e,http:t,overlays:n,application:r,savedObjects:s,docLinks:i}){if(!this.telemetryService)throw Error("Telemetry plugin failed to initialize properly.");this.canUserChangeSettings=this.getCanUserChangeSettings(r),this.telemetryService.userCanChangeSettings=this.canUserChangeSettings;const a=V(i),o=new telemetry_notifications_TelemetryNotifications({http:t,overlays:n,telemetryService:this.telemetryService,telemetryConstants:a});return this.telemetryNotifications=o,this.savedObjectsClient=s.client,r.currentAppId$.subscribe((async()=>{if(this.getIsUnauthenticated(t))return;const n=await this.refreshConfig();e.optIn({global:{enabled:this.telemetryService.isOptedIn}});const r=null==n?void 0:n.banner;this.maybeStartTelemetryPoller(),r&&(this.maybeShowOptedInNotificationBanner(),this.maybeShowOptInBanner())})),{telemetryService:this.getTelemetryServicePublicApis(),telemetryNotifications:{setOptedInNoticeSeen:()=>o.setOptedInNoticeSeen()},telemetryConstants:a}}stop(){var e;null===(e=this.telemetrySender)||void 0===e||e.stop()}getTelemetryServicePublicApis(){const e=this.telemetryService;return{getIsOptedIn:()=>e.getIsOptedIn(),setOptIn:t=>e.setOptIn(t),canSendTelemetry:()=>e.canSendTelemetry(),userCanChangeSettings:e.userCanChangeSettings,getCanChangeOptInStatus:()=>e.getCanChangeOptInStatus(),fetchExample:()=>e.fetchExample()}}async refreshConfig(){if(this.savedObjectsClient&&this.telemetryService){const e=await this.getTelemetrySavedObject(this.savedObjectsClient),t=await this.updateConfigsBasedOnSavedObjects(e);return this.telemetryService.config=t,t}}getCanUserChangeSettings(e){var t,n,r;return null===(t=null===(n=e.capabilities)||void 0===n||null===(r=n.savedObjectsManagement)||void 0===r?void 0:r.edit)||void 0===t||t}getIsUnauthenticated(e){const{anonymousPaths:t}=e;return t.isAnonymous(window.location.pathname)}maybeStartTelemetryPoller(){this.telemetrySender&&this.telemetrySender.startChecking()}maybeShowOptedInNotificationBanner(){this.telemetryNotifications&&this.telemetryNotifications.shouldShowOptedInNoticeBanner()&&this.telemetryNotifications.renderOptedInNoticeBanner()}maybeShowOptInBanner(){this.telemetryNotifications&&this.telemetryNotifications.shouldShowOptInBanner()&&this.telemetryNotifications.renderOptInBanner()}async updateConfigsBasedOnSavedObjects(e){const t=this.config.sendUsageFrom,n=this.config.optIn,r=this.config.allowChangingOptInStatus,s=this.currentKibanaVersion,i=function({telemetrySavedObject:e,configTelemetryAllowChangingOptInStatus:t}){return e?void 0===e.allowChangingOptInStatus?t:e.allowChangingOptInStatus:t}({configTelemetryAllowChangingOptInStatus:r,telemetrySavedObject:e}),a=(({telemetrySavedObject:e,currentKibanaVersion:t,allowChangingOptInStatus:n,configTelemetryOptIn:r})=>{if("boolean"==typeof r&&!n)return r;if(!1===e)return!1;if(null===e||"boolean"!=typeof e.enabled)return r;const s=e.enabled;if(!0===s)return s;const i=e.lastVersionChecked;if("string"!=typeof i)return null;if(i===t)return s;const a=D(i),o=D(t);return null==a||null==o||o.major>a.major||o.major===a.major&&o.minor>a.minor?null:s})({configTelemetryOptIn:n,allowChangingOptInStatus:i,telemetrySavedObject:e,currentKibanaVersion:s}),o=function({telemetrySavedObject:e,configTelemetrySendUsageFrom:t}){return e?void 0===e.sendUsageFrom?t:e.sendUsageFrom:t}({configTelemetrySendUsageFrom:t,telemetrySavedObject:e}),c=function({allowChangingOptInStatus:e,telemetrySavedObject:t,telemetryOptedIn:n,configTelemetryOptIn:r}){return!1!==e&&(!t||!0!==t.userHasSeenNotice)&&!0===n&&!0===r}({telemetrySavedObject:e,allowChangingOptInStatus:i,configTelemetryOptIn:n,telemetryOptedIn:a});return{...this.config,optIn:a,sendUsageFrom:o,telemetryNotifyUserAboutOptInDefault:c,userCanChangeSettings:this.canUserChangeSettings}}async getTelemetrySavedObject(e){try{const{savedObjects:[{attributes:t}]}=await e.bulkGet([{id:"telemetry",type:"telemetry"}]);return t}catch(e){const t=e[Symbol("SavedObjectsClientErrorCode")];if("SavedObjectsClient/notFound"===t)return null;if("SavedObjectsClient/forbidden"===t)return!1;throw e}}}function X(e){return new plugin_TelemetryPlugin(e)}}]);