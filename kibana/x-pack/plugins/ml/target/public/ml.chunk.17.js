/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[17],{118:function(e,t,n){"use strict";n.d(t,"c",(function(){return h})),n.d(t,"a",(function(){return j})),n.d(t,"b",(function(){return S}));var i=n(8),a=n(24),o=n.n(a),s=n(32),r=n.n(s);const{duration:c}=o.a;var u=n(28),l=n(26),d=n(46),b=n(49);const m=r.a.unitsDesc,f=m.indexOf("w"),p=function(){const e=[[c(500,"ms"),c(100,"ms")],[c(5,"second"),c(1,"second")],[c(10,"second"),c(5,"second")],[c(15,"second"),c(10,"second")],[c(30,"second"),c(15,"second")],[c(1,"minute"),c(30,"second")],[c(5,"minute"),c(1,"minute")],[c(10,"minute"),c(5,"minute")],[c(15,"minute"),c(10,"minute")],[c(30,"minute"),c(10,"minute")],[c(1,"hour"),c(30,"minute")],[c(2,"hour"),c(1,"hour")],[c(4,"hour"),c(2,"hour")],[c(6,"hour"),c(4,"hour")],[c(8,"hour"),c(6,"hour")],[c(12,"hour"),c(8,"hour")],[c(24,"hour"),c(12,"hour")],[c(2,"d"),c(1,"d")],[c(4,"d"),c(2,"d")],[c(1,"week"),c(4,"d")],[c(1,"month"),c(1,"week")],[c(1,"year"),c(1,"month")],[1/0,c(1,"year")]].slice(0).reverse();function t(e,t,n){return function(i,a){const s=function(i,a){const s=a/i;let r;for(let i=0;i<e.length;i++){const a=e[i],o=t(a[0],a[1],s);if(null==o){if(!n)continue;if(r)return r;break}if(!n)return o;r=o}const c=Math.max(Math.floor(s),1);return o.a.duration(c,"ms")}(i,a);if(s)return o.a.duration(s._data)}}return{near:t(e,(function(e,t,n){if(e>n){if(e===1/0)return t;const i=e.asMilliseconds(),a=t.asMilliseconds();return Math.abs(i-n)<=Math.abs(a)?e:t}}),!0),lessThan:t(e,(function(e,t,n){if(t<n)return e!==1/0?e:t})),atLeast:t(e,(function(e,t,n){if(t<=n)return t}))}}();function h(){const e=Object(l.m)();return new j({[d.UI_SETTINGS.HISTOGRAM_MAX_BARS]:e.get(d.UI_SETTINGS.HISTOGRAM_MAX_BARS),[d.UI_SETTINGS.HISTOGRAM_BAR_TARGET]:e.get(d.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:e.get("dateFormat"),"dateFormat:scaled":e.get("dateFormat:scaled")})}function j(e){this._timeBucketsConfig=e,this.barTarget=this._timeBucketsConfig[d.UI_SETTINGS.HISTOGRAM_BAR_TARGET],this.maxBars=this._timeBucketsConfig[d.UI_SETTINGS.HISTOGRAM_MAX_BARS]}function O(e,t){const n=function(e){for(let t=0;t<m.length;t++){const n=m[t],i=e.as(n);if(i>=1&&Math.floor(i)===i){if(t<=f)continue;return{value:i,unit:n,expression:i+n}}}const t=e.as("ms");return{value:t,unit:"ms",expression:t+"ms"}}(e);e.esValue=n.value,e.esUnit=n.unit,e.expression=n.expression,e.overflow=t>e&&o.a.duration(e-t);const i=o.a.normalizeUnits(n.unit);return 1===n.value?e.description=i:e.description=`${n.value} ${i}s`,e}function g(e){return e&&"isValid"in e&&e.isValid()}function S(e,t,n=!1){const i=t.asMilliseconds(),a=Math.floor(e.min.valueOf()/i)*i;let s=Math.ceil(e.max.valueOf()/i)*i;return!1===n&&(s-=1),{min:o()(a),max:o()(s)}}j.prototype.setBarTarget=function(e){this.barTarget=e},j.prototype.setMaxBars=function(e){this.maxBars=e},j.prototype.setBounds=function(e){if(!e)return this.clearBounds();let t;t=Object(i.isPlainObject)(e)?[e.min,e.max]:Array.isArray(e)?e:[];const n=Object(i.sortBy)(t.map(Object(i.ary)(o.a,1)),Number);if(2!==n.length||!n.every(g))throw this.clearBounds(),new Error("invalid bounds set: "+e);if(this._lb=n.shift(),this._ub=n.pop(),this.getDuration().asSeconds()<0)throw new TypeError("Intervals must be positive")},j.prototype.clearBounds=function(){this._lb=this._ub=null},j.prototype.hasBounds=function(){return g(this._ub)&&g(this._lb)},j.prototype.getBounds=function(){if(this.hasBounds())return{min:this._lb,max:this._ub}},j.prototype.getDuration=function(){if(this.hasBounds())return o.a.duration(this._ub-this._lb,"ms")},j.prototype.setInterval=function(e){this.originalInterval=e;let t=e;if(t&&"auto"!==t){if(Object(i.isString)(t)&&(e=t,t=Object(u.a)(t),0==+t&&(t=null)),!o.a.isDuration(t))throw new TypeError('"'+e+'" is not a valid interval.');this._i=t}else this._i="auto"},j.prototype.getInterval=function(){const e=this,t=e.getDuration();return O(function(n){if(!e.hasBounds())return n;const a=e.maxBars;let o;return t/n>a?(o=p.lessThan(a,t),+o==+n?n:(O(n,t),Object(i.assign)(o,{preScaled:n,scale:n/o,scaled:!0}))):n}(function(){const n=e._i;return o.a.isDuration(n)?n:p.near(e.barTarget,t)}()),t)},j.prototype.getIntervalToNearestMultiple=function(e){const t=this.getInterval(),n=t.asSeconds(),i=n%e;if(0===i)return t;let a=i>e/2?n+e-i:n-i;a=0===a?e:a;const s=o.a.duration(a,"seconds");O(s,this.getDuration());const r=t.preScaled;return void 0!==r&&r<s&&(s.preScaled=r,s.scale=r/s,s.scaled=!0),s},j.prototype.getScaledDateFormat=function(){const e=this.getInterval(),t=this._timeBucketsConfig["dateFormat:scaled"];for(let n=t.length-1;n>=0;n--){const i=t[n];if(!i[0]||e>=o.a.duration(i[0]))return i[1]}return this._timeBucketsConfig.dateFormat},j.prototype.getScaledDateFormatter=function(){return new(Object(l.e)().getType(b.FIELD_FORMAT_IDS.DATE))({pattern:this.getScaledDateFormat()},this._timeBucketsConfig)}},263:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(89),a=n.n(i),o=n(25),s=n(17),r=n(45);function c(e,t,n,i){const c=a()(t.pipe(Object(o.map)((e=>e.executionContext)))),u=Object(s.useMemo)((()=>{const e={type:"visualization",name:n,id:i};return{...c,child:e}}),[c,i]);Object(r.useExecutionContext)(e,u)}},264:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(130);function a(e,t,n){const a=["kuery"===t.language?Object(i.h)(Object(i.e)(t.query)):Object(i.g)(t.query)],o=[];for(const t of e){if(t.meta.disabled||void 0!==n&&t.meta.controlledBy===n)continue;const{meta:{negate:e,type:i,key:s}}=t;let r=t.query;void 0===r&&"exists"===i&&(r={exists:{field:s}}),r&&(e?o.push(r):a.push(r))}return{bool:{must:a,must_not:o}}}},265:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(23),a=n(25),o=n(8),s=n(28);function r(e,t,n){return e.pipe(Object(a.pluck)("jobIds"),Object(a.distinctUntilChanged)(o.isEqual),Object(a.switchMap)((e=>t.getJobs$(e))),Object(a.map)((e=>e.map((e=>{const t=Object(s.a)(e.analysis_config.bucket_span);return{id:e.job_id,selected:!0,bucketSpanSeconds:t.asSeconds()}})))),Object(a.catchError)((e=>{var t;return n(null!==(t=e.body)&&void 0!==t?t:e),Object(i.of)(void 0)})))}},712:function(e,t,n){"use strict";n.r(t),n.d(t,"EmbeddableSwimLaneContainer",(function(){return S}));var i=n(17),a=n(43),o=n(44),s=n(263),r=n(23),c=n(25),u=n(46),l=n(51),d=n(118),b=n(94),m=n(184),f=n(264),p=n(40),h=n(265),j=n(181),O=n(108),g=n(13);const S=({id:e,embeddableContext:t,embeddableInput:n,services:S,refresh:_,onInputChange:v,onOutputChange:T,onRenderComplete:y,onLoading:E,onError:M})=>{Object(s.a)(S[0].executionContext,n,O.b,e);const[w,x]=Object(i.useState)(0),[I,B]=Object(i.useState)(1),[{},{uiActions:A}]=S,[R,C]=Object(i.useState)(),[k,D,G,F,L,U,N]=function(e,t,n,a,o,s,j){const[{uiSettings:O},,{anomalyTimelineService:g,anomalyDetectorService:S}]=a,[_,v]=Object(i.useState)(),[T,y]=Object(i.useState)(),[E,M]=Object(i.useState)(),[w,x]=Object(i.useState)(),[I,B]=Object(i.useState)(!1),A=Object(i.useMemo)((()=>new r.Subject),[]),R=Object(i.useMemo)((()=>Object(h.a)(e,S,M).pipe(Object(c.shareReplay)(1))),[]),C=Object(i.useMemo)((()=>Object(r.combineLatest)([R,A,e.pipe(Object(c.pluck)("timeRange"))]).pipe(Object(c.skipWhile)((([e,t])=>!Array.isArray(e)||!t)),Object(c.tap)((([,,e])=>{g.setTimeRange(e)})),Object(c.map)((([e,t])=>g.getSwimlaneBucketInterval(e,t))),Object(c.distinctUntilChanged)(((e,t)=>e.asSeconds()===t.asSeconds())))),[]),k=Object(i.useMemo)((()=>new r.Subject),[]),D=Object(i.useMemo)((()=>new r.Subject),[]),G=Object(i.useMemo)((()=>new d.a({"histogram:maxBars":O.get(u.UI_SETTINGS.HISTOGRAM_MAX_BARS),"histogram:barTarget":O.get(u.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:O.get("dateFormat"),"dateFormat:scaled":O.get("dateFormat:scaled")})),[]);return Object(i.useEffect)((()=>{const i=Object(r.combineLatest)([R,e,C,k,D.pipe(Object(c.startWith)(void 0),Object(c.distinctUntilChanged)(((e,t)=>void 0===e&&t===b.i))),n.pipe(Object(c.startWith)(null))]).pipe(Object(c.tap)(B.bind(null,!0)),Object(c.debounceTime)(500),Object(c.tap)((()=>{j.onLoading()})),Object(c.switchMap)((([e,n,i,a,o])=>{if(!e)return Object(r.of)(void 0);const{viewBy:s,swimlaneType:u,perPage:d,filters:h,query:j,viewMode:O}=n;let S;T||y(u);try{S=Object(f.a)(h,j,p.CONTROLLED_BY_SWIM_LANE_FILTER)}catch(e){return M(e),Object(r.of)(void 0)}return Object(r.from)(g.loadOverallData(e,void 0,i)).pipe(Object(c.switchMap)((n=>{const{earliest:f,latest:p}=n;var h;return n&&u===b.h.VIEW_BY?(void 0===o&&x(null!=d?d:b.i),O===l.ViewMode.EDIT&&o!==d&&t({perPage:o}),Object(r.from)(g.loadViewBySwimlane([],{earliest:f,latest:p},e,s,Object(m.c)(_)?_.cardinality:b.a,null!==(h=null!=o?o:d)&&void 0!==h?h:b.i,a,void 0,S,i)).pipe(Object(c.map)((e=>({...e,earliest:f,latest:p}))))):Object(r.of)(n)})))})),Object(c.catchError)((e=>(M(e.body),Object(r.of)(void 0))))).subscribe((e=>{void 0!==e&&(M(null),v(e),B(!1))}));return()=>{i.unsubscribe()}}),[]),Object(i.useEffect)((()=>{k.next(s)}),[s]),Object(i.useEffect)((()=>{void 0!==w&&D.next(w)}),[w]),Object(i.useEffect)((()=>{A.next(o)}),[o]),Object(i.useEffect)((()=>{E&&j.onError(E)}),[E]),Object(i.useEffect)((()=>{_&&j.onRenderComplete()}),[_]),[T,_,null!=w?w:b.i,x,G,I,E]}(n,v,_,S,w,I,{onRenderComplete:y,onError:M,onLoading:E});Object(i.useEffect)((()=>{T({perPage:G,fromPage:I,interval:null==D?void 0:D.interval})}),[G,I,D]);const P=Object(i.useCallback)((e=>{C(e),e&&A.getTrigger(j.a).exec({embeddable:t,data:e,updateCallback:C.bind(null,void 0)})}),[D,G,I,C]);return N?Object(g.jsx)(a.EuiCallOut,{title:Object(g.jsx)(o.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.errorMessage",defaultMessage:"Unable to load the ML swim lane data"}),color:"danger",iconType:"alert",style:{width:"100%"}},Object(g.jsx)("p",null,N.message)):Object(g.jsx)("div",{style:{width:"100%",padding:"8px"},"data-test-subj":"mlAnomalySwimlaneEmbeddableWrapper"},Object(g.jsx)(m.b,{id:e,"data-test-subj":`mlSwimLaneEmbeddable_${t.id}`,timeBuckets:L,swimlaneData:D,swimlaneType:k,fromPage:I,perPage:G,swimlaneLimit:Object(m.c)(D)?D.cardinality:void 0,onResize:x,selection:R,onCellsSelection:P,onPaginationChange:e=>{e.fromPage&&B(e.fromPage),e.perPage&&(B(1),F(e.perPage))},isLoading:U,noDataWarning:Object(g.jsx)(a.EuiEmptyPrompt,{titleSize:"xxs",style:{padding:0},title:Object(g.jsx)("h2",null,Object(g.jsx)(o.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.noDataFound",defaultMessage:"No anomalies found"}))})}))};t.default=S}}]);