/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[23],{69:function(e,t,s){"use strict";s.r(t),s.d(t,"RuleEdit",(function(){return h})),s.d(t,"default",(function(){return h}));var i=s(1),a=s.n(i),c=s(76),n=s(15),l=s(5),u=s(0),r=s(16),o=s(193),j=s(188),d=s(146),b=s(27),g=s(183),O=s(136),p=s(43),x=s(189),E=s(190),y=s(6),f=s(137),m=s(3);const h=({initialRule:e,onClose:t,reloadRules:s,onSave:h,ruleTypeRegistry:T,actionTypeRegistry:v,metadata:F,...S})=>{const w=null!=h?h:s,[{rule:I},k]=Object(i.useReducer)(d.a,{rule:Object(l.cloneDeep)(e)}),[A,C]=Object(i.useState)(!1),[R,U]=Object(i.useState)(!1),[B,M]=Object(i.useState)(!1),[D,L]=Object(i.useState)(!1),[N,z]=Object(i.useState)([]),[P,_]=Object(i.useState)(!1),[H,W]=Object(i.useState)(S.ruleType),[G,V]=Object(i.useState)({isUsingSecurity:!1}),{http:q,notifications:{toasts:J}}=Object(p.b)().services,K=T.get(I.ruleTypeId);Object(i.useEffect)((()=>{(async()=>{V(await Object(f.a)({http:q}))})()}),[q]),Object(i.useEffect)((()=>{(async()=>{_(!0);const e=await Object(j.a)(I,v);z([...e]),_(!1)})()}),[I,v]),Object(i.useEffect)((()=>{S.ruleType||H||(async()=>{const e=await Object(b.n)({http:q});for(const t of e)K.id===t.id&&W(t)})()}),[S.ruleType,K.id,H,q]);const{ruleBaseErrors:Q,ruleErrors:X,ruleParamsErrors:Y}=Object(j.b)(I,K,G),Z=()=>{Object(E.a)(I,e,!0)?L(!0):t(r.k.CANCELED)};return Object(m.jsx)(n.EuiPortal,null,Object(m.jsx)(n.EuiFlyout,{onClose:Z,"aria-labelledby":"flyoutRuleEditTitle",size:"m",maxWidth:620,ownFocus:!1},Object(m.jsx)(n.EuiFlyoutHeader,{hasBorder:!0},Object(m.jsx)(n.EuiTitle,{size:"s","data-test-subj":"editRuleFlyoutTitle"},Object(m.jsx)("h3",{id:"flyoutTitle"},Object(m.jsx)(c.FormattedMessage,{defaultMessage:"Edit rule",id:"xpack.triggersActionsUI.sections.ruleEdit.flyoutTitle"})))),Object(m.jsx)(O.a,null,Object(m.jsx)(g.a,{inFlyout:!0,waitForCheck:!0},Object(m.jsx)(n.EuiFlyoutBody,null,R&&Object(m.jsx)(a.a.Fragment,null,Object(m.jsx)(n.EuiCallOut,{size:"s",color:"danger",iconType:"rule","data-test-subj":"hasActionsDisabled",title:u.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.disabledActionsWarningTitle",{defaultMessage:"This rule has actions that are disabled"})}),Object(m.jsx)(n.EuiSpacer,null)),Object(m.jsx)(o.a,{rule:I,config:G,dispatch:k,errors:X,actionTypeRegistry:v,ruleTypeRegistry:T,canChangeTrigger:!1,setHasActionsDisabled:U,setHasActionsWithBrokenConnector:M,operation:"i18n.translate('xpack.triggersActionsUI.sections.ruleEdit.operationName', { defaultMessage: 'edit', })",metadata:F})),Object(m.jsx)(n.EuiFlyoutFooter,null,Object(m.jsx)(n.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(m.jsx)(n.EuiFlexItem,{grow:!1},Object(m.jsx)(n.EuiButtonEmpty,{"data-test-subj":"cancelSaveEditedRuleButton",onClick:()=>Z()},u.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.cancelButtonLabel",{defaultMessage:"Cancel"}))),P?Object(m.jsx)(n.EuiFlexItem,{grow:!1},Object(m.jsx)(n.EuiSpacer,{size:"s"}),Object(m.jsx)(n.EuiLoadingSpinner,{size:"l"})):Object(m.jsx)(a.a.Fragment,null),Object(m.jsx)(n.EuiFlexItem,{grow:!1},Object(m.jsx)(n.EuiFlexGroup,{alignItems:"center"},G.isUsingSecurity&&Object(m.jsx)(n.EuiFlexItem,{grow:!1},Object(m.jsx)(n.EuiIconTip,{type:"alert",position:"top","data-test-subj":"changeInPrivilegesTip",content:u.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.changeInPrivilegesLabel",{defaultMessage:"Saving this rule will change its privileges and might change its behavior."})})),Object(m.jsx)(n.EuiFlexItem,{grow:!1},Object(m.jsx)(n.EuiButton,{fill:!0,color:"success","data-test-subj":"saveEditedRuleButton",type:"submit",iconType:"check",isLoading:A,onClick:async()=>await async function(){C(!0);try{if(P||!Object(j.c)(I,X,N)||B)i=Object(y.b)(I,Y,Q,N),k({command:{type:"setRule"},payload:{key:"rule",value:i}});else{const e=await Object(b.z)({http:q,rule:I,id:I.id});J.addSuccess(u.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.saveSuccessNotificationText",{defaultMessage:"Updated '{ruleName}'",values:{ruleName:e.name}})),t(r.k.SAVED),w&&w()}}catch(t){var e,s;J.addDanger(null!==(e=null===(s=t.body)||void 0===s?void 0:s.message)&&void 0!==e?e:u.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.saveErrorNotificationText",{defaultMessage:"Cannot update rule."}))}var i;C(!1)}()},Object(m.jsx)(c.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleEdit.saveButtonLabel",defaultMessage:"Save"}))))))))),D&&Object(m.jsx)(x.a,{onConfirm:()=>{L(!1),t(r.k.CANCELED)},onCancel:()=>{L(!1)}})))}}}]);