/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[76],{307:function(e,i,n){"use strict";n.r(i),n.d(i,"default",(function(){return v}));var t=n(1),l=n.n(t),o=n(15),a=n(43),s=n(26),r=n(76),c=n(14),u=n(3);const d=({action:e,editActionConfig:i,editActionSecrets:n,errors:s,readOnly:d})=>{var p,g,j;const{apiUrl:b,appId:f}=e.config,{apiToken:C}=e.secrets,{docLinks:m}=Object(a.b)().services,O=Object(t.useCallback)(((e,n)=>{i(n,e.target.value)}),[i]),E=Object(t.useCallback)((n=>{e.config[n]||i(n,"")}),[e.config,i]),v=Object(t.useCallback)((e=>{n("apiToken",e.target.value)}),[n]),_=Object(t.useCallback)((()=>{C||n("apiToken","")}),[C,n]),I=(null===(p=s.apiUrl)||void 0===p?void 0:p.length)>0&&void 0!==C,T=(null===(g=s.appId)||void 0===g?void 0:g.length)>0&&void 0!==C,x=(null===(j=s.apiToken)||void 0===j?void 0:j.length)>0&&void 0!==C;return Object(u.jsx)(l.a.Fragment,null,Object(u.jsx)(o.EuiFormRow,{id:"apiUrl",fullWidth:!0,label:c.SW_API_URL_TEXT_FIELD_LABEL,error:s.apiUrl,isInvalid:I},Object(u.jsx)(o.EuiFieldText,{fullWidth:!0,name:"apiUrl",value:null!=b?b:"",readOnly:d,isInvalid:I,"data-test-subj":"swimlaneApiUrlInput",onChange:e=>O(e,"apiUrl"),onBlur:()=>E("apiUrl")})),Object(u.jsx)(o.EuiFormRow,{id:"appId",fullWidth:!0,label:c.SW_APP_ID_TEXT_FIELD_LABEL,error:s.appId,isInvalid:T},Object(u.jsx)(o.EuiFieldText,{fullWidth:!0,name:"appId",value:null!=f?f:"",readOnly:d,isInvalid:T,"data-test-subj":"swimlaneAppIdInput",onChange:e=>O(e,"appId"),onBlur:()=>E("appId")})),Object(u.jsx)(o.EuiFormRow,{id:"apiToken",fullWidth:!0,helpText:Object(u.jsx)(o.EuiLink,{href:`${m.ELASTIC_WEBSITE_URL}guide/en/kibana/${m.DOC_LINK_VERSION}/swimlane-action-type.html`,target:"_blank"},Object(u.jsx)(r.FormattedMessage,{id:"xpack.triggersActionsUI.components.builtinActionTypes.swimlaneAction.apiTokenNameHelpLabel",defaultMessage:"Provide a Swimlane API Token"})),error:s.apiToken,isInvalid:x,label:c.SW_API_TOKEN_TEXT_FIELD_LABEL},Object(u.jsx)(l.a.Fragment,null,e.id?Object(u.jsx)(l.a.Fragment,null,Object(u.jsx)(o.EuiSpacer,{size:"s"}),Object(u.jsx)(o.EuiCallOut,{size:"s",iconType:"iInCircle","data-test-subj":"reenterValuesMessage",title:c.SW_REENTER_VALUE_LABEL}),Object(u.jsx)(o.EuiSpacer,{size:"m"})):Object(u.jsx)(l.a.Fragment,null,Object(u.jsx)(o.EuiSpacer,{size:"s"}),Object(u.jsx)(o.EuiText,{size:"s","data-test-subj":"rememberValuesMessage"},c.SW_REMEMBER_VALUE_LABEL),Object(u.jsx)(o.EuiSpacer,{size:"s"})),Object(u.jsx)(o.EuiFieldPassword,{fullWidth:!0,isInvalid:x,readOnly:d,value:null!=C?C:"","data-test-subj":"swimlaneApiTokenInput",onChange:v,onBlur:_}))))},p=l.a.memo(d);var g=n(55);const j={asPlainText:!0},b=[],f=e=>({label:`${e.name} (${e.key})`,value:e.id}),C=e=>null!=e?[f(e)]:b,m=[{id:s.a.All,label:"All"},{id:s.a.Alerts,label:"Alerts"},{id:s.a.Cases,label:"Cases"}],O=({action:e,editActionConfig:i,updateCurrentStep:n,fields:a,errors:r})=>{const{mappings:d,connectorType:p=s.a.All}=e.config,b=Object(t.useRef)(p),O=p!==b.current,[E,v]=Object(t.useMemo)((()=>a.reduce((([e,i],n)=>{var t;return null!=n&&(e.set(n.fieldType,[...null!==(t=e.get(n.fieldType))&&void 0!==t?t:[],f(n)]),i.set(n.id,n)),[e,i]}),[new Map,new Map])),[a]),_=Object(t.useMemo)((()=>{var e;return null!==(e=E.get("text"))&&void 0!==e?e:[]}),[E]),I=Object(t.useMemo)((()=>{var e;return null!==(e=E.get("comments"))&&void 0!==e?e:[]}),[E]),T=Object(t.useMemo)((()=>({alertIdConfig:C(null==d?void 0:d.alertIdConfig),severityConfig:C(null==d?void 0:d.severityConfig),ruleNameConfig:C(null==d?void 0:d.ruleNameConfig),caseIdConfig:C(null==d?void 0:d.caseIdConfig),caseNameConfig:C(null==d?void 0:d.caseNameConfig),commentsConfig:C(null==d?void 0:d.commentsConfig),descriptionConfig:C(null==d?void 0:d.descriptionConfig)})),[d]),x=Object(t.useMemo)((()=>Array.isArray(null==r?void 0:r.mappings)?null==r?void 0:r.mappings[0]:{}),[r]),A=Object(t.useCallback)(((e,n)=>{var t;if(0===n.length){const n={...d,[e]:null};return void i("mappings",n)}const l=n[0],o=v.get(null!==(t=l.value)&&void 0!==t?t:"");if(!o)return;const a={...d,[e]:{id:o.id,name:o.name,key:o.key,fieldType:o.fieldType}};i("mappings",a)}),[i,v,d]);return Object(t.useEffect)((()=>{p!==b.current&&(b.current=p)}),[p]),Object(u.jsx)(l.a.Fragment,null,Object(u.jsx)(o.EuiFormRow,{id:"connectorType",fullWidth:!0,label:c.SW_CONNECTOR_TYPE_LABEL},Object(u.jsx)(o.EuiButtonGroup,{name:"connectorType",legend:c.SW_CONNECTOR_TYPE_LABEL,options:m,idSelected:p,onChange:e=>i("connectorType",e),buttonSize:"compressed"})),Object(g.a)(p,"alertIdConfig")&&Object(u.jsx)(l.a.Fragment,null,Object(u.jsx)(o.EuiFormRow,{id:"alertIdConfig",fullWidth:!0,label:c.SW_ALERT_ID_FIELD_LABEL,error:null==x?void 0:x.alertIdConfig,isInvalid:null!=(null==x?void 0:x.alertIdConfig)&&!O},Object(u.jsx)(o.EuiComboBox,{fullWidth:!0,selectedOptions:T.alertIdConfig,options:_,singleSelection:j,"data-test-subj":"swimlaneAlertIdInput",onChange:e=>A("alertIdConfig",e),isInvalid:null!=(null==x?void 0:x.alertIdConfig)&&!O}))),Object(g.a)(p,"ruleNameConfig")&&Object(u.jsx)(l.a.Fragment,null,Object(u.jsx)(o.EuiFormRow,{id:"ruleNameConfig",fullWidth:!0,label:c.SW_RULE_NAME_FIELD_LABEL,error:null==x?void 0:x.ruleNameConfig,isInvalid:null!=(null==x?void 0:x.ruleNameConfig)&&!O},Object(u.jsx)(o.EuiComboBox,{fullWidth:!0,selectedOptions:T.ruleNameConfig,options:_,singleSelection:j,"data-test-subj":"swimlaneAlertNameInput",onChange:e=>A("ruleNameConfig",e),isInvalid:null!=(null==x?void 0:x.ruleNameConfig)&&!O}))),Object(g.a)(p,"severityConfig")&&Object(u.jsx)(l.a.Fragment,null,Object(u.jsx)(o.EuiFormRow,{id:"severityConfig",fullWidth:!0,label:c.SW_SEVERITY_FIELD_LABEL,error:null==x?void 0:x.severityConfig,isInvalid:null!=(null==x?void 0:x.severityConfig)&&!O},Object(u.jsx)(o.EuiComboBox,{fullWidth:!0,selectedOptions:T.severityConfig,options:_,singleSelection:j,"data-test-subj":"swimlaneSeverityInput",onChange:e=>A("severityConfig",e),isInvalid:null!=(null==x?void 0:x.severityConfig)&&!O}))),Object(g.a)(p,"caseIdConfig")&&Object(u.jsx)(l.a.Fragment,null,Object(u.jsx)(o.EuiFormRow,{id:"caseIdConfig",fullWidth:!0,label:c.SW_CASE_ID_FIELD_LABEL,error:null==x?void 0:x.caseIdConfig,isInvalid:null!=(null==x?void 0:x.caseIdConfig)&&!O},Object(u.jsx)(o.EuiComboBox,{fullWidth:!0,selectedOptions:T.caseIdConfig,options:_,singleSelection:j,"data-test-subj":"swimlaneCaseIdConfig",onChange:e=>A("caseIdConfig",e),isInvalid:null!=(null==x?void 0:x.caseIdConfig)&&!O}))),Object(g.a)(p,"caseNameConfig")&&Object(u.jsx)(l.a.Fragment,null,Object(u.jsx)(o.EuiFormRow,{id:"caseNameConfig",fullWidth:!0,label:c.SW_CASE_NAME_FIELD_LABEL,error:null==x?void 0:x.caseNameConfig,isInvalid:null!=(null==x?void 0:x.caseNameConfig)&&!O},Object(u.jsx)(o.EuiComboBox,{fullWidth:!0,selectedOptions:T.caseNameConfig,options:_,singleSelection:j,"data-test-subj":"swimlaneCaseNameConfig",onChange:e=>A("caseNameConfig",e),isInvalid:null!=(null==x?void 0:x.caseNameConfig)&&!O}))),Object(g.a)(p,"commentsConfig")&&Object(u.jsx)(l.a.Fragment,null,Object(u.jsx)(o.EuiFormRow,{id:"commentsConfig",fullWidth:!0,label:c.SW_COMMENTS_FIELD_LABEL,error:null==x?void 0:x.commentsConfig,isInvalid:null!=(null==x?void 0:x.commentsConfig)&&!O},Object(u.jsx)(o.EuiComboBox,{fullWidth:!0,selectedOptions:T.commentsConfig,options:I,singleSelection:j,"data-test-subj":"swimlaneCommentsConfig",onChange:e=>A("commentsConfig",e),isInvalid:null!=(null==x?void 0:x.commentsConfig)&&!O}))),Object(g.a)(p,"descriptionConfig")&&Object(u.jsx)(l.a.Fragment,null,Object(u.jsx)(o.EuiFormRow,{id:"descriptionConfig",fullWidth:!0,label:c.SW_DESCRIPTION_FIELD_LABEL,error:null==x?void 0:x.descriptionConfig,isInvalid:null!=(null==x?void 0:x.descriptionConfig)&&!O},Object(u.jsx)(o.EuiComboBox,{fullWidth:!0,selectedOptions:T.descriptionConfig,options:_,singleSelection:j,"data-test-subj":"swimlaneDescriptionConfig",onChange:e=>A("descriptionConfig",e),isInvalid:null!=(null==x?void 0:x.descriptionConfig)&&!O}))))},E=l.a.memo(O);const v=({errors:e,action:i,editActionConfig:n,editActionSecrets:r,readOnly:d})=>{var g,j,b;const{notifications:{toasts:f}}=Object(a.b)().services,{apiUrl:C,appId:m,mappings:O,connectorType:v}=i.config,{apiToken:_}=i.secrets,{getApplication:I,isLoading:T}=(({toastNotifications:e,appId:i,apiToken:n,apiUrl:l})=>{const[o,a]=Object(t.useState)(!1),s=Object(t.useRef)(!1),r=Object(t.useRef)(new AbortController);return{isLoading:o,getApplication:Object(t.useCallback)((async()=>{try{s.current=!1,r.current.abort(),r.current=new AbortController,a(!0);const t=await async function({signal:e,url:i,appId:n,apiToken:t}){const l={"Content-Type":"application/json","Private-Token":`${t}`},o=i.endsWith("/")?i.slice(0,-1):i,a=`${o.endsWith("api")?o:o+"/api"}/app/{appId}`;try{var s;const i=await fetch((c=n,a.replace("{appId}",c)),{method:"GET",headers:l,signal:e});if(!i.ok)throw new Error(`Received status: ${i.status} when attempting to get application with id: ${n}`);const t=await i.json();return{...t,fields:(r=null!==(s=null==t?void 0:t.fields)&&void 0!==s?s:[],r.filter((e=>"__proto__"!==e.id&&"__proto__"!==e.key&&"__proto__"!==e.name&&"__proto__"!==e.fieldType)))}}catch(e){throw new Error(`Unable to get application with id ${n}. Error: ${e.message}`)}var r,c}({signal:r.current.signal,appId:i,apiToken:n,url:l});if(!s.current)return a(!1),t.fields?t:void e.addDanger({title:c.SW_GET_APPLICATION_API_ERROR(i),text:c.SW_GET_APPLICATION_API_NO_FIELDS_ERROR})}catch(n){s.current||("AbortError"!==n.name&&e.addDanger({title:c.SW_GET_APPLICATION_API_ERROR(i),text:n.message}),a(!1))}}),[n,l,i,e])}})({toastNotifications:f,apiToken:_,appId:m,apiUrl:C}),x=(null===(g=e.apiUrl)||void 0===g?void 0:g.length)>0||(null===(j=e.appId)||void 0===j?void 0:j.length)>0||(null===(b=e.apiToken)||void 0===b?void 0:b.length)>0,[A,L]=Object(t.useState)(1),[S,h]=Object(t.useState)([]),w=Object(t.useCallback)((e=>{L(e)}),[]),W=Object(t.useCallback)((async()=>{const e=await I();if(null!=e&&e.fields){const i=e.fields;h(i),L(2)}}),[I]),F=Object(t.useCallback)((()=>{L(1)}),[]),N=Object(t.useMemo)((()=>{var i;return Object.values(null!==(i=null==e?void 0:e.mappings)&&void 0!==i?i:{}).some((e=>0!==e.length))}),[null==e?void 0:e.mappings]),y=Object(t.useMemo)((()=>[{title:c.SW_CONFIGURE_CONNECTION_LABEL,isSelected:1===A,isComplete:2===A,onClick:()=>w(1)},{title:c.SW_MAPPING_TITLE_TEXT_FIELD_LABEL,disabled:x||T,isSelected:2===A,onClick:W,status:N?"danger":void 0}]),[A,x,N,T,W,w]);return Object(t.useEffect)((()=>{n("connectorType",null!=v?v:s.a.All),n("mappings",null!=O?O:{})}),[]),Object(u.jsx)(t.Fragment,null,Object(u.jsx)(o.EuiStepsHorizontal,{steps:y}),Object(u.jsx)(o.EuiSpacer,{size:"l"}),Object(u.jsx)(o.EuiForm,null,1===A&&Object(u.jsx)(l.a.Fragment,null,Object(u.jsx)(p,{action:i,editActionConfig:n,editActionSecrets:r,readOnly:d,errors:e}),Object(u.jsx)(o.EuiSpacer,null),Object(u.jsx)(o.EuiFormRow,{fullWidth:!0,helpText:c.SW_FIELDS_BUTTON_HELP_TEXT},Object(u.jsx)(o.EuiButton,{disabled:x||T,isLoading:T,onClick:W,"data-test-subj":"swimlaneConfigureMapping",iconType:"arrowRight",iconSide:"right"},c.SW_NEXT))),2===A&&Object(u.jsx)(l.a.Fragment,null,Object(u.jsx)(E,{action:i,editActionConfig:n,updateCurrentStep:w,fields:S,errors:e}),Object(u.jsx)(o.EuiButton,{onClick:F,iconType:"arrowLeft"},c.SW_BACK))))}}}]);