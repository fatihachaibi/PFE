/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[16],{291:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n.n(r),o=n(35),u=n(70),s=n(12),i=n(96);const l=e=>{const{timerange:t,isLoading:n,hosts:o,pageCount:u,currentPageIndex:l,setCurrentPageIndex:c,sortState:m,setSortState:g}=e,f=Object(r.useMemo)((()=>function(e){return[{name:"Name",field:"name",truncateText:!0,render:t=>a.a.createElement(i.a,{id:t,nodeType:"host",timerange:e})},{name:"# of CPUs",field:"cpuCount",align:"right",render:e=>a.a.createElement(i.b,{value:e})},{name:"CPU usage (avg.)",field:"averageCpuUsagePercent",align:"right",render:e=>a.a.createElement(i.b,{value:e,unit:"%"})},{name:"Memory total (avg.)",field:"totalMemoryMegabytes",align:"right",render:e=>a.a.createElement(i.b,{value:e,unit:" MB"})},{name:"Memory usage (avg.)",field:"averageMemoryUsagePercent",align:"right",render:e=>a.a.createElement(i.b,{value:e,unit:"%"})}]}(t)),[t]),d={enableAllColumns:!0,sort:m},p=Object(r.useCallback)((({sort:e})=>{e&&(g(e),c(0))}),[g,c]);return n?a.a.createElement(s.EuiFlexGroup,{alignItems:"center",justifyContent:"center",direction:"column"},a.a.createElement(s.EuiLoadingSpinner,{size:"xl","data-test-subj":"hostMetricsTableLoader"})):a.a.createElement(a.a.Fragment,null,a.a.createElement(s.EuiBasicTable,{tableCaption:"Infrastructure metrics for hosts",items:o,columns:f,sorting:d,onChange:p,"data-test-subj":"hostMetricsTable"}),a.a.createElement(s.EuiSpacer,{size:"s"}),a.a.createElement(s.EuiFlexGroup,{justifyContent:"flexEnd",alignItems:"center",responsive:!1,wrap:!0},a.a.createElement(s.EuiFlexItem,{grow:!1},a.a.createElement(i.c,{ariaLabel:"Host metrics pagination",pageCount:u,currentPageIndex:l,setCurrentPageIndex:c,"data-test-subj":"hostMetricsTablePagination"}))))},{options:c,metricByField:m}=Object(i.e)({"system.cpu.cores":{aggregation:"max",field:"system.cpu.cores"},"system.cpu.total.norm.pct":{aggregation:"avg",field:"system.cpu.total.norm.pct"},"system.memory.total":{aggregation:"max",field:"system.memory.total"},"system.memory.used.pct":{aggregation:"avg",field:"system.memory.used.pct"}},"host.name");function g(e){return 0===e.rows.length?{name:e.id,cpuCount:null,averageCpuUsagePercent:null,totalMemoryMegabytes:null,averageMemoryUsagePercent:null}:{name:e.id,...f(e.rows)}}function f(e){const{cpuCountValues:t,averageCpuUsagePercentValues:n,totalMemoryMegabytesValues:r,averageMemoryUsagePercentValues:a}=function(e){const t=[],n=[],r=[],a=[];return e.forEach((e=>{const{cpuCount:o,averageCpuUsagePercent:u,totalMemoryMegabytes:s,averageMemoryUsagePercent:i}=function(e){return{cpuCount:e[m["system.cpu.cores"]],averageCpuUsagePercent:e[m["system.cpu.total.norm.pct"]],totalMemoryMegabytes:e[m["system.memory.total"]],averageMemoryUsagePercent:e[m["system.memory.used.pct"]]}}(e);null!==o&&t.push(o),null!==u&&n.push(u),null!==s&&r.push(s),null!==i&&a.push(i)})),{cpuCountValues:t,averageCpuUsagePercentValues:n,totalMemoryMegabytesValues:r,averageMemoryUsagePercentValues:a}}(e);let o=null;0!==t.length&&(o=d(t));let u=null;0!==n.length&&(u=d(n));let s=null;if(0!==r.length){const e=d(r),t=1e6;s=Math.floor(e/t)}let i=null;return 0!==a.length&&(i=d(a)),{cpuCount:o,averageCpuUsagePercent:u,totalMemoryMegabytes:s,averageMemoryUsagePercent:i}}function d(e){return e.reduce(((e,t)=>e+t),0)/e.length}function p({timerange:e,filterClauseDsl:t}){const n=function({timerange:e,filterClauseDsl:t}){const[n,a]=Object(r.useState)(0),[o,u]=Object(r.useState)({field:"averageCpuUsagePercent",direction:"desc"}),{isLoading:s,nodes:l,pageCount:m}=Object(i.f)({metricsExplorerOptions:c,timerange:e,filterClauseDsl:t,transform:g,sortState:o,currentPageIndex:n});return{timerange:e,isLoading:s,hosts:l,pageCount:m,currentPageIndex:n,setCurrentPageIndex:a,sortState:o,setSortState:u}}({timerange:e,filterClauseDsl:t});return a.a.createElement(l,n)}t.default=function({timerange:e,filterClauseDsl:t,sourceId:n,...r}){return a.a.createElement(o.b,r,a.a.createElement(u.b,{sourceId:n},a.a.createElement(p,{timerange:e,filterClauseDsl:t})))}},96:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return d})),n.d(t,"d",(function(){return p})),n.d(t,"e",(function(){return C})),n.d(t,"f",(function(){return O}));var r=n(10),a=n(12),o=n(2),u=n.n(o),s=n(30),i=n(118);const l=({id:e,nodeType:t,timerange:n})=>{var o,l;const c=Object(s.useLinkProps)(Object(i.a)({nodeType:t,nodeId:e,from:null===(o=Object(r.parse)(n.from))||void 0===o?void 0:o.valueOf(),to:null===(l=Object(r.parse)(n.to))||void 0===l?void 0:l.valueOf()}));return u.a.createElement(a.EuiLink,{href:c.href},e)};function c({value:e,unit:t}){return null==e||isNaN(e)?u.a.createElement(a.EuiTextColor,{color:"subdued"},"N/A"):t?u.a.createElement("span",null,u.a.createElement(a.EuiI18nNumber,{value:m(e)}),t):u.a.createElement(a.EuiI18nNumber,{value:m(e)})}function m(e){return Math.round(10*e)/10}var g=n(15);const f=Object(g.euiStyled)(a.EuiPagination)`
  [data-test-subj="pagination-button-first"],
  [data-test-subj="pagination-button-last"] {
    display: none;
  }
`;function d({ariaLabel:e,pageCount:t,currentPageIndex:n,setCurrentPageIndex:r}){return u.a.createElement(f,{"aria-label":e,pageCount:t,activePage:n,onPageClick:r,compressed:!0})}function p({uptimeMs:e}){return null==e||isNaN(e)?u.a.createElement(a.EuiTextColor,{color:"subdued"},"N/A"):u.a.createElement("span",null,function(e){if(e<y){const t=Math.floor(e/b);return t>0?`${t}m`:"< a minute"}if(e<v){const t=Math.floor(e/y),n=e-t*y,r=Math.floor(n/b);return r>0?`${t}h ${r}m`:`${t}h`}const t=Math.floor(e/v),n=e-t*v,r=Math.floor(n/y);return r>0?`${t}d ${r}h`:`${t}d`}(e))}const b=6e4,y=36e5,v=864e5;function C(e,t){const n=Object.values(e),r={aggregation:"avg",groupBy:t,metrics:n},a=function(e,t){return e.reduce(((e,n)=>({...e,[n]:h(n,t)})),{})}(Object.keys(e),n);return{options:r,metricByField:a}}function h(e,t){const n=t.findIndex((t=>t.field===e));if(-1===n)throw new Error("Failed to find index for field "+e);return`metric_${n}`}var E=n(9),M=n(70),P=n(68);const j={series:[],pageInfo:{afterKey:null,total:-1}},O=e=>{const{metricsExplorerOptions:t,timerange:n,filterClauseDsl:a,transform:u,sortState:s,currentPageIndex:i}=e,[l,c]=Object(o.useState)([]),m=function(){var e;const t=null===(e=Object(E.useKibana)().services.http)||void 0===e?void 0:e.fetch;if(!t)throw new Error("Could not find Kibana HTTP fetch");return t}(),{source:g,isLoadingSource:f}=Object(M.c)(),d=function(e){return Object(o.useMemo)((()=>{const t=Object(r.parse)(e.from),n=Object(r.parse)(e.to);if(!t||!n)throw new Error("Could not parse timerange");return{from:t.valueOf(),to:n.valueOf(),interval:"modules"}}),[e])}(n),[{state:p},b]=Object(P.c)({createPromise:()=>{if(!g)return Promise.resolve(j);const e={metrics:t.metrics,groupBy:t.groupBy,limit:1e4,indexPattern:g.configuration.metricAlias,filterQuery:JSON.stringify(a),timerange:d};return m("/api/infra/metrics_explorer",{method:"POST",body:JSON.stringify(e)})},onResolve:e=>{c(e.series.map(u))},onReject:e=>{console.log(e)},cancelPreviousOn:"creation"},[g,t,d,a]),y="pending"===p||"uninitialized"===p;Object(o.useEffect)((()=>{b()}),[b]);const v=Object(o.useMemo)((()=>[...l].sort(function(e){return(t,n)=>{const r=t[e.field],a=n[e.field];return"asc"===e.direction?function(e,t){return null===e?-1:null===t?1:"string"==typeof e&&"string"==typeof t?e.localeCompare(t):"number"==typeof e&&"number"==typeof t?e-t:0}(r,a):function(e,t){return null===e?1:null===t?-1:"string"==typeof e&&"string"==typeof t?t.localeCompare(e):"number"==typeof e&&"number"==typeof t?t-e:0}(r,a)}}(s))),[l,s]),C=Object(o.useMemo)((()=>v.slice(0,100)),[v]);return{isLoading:f||y,nodes:Object(o.useMemo)((()=>{const e=10*i,t=e+10;return C.slice(e,t)}),[C,i]),pageCount:Object(o.useMemo)((()=>Math.ceil(C.length/10)),[C])}}}}]);