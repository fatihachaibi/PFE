/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[4],{107:function(e,t,r){"use strict";r.d(t,"a",(function(){return Q}));var n=r(2),a=r(18),i=r(19),o=r(24),s=r(67),c=r.n(s),u=r(0),l=r(23),d=r(49),f=r.n(d);const m=new u.Type("TimestampFromString",(e=>"number"==typeof e),((e,t)=>Object(o.pipe)(u.string.validate(e,t),Object(a.chain)((e=>{const r=f()(e);return r.isValid()?u.success(r.valueOf()):u.failure(e,t)})))),(e=>new Date(e).toISOString())),p=(u.type({sources:u.type({default:u.partial({fields:u.partial({message:u.array(u.string)})})})}),u.type({timestampColumn:u.type({id:u.string})})),b=u.type({messageColumn:u.type({id:u.string})}),g=u.type({fieldColumn:u.type({id:u.string,field:u.string})}),y=u.union([p,b,g]),v=u.type({type:u.literal("index_pattern"),indexPatternId:u.string}),O=u.type({type:u.literal("index_name"),indexName:u.string}),h=u.union([v,O]),j=u.type({message:u.array(u.string)}),E=u.type({name:u.string,description:u.string,metricAlias:u.string,logIndices:h,inventoryDefaultView:u.string,metricsExplorerDefaultView:u.string,fields:j,logColumns:u.array(y),anomalyThreshold:u.number}),x=u.partial(Object(l.omit)(j.props,["message"])),S=u.intersection([u.partial(Object(l.omit)(E.props,["fields"])),u.partial({fields:x})]),w=u.partial(j.props),I=(u.partial({...E.props,fields:w}),u.type({...E.props,fields:j,logColumns:u.array(y)})),T=u.type({name:u.string,type:u.string,searchable:u.boolean,aggregatable:u.boolean,displayable:u.boolean}),R=u.type({logIndicesExist:u.boolean,metricIndicesExist:u.boolean,indexFields:u.array(T)}),k=u.intersection([u.type({id:u.string,origin:u.keyof({fallback:null,internal:null,stored:null}),configuration:I}),u.partial({version:u.string,updatedAt:u.number,status:R})]),$=(u.type({source:k}),u.intersection([u.type({id:u.string,attributes:S}),u.partial({version:u.string,updated_at:m})]),u.strict({name:E.props.name,description:E.props.description,metricAlias:E.props.metricAlias,inventoryDefaultView:E.props.inventoryDefaultView,metricsExplorerDefaultView:E.props.metricsExplorerDefaultView,anomalyThreshold:u.number})),P=(u.partial({...$.type.props}),u.keyof({fallback:null,internal:null,stored:null})),C=u.strict({metricIndicesExist:R.props.metricIndicesExist,indexFields:R.props.indexFields}),F=u.exact(u.intersection([u.type({id:u.string,origin:P,configuration:$}),u.partial({updatedAt:u.number,version:u.string,status:C})])),M=u.type({source:F});var D=r(79),N=r(17);const Q=({sourceId:e="default",fetch:t,toastWarning:r})=>{const{error:s,loading:c,response:u,makeRequest:l}=Object(D.a)(`/api/metrics/source/${e}`,"GET",null,(e=>Object(o.pipe)(M.decode(e),Object(a.fold)(Object(N.c)(N.a),i.identity))),t,r);return Object(n.useEffect)((()=>{(async()=>{await l()})()}),[l]),{createDerivedIndexPattern:Object(n.useCallback)((()=>{return{fields:null!=u&&u.source.status?u.source.status.indexFields:[],title:(e=null==u?void 0:u.source,t="metrics",e?"metrics"===t?e.configuration.metricAlias:`${e.configuration.metricAlias}`:"unknown-index")};var e,t}),[u]),source:Object(n.useMemo)((()=>u?u.source:null),[u]),loading:c,error:s}},A=c()(Q),[L,_]=A},109:function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return O}));var n=r(1),a=r(23),i=r(2),o=r.n(i),s=r(51),c=r(94),u=r.n(c),l=r(74),d=r(90),f=r(92),m=r(88),p=r(98),b=r(13),g=r(71),y=r(99);const v=({match:{params:{nodeId:e,nodeType:t,sourceId:r="default"}},location:i})=>{const{services:c}=Object(b.b)(),{isLoading:v,load:O}=Object(g.b)({fetch:c.http.fetch,logViewId:r,logViews:c.logViews.client});if(u()((()=>{O()})),v)return o.a.createElement(d.a,{"data-test-subj":`nodeLoadingPage-${t}`,message:n.i18n.translate("xpack.infra.redirectToNodeLogs.loadingNodeLogsMessage",{defaultMessage:"Loading {nodeType} logs",values:{nodeType:t}})});const h=`${Object(l.a)(t).id}: ${e}`,j=Object(y.a)(i),E=j?`(${h}) and (${j})`:h,x=Object(a.flowRight)(Object(f.c)({language:"kuery",query:E}),Object(m.c)(Object(y.c)(i)),Object(p.a)(r))("");return o.a.createElement(s.Redirect,{to:`/stream?${x}`})},O=({nodeId:e,nodeType:t,time:r})=>({app:"logs",pathname:`link-to/${t}-logs/${e}`,search:r?{time:`${r}`}:void 0})},118:function(e,t,r){"use strict";r(155),r(187);var n=r(109);r.d(t,"b",(function(){return n.b}));var a=r(132);r.d(t,"a",(function(){return a.b}))},121:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(52),a=r(2),i=n.__importDefault(r(122));t.default=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=[]);var n=i.default(e,t),o=n[0],s=n[1],c=n[2];return a.useEffect(c,r),[o,s]}},122:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2);t.default=function(e,t){void 0===t&&(t=0);var r=n.useRef(!1),a=n.useRef(),i=n.useRef(e),o=n.useCallback((function(){return r.current}),[]),s=n.useCallback((function(){r.current=!1,a.current&&clearTimeout(a.current),a.current=setTimeout((function(){r.current=!0,i.current()}),t)}),[t]),c=n.useCallback((function(){r.current=null,a.current&&clearTimeout(a.current)}),[]);return n.useEffect((function(){i.current=e}),[e]),n.useEffect((function(){return s(),c}),[t]),[o,c,s]}},132:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return u}));var n=r(2),a=r.n(n),i=r(51),o=r(146),s=r(99);const c=({match:{params:{nodeId:e,nodeType:t}},location:r})=>{const n=Object(o.b)(Object(s.b)(r),Object(s.d)(r))("");return a.a.createElement(i.Redirect,{to:`/detail/${t}/${e}?${n}`})},u=({nodeType:e,nodeId:t,to:r,from:n})=>({app:"metrics",pathname:`link-to/${e}-detail/${t}`,search:r&&n?{to:`${r}`,from:`${n}`}:void 0})},145:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return o}));var n=r(12),a=r(15);const i=a.euiStyled.div`
  display: flex;
  flex-direction: column;
  flex: 1 0 auto;
  width: 100%
`,o=a.euiStyled.div`
  flex: 1 0 0%;
  display: flex;
  flex-direction: row;
  background-color: ${e=>e.theme.eui.euiColorEmptyShade};
`;Object(a.euiStyled)(n.EuiPage)`
  align-self: stretch;
  flex: 1 0 0%;
`},146:function(e,t,r){"use strict";r.d(t,"b",(function(){return x})),r.d(t,"a",(function(){return w})),r.d(t,"c",(function(){return I}));var n=r(67),a=r.n(n),i=r(2),o=r(49),s=r.n(o),c=r(10),u=r.n(c),l=r(0),d=r(24),f=r(18),m=r(19),p=r(81),b=r(89);const g=e=>{const t=u.a.parse(e.from.toString()),r=u.a.parse(e.to.toString(),{roundUp:!0});return{...e,from:t&&t.valueOf()||s()().subtract(1,"hour").valueOf(),to:r&&r.valueOf()||s()().valueOf()}},y={from:"now-1h",to:"now",interval:">=1m"},v={time:y,autoReload:!1,refreshInterval:5e3},O=l.type({from:l.union([l.string,l.number]),to:l.union([l.string,l.number]),interval:l.string}),h=l.partial({time:O,autoReload:l.boolean,refreshInterval:l.number}),j=h.encode,E=e=>Object(d.pipe)(h.decode(e),Object(f.fold)(Object(m.constant)(void 0),m.identity)),x=(e,t)=>Number.isNaN(e)||Number.isNaN(t)?e=>e:Object(b.d)("metricTime",{autoReload:!1,time:{interval:">=1m",from:s()(e).toISOString(),to:s()(t).toISOString()}}),S=a()((()=>{const[e,t]=Object(p.b)({defaultState:v,decodeUrlState:E,encodeUrlState:j,urlStateKey:"metricTime"}),[r,n]=Object(i.useState)(e.autoReload||!1),[a,o]=Object(i.useState)(e.refreshInterval||5e3),[c,u]=Object(i.useState)(s()().valueOf()),[l,d]=Object(i.useState)(e.time||y);Object(i.useEffect)((()=>t({time:l,autoReload:r,refreshInterval:a})),[r,a,t,l]);const[f,m]=Object(i.useState)(g(e.time||y)),b=Object(i.useCallback)((e=>{d(e),m(g(e))}),[]);return{timeRange:l,setTimeRange:b,parsedTimeRange:f,refreshInterval:a,setRefreshInterval:o,isAutoReloading:r,setAutoReload:n,lastRefresh:c,triggerRefresh:Object(i.useCallback)((()=>u(s()().valueOf())),[u])}})),[w,I]=S},155:function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var n=r(2),a=r.n(n),i=r(51),o=r(23),s=r(92),c=r(88),u=r(98),l=r(99);const d=({location:e,match:t})=>{const r=t.params.sourceId||"default",n=Object(l.a)(e),d=Object(o.flowRight)(Object(s.c)({language:"kuery",query:n}),Object(c.c)(Object(l.c)(e)),Object(u.a)(r))("");return a.a.createElement(i.Redirect,{to:`/stream?${d}`})};var f=r(109);const m=r(74).d.map((e=>e.id)).join("|"),p=e=>a.a.createElement(i.Switch,null,a.a.createElement(i.Route,{path:`${e.match.url}/:sourceId?/:nodeType(${m})-logs/:nodeId`,component:f.a}),a.a.createElement(i.Route,{path:`${e.match.url}/:sourceId?/logs`,component:d}),a.a.createElement(i.Route,{path:`${e.match.url}/:sourceId?`,component:d}),a.a.createElement(i.Redirect,{to:"/"}))},187:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var n=r(2),a=r.n(n),i=r(51),o=r(132),s=r(1),c=r(146),u=r(9),l=r(99),d=r(90),f=r(218),m=r(107);const p=({match:{params:{hostIp:e}},location:t})=>{const{source:r}=Object(m.a)({sourceId:"default"}),{error:o,name:p}=((e,t)=>{var r;const a=null===(r=Object(u.useKibana)().services.http)||void 0===r?void 0:r.fetch,[i,o]=Object(n.useState)(null),[s,c]=Object(n.useState)(!0),[l,d]=Object(n.useState)(null);return Object(n.useEffect)((()=>{(async()=>{c(!0),o(null);try{if(!a)throw new Error("HTTP service is unavailable");if(e&&t){const r=await a("/api/infra/ip_to_host",{method:"POST",body:JSON.stringify({ip:e,index_pattern:t})});c(!1),d(r)}}catch(e){c(!1),o(e)}})()}),[e,t,a]),{name:l&&l.host||null,loading:s,error:i}})(e,r&&r.configuration&&r.configuration.metricAlias||null);if(o)return a.a.createElement(f.a,{message:s.i18n.translate("xpack.infra.linkTo.hostWithIp.error",{defaultMessage:'Host not found with IP address "{hostIp}".',values:{hostIp:e}})});const b=Object(c.b)(Object(l.b)(t),Object(l.d)(t))("");return p?a.a.createElement(i.Redirect,{to:`/detail/host/${p}?${b}`}):a.a.createElement(d.a,{message:s.i18n.translate("xpack.infra.linkTo.hostWithIp.loading",{defaultMessage:'Loading host with IP address "{hostIp}".',values:{hostIp:e}})})};var b=r(34);const g=({location:e})=>{const t=function(e){if(0===e.length)return{};const t=Object(b.parse)(e.substring(1));for(const e in t)Object.hasOwnProperty.call(t,e)&&(t[e]||delete t[e],Array.isArray(t.key)&&(t[e]=t[e][0]));return t}(e.search),r="?waffleFilter=(expression:'',kind:kuery)&waffleTime=(currentTime:{timestamp},isAutoReloading:!f)&waffleOptions=(accountId:'',autoBounds:!t,boundsOverride:(max:1,min:0),customMetrics:!({customMetric}),customOptions:!(),groupBy:!(),legend:(palette:cool,reverseColors:!f,steps:10),metric:{metric},nodeType:{nodeType},region:'',sort:(by:name,direction:desc),timelineOpen:!f,view:map)".replace(/{(\w+)}/g,((e,r)=>t[r]||""));return a.a.createElement(i.Redirect,{to:"/inventory"+r})},y=r(74).d.map((e=>e.id)).join("|"),v=e=>a.a.createElement(i.Switch,null,a.a.createElement(i.Route,{path:`${e.match.url}/:nodeType(${y})-detail/:nodeId`,component:o.a}),a.a.createElement(i.Route,{path:`${e.match.url}/host-detail-via-ip/:hostIp`,component:p}),a.a.createElement(i.Route,{path:`${e.match.url}/inventory`,component:g}),a.a.createElement(i.Redirect,{to:"/"}))},218:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return d}));var n=r(12),a=r(16),i=r(2),o=r.n(i),s=r(15),c=r(145);const u=Object(s.euiStyled)(c.b)`
  overflow: auto;
  background-color: ${e=>e.theme.eui.euiColorLightestShade};
`,l=({message:e})=>o.a.createElement(c.a,null,o.a.createElement(u,null,o.a.createElement(d,{message:e}))),d=({message:e})=>o.a.createElement(n.EuiPage,{style:{flex:"1 0 auto"}},o.a.createElement(n.EuiPageBody,null,o.a.createElement(n.EuiPageHeader,null,o.a.createElement(n.EuiPageHeaderSection,null,o.a.createElement(n.EuiTitle,{size:"m"},o.a.createElement("h1",null,o.a.createElement(a.FormattedMessage,{id:"xpack.infra.errorPage.unexpectedErrorTitle",defaultMessage:"Oops!"}))))),o.a.createElement(n.EuiPageContent,null,o.a.createElement(n.EuiCallOut,{color:"danger",title:e,iconType:"alert"},o.a.createElement("p",null,o.a.createElement(a.FormattedMessage,{id:"xpack.infra.errorPage.tryAgainDescription ",defaultMessage:"Please click the back button and try again."}))))))},70:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return f}));var n=r(67),a=r.n(n),i=r(2),o=r(9),s=r(68);const c=(e,t)=>e?"metrics"===t?e.configuration.metricAlias:`${e.configuration.metricAlias}`:"unknown-index",u="Failed to load source: No fetch client available.",l=a()((({sourceId:e})=>{var t;const r=null===(t=Object(o.useKibana)().services.http)||void 0===t?void 0:t.fetch,n=`/api/metrics/source/${e}`,[a,l]=Object(i.useState)(void 0),[d,f]=Object(s.c)({cancelPreviousOn:"resolution",createPromise:async()=>{if(!r)throw new Error(u);return await r(`${n}`,{method:"GET"})},onResolve:e=>{l(e.source)}},[r,e]),[m,p]=Object(s.c)({createPromise:async e=>{if(!r)throw new Error(u);return await r(n,{method:"PATCH",body:JSON.stringify(e)})},onResolve:e=>{e&&l(e.source)}},[r,e]),[b,g]=Object(s.c)({createPromise:async e=>{if(!r)throw new Error(u);return await r(n,{method:"PATCH",body:JSON.stringify(e)})},onResolve:e=>{e&&l(e.source)}},[r,e]),y=Object(i.useMemo)((()=>[d.state,m.state,b.state].some((e=>"pending"===e))),[d.state,m.state,b.state]),v=Object(i.useMemo)((()=>"uninitialized"===d.state),[d.state]),O=Object(i.useMemo)((()=>a?!!a.version:void 0),[a]),h=Object(i.useMemo)((()=>a&&a.status&&a.status.metricIndicesExist),[a]);return Object(i.useEffect)((()=>{f()}),[f,e]),{createSourceConfiguration:p,createDerivedIndexPattern:()=>({fields:null!=a&&a.status?a.status.indexFields:[],title:c(a,"metrics")}),isLoading:y,isLoadingSource:"pending"===d.state,isUninitialized:v,hasFailedLoadingSource:"rejected"===d.state,loadSource:f,loadSourceFailureMessage:"rejected"===d.state?`${d.value}`:void 0,metricIndicesExist:h,source:a,sourceExists:O,sourceId:e,updateSourceConfiguration:g,version:a&&a.version?a.version:void 0}})),[d,f]=l},79:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(2),a=r.n(n),i=r(1),o=r(9),s=r(68);function c(e,t,r,c=(e=>e),u,l){var d;const f=Object(o.useKibana)(),m=u||(null===(d=f.services.http)||void 0===d?void 0:d.fetch),p=l||f.notifications.toasts.danger,[b,g]=Object(n.useState)(null),[y,v]=Object(n.useState)(null),[O,h]=Object(s.c)({cancelPreviousOn:"resolution",createPromise:()=>{if(!m)throw new Error("HTTP service is unavailable");return m(e,{method:t,body:r})},onResolve:e=>g(c(e)),onReject:e=>{var t,r,n,o,c;const u=e;e&&e instanceof s.a||(v(u),p({toastLifeTimeMs:3e3,title:i.i18n.translate("xpack.infra.useHTTPRequest.error.title",{defaultMessage:"Error while fetching resource"}),body:a.a.createElement("div",null,u.response?a.a.createElement(a.a.Fragment,null,a.a.createElement("h5",null,i.i18n.translate("xpack.infra.useHTTPRequest.error.status",{defaultMessage:"Error"})),null===(t=u.response)||void 0===t?void 0:t.statusText," (",null===(r=u.response)||void 0===r?void 0:r.status,")",a.a.createElement("h5",null,i.i18n.translate("xpack.infra.useHTTPRequest.error.url",{defaultMessage:"URL"})),null===(n=u.response)||void 0===n?void 0:n.url,a.a.createElement("h5",null,i.i18n.translate("xpack.infra.useHTTPRequest.error.body.message",{defaultMessage:"Message"})),(null===(o=u.body)||void 0===o?void 0:o.message)||u.message):a.a.createElement("h5",null,(null===(c=u.body)||void 0===c?void 0:c.message)||u.message))}))}},[e,r,t,u,p]),j=Object(n.useMemo)((()=>"resolved"===O.state&&null===b||"pending"===O.state),[O.state,b]);return{response:b,error:y,loading:j,makeRequest:h}}},90:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return c}));var n=r(12),a=r(2),i=r.n(a),o=r(127);const s=({message:e,"data-test-subj":t="loadingPage"})=>i.a.createElement(o.a,{isEmptyState:!0,"data-test-subj":t},i.a.createElement(c,{message:e})),c=({message:e})=>i.a.createElement(n.EuiEmptyPrompt,{body:i.a.createElement(n.EuiFlexGroup,{alignItems:"center",gutterSize:"none"},i.a.createElement(n.EuiFlexItem,{grow:!1},i.a.createElement(n.EuiLoadingSpinner,{size:"xl",style:{marginRight:"8px"}})),i.a.createElement(n.EuiFlexItem,null,e))})},92:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return y}));var n=r(106),a=r(67),i=r.n(a),o=r(2),s=r.n(o),c=r(121),u=r.n(c),l=r(159);const d={filterQuery:null,filterQueryDraft:{language:"kuery",query:""},validationErrors:[]},f=i()((({indexPattern:e})=>{const[t,r]=Object(o.useState)(d),a=Object(l.a)(),i=Object(o.useCallback)((t=>Object(n.b)(e,t,[],a)),[e,a]),s=Object(o.useCallback)((e=>{r((t=>({...t,filterQueryDraft:e,validationErrors:[]})))}),[]),[,c]=u()((()=>{r((e=>{try{return i(t.filterQueryDraft),{...e,validationErrors:[]}}catch(t){return{...e,validationErrors:[`${t}`]}}}))}),1e3,[t.filterQueryDraft,i]),f=Object(o.useCallback)((e=>{c();try{const t=i(e);r((r=>({...r,filterQuery:{parsedQuery:t,serializedQuery:JSON.stringify(t),originalQuery:e},filterQueryDraft:e,validationErrors:[]})))}catch(e){r((t=>({...t,validationErrors:[`${e}`]})))}}),[c,i]);return{filterQuery:t.filterQuery,filterQueryDraft:t.filterQueryDraft,isFilterQueryDraftValid:0===t.validationErrors.length,setLogFilterQueryDraft:s,applyLogFilterQuery:f}}));var m=r(0),p=r(89);const b=()=>{const{filterQuery:e,applyLogFilterQuery:t}=Object(o.useContext)(f.Context);return s.a.createElement(p.a,{urlState:null==e?void 0:e.originalQuery,urlStateKey:"logFilter",mapToUrlState:g,onChange:e=>{e&&t(e)},onInitialize:e=>{e&&t(e)}})},g=e=>O.is(e)?{language:e.kind,query:e.expression}:v.is(e)?e:void 0,y=e=>Object(p.d)("logFilter",e),v=m.type({language:m.string,query:m.string}),O=m.type({kind:m.literal("kuery"),expression:m.string})},98:function(e,t,r){"use strict";r.d(t,"b",(function(){return u})),r.d(t,"a",(function(){return l}));var n=r(0),a=r(24),i=r(18),o=r(19),s=r(81);const c="sourceId",u=()=>Object(s.b)({defaultState:"default",decodeUrlState:m,encodeUrlState:f,urlStateKey:c}),l=e=>Object(s.a)(c,e),d=n.union([n.string,n[void 0]]),f=d.encode,m=e=>Object(a.pipe)(d.decode(e),Object(i.fold)(Object(o.constant)(void 0),o.identity))},99:function(e,t,r){"use strict";r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return i})),r.d(t,"d",(function(){return o})),r.d(t,"b",(function(){return s}));var n=r(89);const a=e=>{const t=Object(n.b)(Object(n.c)(e),"time");return t?parseFloat(t):NaN},i=e=>Object(n.b)(Object(n.c)(e),"filter")||"",o=e=>{const t=Object(n.b)(Object(n.c)(e),"to");return t?parseFloat(t):NaN},s=e=>{const t=Object(n.b)(Object(n.c)(e),"from");return t?parseFloat(t):NaN}}}]);