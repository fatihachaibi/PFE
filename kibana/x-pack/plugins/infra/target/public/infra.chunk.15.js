/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[15],{290:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n.n(r),i=n(35),o=n(70),u=n(12),s=n(96);const c=e=>{const{timerange:t,isLoading:n,containers:i,pageCount:o,currentPageIndex:c,setCurrentPageIndex:l,sortState:g,setSortState:m}=e,f=Object(r.useMemo)((()=>function(e){return[{name:"Name",field:"name",truncateText:!0,render:t=>a.a.createElement(s.a,{id:t,nodeType:"container",timerange:e})},{name:"Uptime",field:"uptime",align:"right",render:e=>a.a.createElement(s.d,{uptimeMs:e})},{name:"CPU usage (avg.)",field:"averageCpuUsagePercent",align:"right",render:e=>a.a.createElement(s.b,{value:e,unit:"%"})},{name:"Memory usage(avg.)",field:"averageMemoryUsageMegabytes",align:"right",render:e=>a.a.createElement(s.b,{value:e,unit:" MB"})}]}(t)),[t]),d={enableAllColumns:!0,sort:g},p=Object(r.useCallback)((({sort:e})=>{e&&(m(e),l(0))}),[m,l]);return n?a.a.createElement(u.EuiFlexGroup,{alignItems:"center",justifyContent:"center",direction:"column"},a.a.createElement(u.EuiLoadingSpinner,{size:"xl","data-test-subj":"containerMetricsTableLoader"})):a.a.createElement(a.a.Fragment,null,a.a.createElement(u.EuiBasicTable,{tableCaption:"Infrastructure metrics for containers",items:i,columns:f,sorting:d,onChange:p,"data-test-subj":"containerMetricsTable"}),a.a.createElement(u.EuiSpacer,{size:"s"}),a.a.createElement(u.EuiFlexGroup,{justifyContent:"flexEnd",alignItems:"center",responsive:!1,wrap:!0},a.a.createElement(u.EuiFlexItem,{grow:!1},a.a.createElement(s.c,{ariaLabel:"Container metrics pagination",pageCount:o,currentPageIndex:c,setCurrentPageIndex:l,"data-test-subj":"containerMetricsTablePagination"}))))},{options:l,metricByField:g}=Object(s.e)({"kubernetes.container.start_time":{aggregation:"max",field:"kubernetes.container.start_time"},"kubernetes.container.cpu.usage.node.pct":{aggregation:"avg",field:"kubernetes.container.cpu.usage.node.pct"},"kubernetes.container.memory.usage.bytes":{aggregation:"avg",field:"kubernetes.container.memory.usage.bytes"}},"container.id");function m(e){return 0===e.rows.length?{name:e.id,uptime:null,averageCpuUsagePercent:null,averageMemoryUsageMegabytes:null}:{name:e.id,...f(e.rows)}}function f(e){const{uptimeValues:t,averageCpuUsagePercentValues:n,averageMemoryUsageMegabytesValues:r}=function(e){const t=[],n=[],r=[];return e.forEach((e=>{const{uptime:a,averageCpuUsagePercent:i,averageMemoryUsageMegabytes:o}=function(e){return{uptime:e[g["kubernetes.container.start_time"]],averageCpuUsagePercent:e[g["kubernetes.container.cpu.usage.node.pct"]],averageMemoryUsageMegabytes:e[g["kubernetes.container.memory.usage.bytes"]]}}(e);null!==a&&t.push(a),null!==i&&n.push(i),null!==o&&r.push(o)})),{uptimeValues:t,averageCpuUsagePercentValues:n,averageMemoryUsageMegabytesValues:r}}(e);let a=null;0!==t.length&&(a=d(t));let i=null;0!==n.length&&(i=d(n));let o=null;if(0!==r.length){const e=d(r),t=1e6;o=Math.floor(e/t)}return{uptime:a,averageCpuUsagePercent:i,averageMemoryUsageMegabytes:o}}function d(e){return e.reduce(((e,t)=>e+t),0)/e.length}function p({timerange:e,filterClauseDsl:t}){const n=function({timerange:e,filterClauseDsl:t}){const[n,a]=Object(r.useState)(0),[i,o]=Object(r.useState)({field:"averageCpuUsagePercent",direction:"desc"}),{isLoading:u,nodes:c,pageCount:g}=Object(s.f)({metricsExplorerOptions:l,timerange:e,filterClauseDsl:t,transform:m,sortState:i,currentPageIndex:n});return{timerange:e,isLoading:u,containers:c,pageCount:g,currentPageIndex:n,setCurrentPageIndex:a,sortState:i,setSortState:o}}({timerange:e,filterClauseDsl:t});return a.a.createElement(c,n)}t.default=function({timerange:e,filterClauseDsl:t,sourceId:n,...r}){return a.a.createElement(i.b,r,a.a.createElement(o.b,{sourceId:n},a.a.createElement(p,{timerange:e,filterClauseDsl:t})))}},96:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return d})),n.d(t,"d",(function(){return p})),n.d(t,"e",(function(){return E})),n.d(t,"f",(function(){return P}));var r=n(10),a=n(12),i=n(2),o=n.n(i),u=n(30),s=n(118);const c=({id:e,nodeType:t,timerange:n})=>{var i,c;const l=Object(u.useLinkProps)(Object(s.a)({nodeType:t,nodeId:e,from:null===(i=Object(r.parse)(n.from))||void 0===i?void 0:i.valueOf(),to:null===(c=Object(r.parse)(n.to))||void 0===c?void 0:c.valueOf()}));return o.a.createElement(a.EuiLink,{href:l.href},e)};function l({value:e,unit:t}){return null==e||isNaN(e)?o.a.createElement(a.EuiTextColor,{color:"subdued"},"N/A"):t?o.a.createElement("span",null,o.a.createElement(a.EuiI18nNumber,{value:g(e)}),t):o.a.createElement(a.EuiI18nNumber,{value:g(e)})}function g(e){return Math.round(10*e)/10}var m=n(15);const f=Object(m.euiStyled)(a.EuiPagination)`
  [data-test-subj="pagination-button-first"],
  [data-test-subj="pagination-button-last"] {
    display: none;
  }
`;function d({ariaLabel:e,pageCount:t,currentPageIndex:n,setCurrentPageIndex:r}){return o.a.createElement(f,{"aria-label":e,pageCount:t,activePage:n,onPageClick:r,compressed:!0})}function p({uptimeMs:e}){return null==e||isNaN(e)?o.a.createElement(a.EuiTextColor,{color:"subdued"},"N/A"):o.a.createElement("span",null,function(e){if(e<v){const t=Math.floor(e/b);return t>0?`${t}m`:"< a minute"}if(e<y){const t=Math.floor(e/v),n=e-t*v,r=Math.floor(n/b);return r>0?`${t}h ${r}m`:`${t}h`}const t=Math.floor(e/y),n=e-t*y,r=Math.floor(n/v);return r>0?`${t}d ${r}h`:`${t}d`}(e))}const b=6e4,v=36e5,y=864e5;function E(e,t){const n=Object.values(e),r={aggregation:"avg",groupBy:t,metrics:n},a=function(e,t){return e.reduce(((e,n)=>({...e,[n]:C(n,t)})),{})}(Object.keys(e),n);return{options:r,metricByField:a}}function C(e,t){const n=t.findIndex((t=>t.field===e));if(-1===n)throw new Error("Failed to find index for field "+e);return`metric_${n}`}var h=n(9),j=n(70),M=n(68);const O={series:[],pageInfo:{afterKey:null,total:-1}},P=e=>{const{metricsExplorerOptions:t,timerange:n,filterClauseDsl:a,transform:o,sortState:u,currentPageIndex:s}=e,[c,l]=Object(i.useState)([]),g=function(){var e;const t=null===(e=Object(h.useKibana)().services.http)||void 0===e?void 0:e.fetch;if(!t)throw new Error("Could not find Kibana HTTP fetch");return t}(),{source:m,isLoadingSource:f}=Object(j.c)(),d=function(e){return Object(i.useMemo)((()=>{const t=Object(r.parse)(e.from),n=Object(r.parse)(e.to);if(!t||!n)throw new Error("Could not parse timerange");return{from:t.valueOf(),to:n.valueOf(),interval:"modules"}}),[e])}(n),[{state:p},b]=Object(M.c)({createPromise:()=>{if(!m)return Promise.resolve(O);const e={metrics:t.metrics,groupBy:t.groupBy,limit:1e4,indexPattern:m.configuration.metricAlias,filterQuery:JSON.stringify(a),timerange:d};return g("/api/infra/metrics_explorer",{method:"POST",body:JSON.stringify(e)})},onResolve:e=>{l(e.series.map(o))},onReject:e=>{console.log(e)},cancelPreviousOn:"creation"},[m,t,d,a]),v="pending"===p||"uninitialized"===p;Object(i.useEffect)((()=>{b()}),[b]);const y=Object(i.useMemo)((()=>[...c].sort(function(e){return(t,n)=>{const r=t[e.field],a=n[e.field];return"asc"===e.direction?function(e,t){return null===e?-1:null===t?1:"string"==typeof e&&"string"==typeof t?e.localeCompare(t):"number"==typeof e&&"number"==typeof t?e-t:0}(r,a):function(e,t){return null===e?1:null===t?-1:"string"==typeof e&&"string"==typeof t?t.localeCompare(e):"number"==typeof e&&"number"==typeof t?t-e:0}(r,a)}}(u))),[c,u]),E=Object(i.useMemo)((()=>y.slice(0,100)),[y]);return{isLoading:f||v,nodes:Object(i.useMemo)((()=>{const e=10*s,t=e+10;return E.slice(e,t)}),[E,s]),pageCount:Object(i.useMemo)((()=>Math.ceil(E.length/10)),[E])}}}}]);