/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[14],{107:function(e,t,a){"use strict";a.d(t,"a",(function(){return D}));var r=a(2),n=a(18),i=a(19),l=a(24),s=a(67),o=a.n(s),c=a(0),u=a(23),d=a(49),m=a.n(d);const p=new c.Type("TimestampFromString",(e=>"number"==typeof e),((e,t)=>Object(l.pipe)(c.string.validate(e,t),Object(n.chain)((e=>{const a=m()(e);return a.isValid()?c.success(a.valueOf()):c.failure(e,t)})))),(e=>new Date(e).toISOString())),g=(c.type({sources:c.type({default:c.partial({fields:c.partial({message:c.array(c.string)})})})}),c.type({timestampColumn:c.type({id:c.string})})),f=c.type({messageColumn:c.type({id:c.string})}),b=c.type({fieldColumn:c.type({id:c.string,field:c.string})}),y=c.union([g,f,b]),h=c.type({type:c.literal("index_pattern"),indexPatternId:c.string}),E=c.type({type:c.literal("index_name"),indexName:c.string}),v=c.union([h,E]),x=c.type({message:c.array(c.string)}),O=c.type({name:c.string,description:c.string,metricAlias:c.string,logIndices:v,inventoryDefaultView:c.string,metricsExplorerDefaultView:c.string,fields:x,logColumns:c.array(y),anomalyThreshold:c.number}),T=c.partial(Object(u.omit)(x.props,["message"])),j=c.intersection([c.partial(Object(u.omit)(O.props,["fields"])),c.partial({fields:T})]),k=c.partial(x.props),M=(c.partial({...O.props,fields:k}),c.type({...O.props,fields:x,logColumns:c.array(y)})),C=c.type({name:c.string,type:c.string,searchable:c.boolean,aggregatable:c.boolean,displayable:c.boolean}),F=c.type({logIndicesExist:c.boolean,metricIndicesExist:c.boolean,indexFields:c.array(C)}),w=c.intersection([c.type({id:c.string,origin:c.keyof({fallback:null,internal:null,stored:null}),configuration:M}),c.partial({version:c.string,updatedAt:c.number,status:F})]),S=(c.type({source:w}),c.intersection([c.type({id:c.string,attributes:j}),c.partial({version:c.string,updated_at:p})]),c.strict({name:O.props.name,description:O.props.description,metricAlias:O.props.metricAlias,inventoryDefaultView:O.props.inventoryDefaultView,metricsExplorerDefaultView:O.props.metricsExplorerDefaultView,anomalyThreshold:c.number})),A=(c.partial({...S.type.props}),c.keyof({fallback:null,internal:null,stored:null})),R=c.strict({metricIndicesExist:F.props.metricIndicesExist,indexFields:F.props.indexFields}),I=c.exact(c.intersection([c.type({id:c.string,origin:A,configuration:S}),c.partial({updatedAt:c.number,version:c.string,status:R})])),B=c.type({source:I});var L=a(79),P=a(17);const D=({sourceId:e="default",fetch:t,toastWarning:a})=>{const{error:s,loading:o,response:c,makeRequest:u}=Object(L.a)(`/api/metrics/source/${e}`,"GET",null,(e=>Object(l.pipe)(B.decode(e),Object(n.fold)(Object(P.c)(P.a),i.identity))),t,a);return Object(r.useEffect)((()=>{(async()=>{await u()})()}),[u]),{createDerivedIndexPattern:Object(r.useCallback)((()=>{return{fields:null!=c&&c.source.status?c.source.status.indexFields:[],title:(e=null==c?void 0:c.source,t="metrics",e?"metrics"===t?e.configuration.metricAlias:`${e.configuration.metricAlias}`:"unknown-index")};var e,t}),[c]),source:Object(r.useMemo)((()=>c?c.source:null),[c]),loading:o,error:s}},z=o()(D),[N,G]=z},113:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a(9),n=a(54);function i(){const[e]=Object(r.useUiSetting$)(n.UI_SETTINGS.DATEFORMAT_TZ);return e&&"Browser"!==e?e:"local"}},135:function(e,t,a){"use strict";a.d(t,"i",(function(){return p})),a.d(t,"d",(function(){return g})),a.d(t,"f",(function(){return f})),a.d(t,"j",(function(){return b})),a.d(t,"k",(function(){return y})),a.d(t,"h",(function(){return h})),a.d(t,"g",(function(){return E})),a.d(t,"a",(function(){return x})),a.d(t,"e",(function(){return O})),a.d(t,"c",(function(){return T})),a.d(t,"b",(function(){return j}));var r=a(2),n=a.n(r),i=a(50),l=a(49),s=a.n(l),o=a(1),c=a(12),u=a(16),d=a(23),m=a(11);const p={headerFormatter:e=>s()(e.value).format("Y-MM-DD HH:mm:ss")},g=20,f={s:o.i18n.translate("xpack.infra.alerts.timeLabels.seconds",{defaultMessage:"seconds"}),m:o.i18n.translate("xpack.infra.alerts.timeLabels.minutes",{defaultMessage:"minutes"}),h:o.i18n.translate("xpack.infra.alerts.timeLabels.hours",{defaultMessage:"hours"}),d:o.i18n.translate("xpack.infra.alerts.timeLabels.days",{defaultMessage:"days"})},b=(e,t)=>Object(r.useMemo)((()=>"number"==typeof e&&"number"==typeof t?Object(i.niceTimeFormatter)([e,t]):e=>`${e}`),[e,t]),y=m.a,h=(e,t=!1)=>{let a=null,r=null;const n=e.reduce(((e,t)=>(t.points.forEach((t=>{const a=e[t.timestamp]||[];e[t.timestamp]=[...a,t.value]})),e)),{});Object.values(n).forEach((e=>{const n=t?Object(d.sum)(e):Object(d.max)(e),i=Object(d.min)(e);n&&(!r||n>r)&&(r=n),i&&(!a||i<a)&&(a=i)}));const i=Object.keys(n).map(Number),l=Object(d.min)(i)||0,s=Object(d.max)(i)||0;return{yMin:a||0,yMax:r||0,xMin:l,xMax:s}},E=e=>e?i.DARK_THEME:i.LIGHT_THEME,v=({children:e})=>n.a.createElement("div",{style:{width:"100%",height:150,display:"flex",justifyContent:"center",alignItems:"center"}},e),x=({children:e})=>n.a.createElement("div",{style:{width:"100%",height:150}},e),O=()=>n.a.createElement(v,null,n.a.createElement(c.EuiText,{color:"subdued","data-test-subj":"noChartData"},n.a.createElement(u.FormattedMessage,{id:"xpack.infra.alerts.charts.noDataMessage",defaultMessage:"No chart data available"}))),T=()=>n.a.createElement(v,null,n.a.createElement(c.EuiText,{color:"subdued","data-test-subj":"loadingData"},n.a.createElement(u.FormattedMessage,{id:"xpack.infra.alerts.charts.loadingMessage",defaultMessage:"Loading"}))),j=()=>n.a.createElement(v,null,n.a.createElement(c.EuiText,{color:"subdued","data-test-subj":"chartErrorState"},n.a.createElement(u.FormattedMessage,{id:"xpack.infra.alerts.charts.errorMessage",defaultMessage:"Uh oh, something went wrong"})))},174:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var r=a(12),n=a(1),i=a(2),l=a.n(i);const s=({options:e,onChange:t,fields:a,errorOptions:s})=>{const o=Object(i.useCallback)((e=>{const a=e.map((e=>e.label));t(a)}),[t]),c=Array.isArray(e.groupBy)?e.groupBy.map((e=>({label:e,color:null!=s&&s.includes(e)?"danger":void 0}))):e.groupBy?[{label:e.groupBy,color:null!=s&&s.includes(e.groupBy)?"danger":void 0}]:[];return l.a.createElement(r.EuiComboBox,{"data-test-subj":"metricsExplorer-groupBy",placeholder:n.i18n.translate("xpack.infra.metricsExplorer.groupByLabel",{defaultMessage:"Everything"}),"aria-label":n.i18n.translate("xpack.infra.metricsExplorer.groupByAriaLabel",{defaultMessage:"Graph per"}),fullWidth:!0,singleSelection:!1,selectedOptions:c,options:a.filter((e=>e.aggregatable&&"string"===e.type)).map((e=>({label:e.name}))),onChange:o,isClearable:!0})}},175:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var r=a(10),n=a.n(r),i=a(2),l=a(23),s=a(9),o=a(86),c=a(105),u=a(17),d=a(68);function m(e,t,a,r,m,p,g=!0){var f;const b=null===(f=Object(s.useKibana)().services.http)||void 0===f?void 0:f.fetch,[y,h]=Object(i.useState)(null),[E,v]=Object(i.useState)(!0),[x,O]=Object(i.useState)(null),[T,j]=Object(i.useState)(null),[k,M]=Object(i.useState)(null),C=n.a.parse(r.from),F=n.a.parse(r.to,{roundUp:!0}),[,w]=Object(d.c)({cancelPreviousOn:"creation",createPromise:()=>(v(!0),C&&F?b?t?b?b("/api/infra/metrics_explorer",{method:"POST",body:JSON.stringify({forceInterval:e.forceInterval,dropLastBucket:null==e.dropLastBucket||e.dropLastBucket,metrics:"count"===e.aggregation?[{aggregation:"count"}]:e.metrics.map((e=>({aggregation:e.aggregation,field:e.field}))),groupBy:e.groupBy,afterKey:m,limit:e.limit,indexPattern:t.metricAlias,filterQuery:e.filterQuery&&Object(c.a)(e.filterQuery,a)||void 0,timerange:{...r,from:C.valueOf(),to:F.valueOf()}})}):Promise.reject(new Error("HTTP service is unavailable")):Promise.reject(new Error("Source is unavailable")):Promise.reject(new Error("HTTP service is unavailable")):Promise.reject(new Error("Unalble to parse timerange"))),onResolve:t=>{v(!1);const a=Object(u.b)(o.e)(t);if(a){if(x&&T&&x.pageInfo.afterKey!==a.pageInfo.afterKey&&(n=T,i=e,Object(l.isEqual)(n,i))&&Object(l.isEqual)(r,k)&&m){const{series:e}=x;O({...a,series:[...e,...a.series]})}else O(a);j(e),M(r),h(null)}var n,i},onReject:e=>{h(e),v(!1)}},[t,r,e,p,m]);return Object(i.useEffect)((()=>{g&&w()}),[w,g]),{error:y,loading:E,data:x,loadData:w}}},183:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var r=a(50),n=a(23),i=a(2),l=a.n(i),s=a(7),o=a(78);const c=.3,u=({threshold:e,sortedThresholds:t,comparator:a,color:i,id:u,firstTimestamp:d,lastTimestamp:m,domain:p})=>{if(!a||!e)return null;const g=[s.b.GT,s.b.GT_OR_EQ].includes(a),f=[s.b.LT,s.b.LT_OR_EQ].includes(a);return l.a.createElement(l.a.Fragment,null,l.a.createElement(r.LineAnnotation,{id:`${u}-thresholds`,domainType:r.AnnotationDomainType.YDomain,"data-test-subj":"threshold-line",dataValues:t.map((e=>({dataValue:e}))),style:{line:{strokeWidth:2,stroke:Object(o.b)(i),opacity:1}}}),2===t.length&&a===s.b.BETWEEN?l.a.createElement(l.a.Fragment,null,l.a.createElement(r.RectAnnotation,{id:`${u}-lower-threshold`,"data-test-subj":"between-rect",style:{fill:Object(o.b)(i),opacity:c},dataValues:[{coordinates:{x0:d,x1:m,y0:Object(n.first)(e),y1:Object(n.last)(e)}}]})):null,2===t.length&&a===s.b.OUTSIDE_RANGE?l.a.createElement(l.a.Fragment,null,l.a.createElement(r.RectAnnotation,{id:`${u}-lower-threshold`,"data-test-subj":"outside-range-lower-rect",style:{fill:Object(o.b)(i),opacity:c},dataValues:[{coordinates:{x0:d,x1:m,y0:p.min,y1:Object(n.first)(e)}}]}),l.a.createElement(r.RectAnnotation,{id:`${u}-upper-threshold`,"data-test-subj":"outside-range-upper-rect",style:{fill:Object(o.b)(i),opacity:c},dataValues:[{coordinates:{x0:d,x1:m,y0:Object(n.last)(e),y1:p.max}}]})):null,f&&null!=Object(n.first)(e)?l.a.createElement(r.RectAnnotation,{id:`${u}-upper-threshold`,"data-test-subj":"below-rect",style:{fill:Object(o.b)(i),opacity:c},dataValues:[{coordinates:{x0:d,x1:m,y0:p.min,y1:Object(n.first)(e)}}]}):null,g&&null!=Object(n.first)(e)?l.a.createElement(r.RectAnnotation,{id:`${u}-upper-threshold`,"data-test-subj":"above-rect",style:{fill:Object(o.b)(i),opacity:c},dataValues:[{coordinates:{x0:d,x1:m,y0:Object(n.first)(e),y1:p.max}}]}):null)}},288:function(e,t,a){"use strict";a.r(t),a.d(t,"defaultExpression",(function(){return D})),a.d(t,"Expressions",(function(){return z}));var r=a(2),n=a.n(r),i=a(12),l=a(1),s=a(16),o=a(23),c=a(56),u=a(7),d=a(107),m=a(13),p=a(174),g=a(148),f=a(105),b=a(50),y=a(78),h=a(115),E=a(82),v=a(114),x=a(116),O=a(175),T=a(147),j=a(135),k=a(183);const M=({expression:e,derivedIndexPattern:t,source:a,filterQuery:l,groupBy:c})=>{var u,d;const{loading:p,data:g}=((e,t,a,n,i)=>{const{timeSize:l,timeUnit:s}=e||{timeSize:1,timeUnit:"m"},o=Object(r.useMemo)((()=>({limit:1,forceInterval:!0,dropLastBucket:!1,groupBy:i,filterQuery:n,metrics:[{field:e.metric,aggregation:e.aggType}],aggregation:e.aggType||"avg"})),[e.aggType,e.metric,n,i]),c=Object(r.useMemo)((()=>({interval:`>=${l||1}${s}`,from:`now-${20*(l||1)}${s}`,to:"now"})),[l,s]);return Object(O.a)(o,null==a?void 0:a.configuration,t,c,null,null)})(e,t,a,l,c),{uiSettings:f}=Object(m.b)().services,M={field:e.metric,aggregation:e.aggType,color:y.a.color0},C=(null==f?void 0:f.get("theme:darkMode"))||!1,F=Object(r.useMemo)((()=>{var e,t;const a=Object(o.first)(null==g?void 0:g.series),r=null===(e=Object(o.first)(null==a?void 0:a.rows))||void 0===e?void 0:e.timestamp,n=null===(t=Object(o.last)(null==a?void 0:a.rows))||void 0===t?void 0:t.timestamp;return null==r||null==n?e=>`${e}`:Object(b.niceTimeFormatter)([r,n])}),[null==g?void 0:g.series]),w=Object(r.useCallback)(Object(v.a)(M),[e]);if(p||!g)return n.a.createElement(j.c,null);const S=e.threshold.slice().sort(),A=null!==(u=null===(d=e.warningThreshold)||void 0===d?void 0:d.slice().sort())&&void 0!==u?u:[],R=[...S,...A].sort(),I=Object(o.first)(g.series);if(!I||!I.rows||0===I.rows.length)return n.a.createElement(j.e,null);const B={...I,rows:I.rows.map((e=>{const t={...e};return R.forEach(((e,a)=>{t[Object(T.a)(M,`threshold_${a}`)]=e})),t}))},L=Object(o.first)(I.rows).timestamp,P=Object(o.last)(I.rows).timestamp,D=Object(x.a)(B,[M],!1),z={max:1.1*Math.max(D.max,Object(o.last)(R)||D.max),min:.9*Math.min(D.min,Object(o.first)(R)||D.min)};z.min===Object(o.first)(e.threshold)&&(z.min=.9*z.min);const{timeSize:N,timeUnit:G}=e,U=j.f[G];return n.a.createElement(n.a.Fragment,null,n.a.createElement(j.a,null,n.a.createElement(b.Chart,null,n.a.createElement(h.a,{type:E.b.bar,metric:M,id:"0",series:B,stack:!1}),n.a.createElement(k.a,{comparator:e.comparator,threshold:e.threshold,sortedThresholds:S,color:y.a.color1,id:"critical",firstTimestamp:L,lastTimestamp:P,domain:z}),e.warningComparator&&e.warningThreshold&&n.a.createElement(k.a,{comparator:e.warningComparator,threshold:e.warningThreshold,sortedThresholds:A,color:y.a.color5,id:"warning",firstTimestamp:L,lastTimestamp:P,domain:z}),n.a.createElement(b.Axis,{id:"timestamp",position:b.Position.Bottom,showOverlappingTicks:!0,tickFormat:F}),n.a.createElement(b.Axis,{id:"values",position:b.Position.Left,tickFormat:w,domain:z}),n.a.createElement(b.Settings,{tooltip:j.i,theme:Object(j.g)(C)}))),n.a.createElement("div",{style:{textAlign:"center"}},"ALL"!==B.id?n.a.createElement(i.EuiText,{size:"xs",color:"subdued"},n.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alerts.dataTimeRangeLabelWithGrouping",defaultMessage:"Last {lookback} {timeLabel} of data for {id}",values:{id:B.id,timeLabel:U,lookback:20*N}})):n.a.createElement(i.EuiText,{size:"xs",color:"subdued"},n.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alerts.dataTimeRangeLabel",defaultMessage:"Last {lookback} {timeLabel}",values:{timeLabel:U,lookback:20*N}}))))};var C=a(15);const F=(e,t)=>{const a=t?new RegExp(/0?\./):".",r=String(e).replace(a,"").length;return parseFloat((t?100*e:e/100).toPrecision(r))};let w;!function(e){e.COUNT="count",e.AVERAGE="avg",e.SUM="sum",e.MIN="min",e.MAX="max",e.RATE="rate",e.CARDINALITY="cardinality",e.P95="p95",e.P99="p99"}(w||(w={}));const S={...c.builtInComparators,[u.b.OUTSIDE_RANGE]:{text:l.i18n.translate("xpack.infra.metrics.alertFlyout.outsideRangeLabel",{defaultMessage:"Is not between"}),value:u.b.OUTSIDE_RANGE,requiredValues:2}},A=Object(C.euiStyled)(i.EuiFlexGroup)`
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  margin: 0 -4px;
`,R=C.euiStyled.div`
  padding: 0 4px;
`,I=Object(C.euiStyled)(i.EuiHealth)`
  margin-left: 4px;
`,B=e=>{var t,a;const[d,m]=Object(r.useState)(!0),p=Object(r.useCallback)((()=>m(!d)),[d]),{children:g,setRuleParams:f,expression:b,errors:y,expressionId:h,remove:E,fields:v,canDelete:x}=e,{aggType:O=w.MAX,metric:T,comparator:j=u.b.GT,threshold:k=[],warningThreshold:M=[],warningComparator:C}=b,[S,B]=Object(r.useState)(Boolean(null==M?void 0:M.length)),D=Object(r.useMemo)((()=>Boolean(T&&T.endsWith(".pct"))),[T]),z=Object(r.useCallback)((e=>{f(h,{...b,aggType:e,metric:"count"===e?void 0:b.metric})}),[h,b,f]),N=Object(r.useCallback)((e=>{f(h,{...b,metric:e})}),[h,b,f]),G=Object(r.useCallback)((e=>{f(h,{...b,comparator:e})}),[h,b,f]),U=Object(r.useCallback)((e=>{f(h,{...b,warningComparator:e})}),[h,b,f]),Q=Object(r.useCallback)((e=>D?e.map((e=>(e=>F(e,!1))(e))):e),[D]),$=Object(r.useCallback)((e=>{const t=Q(e);t.join()!==b.threshold.join()&&f(h,{...b,threshold:t})}),[h,b,Q,f]),q=Object(r.useCallback)((e=>{var t;const a=Q(e);a.join()!==(null===(t=b.warningThreshold)||void 0===t?void 0:t.join())&&f(h,{...b,warningThreshold:a})}),[h,b,Q,f]),_=Object(r.useCallback)((()=>{S?(B(!1),f(h,Object(o.omit)(b,"warningComparator","warningThreshold"))):(B(!0),f(h,{...b,warningComparator:j,warningThreshold:[]}))}),[S,B,f,j,b,h]),W=n.a.createElement(L,{comparator:j,threshold:k,updateComparator:G,updateThreshold:$,errors:null!==(t=y.critical)&&void 0!==t?t:{},isMetricPct:D}),H=S&&n.a.createElement(L,{comparator:C||j,threshold:M,updateComparator:U,updateThreshold:q,errors:null!==(a=y.warning)&&void 0!==a?a:{},isMetricPct:D});return n.a.createElement(n.a.Fragment,null,n.a.createElement(i.EuiFlexGroup,{gutterSize:"xs"},n.a.createElement(i.EuiFlexItem,{grow:!1},n.a.createElement(i.EuiButtonIcon,{iconType:d?"arrowDown":"arrowRight",onClick:p,"aria-label":l.i18n.translate("xpack.infra.metrics.alertFlyout.expandRowLabel",{defaultMessage:"Expand row."})})),n.a.createElement(i.EuiFlexItem,{grow:!0},n.a.createElement(A,null,n.a.createElement(R,null,n.a.createElement(c.WhenExpression,{customAggTypesOptions:P,aggType:O,onChangeSelectedAggType:z})),"count"!==O&&n.a.createElement(R,null,n.a.createElement(c.OfExpression,{customAggTypesOptions:P,aggField:T,fields:v.map((e=>({normalizedType:e.type,name:e.name}))),aggType:O,errors:y,onChangeSelectedAggField:N,helpText:n.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.ofExpression.helpTextDetail",defaultMessage:"Can't find a metric? {documentationLink}.",values:{documentationLink:n.a.createElement(i.EuiLink,{href:"https://www.elastic.co/guide/en/observability/current/configure-settings.html",target:"BLANK"},n.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.ofExpression.popoverLinkLabel",defaultMessage:"Learn how to add more data"}))}}),"data-test-subj":"ofExpression"})),!S&&W),S&&n.a.createElement(n.a.Fragment,null,n.a.createElement(A,null,W,n.a.createElement(I,{color:"danger"},n.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.criticalThreshold",defaultMessage:"Alert"}))),n.a.createElement(A,null,H,n.a.createElement(I,{color:"warning"},n.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.warningThreshold",defaultMessage:"Warning"})),n.a.createElement(i.EuiButtonIcon,{"aria-label":l.i18n.translate("xpack.infra.metrics.alertFlyout.removeWarningThreshold",{defaultMessage:"Remove warningThreshold"}),iconSize:"s",color:"text",iconType:"crossInACircleFilled",onClick:_}))),!S&&n.a.createElement(n.a.Fragment,null," ",n.a.createElement(i.EuiSpacer,{size:"xs"}),n.a.createElement(A,null,n.a.createElement(i.EuiButtonEmpty,{color:"primary",flush:"left",size:"xs",iconType:"plusInCircleFilled",onClick:_},n.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.addWarningThreshold",defaultMessage:"Add warning threshold"}))))),x&&n.a.createElement(i.EuiFlexItem,{grow:!1},n.a.createElement(i.EuiButtonIcon,{"aria-label":l.i18n.translate("xpack.infra.metrics.alertFlyout.removeCondition",{defaultMessage:"Remove condition"}),color:"danger",iconType:"trash",onClick:()=>E(h)}))),d?n.a.createElement("div",{style:{padding:"0 0 0 28px"}},g):null,n.a.createElement(i.EuiSpacer,{size:"s"}))},L=({updateComparator:e,updateThreshold:t,threshold:a,isMetricPct:l,comparator:s,errors:o})=>{const d=Object(r.useMemo)((()=>l?a.map((e=>(e=>F(e,!0))(e))):a),[a,l]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(R,null,n.a.createElement(c.ThresholdExpression,{thresholdComparator:s||u.b.GT,threshold:d,customComparators:S,onChangeSelectedThresholdComparator:e,onChangeSelectedThreshold:t,errors:o})),l&&n.a.createElement("div",{style:{alignSelf:"center"}},n.a.createElement(i.EuiText,{size:"s"},"%")))},P={avg:{text:l.i18n.translate("xpack.infra.metrics.alertFlyout.aggregationText.avg",{defaultMessage:"Average"}),fieldRequired:!0,validNormalizedTypes:["number"],value:w.AVERAGE},max:{text:l.i18n.translate("xpack.infra.metrics.alertFlyout.aggregationText.max",{defaultMessage:"Max"}),fieldRequired:!0,validNormalizedTypes:["number","date"],value:w.MAX},min:{text:l.i18n.translate("xpack.infra.metrics.alertFlyout.aggregationText.min",{defaultMessage:"Min"}),fieldRequired:!0,validNormalizedTypes:["number","date"],value:w.MIN},cardinality:{text:l.i18n.translate("xpack.infra.metrics.alertFlyout.aggregationText.cardinality",{defaultMessage:"Cardinality"}),fieldRequired:!1,value:w.CARDINALITY,validNormalizedTypes:["number"]},rate:{text:l.i18n.translate("xpack.infra.metrics.alertFlyout.aggregationText.rate",{defaultMessage:"Rate"}),fieldRequired:!1,value:w.RATE,validNormalizedTypes:["number"]},count:{text:l.i18n.translate("xpack.infra.metrics.alertFlyout.aggregationText.count",{defaultMessage:"Document count"}),fieldRequired:!1,value:w.COUNT,validNormalizedTypes:["number"]},sum:{text:l.i18n.translate("xpack.infra.metrics.alertFlyout.aggregationText.sum",{defaultMessage:"Sum"}),fieldRequired:!1,value:w.SUM,validNormalizedTypes:["number"]},p95:{text:l.i18n.translate("xpack.infra.metrics.alertFlyout.aggregationText.p95",{defaultMessage:"95th Percentile"}),fieldRequired:!1,value:w.P95,validNormalizedTypes:["number"]},p99:{text:l.i18n.translate("xpack.infra.metrics.alertFlyout.aggregationText.p99",{defaultMessage:"99th Percentile"}),fieldRequired:!1,value:w.P99,validNormalizedTypes:["number"]}},D={aggType:u.a.AVERAGE,comparator:u.b.GT,threshold:[],timeSize:1,timeUnit:"m"},z=e=>{const{setRuleParams:t,ruleParams:a,errors:b,metadata:y}=e,{http:h,notifications:E,docLinks:v}=Object(m.b)().services,{source:x,createDerivedIndexPattern:O}=Object(d.a)({sourceId:"default",fetch:h.fetch,toastWarning:E.toasts.addWarning}),[T,j]=Object(r.useState)(1),[k,C]=Object(r.useState)("m"),F=Object(r.useMemo)((()=>O()),[O]),w=Object(r.useMemo)((()=>{var e;return null!=y&&null!==(e=y.currentOptions)&&void 0!==e&&e.metrics?y.currentOptions:{metrics:[],aggregation:"avg"}}),[y]),S=Object(r.useCallback)(((e,r)=>{const n=a.criteria?a.criteria.slice():[];n[e]=r,t("criteria",n)}),[t,a.criteria]),A=Object(r.useCallback)((()=>{var e;const r=(null===(e=a.criteria)||void 0===e?void 0:e.slice())||[];r.push({...D,timeSize:null!=T?T:D.timeSize,timeUnit:null!=k?k:D.timeUnit}),t("criteria",r)}),[t,a.criteria,T,k]),R=Object(r.useCallback)((e=>{var r;const n=(null===(r=a.criteria)||void 0===r?void 0:r.slice())||[];n.length>1&&(n.splice(e,1),t("criteria",n))}),[t,a.criteria]),I=Object(r.useCallback)((e=>{t("filterQueryText",e);try{t("filterQuery",Object(f.a)(e,F,!1)||"")}catch(e){t("filterQuery",u.f)}}),[t,F]),L=Object(r.useCallback)(Object(o.debounce)(I,500),[I]),P=Object(r.useCallback)((e=>{t("groupBy",e&&e.length?e:"")}),[t]),z=Object(r.useMemo)((()=>({aggField:[],timeSizeUnit:[],timeWindowSize:[]})),[]),G=Object(r.useCallback)((e=>{var r;const n=(null===(r=a.criteria)||void 0===r?void 0:r.map((t=>({...t,timeSize:e}))))||[];j(e||void 0),t("criteria",n)}),[a.criteria,t]),U=Object(r.useCallback)((e=>{var r;const n=(null===(r=a.criteria)||void 0===r?void 0:r.map((t=>({...t,timeUnit:e}))))||[];C(e),t("criteria",n)}),[a.criteria,t]),Q=Object(r.useCallback)((()=>{var e,a;const r=y;null!=r&&null!==(e=r.currentOptions)&&void 0!==e&&null!==(a=e.metrics)&&void 0!==a&&a.length?t("criteria",r.currentOptions.metrics.map((e=>({metric:e.field,comparator:u.b.GT,threshold:[],timeSize:T,timeUnit:k,aggType:e.aggregation})))):t("criteria",[D])}),[y,t,T,k]),$=Object(r.useCallback)((()=>{var e,a;const r=y;if(r&&null!==(e=r.currentOptions)&&void 0!==e&&e.filterQuery)t("filterQueryText",r.currentOptions.filterQuery),t("filterQuery",Object(f.a)(r.currentOptions.filterQuery,F)||"");else if(r&&null!==(a=r.currentOptions)&&void 0!==a&&a.groupBy&&r.series){const{groupBy:e}=r.currentOptions,a=Array.isArray(e)?e.map(((e,t)=>{var a,n;return`${e}: "${null===(a=r.series)||void 0===a||null===(n=a.keys)||void 0===n?void 0:n[t]}"`})).join(" and "):`${e}: "${r.series.id}"`;t("filterQueryText",a),t("filterQuery",Object(f.a)(a,F)||"")}}),[y,F,t]),q=Object(r.useCallback)((()=>{var e;const a=y;a&&null!==(e=a.currentOptions)&&void 0!==e&&e.groupBy&&!a.series&&t("groupBy",a.currentOptions.groupBy)}),[y,t]);Object(r.useEffect)((()=>{a.criteria&&a.criteria.length?(j(a.criteria[0].timeSize),C(a.criteria[0].timeUnit)):Q(),a.filterQuery||$(),a.groupBy||q(),a.sourceId||t("sourceId",(null==x?void 0:x.id)||"default"),void 0===a.alertOnNoData&&t("alertOnNoData",!0),void 0===a.alertOnGroupDisappear&&t("alertOnGroupDisappear",!0)}),[y,x]);const _=Object(r.useCallback)((e=>I(e.target.value)),[I]),W=Object(r.useMemo)((()=>a.groupBy&&a.groupBy.length>0),[a.groupBy]),H=Object(r.useMemo)((()=>{var e;return null===(e=a.criteria)||void 0===e?void 0:e.every((e=>e.aggType===u.a.COUNT))}),[a.criteria]),V=Object(r.useMemo)((()=>a.groupBy?(Array.isArray(a.groupBy)?a.groupBy:[a.groupBy]).map((e=>({groupName:e,pattern:new RegExp(`{"match(_phrase)?":{"${e}":"(.*?)"}}`)}))):null),[a.groupBy]),K=Object(r.useMemo)((()=>{const{filterQuery:e}=a;return"string"==typeof e&&V?V.map((({groupName:t,pattern:a})=>{if(a.test(e))return t})).filter((e=>"string"==typeof e)):[]}),[a,V]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(i.EuiSpacer,{size:"m"}),n.a.createElement(i.EuiText,{size:"xs"},n.a.createElement("h4",null,n.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.conditions",defaultMessage:"Conditions"}))),n.a.createElement(i.EuiSpacer,{size:"xs"}),a.criteria&&a.criteria.map(((e,t)=>n.a.createElement(B,{canDelete:a.criteria&&a.criteria.length>1||!1,fields:F.fields,remove:R,addExpression:A,key:t,expressionId:t,setRuleParams:S,errors:b[t]||z,expression:e||{}},n.a.createElement(M,{expression:e,derivedIndexPattern:F,source:x,filterQuery:a.filterQueryText,groupBy:a.groupBy})))),n.a.createElement("div",{style:{marginLeft:28}},n.a.createElement(c.ForLastExpression,{timeWindowSize:T,timeWindowUnit:k,errors:z,onChangeWindowSize:G,onChangeWindowUnit:U})),n.a.createElement(i.EuiSpacer,{size:"m"}),n.a.createElement("div",null,n.a.createElement(i.EuiButtonEmpty,{color:"primary",iconSide:"left",flush:"left",iconType:"plusInCircleFilled",onClick:A},n.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.addCondition",defaultMessage:"Add condition"}))),n.a.createElement(i.EuiSpacer,{size:"m"}),n.a.createElement(i.EuiAccordion,{id:"advanced-options-accordion",buttonContent:l.i18n.translate("xpack.infra.metrics.alertFlyout.advancedOptions",{defaultMessage:"Advanced options"})},n.a.createElement(i.EuiPanel,{color:"subdued"},n.a.createElement(i.EuiCheckbox,{disabled:H,id:"metrics-alert-no-data-toggle",label:n.a.createElement(n.a.Fragment,null,l.i18n.translate("xpack.infra.metrics.alertFlyout.alertOnNoData",{defaultMessage:"Alert me if there's no data"})," ",n.a.createElement(i.EuiToolTip,{content:(H?`${N} `:"")+l.i18n.translate("xpack.infra.metrics.alertFlyout.noDataHelpText",{defaultMessage:"Enable this to trigger the action if the metric(s) do not report any data over the expected time period, or if the alert fails to query Elasticsearch"})},n.a.createElement(i.EuiIcon,{type:"questionInCircle",color:"subdued"}))),checked:a.alertOnNoData,onChange:e=>t("alertOnNoData",e.target.checked)}))),n.a.createElement(i.EuiSpacer,{size:"m"}),n.a.createElement(i.EuiFormRow,{label:l.i18n.translate("xpack.infra.metrics.alertFlyout.filterLabel",{defaultMessage:"Filter (optional)"}),helpText:l.i18n.translate("xpack.infra.metrics.alertFlyout.filterHelpText",{defaultMessage:"Use a KQL expression to limit the scope of your alert trigger."}),fullWidth:!0,display:"rowCompressed"},y&&n.a.createElement(g.a,{derivedIndexPattern:F,onChange:L,onSubmit:I,value:a.filterQueryText})||n.a.createElement(i.EuiFieldSearch,{onChange:_,value:a.filterQueryText,fullWidth:!0})),n.a.createElement(i.EuiSpacer,{size:"m"}),n.a.createElement(i.EuiFormRow,{label:l.i18n.translate("xpack.infra.metrics.alertFlyout.createAlertPerText",{defaultMessage:"Group alerts by (optional)"}),helpText:l.i18n.translate("xpack.infra.metrics.alertFlyout.createAlertPerHelpText",{defaultMessage:'Create an alert for every unique value. For example: "host.id" or "cloud.region".'}),fullWidth:!0,display:"rowCompressed"},n.a.createElement(p.a,{onChange:P,fields:F.fields,options:{...w,groupBy:a.groupBy||void 0},errorOptions:K})),K.length>0&&n.a.createElement(n.a.Fragment,null,n.a.createElement(i.EuiSpacer,{size:"s"}),n.a.createElement(i.EuiText,{size:"xs",color:"danger"},n.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.alertPerRedundantFilterError",defaultMessage:"This rule may alert on {matchedGroups} less than expected, because the filter query contains a match for {groupCount, plural, one {this field} other {these fields}}. For more information, refer to {filteringAndGroupingLink}.",values:{matchedGroups:n.a.createElement("strong",null,K.join(", ")),groupCount:K.length,filteringAndGroupingLink:n.a.createElement(i.EuiLink,{href:`${v.links.observability.metricsThreshold}#filtering-and-grouping`},l.i18n.translate("xpack.infra.metrics.alertFlyout.alertPerRedundantFilterError.docsLink",{defaultMessage:"the docs"}))}}))),n.a.createElement(i.EuiSpacer,{size:"s"}),n.a.createElement(i.EuiCheckbox,{id:"metrics-alert-group-disappear-toggle",label:n.a.createElement(n.a.Fragment,null,l.i18n.translate("xpack.infra.metrics.alertFlyout.alertOnGroupDisappear",{defaultMessage:"Alert me if a group stops reporting data"})," ",n.a.createElement(i.EuiToolTip,{content:(H?`${N} `:"")+l.i18n.translate("xpack.infra.metrics.alertFlyout.groupDisappearHelpText",{defaultMessage:"Enable this to trigger the action if a previously detected group begins to report no results. This is not recommended for dynamically scaling infrastructures that may rapidly start and stop nodes automatically."})},n.a.createElement(i.EuiIcon,{type:"questionInCircle",color:"subdued"}))),disabled:H||!W,checked:Boolean(W&&a.alertOnGroupDisappear),onChange:e=>t("alertOnGroupDisappear",e.target.checked)}),n.a.createElement(i.EuiSpacer,{size:"m"}))},N=l.i18n.translate("xpack.infra.metrics.alertFlyout.docCountNoDataDisabledHelpText",{defaultMessage:"[This setting is not applicable to the Document Count aggregator.]"});t.default=z},79:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var r=a(2),n=a.n(r),i=a(1),l=a(9),s=a(68);function o(e,t,a,o=(e=>e),c,u){var d;const m=Object(l.useKibana)(),p=c||(null===(d=m.services.http)||void 0===d?void 0:d.fetch),g=u||m.notifications.toasts.danger,[f,b]=Object(r.useState)(null),[y,h]=Object(r.useState)(null),[E,v]=Object(s.c)({cancelPreviousOn:"resolution",createPromise:()=>{if(!p)throw new Error("HTTP service is unavailable");return p(e,{method:t,body:a})},onResolve:e=>b(o(e)),onReject:e=>{var t,a,r,l,o;const c=e;e&&e instanceof s.a||(h(c),g({toastLifeTimeMs:3e3,title:i.i18n.translate("xpack.infra.useHTTPRequest.error.title",{defaultMessage:"Error while fetching resource"}),body:n.a.createElement("div",null,c.response?n.a.createElement(n.a.Fragment,null,n.a.createElement("h5",null,i.i18n.translate("xpack.infra.useHTTPRequest.error.status",{defaultMessage:"Error"})),null===(t=c.response)||void 0===t?void 0:t.statusText," (",null===(a=c.response)||void 0===a?void 0:a.status,")",n.a.createElement("h5",null,i.i18n.translate("xpack.infra.useHTTPRequest.error.url",{defaultMessage:"URL"})),null===(r=c.response)||void 0===r?void 0:r.url,n.a.createElement("h5",null,i.i18n.translate("xpack.infra.useHTTPRequest.error.body.message",{defaultMessage:"Message"})),(null===(l=c.body)||void 0===l?void 0:l.message)||c.message):n.a.createElement("h5",null,(null===(o=c.body)||void 0===o?void 0:o.message)||c.message))}))}},[e,a,t,c,g]),x=Object(r.useMemo)((()=>"resolved"===E.state&&null===f||"pending"===E.state),[E.state,f]);return{response:f,error:y,loading:x,makeRequest:v}}},86:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"c",(function(){return l})),a.d(t,"d",(function(){return c})),a.d(t,"b",(function(){return p})),a.d(t,"e",(function(){return v}));var r=a(0);const n=["avg","max","min","cardinality","rate","count","sum","p95","p99"],i=n.reduce(((e,t)=>({...e,[t]:null})),{}),l=r.keyof(i),s=r.type({aggregation:l}),o=r.partial({field:r.union([r.string,r[void 0]])}),c=r.intersection([s,o]),u=r.type({from:r.number,to:r.number,interval:r.string}),d=r.type({timerange:u,indexPattern:r.string,metrics:r.array(c)}),m=r.union([r.string,r.null,r[void 0]]),p=r.record(r.string,r.union([r.string,r.null])),g=r.partial({groupBy:r.union([m,r.array(m)]),afterKey:r.union([r.string,r.null,r[void 0],p]),limit:r.union([r.number,r.null,r[void 0]]),filterQuery:r.union([r.string,r.null,r[void 0]]),forceInterval:r.boolean,dropLastBucket:r.boolean}),f=(r.intersection([d,g]),r.type({total:r.number,afterKey:r.union([r.string,r.null,p])})),b=r.keyof({date:null,number:null,string:null}),y=r.type({name:r.string,type:b}),h=r.intersection([r.type({timestamp:r.number}),r.record(r.string,r.union([r.string,r.number,r.null,r[void 0],r.array(r.object)]))]),E=r.intersection([r.type({id:r.string,columns:r.array(y),rows:r.array(h)}),r.partial({keys:r.array(r.string)})]),v=r.type({series:r.array(E),pageInfo:f})}}]);