/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.fleet_bundle_jsonpfunction=window.fleet_bundle_jsonpfunction||[]).push([[2],{154:function(e,t,a){"use strict";t.decode=t.parse=a(291),t.encode=t.stringify=a(292)},155:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDeepEqual=t.off=t.on=t.isClient=void 0;var n=a(40).__importDefault(a(295));t.isClient="object"==typeof window,t.on=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return e.addEventListener.apply(e,t)},t.off=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return e.removeEventListener.apply(e,t)},t.isDeepEqual=n.default},288:function(e,t,a){"use strict";var n=a(289),l=a(290);function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=y,t.resolve=function(e,t){return y(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?y(e,!1,!0).resolveObject(t):t},t.format=function(e){return l.isString(e)&&(e=y(e)),e instanceof i?e.format():i.prototype.format.call(e)},t.Url=i;var s=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,o=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(c),d=["%","/","?",";","#"].concat(u),g=["/","?","#"],m=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},E={javascript:!0,"javascript:":!0},h={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=a(154);function y(e,t,a){if(e&&l.isObject(e)&&e instanceof i)return e;var n=new i;return n.parse(e,t,a),n}i.prototype.parse=function(e,t,a){if(!l.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),r=-1!==i&&i<e.indexOf("#")?"?":"#",c=e.split(r);c[0]=c[0].replace(/\\/g,"/");var y=e=c.join(r);if(y=y.trim(),!a&&1===e.split("#").length){var k=o.exec(y);if(k)return this.path=y,this.href=y,this.pathname=k[1],k[2]?(this.search=k[2],this.query=t?b.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var v=s.exec(y);if(v){var x=(v=v[0]).toLowerCase();this.protocol=x,y=y.substr(v.length)}if(a||v||y.match(/^\/\/[^@\/]+@[^@\/]+/)){var M="//"===y.substr(0,2);!M||v&&E[v]||(y=y.substr(2),this.slashes=!0)}if(!E[v]&&(M||v&&!h[v])){for(var F,I,O=-1,S=0;S<g.length;S++)-1!==(j=y.indexOf(g[S]))&&(-1===O||j<O)&&(O=j);for(-1!==(I=-1===O?y.lastIndexOf("@"):y.lastIndexOf("@",O))&&(F=y.slice(0,I),y=y.slice(I+1),this.auth=decodeURIComponent(F)),O=-1,S=0;S<d.length;S++){var j;-1!==(j=y.indexOf(d[S]))&&(-1===O||j<O)&&(O=j)}-1===O&&(O=y.length),this.host=y.slice(0,O),y=y.slice(O),this.parseHost(),this.hostname=this.hostname||"";var C="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!C)for(var w=this.hostname.split(/\./),T=(S=0,w.length);S<T;S++){var L=w[S];if(L&&!L.match(m)){for(var P="",A=0,_=L.length;A<_;A++)L.charCodeAt(A)>127?P+="x":P+=L[A];if(!P.match(m)){var D=w.slice(0,S),B=w.slice(S+1),z=L.match(p);z&&(D.push(z[1]),B.unshift(z[2])),B.length&&(y="/"+B.join(".")+y),this.hostname=D.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),C||(this.hostname=n.toASCII(this.hostname));var N=this.port?":"+this.port:"",R=this.hostname||"";this.host=R+N,this.href+=this.host,C&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!f[x])for(S=0,T=u.length;S<T;S++){var U=u[S];if(-1!==y.indexOf(U)){var H=encodeURIComponent(U);H===U&&(H=escape(U)),y=y.split(U).join(H)}}var q=y.indexOf("#");-1!==q&&(this.hash=y.substr(q),y=y.slice(0,q));var G=y.indexOf("?");if(-1!==G?(this.search=y.substr(G),this.query=y.substr(G+1),t&&(this.query=b.parse(this.query)),y=y.slice(0,G)):t&&(this.search="",this.query={}),y&&(this.pathname=y),h[x]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){N=this.pathname||"";var W=this.search||"";this.path=N+W}return this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",a=this.pathname||"",n=this.hash||"",i=!1,s="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&l.isObject(this.query)&&Object.keys(this.query).length&&(s=b.stringify(this.query));var r=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||h[t])&&!1!==i?(i="//"+(i||""),a&&"/"!==a.charAt(0)&&(a="/"+a)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),r&&"?"!==r.charAt(0)&&(r="?"+r),t+i+(a=a.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(r=r.replace("#","%23"))+n},i.prototype.resolve=function(e){return this.resolveObject(y(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if(l.isString(e)){var t=new i;t.parse(e,!1,!0),e=t}for(var a=new i,n=Object.keys(this),s=0;s<n.length;s++){var r=n[s];a[r]=this[r]}if(a.hash=e.hash,""===e.href)return a.href=a.format(),a;if(e.slashes&&!e.protocol){for(var o=Object.keys(e),c=0;c<o.length;c++){var u=o[c];"protocol"!==u&&(a[u]=e[u])}return h[a.protocol]&&a.hostname&&!a.pathname&&(a.path=a.pathname="/"),a.href=a.format(),a}if(e.protocol&&e.protocol!==a.protocol){if(!h[e.protocol]){for(var d=Object.keys(e),g=0;g<d.length;g++){var m=d[g];a[m]=e[m]}return a.href=a.format(),a}if(a.protocol=e.protocol,e.host||E[e.protocol])a.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),a.pathname=p.join("/")}if(a.search=e.search,a.query=e.query,a.host=e.host||"",a.auth=e.auth,a.hostname=e.hostname||e.host,a.port=e.port,a.pathname||a.search){var f=a.pathname||"",b=a.search||"";a.path=f+b}return a.slashes=a.slashes||e.slashes,a.href=a.format(),a}var y=a.pathname&&"/"===a.pathname.charAt(0),k=e.host||e.pathname&&"/"===e.pathname.charAt(0),v=k||y||a.host&&e.pathname,x=v,M=a.pathname&&a.pathname.split("/")||[],F=(p=e.pathname&&e.pathname.split("/")||[],a.protocol&&!h[a.protocol]);if(F&&(a.hostname="",a.port=null,a.host&&(""===M[0]?M[0]=a.host:M.unshift(a.host)),a.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),v=v&&(""===p[0]||""===M[0])),k)a.host=e.host||""===e.host?e.host:a.host,a.hostname=e.hostname||""===e.hostname?e.hostname:a.hostname,a.search=e.search,a.query=e.query,M=p;else if(p.length)M||(M=[]),M.pop(),M=M.concat(p),a.search=e.search,a.query=e.query;else if(!l.isNullOrUndefined(e.search))return F&&(a.hostname=a.host=M.shift(),(C=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=C.shift(),a.host=a.hostname=C.shift())),a.search=e.search,a.query=e.query,l.isNull(a.pathname)&&l.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.href=a.format(),a;if(!M.length)return a.pathname=null,a.search?a.path="/"+a.search:a.path=null,a.href=a.format(),a;for(var I=M.slice(-1)[0],O=(a.host||e.host||M.length>1)&&("."===I||".."===I)||""===I,S=0,j=M.length;j>=0;j--)"."===(I=M[j])?M.splice(j,1):".."===I?(M.splice(j,1),S++):S&&(M.splice(j,1),S--);if(!v&&!x)for(;S--;S)M.unshift("..");!v||""===M[0]||M[0]&&"/"===M[0].charAt(0)||M.unshift(""),O&&"/"!==M.join("/").substr(-1)&&M.push("");var C,w=""===M[0]||M[0]&&"/"===M[0].charAt(0);return F&&(a.hostname=a.host=w?"":M.length?M.shift():"",(C=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=C.shift(),a.host=a.hostname=C.shift())),(v=v||a.host&&M.length)&&!w&&M.unshift(""),M.length?a.pathname=M.join("/"):(a.pathname=null,a.path=null),l.isNull(a.pathname)&&l.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.auth=e.auth||a.auth,a.slashes=a.slashes||e.slashes,a.href=a.format(),a},i.prototype.parseHost=function(){var e=this.host,t=r.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},289:function(e,t,a){e.exports=a(32)(2556)},290:function(e,t,a){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},291:function(e,t,a){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,a,i){t=t||"&",a=a||"=";var s={};if("string"!=typeof e||0===e.length)return s;var r=/\+/g;e=e.split(t);var o=1e3;i&&"number"==typeof i.maxKeys&&(o=i.maxKeys);var c=e.length;o>0&&c>o&&(c=o);for(var u=0;u<c;++u){var d,g,m,p,f=e[u].replace(r,"%20"),E=f.indexOf(a);E>=0?(d=f.substr(0,E),g=f.substr(E+1)):(d=f,g=""),m=decodeURIComponent(d),p=decodeURIComponent(g),n(s,m)?l(s[m])?s[m].push(p):s[m]=[s[m],p]:s[m]=p}return s};var l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},292:function(e,t,a){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,a,r){return t=t||"&",a=a||"=",null===e&&(e=void 0),"object"==typeof e?i(s(e),(function(s){var r=encodeURIComponent(n(s))+a;return l(e[s])?i(e[s],(function(e){return r+encodeURIComponent(n(e))})).join(t):r+encodeURIComponent(n(e[s]))})).join(t):r?encodeURIComponent(n(r))+a+encodeURIComponent(n(e)):""};var l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function i(e,t){if(e.map)return e.map(t);for(var a=[],n=0;n<e.length;n++)a.push(t(e[n],n));return a}var s=Object.keys||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.push(a);return t}},293:function(e,t,a){const n=a(43);e.exports=(e,t,a)=>n(e,t,a)>=0},294:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(40),l=a(0),i=n.__importDefault(a(153)),s=a(155),r={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};t.default=s.isClient&&window.ResizeObserver?function(){var e=l.useState(null),t=e[0],a=e[1],n=l.useState(r),s=n[0],o=n[1],c=l.useMemo((function(){return new window.ResizeObserver((function(e){if(e[0]){var t=e[0].contentRect,a=t.x,n=t.y,l=t.width,i=t.height,s=t.top,r=t.left,c=t.bottom,u=t.right;o({x:a,y:n,width:l,height:i,top:s,left:r,bottom:c,right:u})}}))}),[]);return i.default((function(){if(t)return c.observe(t),function(){c.disconnect()}}),[t]),[a,s]}:function(){return[function(){},r]}},295:function(e,t,a){"use strict";e.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var n,l,i;if(Array.isArray(t)){if((n=t.length)!=a.length)return!1;for(l=n;0!=l--;)if(!e(t[l],a[l]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((n=(i=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(l=n;0!=l--;)if(!Object.prototype.hasOwnProperty.call(a,i[l]))return!1;for(l=n;0!=l--;){var s=i[l];if(!("_owner"===s&&t.$$typeof||e(t[s],a[s])))return!1}return!0}return t!=t&&a!=a}},296:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(40),l=a(0),i=n.__importDefault(a(297)),s=a(155);t.default=function(e,t){void 0===e&&(e=1/0),void 0===t&&(t=1/0);var a=i.default({width:s.isClient?window.innerWidth:e,height:s.isClient?window.innerHeight:t}),n=a[0],r=a[1];return l.useEffect((function(){if(s.isClient){var e=function(){r({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}}),[]),n}},297:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(40),l=a(0),i=n.__importDefault(a(298));t.default=function(e){var t=l.useRef(0),a=l.useState(e),n=a[0],s=a[1],r=l.useCallback((function(e){cancelAnimationFrame(t.current),t.current=requestAnimationFrame((function(){s(e)}))}),[]);return i.default((function(){cancelAnimationFrame(t.current)})),[n,r]}},298:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(40),l=a(0),i=n.__importDefault(a(299));t.default=function(e){var t=l.useRef(e);t.current=e,i.default((function(){return function(){return t.current()}}))}},299:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(0);t.default=function(e){n.useEffect(e,[])}},300:function(e,t,a){e.exports=a(32)(1109)},303:function(e,t,a){"use strict";a.r(t),a.d(t,"ProtectedRoute",(function(){return Wn})),a.d(t,"renderApp",(function(){return Vn})),a.d(t,"teardownFleet",(function(){return Kn}));var n=a(0),l=a.n(n),i=a(64),s=a.n(i),r=a(12),o=a(77),c=a(6),u=a(62),d=a(4),g=a(63),m=a.n(g),p=a(152),f=a.n(p),E=a(22),h=a(65),b=a(79),y=a(78),k=a(80),v=a(87),x=a(91),M=a(82),F=a.n(M),I=a(5);const O=m()(c.EuiFlyout).withConfig({displayName:"FlyoutWithHigherZIndex",componentId:"sc-4bxzaq-0"})(["z-index:",";"],(e=>e.theme.eui.euiZLevel5)),S=({onClose:e,as:t,...a})=>{const{notifications:i}=Object(o.ub)(),s=Object(o.S)().fleet.all,[r,g]=Object(n.useState)({name:"",description:"",namespace:"default",monitoring_enabled:Object.values(I.dataTypes)}),[m,p]=Object(n.useState)(!1),[f,E]=Object(n.useState)(!0),h=Object(x.g)(r),b=l.a.createElement(c.EuiFlyoutHeader,{hasBorder:!0,"aria-labelledby":"CreateAgentPolicyFlyoutTitle"},l.a.createElement(c.EuiTitle,{size:"m"},l.a.createElement("h2",{id:"CreateAgentPolicyFlyoutTitle"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.flyoutTitle",defaultMessage:"Create agent policy"}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiText,{size:"s"},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.flyoutTitleDescription",defaultMessage:"Agent policies are used to manage settings across a group of agents. You can add integrations to your agent policy to specify what data your agents collect. When you edit an agent policy, you can use Fleet to deploy updates to a specified group of agents."})))),y=l.a.createElement(c.EuiFlyoutBody,null,l.a.createElement(x.c,{agentPolicy:r,updateAgentPolicy:e=>{g({...r,...e})},withSysMonitoring:f,updateSysMonitoring:e=>E(e),validation:h})),k=l.a.createElement(c.EuiFlyoutFooter,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{onClick:()=>e(),flush:"left"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.cancelButtonLabel",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,isLoading:m,isDisabled:!s||m||Object.keys(h).length>0,onClick:async()=>{p(!0);try{const{data:t,error:a}=await(async()=>await Object(o.i)(r,{withSysMonitoring:f}))();p(!1),t?(i.toasts.addSuccess(d.i18n.translate("xpack.fleet.createAgentPolicy.successNotificationTitle",{defaultMessage:"Agent policy '{name}' created",values:{name:r.name}})),e(t.item)):i.toasts.addDanger(a?a.message:d.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"}))}catch(e){p(!1),i.toasts.addDanger(d.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"}))}},"data-test-subj":"createAgentPolicyFlyoutBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.submitButtonLabel",defaultMessage:"Create agent policy"})))));return l.a.createElement(O,F()({onClose:()=>e(),size:"l",maxWidth:400},a),b,y,k)},j=()=>{var e,t;Object(o.T)("policies_list");const{getPath:a}=Object(o.ob)(),i=Object(o.S)().fleet.all,{agents:{enabled:s}}=Object(o.V)(),{urlParams:g,toUrlParams:m}=Object(o.xb)(),[p,f]=Object(n.useState)(Array.isArray(g.kuery)?g.kuery[g.kuery.length-1]:null!==(e=g.kuery)&&void 0!==e?e:""),{pagination:E,pageSizeOptions:h,setPagination:b}=Object(o.qb)(),{sorting:v,setSorting:M}=Object(o.tb)({field:"updated_at",direction:"desc"}),F=Object(r.useHistory)(),I="create"in g,O=Object(n.useCallback)((e=>{if(e!==I)if(e)F.push(`${a("policies_list")}?${m({...g,create:null})}`);else{const{create:e,...t}=g;F.push(`${a("policies_list")}?${m(t)}`)}}),[a,F,I,m,g]),{isLoading:j,data:C,resendRequest:w}=Object(o.Z)({page:E.currentPage,perPage:E.pageSize,sortField:null==v?void 0:v.field,sortOrder:null==v?void 0:v.direction,kuery:p}),T=Object(n.useMemo)((()=>{const e=[{field:"name",sortable:!0,name:d.i18n.translate("xpack.fleet.agentPolicyList.nameColumnTitle",{defaultMessage:"Name"}),width:"20%",render:(e,t)=>l.a.createElement(y.e,{policy:t})},{field:"description",name:d.i18n.translate("xpack.fleet.agentPolicyList.descriptionColumnTitle",{defaultMessage:"Description"}),width:"35%",render:e=>l.a.createElement(c.EuiTextColor,{color:"subdued",className:"eui-textTruncate",title:e},e)},{field:"updated_at",sortable:!0,name:d.i18n.translate("xpack.fleet.agentPolicyList.updatedOnColumnTitle",{defaultMessage:"Last updated on"}),render:e=>l.a.createElement(u.FormattedDate,{value:e,year:"numeric",month:"short",day:"2-digit"})},{field:"agents",name:d.i18n.translate("xpack.fleet.agentPolicyList.agentsColumnTitle",{defaultMessage:"Agents"}),dataType:"number",render:(e,t)=>l.a.createElement(x.f,{count:e,agentPolicyId:t.id})},{field:"package_policies",name:d.i18n.translate("xpack.fleet.agentPolicyList.packagePoliciesCountColumnTitle",{defaultMessage:"Integrations"}),dataType:"number",render:e=>e?e.length:0},{field:"actions",name:d.i18n.translate("xpack.fleet.agentPolicyList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>l.a.createElement(x.a,{agentPolicy:e,onCopySuccess:()=>w()})}]}];return s?e:e.filter((e=>!("field"in e)||"agents"!==e.field))}),[s,w]),L=Object(n.useMemo)((()=>l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",isDisabled:!i,onClick:()=>O(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.addButton",defaultMessage:"Create agent policy"}))),[i,O]),P=Object(n.useMemo)((()=>l.a.createElement(c.EuiEmptyPrompt,{title:l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.noAgentPoliciesPrompt",defaultMessage:"No agent policies"})),actions:L})),[L]);return l.a.createElement(l.a.Fragment,null,I?l.a.createElement(S,{onClose:()=>{O(!1),w()}}):null,l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"m"},l.a.createElement(c.EuiFlexItem,{grow:4},l.a.createElement(y.s,{value:p,onChange:e=>{b({...E,currentPage:1}),f(e)},fieldPrefix:k.c})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"primary",iconType:"refresh",onClick:()=>w()},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.reloadAgentPoliciesButtonText",defaultMessage:"Reload"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},L)),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiBasicTable,{loading:j,hasActions:!0,noItemsMessage:j?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.loadingAgentPoliciesMessage",defaultMessage:"Loading agent policies…"}):p.trim()||0!==(null!==(t=null==C?void 0:C.total)&&void 0!==t?t:0)?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.noFilteredAgentPoliciesPrompt",defaultMessage:"No agent policies found. {clearFiltersLink}",values:{clearFiltersLink:l.a.createElement(c.EuiLink,{onClick:()=>f("")},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.clearFiltersLinkText",defaultMessage:"Clear filters"}))}}):P,items:C?C.items:[],itemId:"id",columns:T,isSelectable:!1,pagination:{pageIndex:E.currentPage-1,pageSize:E.pageSize,totalItemCount:C?C.total:0,pageSizeOptions:h},sorting:{sort:v},onChange:e=>{const t={...E,currentPage:e.page.index+1,pageSize:e.page.size};b(t),M(e.sort)}}))};var C=a(81);const w=l.a.createContext({refresh:()=>{}});var T=a(7);const L=(e,t)=>e.localeCompare(t),P=e=>({name:e,value:e}),A=({packagePolicies:e,agentPolicy:t,...a})=>{var i,s;const{application:r}=Object(o.ub)(),g=Object(o.S)().integrations.writeIntegrationPolicies,m=Object(o.S)().integrations.readIntegrationPolicies,{updatableIntegrations:p}=Object(o.pb)(),{getHref:f}=Object(o.ob)(),E=Object(o.rb)(),h=!(null!==(i=E.data)&&void 0!==i&&i.success)&&"MISSING_SECURITY"===(null===(s=E.data)||void 0===s?void 0:s.error),[b,k]=Object(n.useMemo)((()=>{const t=new Set;return[e.map((e=>{var a,n,l,i,s,r,o,c;e.namespace&&t.add(e.namespace);const u=p.get(null!==(a=null===(n=e.package)||void 0===n?void 0:n.name)&&void 0!==a?a:""),d=!!u&&u.policiesToUpgrade.some((({pkgPolicyId:t})=>t===e.id));return{...e,packageName:null!==(l=null===(i=e.package)||void 0===i?void 0:i.name)&&void 0!==l?l:"",packageTitle:null!==(s=null===(r=e.package)||void 0===r?void 0:r.title)&&void 0!==s?s:"",packageVersion:null!==(o=null===(c=e.package)||void 0===c?void 0:c.version)&&void 0!==o?o:"",hasUpgrade:d}})),[...t].sort(L).map(P)]}),[e,p]),v=Object(n.useMemo)((()=>[{field:"name",sortable:!0,truncateText:!0,name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.nameColumnTitle",{defaultMessage:"Name"}),render:(e,a)=>l.a.createElement(c.EuiLink,F()({title:e},m?{href:f("edit_integration",{policyId:t.id,packagePolicyId:a.id})}:{disabled:!0}),l.a.createElement("span",{className:"eui-textTruncate",title:e},e),a.description?l.a.createElement("span",null," ",l.a.createElement(c.EuiToolTip,{content:a.description},l.a.createElement(c.EuiIcon,{type:"help"}))):null)},{field:"packageTitle",sortable:!0,name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.packageNameColumnTitle",{defaultMessage:"Integration"}),render:(e,a)=>l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{"data-test-subj":"PackagePoliciesTableLink",grow:!1},l.a.createElement(c.EuiLink,{href:a.package&&f("integration_details_overview",{pkgkey:Object(C.n)(a.package)})},l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},a.package&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(y.p,{packageName:a.package.name,version:a.package.version,size:"m",tryApi:!0})),l.a.createElement(c.EuiFlexItem,{grow:!1},e),a.package&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.packagePoliciesTable.packageVersion",defaultMessage:"v{version}",values:{version:a.package.version}})))))),a.hasUpgrade&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiToolTip,{content:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.upgradeAvailable",{defaultMessage:"Upgrade Available"})},l.a.createElement(c.EuiIcon,{type:"alert",color:"warning"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{"data-test-subj":"PackagePoliciesTableUpgradeButton",size:"s",minWidth:"0",isDisabled:!g,href:`${f("upgrade_package_policy",{policyId:t.id,packagePolicyId:a.id})}?from=fleet-policy-list`},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.packagePoliciesTable.upgradeButton",defaultMessage:"Upgrade"})))))},{field:"namespace",name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.namespaceColumnTitle",{defaultMessage:"Namespace"}),render:e=>e?l.a.createElement(c.EuiBadge,{color:"hollow"},e):""},{name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>g?l.a.createElement(y.q,{agentPolicy:t,packagePolicy:e,upgradePackagePolicyHref:`${f("upgrade_package_policy",{policyId:t.id,packagePolicyId:e.id})}?from=fleet-policy-list`}):l.a.createElement(l.a.Fragment,null)}]}]),[t,f,g,m]);return l.a.createElement(c.EuiInMemoryTable,F()({itemId:"id",items:b,columns:v,sorting:{sort:{field:"name",direction:"asc"}}},a,{search:{toolsRight:t.is_managed?[]:[l.a.createElement(y.h,{key:"addPackagePolicyButton",fill:!0,isDisabled:!g,iconType:"plusInCircle",onClick:()=>{r.navigateToApp(I.INTEGRATIONS_PLUGIN_ID,{path:T.u.integrations_all({})[1],state:{forAgentPolicyId:t.id}})},"data-test-subj":"addPackagePolicyButton",tooltip:g?void 0:{content:h?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.epm.addPackagePolicyButtonSecurityRequiredTooltip",defaultMessage:"To add Elastic Agent Integrations, you must have security enabled and have the All privilege for Fleet. Contact your administrator."}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.epm.addPackagePolicyButtonPrivilegesRequiredTooltip",defaultMessage:"Elastic Agent Integrations require the All privilege for Fleet and All privilege for Integrations. Contact your administrator."})}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.addPackagePolicyButtonText",defaultMessage:"Add integration"}))],box:{incremental:!0,schema:!0},filters:[{type:"field_value_selection",field:"namespace",name:"Namespace",options:k,multiSelect:"or",operator:"exact"}]},isSelectable:!1}))},_=Object(n.memo)((({policyId:e})=>{const{application:t}=Object(o.ub)(),a=Object(o.S)().integrations.writeIntegrationPolicies;return l.a.createElement(c.EuiEmptyPrompt,{iconType:"plusInCircle",title:l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstTitle",defaultMessage:"Add your first integration"})),body:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstMessage",defaultMessage:"This policy does not have any integrations yet."}),actions:l.a.createElement(c.EuiButton,{iconType:"plusInCircle",isDisabled:!a,fill:!0,onClick:()=>t.navigateToApp(k.k,{path:k.o.integrations_all({})[1],state:{forAgentPolicyId:e}}),"data-test-subj":"addPackagePolicyButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstButtonText",defaultMessage:"Add integration"}))})})),D=Object(n.memo)((({agentPolicy:e})=>(Object(o.T)("policy_details",{policyName:e.name}),0===e.package_policies.length?l.a.createElement(_,{policyId:e.id}):l.a.createElement(A,{agentPolicy:e,packagePolicies:e.package_policies||[]})))),B=m.a.div.withConfig({displayName:"FormWrapper",componentId:"sc-1b9jodr-0"})(["max-width:800px;margin-right:auto;margin-left:auto;"]),z=Object(n.memo)((({agentPolicy:e})=>{Object(o.T)("policy_details",{policyName:e.name});const{notifications:t}=Object(o.ub)(),{agents:{enabled:a}}=Object(o.V)(),i=Object(r.useHistory)(),{getPath:s}=Object(o.ob)(),g=Object(o.S)().fleet.all,m=Object(o.R)(),[p,f]=Object(n.useState)({...e}),[E,h]=Object(n.useState)(!1),[b,y]=Object(n.useState)(!1),[k,v]=Object(n.useState)(0),[M,F]=Object(n.useState)(!0),I=Object(x.g)(p),O=async()=>{h(!0);try{const{name:e,description:a,namespace:n,monitoring_enabled:l,unenroll_timeout:i,data_output_id:s,monitoring_output_id:r}=p,{data:c,error:u}=await Object(o.O)(p.id,{name:e,description:a,namespace:n,monitoring_enabled:l,unenroll_timeout:i,data_output_id:s,monitoring_output_id:r});c?(t.toasts.addSuccess(d.i18n.translate("xpack.fleet.editAgentPolicy.successNotificationTitle",{defaultMessage:"Successfully updated '{name}' settings",values:{name:p.name}})),m(),y(!1)):t.toasts.addDanger(u?u.message:d.i18n.translate("xpack.fleet.editAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to update agent policy"}))}catch(e){t.toasts.addDanger(d.i18n.translate("xpack.fleet.editAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to update agent policy"}))}h(!1)};return l.a.createElement(B,null,k?l.a.createElement(x.e,{agentCount:k,agentPolicy:p,onConfirm:()=>{v(0),O()},onCancel:()=>{v(0),h(!1)}}):null,l.a.createElement(x.c,{agentPolicy:p,updateAgentPolicy:e=>{f({...p,...e}),y(!0)},withSysMonitoring:M,updateSysMonitoring:e=>F(e),validation:I,isEditing:!0,onDelete:()=>{i.push(s("policies_list"))}}),b?l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiBottomBar,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.unsavedChangesText",defaultMessage:"You have unsaved changes"})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",onClick:()=>{f({...e}),y(!1)}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.cancelButtonText",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{onClick:async()=>{if(a){h(!0);const{data:e}=await Object(o.q)({policyId:p.id});null!=e&&e.results.total?v(e.results.total):await O()}else await O()},isLoading:E,isDisabled:!g||E||Object.keys(I).length>0,iconType:"save",color:"primary",fill:!0},E?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.savingButtonText",defaultMessage:"Saving…"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.saveButtonText",defaultMessage:"Save changes"})))))))):null)})),N=({isLoading:e,policyId:t,agentPolicy:a})=>{const{getHref:n}=Object(o.ob)();return l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"s",alignItems:"flexStart"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiButtonEmpty,{iconType:"arrowLeft",href:n("policies_list"),flush:"left",size:"xs"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.viewAgentListTitle",defaultMessage:"View all agent policies"}))),l.a.createElement(c.EuiFlexItem,null,e?l.a.createElement(y.n,null):l.a.createElement(c.EuiFlexGroup,{alignItems:"center",wrap:!0,responsive:!1,gutterSize:"s"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiTitle,null,l.a.createElement("h1",null,a&&a.name||l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.policyDetailsTitle",defaultMessage:"Policy '{id}'",values:{id:t}})))),(null==a?void 0:a.is_managed)&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiIconTip,{title:"Hosted agent policy",content:d.i18n.translate("xpack.fleet.policyDetails.policyDetailsHostedPolicyTooltip",{defaultMessage:"This policy is managed outside of Fleet. Most actions related to this policy are unavailable."}),type:"lock",size:"l",color:"subdued"})))),a&&a.description?l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiText,{color:"subdued",size:"s",className:"eui-textBreakWord"},a.description)):null)},R=m.a.div.withConfig({displayName:"Divider",componentId:"sc-1n9nfzq-0"})(["width:0;height:100%;border-left:",";"],(e=>e.theme.eui.euiBorderThin)),U=({isLoading:e,policyId:t,agentPolicy:a,agentStatus:n,addAgent:i,onCancelEnrollment:s,isAddAgentHelpPopoverOpen:g,setIsAddAgentHelpPopoverOpen:m})=>{var p;const{getPath:f}=Object(o.ob)(),E=Object(r.useHistory)();if(!a)return null;const h=l.a.createElement(c.EuiLink,{onClick:i},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.addAgentButton",defaultMessage:"Add agent"}));return l.a.createElement(c.EuiFlexGroup,{justifyContent:"flexEnd",direction:"row"},[{label:d.i18n.translate("xpack.fleet.policyDetails.summary.revision",{defaultMessage:"Revision"}),content:null!==(p=null==a?void 0:a.revision)&&void 0!==p?p:0},{isDivider:!0},{label:d.i18n.translate("xpack.fleet.policyDetails.summary.integrations",{defaultMessage:"Integrations"}),content:l.a.createElement(c.EuiI18nNumber,{value:a&&a.package_policies&&a.package_policies.length||0})},{isDivider:!0},{label:d.i18n.translate("xpack.fleet.policyDetails.summary.usedBy",{defaultMessage:"Agents"}),content:n&&n.total?l.a.createElement(x.f,{count:n.total,agentPolicyId:a&&a.id||"",showAgentText:!0}):null!=a&&a.is_managed?l.a.createElement(x.f,{count:0,agentPolicyId:a&&a.id||"",showAgentText:!0}):l.a.createElement(y.a,{button:h,isOpen:g,offset:15,closePopover:()=>{m(!1)}})},{isDivider:!0},{label:d.i18n.translate("xpack.fleet.policyDetails.summary.lastUpdated",{defaultMessage:"Last updated on"}),content:a&&l.a.createElement(u.FormattedDate,{value:null==a?void 0:a.updated_at,year:"numeric",month:"short",day:"2-digit"})||""},{isDivider:!0},{content:a&&l.a.createElement(x.a,{agentPolicy:a,fullButton:!0,onCopySuccess:e=>{E.push(f("policy_details",{policyId:e.id}))},onCancelEnrollment:s})}].map(((e,t)=>{var a;return l.a.createElement(c.EuiFlexItem,{grow:!1,key:t},null!==(a=e.isDivider)&&void 0!==a&&a?l.a.createElement(R,null):e.label?l.a.createElement(c.EuiDescriptionList,{compressed:!0,textStyle:"reverse",style:{textAlign:"right"}},l.a.createElement(c.EuiDescriptionListTitle,{className:"eui-textNoWrap"},e.label),l.a.createElement(c.EuiDescriptionListDescription,{className:"eui-textNoWrap"},e.content)):e.content)})))},H=()=>{var e;const{params:{policyId:t,tabId:a=""}}=Object(r.useRouteMatch)(),{getHref:i}=Object(o.ob)(),s=Object(o.db)(t),g=s.data?s.data.item:null,{isLoading:m,error:p,sendRequest:f}=s,E=new URLSearchParams(Object(r.useLocation)().search),h="true"===E.get("openEnrollmentFlyout"),b="true"===E.get("showAddAgentHelp"),[k]=Object(n.useState)(!1),[x,M]=Object(n.useState)(h),[F,I]=Object(n.useState)(b),O=function(e,t){const a=Object(o.sb)({path:C.c.getStatusPath(),query:{policyId:e},method:"get"});return{isLoading:a.isLoading,data:a.data,error:a.error,refreshAgentStatus:()=>a.resendRequest}}(t),{refreshAgentStatus:S}=O,{application:{navigateToApp:j}}=Object(o.ub)(),T=Object(o.kb)(),L=null===(e=O.data)||void 0===e?void 0:e.results,{isReady:P}=Object(o.X)(),A=Object(n.useMemo)((()=>{if(T&&T.onDoneNavigateTo&&P){const[e,t]=T.onDoneNavigateTo;return()=>j(e,t)}}),[P,j,T]),_=Object(n.useCallback)((()=>{I(!1),M(!0)}),[]),D=Object(n.useMemo)((()=>[{id:"integrations",name:d.i18n.translate("xpack.fleet.policyDetails.subTabs.packagePoliciesTabText",{defaultMessage:"Integrations"}),href:i("policy_details",{policyId:t,tabId:"integrations"}),isSelected:""===a||"integrations"===a},{id:"settings",name:d.i18n.translate("xpack.fleet.policyDetails.subTabs.settingsTabText",{defaultMessage:"Settings"}),href:i("policy_details",{policyId:t,tabId:"settings"}),isSelected:"settings"===a}]),[i,t,a]),B=Object(n.useMemo)((()=>k?l.a.createElement(r.Redirect,{to:"/"}):m?l.a.createElement(y.n,null):p?l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.unexceptedErrorTitle",defaultMessage:"An error happened while loading the agent policy"}),error:p}):g?l.a.createElement(l.a.Fragment,null,x&&l.a.createElement(c.EuiPortal,null,l.a.createElement(y.b,{agentPolicy:g,onClose:A||(()=>M(!1))})),l.a.createElement(q,{agentPolicy:g})):l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.unexceptedErrorTitle",defaultMessage:"An error happened while loading the agent policy"}),error:d.i18n.translate("xpack.fleet.policyDetails.policyNotFoundErrorTitle",{defaultMessage:"Policy '{id}' not found",values:{id:t}})})),[k,m,p,g,x,A,t]),z=l.a.createElement(N,{agentPolicy:g,policyId:t,isLoading:m}),R=l.a.createElement(U,{agentPolicy:g,agentStatus:L,policyId:t,onCancelEnrollment:A,isLoading:m,isAddAgentHelpPopoverOpen:F,setIsAddAgentHelpPopoverOpen:I,addAgent:_});return l.a.createElement(o.a.Provider,{value:{refresh:f}},l.a.createElement(w.Provider,{value:{refresh:S}},l.a.createElement(v.c,{leftColumn:z,rightColumn:R,tabs:D},B)))},q=({agentPolicy:e})=>(Object(o.T)("policy_details",{policyName:e.name}),l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:k.g.policy_details_settings,render:()=>l.a.createElement(z,{agentPolicy:e})}),l.a.createElement(r.Route,{path:k.g.policy_details,render:()=>l.a.createElement(D,{agentPolicy:e})})));var G=a(127);const W=Object(n.memo)((()=>{const{params:{packagePolicyId:e}}=Object(r.useRouteMatch)(),{search:t}=Object(r.useLocation)(),a=new URLSearchParams(t).get("from");let n;return a&&"fleet-policy-list"===a?n="upgrade-from-fleet-policy-list":a&&"integrations-policy-list"===a&&(n="upgrade-from-integrations-policy-list"),l.a.createElement(G.a,{packagePolicyId:e,from:n,forceUpgrade:!0})})),$=()=>{Object(o.T)("policies");const e=Object(r.useHistory)();return l.a.createElement(r.Router,{history:e},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:k.g.edit_integration},l.a.createElement(G.b,null)),l.a.createElement(r.Route,{path:k.g.upgrade_package_policy},l.a.createElement(W,null)),l.a.createElement(r.Route,{path:k.g.policy_details},l.a.createElement(H,null)),l.a.createElement(r.Route,{path:k.g.policies_list},l.a.createElement(v.a,{section:"agent_policies"},l.a.createElement(j,null)))))};var V=a(129);const K=Object(n.memo)((({datastream:e})=>{const{dashboards:t}=e,a=l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.viewDashboardActionText",defaultMessage:"View dashboard"}),n=l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.viewDashboardsActionText",defaultMessage:"View dashboards"}),i=d.i18n.translate("xpack.fleet.dataStreamList.viewDashboardsPanelTitle",{defaultMessage:"View dashboards"}),s=d.i18n.translate("xpack.fleet.dataStreamList.viewInApmActionText",{defaultMessage:"View in APM"}),{isSuccessful:r,href:c}=Object(V.a)(e);if(r&&c){const e=[{id:0,items:[{icon:"apmApp",href:c,name:s}]}];return l.a.createElement(y.f,{panels:e})}if(!t||0===t.length){const e=[{id:0,items:[{icon:"dashboardApp",disabled:!0,name:a}]}];return l.a.createElement(y.f,{panels:e})}if(1===t.length){const e=[{id:0,items:[{icon:"dashboardApp",href:Object(o.lb)(`/dashboard/${t[0].id||""}`),name:a}]}];return l.a.createElement(y.f,{panels:e})}const g=[{id:0,items:[{icon:"dashboardApp",panel:1,name:n}]},{id:1,title:i,items:t.map((e=>({icon:"dashboardApp",href:Object(o.lb)(`/dashboard/${e.id||""}`),name:e.title})))}];return l.a.createElement(y.f,{panels:g})})),Y=()=>{Object(o.T)("data_streams");const{pagination:e,pageSizeOptions:t}=Object(o.qb)(),{isLoading:a,data:i,resendRequest:s}=Object(o.ab)(),r=Object(n.useMemo)((()=>[{field:"dataset",sortable:!0,width:"25%",name:d.i18n.translate("xpack.fleet.dataStreamList.datasetColumnTitle",{defaultMessage:"Dataset"})},{field:"type",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.typeColumnTitle",{defaultMessage:"Type"})},{field:"namespace",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.namespaceColumnTitle",{defaultMessage:"Namespace"}),render:e=>e?l.a.createElement(c.EuiBadge,{color:"hollow"},e):""},{field:"package",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.integrationColumnTitle",{defaultMessage:"Integration"}),render:(e,t)=>l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},t.package_version&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(y.p,{packageName:e,version:t.package_version,size:"m",tryApi:!0})),l.a.createElement(c.EuiFlexItem,{grow:!1},e))},{field:"last_activity_ms",sortable:!0,width:"25%",dataType:"date",name:d.i18n.translate("xpack.fleet.dataStreamList.lastActivityColumnTitle",{defaultMessage:"Last activity"}),render:e=>l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedDate,{value:e,year:"numeric",month:"short",day:"numeric"}),l.a.createElement(l.a.Fragment,null," @ "),l.a.createElement(u.FormattedTime,{value:e,hour:"numeric",minute:"numeric",second:"numeric"}))},{field:"size_in_bytes",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.sizeColumnTitle",{defaultMessage:"Size"}),render:(e,t)=>l.a.createElement(l.a.Fragment,null,t.size_in_bytes_formatted)},{name:d.i18n.translate("xpack.fleet.dataStreamList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>l.a.createElement(K,{datastream:e})}]}]),[]),g=Object(n.useMemo)((()=>l.a.createElement(c.EuiEmptyPrompt,{title:l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.noDataStreamsPrompt",defaultMessage:"No data streams"}))})),[]),m={dataset:[],type:[],namespace:[],package:[]};if(i&&i.data_streams.length){const e={dataset:[],type:[],namespace:[],package:[]};i.data_streams.forEach((t=>{const{dataset:a,type:n,namespace:l,package:i}=t;e.dataset.includes(a)||e.dataset.push(a),e.type.includes(n)||e.type.push(n),e.namespace.includes(l)||e.namespace.push(l),e.package.includes(i)||e.package.push(i)}));for(const t in e)m[t]&&(m[t]=e[t].sort().map((e=>({value:e,name:e}))))}return l.a.createElement(c.EuiInMemoryTable,{loading:a,hasActions:!0,tableLayout:"auto",message:a?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.loadingDataStreamsMessage",defaultMessage:"Loading data streams…"}):i&&!i.data_streams.length?g:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.noFilteredDataStreamsMessage",defaultMessage:"No matching data streams found"}),items:i?i.data_streams:[],itemId:"index",columns:r,pagination:{initialPageSize:e.pageSize,pageSizeOptions:t},sorting:!0,search:{toolsRight:[l.a.createElement(c.EuiButton,{key:"reloadButton",color:"primary",iconType:"refresh",onClick:()=>s()},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.reloadDataStreamsButtonText",defaultMessage:"Reload"}))],box:{placeholder:d.i18n.translate("xpack.fleet.dataStreamList.searchPlaceholderTitle",{defaultMessage:"Filter data streams"}),incremental:!0},filters:[{type:"field_value_selection",field:"dataset",name:d.i18n.translate("xpack.fleet.dataStreamList.datasetColumnTitle",{defaultMessage:"Dataset"}),multiSelect:"or",operator:"exact",options:m.dataset},{type:"field_value_selection",field:"type",name:d.i18n.translate("xpack.fleet.dataStreamList.typeColumnTitle",{defaultMessage:"Type"}),multiSelect:"or",operator:"exact",options:m.type},{type:"field_value_selection",field:"namespace",name:d.i18n.translate("xpack.fleet.dataStreamList.namespaceColumnTitle",{defaultMessage:"Namespace"}),multiSelect:"or",operator:"exact",options:m.namespace},{type:"field_value_selection",field:"package",name:d.i18n.translate("xpack.fleet.dataStreamList.integrationColumnTitle",{defaultMessage:"Integration"}),multiSelect:"or",operator:"exact",options:m.package}]}})},Q=()=>{const e=Object(r.useHistory)();return l.a.createElement(r.Router,{history:e},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:k.g.data_streams},l.a.createElement(v.a,{section:"data_streams"},l.a.createElement(Y,null)))))};var Z=a(9),X=a(97),J=a(130);const ee=({currentUpgrade:e,abortUpgrade:t})=>{const{docLinks:a}=Object(o.ub)(),[i,s]=Object(n.useState)(!1),r=Object(n.useCallback)((async()=>{try{s(!0),await t(e)}finally{s(!1)}}),[e,t]),d=Object(n.useMemo)((()=>{if(!e.startTime)return!1;const t=Date.now();return new Date(e.startTime).getTime()>t}),[e]),g=d&&e.startTime?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.currentUpgrade.scheduleCalloutTitle",defaultMessage:"{nbAgents} agents scheduled to upgrade to version {version} on {date}",values:{nbAgents:e.nbAgents-e.nbAgentsAck,version:e.version,date:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedDate,{value:e.startTime,year:"numeric",month:"short",day:"2-digit"})," ",l.a.createElement(u.FormattedTime,{value:e.startTime}))}}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.currentUpgrade.calloutTitle",defaultMessage:"Upgrading {nbAgents, plural, one {# agent} other {# agents}} to version {version}",values:{nbAgents:e.nbAgents-e.nbAgentsAck,version:e.version}});return l.a.createElement(c.EuiCallOut,{color:"primary"},l.a.createElement(c.EuiFlexGroup,{className:"euiCallOutHeader__title",justifyContent:"spaceBetween",alignItems:"center",gutterSize:"none"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement("div",null,d?l.a.createElement(c.EuiIcon,{type:"iInCircle"}):l.a.createElement(c.EuiLoadingSpinner,null),"  ",g)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{size:"s",onClick:r,isLoading:i,"data-test-subj":"abortUpgradeBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.currentUpgrade.abortUpgradeButtom",defaultMessage:"Abort upgrade"})))),l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.currentUpgrade.calloutDescription",defaultMessage:"For more information see the {guideLink}.",values:{guideLink:l.a.createElement(c.EuiLink,{href:a.links.fleet.fleetServerAddFleetServer,target:"_blank",external:!0},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.currentUpgrade.guideLink",defaultMessage:"Fleet and Elastic Agent Guide"}))}}))};var te=a(66);const ae=Object(c.euiPaletteColorBlindBehindText)(),ne={default:te.euiLightVars.euiColorLightShade,primary:ae[1],success:ae[0],accent:ae[2],warning:ae[5],danger:ae[9],inactive:te.euiLightVars.euiColorDarkShade},le=["healthy","unhealthy","updating","offline","inactive"];function ie(e){switch(e){case"healthy":return ne.success;case"offline":return ne.default;case"inactive":return ne.inactive;case"unhealthy":return ne.warning;case"updating":return ne.primary;default:throw new Error(`Insuported Agent status ${e}`)}}const se=m()(c.EuiColorPaletteDisplay).withConfig({displayName:"StyledEuiColorPaletteDisplay",componentId:"sc-147tmhq-0"})(["&.ingest-agent-status-bar{border:none;border-radius:0;&:after{border:none;}}"]),re=({agentStatus:e})=>{const t=Object(n.useMemo)((()=>le.reduce(((t,a)=>{const n=t.length>0?t[t.length-1].stop:0;return t.push({stop:n+(e[a]||0),color:ie(a)}),t}),[])),[e]);return l.a.createElement(l.a.Fragment,null,l.a.createElement(se,{className:"ingest-agent-status-bar",size:"s",palette:t}))},oe=m.a.div.withConfig({displayName:"Divider",componentId:"sc-1tjpa1k-0"})(["width:0;height:",";border-left:",";"],(e=>e.theme.eui.euiSizeL),(e=>e.theme.eui.euiBorderThin)),ce=m()(c.EuiFlexItem).withConfig({displayName:"FlexItem",componentId:"sc-1tjpa1k-1"})(["height:",";"],(e=>e.theme.eui.euiSizeL)),ue=m()(c.EuiButtonEmpty).withConfig({displayName:"Button",componentId:"sc-1tjpa1k-2"})([".euiButtonEmpty__text{font-size:",";}"],(e=>e.theme.eui.euiFontSizeXS)),de=({totalAgents:e,selectableAgents:t,selectionMode:a,setSelectionMode:n,selectedAgents:i,setSelectedAgents:s})=>{const r="manual"===a&&i.length===t&&t<e;return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{size:"xs",color:"subdued"},e>k.n?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.totalAgentsWithLimit",defaultMessage:"Showing {count} of {total} agents",values:{count:l.a.createElement(u.FormattedNumber,{value:k.n}),total:l.a.createElement(u.FormattedNumber,{value:e})}}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.totalAgents",defaultMessage:"Showing {count, plural, one {# agent} other {# agents}}",values:{count:e}}))),"manual"===a&&i.length||"query"===a&&e>0?l.a.createElement(l.a.Fragment,null,l.a.createElement(ce,{grow:!1},l.a.createElement(oe,null)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{size:"xs",color:"subdued"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.agentsSelected",defaultMessage:"{count, plural, one {# agent} other {# agents} =all {All agents}} selected",values:{count:"manual"===a?i.length:"all"}}))),r?l.a.createElement(l.a.Fragment,null,l.a.createElement(ce,{grow:!1},l.a.createElement(oe,null)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(ue,{size:"xs",flush:"left",onClick:()=>n("query")},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.selectAll",defaultMessage:"Select everything on all pages"})))):null,l.a.createElement(ce,{grow:!1},l.a.createElement(oe,null)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(ue,{size:"xs",flush:"left",onClick:()=>{n("manual"),s([])}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.clearSelection",defaultMessage:"Clear selection"})))):l.a.createElement(ce,{grow:!1})))},ge=Object(n.memo)((({agentStatus:e,showInactive:t})=>{const a=Object(n.useMemo)((()=>le.filter((e=>!!t||"inactive"!==e))),[t]);return l.a.createElement(c.EuiFlexGroup,{gutterSize:"m"},a.map((t=>l.a.createElement(c.EuiFlexItem,{key:t,grow:!1},l.a.createElement(me,{status:t,count:e[t]||0})))))})),me=Object(n.memo)((({status:e,count:t})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiHealth,{color:ie(e)},l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:!1},function(e){switch(e){case"healthy":return d.i18n.translate("xpack.fleet.agentStatus.healthyLabel",{defaultMessage:"Healthy"});case"offline":return d.i18n.translate("xpack.fleet.agentStatus.offlineLabel",{defaultMessage:"Offline"});case"inactive":return d.i18n.translate("xpack.fleet.agentStatus.inactiveLabel",{defaultMessage:"Inactive"});case"unhealthy":return d.i18n.translate("xpack.fleet.agentStatus.unhealthyLabel",{defaultMessage:"Unhealthy"});case"updating":return d.i18n.translate("xpack.fleet.agentStatus.updatingLabel",{defaultMessage:"Updating"});default:throw new Error(`Insuported Agent status ${e}`)}}(e)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiNotificationBadge,{size:"s",color:"subdued"},t))))))),pe=({agentStatus:e,totalAgents:t,selectableAgents:a,selectionMode:n,setSelectionMode:i,selectedAgents:s,setSelectedAgents:r,showInactive:o})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(de,{totalAgents:t,selectableAgents:a,selectionMode:n,setSelectionMode:i,selectedAgents:s,setSelectedAgents:r})),l.a.createElement(c.EuiFlexItem,{grow:!1},e&&l.a.createElement(ge,{showInactive:o,agentStatus:e}))),l.a.createElement(c.EuiSpacer,{size:"s"}),e&&l.a.createElement(re,{agentStatus:e}));function fe(e){return e.length>20?`${e.substring(0,20)}...`:e}const Ee=m()(c.EuiFlexItem).withConfig({displayName:"FlexItem",componentId:"sc-1ynhme7-0"})(["height:",";"],(e=>e.theme.eui.euiSizeL)),he=({totalAgents:e,totalInactiveAgents:t,selectionMode:a,currentQuery:i,selectedAgents:s,refreshAgents:r})=>{const d=Object(o.nb)().hasAtLeast(I.LICENSE_FOR_SCHEDULE_UPGRADE),[g,m]=Object(n.useState)(!1),p=()=>m(!1),[f,E]=Object(n.useState)(!1),[h,b]=Object(n.useState)(!1),[y,k]=Object(n.useState)({isOpen:!1,isScheduled:!1}),v="manual"===a?!!s.find((e=>e.active)):e>t,x=e-t,M="manual"===a?s.length:x,F="manual"===a?s:i,O=[{id:0,items:[{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.reassignPolicy","data-test-subj":"agentBulkActionsReassign",defaultMessage:"Assign to new policy"}),icon:l.a.createElement(c.EuiIcon,{type:"pencil",size:"m"}),disabled:!v,onClick:()=>{p(),E(!0)}},{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.unenrollAgents","data-test-subj":"agentBulkActionsUnenroll",defaultMessage:"Unenroll {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:M}}),icon:l.a.createElement(c.EuiIcon,{type:"trash",size:"m"}),disabled:!v,onClick:()=>{p(),b(!0)}},{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.upgradeAgents","data-test-subj":"agentBulkActionsUpgrade",defaultMessage:"Upgrade {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:M}}),icon:l.a.createElement(c.EuiIcon,{type:"refresh",size:"m"}),disabled:!v,onClick:()=>{p(),k({isOpen:!0,isScheduled:!1})}},{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.scheduleUpgradeAgents","data-test-subj":"agentBulkActionsScheduleUpgrade",defaultMessage:"Schedule upgrade for {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:M}}),icon:l.a.createElement(c.EuiIcon,{type:"timeRefresh",size:"m"}),disabled:!v||!d,onClick:()=>{p(),k({isOpen:!0,isScheduled:!0})}}]}];return l.a.createElement(l.a.Fragment,null,f&&l.a.createElement(c.EuiPortal,null,l.a.createElement(X.c,{agents:F,onClose:()=>{E(!1),r()}})),h&&l.a.createElement(c.EuiPortal,null,l.a.createElement(X.d,{agents:F,agentCount:M,onClose:()=>{b(!1),r({refreshTags:!0})}})),y.isOpen&&l.a.createElement(c.EuiPortal,null,l.a.createElement(X.e,{agents:F,agentCount:M,isScheduled:y.isScheduled,onClose:()=>{k({isOpen:!1,isScheduled:!1}),r()}})),l.a.createElement(c.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},"manual"===a&&s.length||"query"===a&&e>0?l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiPopover,{id:"agentBulkActionsMenu",button:l.a.createElement(c.EuiButton,{fill:!0,iconType:"arrowDown",iconSide:"right",onClick:()=>m(!g),"data-test-subj":"agentBulkActionsButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.actions",defaultMessage:"Actions"})),isOpen:g,closePopover:p,panelPaddingSize:"none",anchorPosition:"downLeft"},l.a.createElement(c.EuiContextMenu,{initialPanelId:0,panels:O})))):l.a.createElement(Ee,{grow:!1})))},be=[{status:"healthy",label:d.i18n.translate("xpack.fleet.agentList.statusHealthyFilterText",{defaultMessage:"Healthy"})},{status:"unhealthy",label:d.i18n.translate("xpack.fleet.agentList.statusUnhealthyFilterText",{defaultMessage:"Unhealthy"})},{status:"updating",label:d.i18n.translate("xpack.fleet.agentList.statusUpdatingFilterText",{defaultMessage:"Updating"})},{status:"offline",label:d.i18n.translate("xpack.fleet.agentList.statusOfflineFilterText",{defaultMessage:"Offline"})},{status:"inactive",label:d.i18n.translate("xpack.fleet.agentList.statusInactiveFilterText",{defaultMessage:"Inactive"})}],ye=m()(c.EuiFilterSelectItem).withConfig({displayName:"ClearAllTagsFilterItem",componentId:"sc-1j1p1r8-0"})(["padding:",";"],(e=>e.theme.eui.paddingSizes.s)),ke=({agentPolicies:e,draftKuery:t,onDraftKueryChange:a,onSubmitSearch:i,selectedAgentPolicies:s,onSelectedAgentPoliciesChange:r,selectedStatus:o,onSelectedStatusChange:d,showUpgradeable:g,onShowUpgradeableChange:m,tags:p,selectedTags:f,onSelectedTagsChange:E,totalAgents:h,totalInactiveAgents:b,selectionMode:v,currentQuery:x,selectedAgents:M,refreshAgents:F,onClickAddAgent:I,onClickAddFleetServer:O})=>{const[S,j]=Object(n.useState)(!1),[C,w]=Object(n.useState)(!1),[T,L]=Object(n.useState)(!1);return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:4},l.a.createElement(c.EuiFlexGroup,{gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:6},l.a.createElement(y.s,{value:t,onChange:(e,t)=>{a(e),t&&i(e)},indexPattern:k.a,dataTestSubj:"agentList.queryInput"})),l.a.createElement(c.EuiFlexItem,{grow:2},l.a.createElement(c.EuiFilterGroup,null,l.a.createElement(c.EuiPopover,{ownFocus:!0,button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:()=>w(!C),isSelected:C,hasActiveFilters:o.length>0,disabled:0===e.length,"data-test-subj":"agentList.statusFilter"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.statusFilterText",defaultMessage:"Status"})),isOpen:C,closePopover:()=>w(!1),panelPaddingSize:"none"},l.a.createElement("div",{className:"euiFilterSelect__items"},be.map((({label:e,status:t},a)=>l.a.createElement(c.EuiFilterSelectItem,{key:a,checked:o.includes(t)?"on":void 0,onClick:()=>{o.includes(t)?d([...o.filter((e=>e!==t))]):d([...o,t])}},e))))),l.a.createElement(c.EuiPopover,{ownFocus:!0,button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:()=>L(!T),isSelected:T,hasActiveFilters:f.length>0,numActiveFilters:f.length,numFilters:p.length,disabled:0===p.length,"data-test-subj":"agentList.tagsFilter"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.tagsFilterText",defaultMessage:"Tags"})),isOpen:T,closePopover:()=>L(!1),panelPaddingSize:"none"},l.a.createElement("div",{className:"euiFilterSelect__items"},l.a.createElement(l.a.Fragment,null,p.map(((e,t)=>l.a.createElement(c.EuiFilterSelectItem,{checked:f.includes(e)?"on":void 0,key:t,onClick:()=>{f.includes(e)?(e=>{E(f.filter((t=>t!==e)))})(e):(e=>{E([...f,e])})(e)}},e.length>20?l.a.createElement(c.EuiToolTip,{content:e},l.a.createElement("span",null,fe(e))):e))),l.a.createElement(c.EuiHorizontalRule,{margin:"none"}),l.a.createElement(ye,{showIcons:!1,onClick:()=>{E([])}},l.a.createElement(c.EuiFlexGroup,{alignItems:"center",justifyContent:"center",gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiIcon,{type:"crossInACircleFilled",color:"danger",size:"s"})),l.a.createElement(c.EuiFlexItem,{grow:!1},"Clear all")))))),l.a.createElement(c.EuiPopover,{ownFocus:!0,button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:()=>j(!S),isSelected:S,hasActiveFilters:s.length>0,numActiveFilters:s.length,numFilters:e.length,disabled:0===e.length,"data-test-subj":"agentList.policyFilter"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.policyFilterText",defaultMessage:"Agent policy"})),isOpen:S,closePopover:()=>j(!1),panelPaddingSize:"none"},l.a.createElement("div",{className:"euiFilterSelect__items"},e.map(((e,t)=>l.a.createElement(c.EuiFilterSelectItem,{checked:s.includes(e.id)?"on":void 0,key:t,onClick:()=>{var t;s.includes(e.id)?(t=e.id,r(s.filter((e=>e!==t)))):(e=>{r([...s,e])})(e.id)}},e.name))))),l.a.createElement(c.EuiFilterButton,{hasActiveFilters:g,onClick:()=>{m(!g)},"data-test-subj":"agentList.showUpgradeable"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.showUpgradeableFilterLabel",defaultMessage:"Upgrade available"})))),0===M.length&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiToolTip,{content:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addFleetServerButton.tooltip",defaultMessage:"Fleet Server is a component of the Elastic Stack used to centrally manage Elastic Agents"})},l.a.createElement(c.EuiButton,{onClick:O,"data-test-subj":"addFleetServerButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addFleetServerButton",defaultMessage:"Add Fleet Server"})))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiToolTip,{content:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addAgentButton.tooltip",defaultMessage:"Add Elastic Agents to your hosts to collect data and send it to the Elastic Stack"})},l.a.createElement(c.EuiButton,{fill:!0,onClick:I,"data-test-subj":"addAgentButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addButton",defaultMessage:"Add agent"}))))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(he,{totalAgents:h,totalInactiveAgents:b,selectionMode:v,currentQuery:x,selectedAgents:M,refreshAgents:F}))))))},ve=({tags:e})=>l.a.createElement(l.a.Fragment,null,e.length>3?l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiToolTip,{content:l.a.createElement("span",{"data-test-subj":"agentTagsTooltip"},e.join(", "))},l.a.createElement("span",{"data-test-subj":"agentTags"},Object(Z.take)(e,3).map(fe).join(", ")," + ",e.length-3," more"))):l.a.createElement("span",{"data-test-subj":"agentTags"},e.map(((e,t)=>l.a.createElement(l.a.Fragment,null,t>0&&", ",e.length>20?l.a.createElement(c.EuiToolTip,{content:l.a.createElement("span",null,e),key:e},l.a.createElement("span",null,fe(e))):l.a.createElement("span",{key:e},e)))))),xe=({agent:e,agentPolicy:t,onReassignClick:a,onUnenrollClick:i,onUpgradeClick:s})=>{const{getHref:r}=Object(o.ob)(),d=Object(o.S)().fleet.all,g="unenrolling"===e.status,m=Object(o.mb)(),[p,f]=Object(n.useState)(!1),E=[l.a.createElement(c.EuiContextMenuItem,{icon:"inspect",href:r("agent_details",{agentId:e.id}),key:"viewAgent"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.viewActionText",defaultMessage:"View agent"}))];return!1===(null==t?void 0:t.is_managed)&&E.push(l.a.createElement(c.EuiContextMenuItem,{icon:"pencil",onClick:()=>{a()},disabled:!e.active,key:"reassignPolicy"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.reassignActionText",defaultMessage:"Assign to new policy"})),l.a.createElement(c.EuiContextMenuItem,{disabled:!d||!e.active,icon:"trash",onClick:()=>{i()}},g?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.forceUnenrollOneButton",defaultMessage:"Force unenroll"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.unenrollOneButton",defaultMessage:"Unenroll agent"})),l.a.createElement(c.EuiContextMenuItem,{icon:"refresh",disabled:!Object(C.j)(e,m),onClick:()=>{s()}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.upgradeOneButton",defaultMessage:"Upgrade agent"}))),l.a.createElement(y.f,{isOpen:p,onChange:e=>f(e),items:E})},Me=({hasFleetAllPrivileges:e,setEnrollmentFlyoutState:t})=>l.a.createElement(c.EuiEmptyPrompt,{title:l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.noAgentsPrompt",defaultMessage:"No agents enrolled"})),actions:e?l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>t({isOpen:!0})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addButton",defaultMessage:"Add agent"})):null});function Fe(e){return"string"!=typeof e?"-":e}const Ie=()=>{const{notifications:e,cloud:t}=Object(o.ub)();Object(o.T)("agent_list");const{getHref:a}=Object(o.ob)(),i=Object(o.xb)().urlParams.kuery||"",s=Object(o.S)().fleet.all,r=Object(o.mb)(),[g,m]=Object(n.useState)(!1),[p,f]=Object(n.useState)(i),[E,h]=Object(n.useState)(i),[b,v]=Object(n.useState)("manual"),[x,M]=Object(n.useState)([]),F=Object(n.useRef)(null),{pagination:I,pageSizeOptions:O,setPagination:S}=Object(o.qb)(),j=Object(n.useCallback)((e=>{h(e),S({...I,currentPage:1})}),[h,I,S]),[w,T]=Object(n.useState)([]),[L,P]=Object(n.useState)([]),[A,_]=Object(n.useState)([]),D=E.trim()||w.length||L.length||A.length||g,B=Object(n.useCallback)((()=>{f(""),h(""),T([]),P([]),_([]),m(!1)}),[h,f,T,P,m]),[z,N]=Object(n.useState)({isOpen:!1}),R=Object(o.Y)(),[U,H]=Object(n.useState)(void 0),[q,G]=Object(n.useState)(void 0),[W,$]=Object(n.useState)(void 0),V=Object(n.useMemo)((()=>{let e=E.trim();if(w.length&&(e&&(e=`(${e}) and`),e=`${e} ${k.b}.policy_id : (${w.map((e=>`"${e}"`)).join(" or ")})`),A.length&&(e&&(e=`(${e}) and`),e=`${e} ${k.b}.tags : (${A.map((e=>`"${e}"`)).join(" or ")})`),L.length){const t=L.map((e=>{switch(e){case"healthy":return C.a.buildKueryForOnlineAgents();case"unhealthy":return C.a.buildKueryForErrorAgents();case"offline":return C.a.buildKueryForOfflineAgents();case"updating":return C.a.buildKueryForUpdatingAgents();case"inactive":return C.a.buildKueryForInactiveAgents()}})).filter((e=>void 0!==e)).join(" or ");e=e?`(${e}) and (${t})`:t}return e}),[E,w,A,L]),K=Object(n.useMemo)((()=>L.includes("inactive")),[L]),[Y,Q]=Object(n.useState)([]),[te,ae]=Object(n.useState)(),[ne,le]=Object(n.useState)(),[ie,se]=Object(n.useState)(!1),[re,oe]=Object(n.useState)(0),[ce,ue]=Object(n.useState)(0),de=Object(n.useRef)(0),ge=Object(n.useCallback)((({refreshTags:t=!1}={})=>{!async function(){de.current++;const a=de.current;try{se(!0);const[e,n]=await Promise.all([Object(o.r)({page:I.currentPage,perPage:I.pageSize,kuery:V&&""!==V?V:void 0,showInactive:K,showUpgradeable:g}),Object(o.q)({kuery:V&&""!==V?V:void 0})]);if(de.current!==a)return;if(e.error)throw e.error;if(!e.data)throw new Error("Invalid GET /agents response");if(n.error)throw n.error;if(!n.data)throw new Error("Invalid GET /agents-status response");ae({healthy:n.data.results.online,unhealthy:n.data.results.error,offline:n.data.results.offline,updating:n.data.results.updating,inactive:e.data.totalInactive});const l=Array.from(new Set(e.data.items.flatMap((e=>{var t;return null!==(t=e.tags)&&void 0!==t?t:[]}))));(!ne||l.length>ne.length||t)&&le(l),Q(e.data.items),oe(e.data.total),ue(e.data.totalInactive)}catch(t){e.toasts.addError(t,{title:d.i18n.translate("xpack.fleet.agentList.errorFetchingDataTitle",{defaultMessage:"Error fetching agents"})})}se(!1)}()}),[I.currentPage,I.pageSize,V,K,g,ne,e.toasts]);Object(n.useEffect)((()=>{ge();const e=setInterval((()=>{ge()}),3e4);return()=>clearInterval(e)}),[ge]);const me=Object(o.Z)({page:1,perPage:k.n,full:!0}),fe=Object(n.useMemo)((()=>me.data?me.data.items:[]),[me]),Ee=Object(n.useMemo)((()=>fe.reduce(((e,t)=>(e[t.id]=t,e)),{})),[fe]),he=e=>{if(!e.active)return!1;if(!e.policy_id)return!0;const t=Ee[e.policy_id];return!(!0===(null==t?void 0:t.is_managed))},be=Object(n.useMemo)((()=>{if(!q||!q.policy_id)return!1;const e=Ee[q.policy_id];return!!e&&e.package_policies.some((e=>{var t;return"string"!=typeof e&&(null===(t=e.package)||void 0===t?void 0:t.name)===k.h}))}),[q,Ee]),{isUnhealthy:ye}=Object(J.a)(),Ie=Object(n.useCallback)((()=>{R.openFleetServerFlyout()}),[R]),{abortUpgrade:Oe,currentUpgrades:Se,refreshUpgrades:je}=function(e){const[t,a]=Object(n.useState)([]),l=Object(n.useRef)(),i=Object(n.useRef)(!1),{notifications:s,overlays:r}=Object(o.ub)(),c=Object(n.useCallback)((async()=>{try{const e=await Object(o.s)();if(i.current)return;if(e.error)throw e.error;if(!e.data)throw new Error("No data");a(e.data.items)}catch(e){s.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.currentUpgrade.fetchRequestError",{defaultMessage:"An error happened while fetching current upgrades"})})}}),[s.toasts]),u=Object(n.useCallback)((async t=>{try{if(!await r.openConfirm(d.i18n.translate("xpack.fleet.currentUpgrade.confirmDescription",{defaultMessage:"This action will abort upgrade of {nbAgents} agents",values:{nbAgents:t.nbAgents-t.nbAgentsAck}}),{title:d.i18n.translate("xpack.fleet.currentUpgrade.confirmTitle",{defaultMessage:"Abort upgrade?"})}))return;await Object(o.G)(t.actionId),await Promise.all([c(),e()])}catch(e){s.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.currentUpgrade.abortRequestError",{defaultMessage:"An error happened while aborting upgrade"})})}}),[c,s.toasts,r,e]);return Object(n.useEffect)((()=>(i.current=!1,async function e(){await c(),i.current||(l.current=setTimeout((()=>e()),12e4))}(),()=>{i.current=!0,l.current&&clearTimeout(l.current)})),[c]),{currentUpgrades:t,refreshUpgrades:c,abortUpgrade:u}}(ge),Ce=[{field:"local_metadata.host.hostname",name:d.i18n.translate("xpack.fleet.agentList.hostColumnTitle",{defaultMessage:"Host"}),width:"185px",render:(e,t)=>l.a.createElement(c.EuiLink,{href:a("agent_details",{agentId:t.id})},Fe(e))},{field:"active",width:"85px",name:d.i18n.translate("xpack.fleet.agentList.statusColumnTitle",{defaultMessage:"Status"}),render:(e,t)=>l.a.createElement(X.a,{agent:t})},{field:"tags",width:"210px",name:d.i18n.translate("xpack.fleet.agentList.tagsColumnTitle",{defaultMessage:"Tags"}),render:(e=[],t)=>l.a.createElement(ve,{tags:e})},{field:"policy_id",name:d.i18n.translate("xpack.fleet.agentList.policyColumnTitle",{defaultMessage:"Agent policy"}),width:"260px",render:(e,t)=>{const a=Ee[e],n=t.policy_revision&&(null==a?void 0:a.revision)>t.policy_revision;return l.a.createElement(c.EuiFlexGroup,{gutterSize:"none",style:{minWidth:0},direction:"column"},a&&l.a.createElement(y.e,{policy:a}),n&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},l.a.createElement(c.EuiIcon,{size:"m",type:"alert",color:"warning"})," ",l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.outOfDateLabel",defaultMessage:"Out-of-date"}))))}},{field:"local_metadata.elastic.agent.version",width:"135px",name:d.i18n.translate("xpack.fleet.agentList.versionTitle",{defaultMessage:"Version"}),render:(e,t)=>l.a.createElement(c.EuiFlexGroup,{gutterSize:"none",style:{minWidth:0},direction:"column"},l.a.createElement(c.EuiFlexItem,{grow:!1,className:"eui-textNoWrap"},Fe(e)),he(t)&&Object(C.j)(t,r)?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},l.a.createElement(c.EuiIcon,{size:"m",type:"alert",color:"warning"})," ",l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.agentUpgradeLabel",defaultMessage:"Upgrade available"}))):null)},{field:"last_checkin",name:d.i18n.translate("xpack.fleet.agentList.lastCheckinTitle",{defaultMessage:"Last activity"}),width:"180px",render:(e,t)=>e?l.a.createElement(u.FormattedRelative,{value:e}):null},{name:d.i18n.translate("xpack.fleet.agentList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>{const t="string"==typeof e.policy_id?Ee[e.policy_id]:void 0;return l.a.createElement(xe,{agent:e,agentPolicy:t,onReassignClick:()=>H(e),onUnenrollClick:()=>G(e),onUpgradeClick:()=>$(e)})}}],width:"100px"}];return l.a.createElement(l.a.Fragment,null,z.isOpen?l.a.createElement(c.EuiPortal,null,l.a.createElement(y.b,{agentPolicy:fe.find((e=>e.id===z.selectedPolicyId)),onClose:()=>{N({isOpen:!1}),ge(),me.resendRequest()}})):null,U&&l.a.createElement(c.EuiPortal,null,l.a.createElement(X.c,{agents:[U],onClose:()=>{H(void 0),ge()}})),q&&l.a.createElement(c.EuiPortal,null,l.a.createElement(X.d,{agents:[q],agentCount:1,onClose:()=>{G(void 0),ge({refreshTags:!0})},useForceUnenroll:"unenrolling"===q.status,hasFleetServer:be})),W&&l.a.createElement(c.EuiPortal,null,l.a.createElement(X.e,{agents:[W],agentCount:1,onClose:()=>{$(void 0),ge(),je()}})),ye&&l.a.createElement(l.a.Fragment,null,null!=t&&t.deploymentUrl?l.a.createElement(X.g,{deploymentUrl:t.deploymentUrl}):l.a.createElement(X.h,{onClickAddFleetServer:Ie}),l.a.createElement(c.EuiSpacer,{size:"l"})),Se.map((e=>l.a.createElement(l.a.Fragment,{key:e.actionId},l.a.createElement(ee,{currentUpgrade:e,abortUpgrade:Oe}),l.a.createElement(c.EuiSpacer,{size:"l"})))),l.a.createElement(ke,{agentPolicies:fe,draftKuery:p,onDraftKueryChange:f,onSubmitSearch:j,selectedAgentPolicies:w,onSelectedAgentPoliciesChange:T,selectedStatus:L,onSelectedStatusChange:P,showUpgradeable:g,onShowUpgradeableChange:m,tags:null!=ne?ne:[],selectedTags:A,onSelectedTagsChange:_,totalAgents:re,totalInactiveAgents:ce,selectionMode:b,currentQuery:V,selectedAgents:x,refreshAgents:({refreshTags:e=!1}={})=>Promise.all([ge({refreshTags:e}),je()]),onClickAddAgent:()=>N({isOpen:!0}),onClickAddFleetServer:Ie}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(pe,{showInactive:K,totalAgents:re,agentStatus:te,selectableAgents:(null==Y?void 0:Y.filter(he).length)||0,selectionMode:b,setSelectionMode:v,selectedAgents:x,setSelectedAgents:e=>{null!=F&&F.current&&(F.current.setSelection(e),v("manual"))}}),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiBasicTable,{ref:F,className:"fleet__agentList__table","data-test-subj":"fleetAgentListTable",loading:ie,hasActions:!0,noItemsMessage:ie&&1===de.current?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.loadingAgentsMessage",defaultMessage:"Loading agents…"}):D?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.noFilteredAgentsPrompt",defaultMessage:"No agents found. {clearFiltersLink}",values:{clearFiltersLink:l.a.createElement(c.EuiLink,{onClick:()=>B()},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.clearFiltersLinkText",defaultMessage:"Clear filters"}))}}):l.a.createElement(Me,{hasFleetAllPrivileges:s,setEnrollmentFlyoutState:N}),items:re?g?Y.filter((e=>he(e)&&Object(C.j)(e,r))):Y:[],itemId:"id",columns:Ce,pagination:{pageIndex:I.currentPage-1,pageSize:I.pageSize,totalItemCount:Math.min(re,k.n),pageSizeOptions:O},isSelectable:!0,selection:{onSelectionChange:e=>{M(e),"query"===b&&e.length<x.length&&(x.length>0&&0===Object(Z.differenceBy)(x,Y,"id").length?v("manual"):null!=F&&F.current&&F.current.setSelection(Y))},selectable:he,selectableMessage:(e,t)=>e?"":t.active?t.policy_id&&Ee[t.policy_id].is_managed?"This action is not available for agents enrolled in an externally managed agent policy":"":"This agent is not active"},onChange:({page:e})=>{const t={...I,currentPage:e.index+1,pageSize:e.size};S(t)}}))};var Oe=a(125);const Se=l.a.createContext({refresh:()=>{}});var je=a(41);const Ce="logs-elastic_agent-*,logs-elastic_agent.*-*",we="elastic_agent",Te="elastic_agent.id",Le={name:"data_stream.dataset",type:"string",aggregatable:!0},Pe={name:"log.level",type:"string",aggregatable:!0},Ae="now-1d",_e="now",De={start:Ae,end:_e,logLevels:[],datasets:[we],query:""},Be={ERROR:"error",WARNING:"warning",INFO:"info",DEBUG:"debug"},ze=["error","warning","warn","notice","info","debug"],Ne=Be.INFO;var Re=a(288),Ue=a.n(Re),He=a(154),qe=a(75),Ge=a(294),We=a.n(Ge),$e=a(156),Ve=a(293),Ke=a.n(Ve),Ye=a(13),Qe=a.n(Ye),Ze=a(76);const Xe=Object(n.memo)((({selectedDatasets:e,onToggleDataset:t})=>{const{unifiedSearch:a}=Object(o.ub)(),[i,s]=Object(n.useState)(!1),[r,u]=Object(n.useState)(!1),[g,m]=Object(n.useState)([we]),p=Object(n.useCallback)((()=>s((e=>!e))),[s]),f=Object(n.useCallback)((()=>s(!1)),[s]);return Object(n.useEffect)((()=>{(async()=>{u(!0);try{const e=await a.autocomplete.getValueSuggestions({indexPattern:{title:Ce,fields:[Le]},field:Le,query:""});e.length>0&&m(e.sort())}catch(e){m([we])}u(!1)})()}),[a.autocomplete]),l.a.createElement(c.EuiPopover,{button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:p,isSelected:i,isLoading:r,numFilters:g.length,hasActiveFilters:e.length>0,numActiveFilters:e.length},d.i18n.translate("xpack.fleet.agentLogs.datasetSelectText",{defaultMessage:"Dataset"})),isOpen:i,closePopover:f,panelPaddingSize:"none"},g.map((a=>l.a.createElement(c.EuiFilterSelectItem,{checked:e.includes(a)?"on":void 0,key:a,onClick:()=>t(a)},a))))})),Je=Object(n.memo)((({selectedLevels:e,onToggleLevel:t})=>{const{unifiedSearch:a}=Object(o.ub)(),[i,s]=Object(n.useState)(!1),[r,u]=Object(n.useState)(!1),[g,m]=Object(n.useState)([]),p=Object(n.useCallback)((()=>s((e=>!e))),[]),f=Object(n.useCallback)((()=>s(!1)),[]);Object(n.useEffect)((()=>{(async()=>{u(!0);try{const t=await a.autocomplete.getValueSuggestions({indexPattern:{title:Ce,fields:[Pe]},field:Pe,query:""});m((e=t,[...new Set([...ze.filter((t=>e.includes(t))),...e.sort()])]))}catch(e){m([])}var e;u(!1)})()}),[a.autocomplete]);const E=l.a.createElement("div",{className:"euiFilterSelect__note"},l.a.createElement("div",{className:"euiFilterSelect__noteContent"},l.a.createElement(c.EuiIcon,{type:"minusInCircle"}),l.a.createElement(c.EuiSpacer,{size:"xs"}),l.a.createElement("p",null,d.i18n.translate("xpack.fleet.agentLogs.logLevelEmpty",{defaultMessage:"No Logs Found"})))),h=g.map((a=>l.a.createElement(c.EuiFilterSelectItem,{checked:e.includes(a)?"on":void 0,key:a,onClick:()=>t(a)},a)));return l.a.createElement(c.EuiPopover,{button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:p,isSelected:i,isLoading:r,numFilters:g.length,hasActiveFilters:e.length>0,numActiveFilters:e.length},d.i18n.translate("xpack.fleet.agentLogs.logLevelSelectText",{defaultMessage:"Log level"})),isOpen:i,closePopover:f,panelPaddingSize:"none"},0===g.length?E:h)}));var et=a(67);const tt=[Te,Le.name,Pe.name],at=Object(n.memo)((({query:e,isQueryValid:t,onUpdateQuery:a})=>{const{data:i}=Object(o.ub)(),[s,r]=Object(n.useState)();return Object(n.useEffect)((()=>{(async()=>{try{const e=(await i.dataViews.getFieldsForWildcard({pattern:Ce})||[]).filter((e=>!tt.includes(e.name)));r(e)}catch(e){r(void 0)}})()}),[i.dataViews]),l.a.createElement(et.QueryStringInput,{iconType:"search",disableLanguageSwitcher:!0,indexPatterns:s?[{title:Ce,fields:s}]:[],query:{query:e,language:"kuery"},isInvalid:!t,disableAutoFocus:!0,placeholder:d.i18n.translate("xpack.fleet.agentLogs.searchPlaceholderText",{defaultMessage:"Search logs…"}),onChange:e=>{a(e.query)},onSubmit:e=>{a(e.query,!0)}})})),nt=Object.values(Be),lt=Object(n.memo)((({agent:e})=>{var t,a,i,s;const{notifications:r}=Object(o.ub)(),[g,m]=Object(n.useState)(!1),[p,f]=Object(n.useState)(null!==(t=null===(a=e.local_metadata)||void 0===a||null===(i=a.elastic)||void 0===i||null===(s=i.agent)||void 0===s?void 0:s.log_level)&&void 0!==t?t:Ne),[E,h]=Object(n.useState)(p),b=Object(n.useCallback)((()=>{m(!0),async function(){try{const t=await Object(o.A)(e.id,{action:{type:"SETTINGS",data:{log_level:E}}});if(t.error)throw t.error;f(E),r.toasts.addSuccess(d.i18n.translate("xpack.fleet.agentLogs.selectLogLevel.successText",{defaultMessage:"Changed agent logging level to '{logLevel}'.",values:{logLevel:E}}))}catch(e){r.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.agentLogs.selectLogLevel.errorTitleText",{defaultMessage:"Error updating agent logging level"})})}m(!1)}()}),[r,E,e.id]);return l.a.createElement(c.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFormLabel,{htmlFor:"selectAgentLogLevel"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.selectLogLevelLabelText",defaultMessage:"Agent logging level"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiSelect,{disabled:g,compressed:!0,id:"selectAgentLogLevel",value:E,onChange:e=>{h(e.target.value)},options:nt.map((e=>({text:e,value:e})))})),p!==E&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{flush:"left",size:"xs",isLoading:g,disabled:p===E,iconType:"refresh",onClick:b},g?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.updateButtonLoadingText",defaultMessage:"Applying changes..."}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.updateButtonText",defaultMessage:"Apply changes"}))))})),it=m()(c.EuiFlexGroup).withConfig({displayName:"WrapperFlexGroup",componentId:"sc-mjo9ba-0"})(["height:100%;"]),st=m()(c.EuiFlexItem).withConfig({displayName:"DatePickerFlexItem",componentId:"sc-mjo9ba-1"})(["max-width:312px;"]),rt=Object(je.createStateContainerReactHelpers)(),ot=({agentPolicy:e})=>{const{getHref:t}=Object(o.ob)();return l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiCallOut,{size:"m",color:"primary",iconType:"iInCircle",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.logDisabledCallOutTitle",defaultMessage:"Log collection is disabled"})},e.is_managed?null:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.logDisabledCallOutDescription",defaultMessage:"Update the agent's policy {settingsLink} to enable logs collection.",values:{settingsLink:l.a.createElement(c.EuiLink,{href:t("policy_details",{policyId:e.id,tabId:"settings"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.settingsLink",defaultMessage:"settings"}))}})))},ct=Object(n.memo)((({agent:e,agentPolicy:t,state:a})=>{var i,s,r,d;const{data:g,application:m,http:p}=Object(o.ub)(),{update:f}=rt.useTransitions(),h=Object(n.useCallback)((e=>{const{min:t,max:a}=g.query.timefilter.timefilter.calculateBounds(e);return t&&a?{start:t.valueOf(),end:a.valueOf()}:void 0}),[g.query.timefilter.timefilter]),b=Object(n.useCallback)((e=>{h(e)&&f({start:e.from,end:e.to})}),[h,f]),[y,k]=Object(n.useState)(h({from:a.start,to:a.end})||h({from:Ae,to:_e}));Object(n.useEffect)((()=>{const e=h({from:a.start,to:a.end});e?k(e):b({from:Ae,to:_e})}),[a.start,a.end,h,b]);const v=Object(n.useCallback)((e=>{try{return Object($e.a)(e),!0}catch(e){return!1}}),[]),[x,M]=Object(n.useState)(a.query),[F,I]=Object(n.useState)(v(a.query)),O=Object(n.useCallback)(((e,t)=>{M(e),v(e)?(I(!0),t&&f({query:e})):I(!1)}),[v,f]),S=Object(n.useMemo)((()=>(({agentId:e,datasets:t,logLevels:a,userQuery:n})=>{const l=`elastic_agent.id:${e}`,i=t.length?t.map((e=>`${Le.name}:${e}`)).join(" or "):`${Le.name}:elastic_agent or ${Le.name}:elastic_agent.*`,s=a.map((e=>`${Pe.name}:${e}`)).join(" or "),r=`${l} and (${i})`,o=s?`${r} and (${s})`:r;return n?`(${o}) and (${n})`:o})({agentId:e.id,datasets:a.datasets,logLevels:a.logLevels,userQuery:a.query})),[e.id,a.datasets,a.logLevels,a.query]),j=Object(n.useMemo)((()=>p.basePath.prepend(Ue.a.format({pathname:"/app/logs/stream",search:Object(He.stringify)({logPosition:Object(qe.encode)({start:a.start,end:a.end,streamLive:!1}),logFilter:Object(qe.encode)({expression:S,kind:"kuery"})})}))),[p.basePath,a.start,a.end,S]),C=null===(i=e.local_metadata)||void 0===i||null===(s=i.elastic)||void 0===s||null===(r=s.agent)||void 0===r?void 0:r.version,w=Object(n.useMemo)((()=>{var e;if(!C)return!1;const t=null===(e=Qe()(C))||void 0===e?void 0:e.version;return!!t&&Ke()(t,"7.11.0")}),[C]),[T,{height:L}]=We()(),P=Object(n.useMemo)((()=>Math.max(L,600)),[L]);return w?l.a.createElement(it,{direction:"column",gutterSize:"m"},t&&!(null!==(d=t.monitoring_enabled)&&void 0!==d&&d.includes("logs"))&&l.a.createElement(ot,{agentPolicy:t}),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexGroup,{gutterSize:"m"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(at,{query:x,onUpdateQuery:O,isQueryValid:F})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFilterGroup,null,l.a.createElement(Xe,{selectedDatasets:a.datasets,onToggleDataset:e=>{const t=[...a.datasets],n=t.indexOf(e);n>=0?(t.splice(n,1),f({datasets:t})):f({datasets:[...a.datasets,e]})}}),l.a.createElement(Je,{selectedLevels:a.logLevels,onToggleLevel:e=>{const t=[...a.logLevels],n=t.indexOf(e);n>=0?(t.splice(n,1),f({logLevels:t})):f({logLevels:[...a.logLevels,e]})}}))),l.a.createElement(st,{grow:!1},l.a.createElement(c.EuiSuperDatePicker,{showUpdateButton:!1,start:a.start,end:a.end,onTimeChange:({start:e,end:t})=>{b({from:e,to:t})}})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(E.RedirectAppLinks,{application:m},l.a.createElement(c.EuiButtonEmpty,{href:j,iconType:"popout",flush:"both"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.openInLogsUiLinkText",defaultMessage:"Open in Logs"})))))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiPanel,{paddingSize:"none",panelRef:T},l.a.createElement(Ze.LogStream,{height:P,startTimestamp:y.start,endTimestamp:y.end,query:S}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(lt,{agent:e}))):l.a.createElement(c.EuiCallOut,{size:"m",color:"warning",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.oldAgentWarningTitle",defaultMessage:"The Logs view requires Elastic Agent 7.11 or higher. To upgrade an agent, go to the Actions menu, or {downloadLink} a newer version.",values:{downloadLink:l.a.createElement(c.EuiLink,{href:"https://ela.st/download-elastic-agent",external:!0,target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.downloadLink",defaultMessage:"download"}))}})})})),ut=Object(n.memo)((({agent:e,agentPolicy:t})=>{const a=Object(n.useMemo)((()=>Object(je.createStateContainer)({...De,...Object(je.getStateFromKbnUrl)("_q",window.location.href,{getFromHashQuery:!1})},{update:e=>t=>({...e,...t})})),[]),i=Object(n.useMemo)((()=>rt.connect((e=>({state:e||De})))(ct)),[]),[s,r]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{const e=Object(je.createKbnUrlStateStorage)({useHashQuery:!1,useHash:!1}),{start:t,stop:n}=Object(je.syncState)({storageKey:"_q",stateContainer:a,stateStorage:e});return t(),r(!0),()=>{n(),a.set(De)}}),[a]),l.a.createElement(rt.Provider,{value:a},s?l.a.createElement(i,{agent:e,agentPolicy:t}):null)})),dt=Object(n.memo)((({agent:e,assignFlyoutOpenByDefault:t=!1,onCancelReassign:a,agentPolicy:i})=>{const s=Object(o.S)().fleet.all,r=Object(o.mb)(),d=l.a.useContext(Se).refresh,[g,m]=Object(n.useState)(t),[p,f]=Object(n.useState)(!1),[E,h]=Object(n.useState)(!1),b="unenrolling"===e.status,k=i&&Object(C.o)(i),v=Object(n.useMemo)((()=>a||(()=>m(!1))),[a,m]);return l.a.createElement(l.a.Fragment,null,g&&l.a.createElement(c.EuiPortal,null,l.a.createElement(X.c,{agents:[e],onClose:v})),p&&l.a.createElement(c.EuiPortal,null,l.a.createElement(X.d,{agents:[e],agentCount:1,onClose:()=>{f(!1),d()},useForceUnenroll:b,hasFleetServer:k})),E&&l.a.createElement(c.EuiPortal,null,l.a.createElement(X.e,{agents:[e],agentCount:1,onClose:()=>{h(!1),d()}})),l.a.createElement(y.f,{button:{props:{iconType:"arrowDown",iconSide:"right",color:"primary"},children:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.actionsButton",defaultMessage:"Actions"})},items:[l.a.createElement(c.EuiContextMenuItem,{icon:"pencil",onClick:()=>{m(!0)},disabled:!e.active,key:"reassignPolicy"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.reassignActionText",defaultMessage:"Assign to new policy"})),l.a.createElement(c.EuiContextMenuItem,{icon:"trash",disabled:!s||!e.active,onClick:()=>{f(!0)}},b?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.forceUnenrollOneButton",defaultMessage:"Force unenroll"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.unenrollOneButton",defaultMessage:"Unenroll agent"})),l.a.createElement(c.EuiContextMenuItem,{icon:"refresh",disabled:!Object(C.j)(e,r),onClick:()=>{h(!0)}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.upgradeOneButton",defaultMessage:"Upgrade agent"}))]}))})),gt=m()(c.EuiFlexItem).withConfig({displayName:"FlexItemWithMinWidth",componentId:"sc-19wc892-0"})(["min-width:0px;"]),mt=Object(n.memo)((({agent:e,agentPolicy:t})=>{var a,n,i,s,r,g,m,p,f,E,h,b,k,v,x;const M=Object(o.mb)();return l.a.createElement(c.EuiPanel,null,l.a.createElement(c.EuiDescriptionList,{compressed:!0},[{title:d.i18n.translate("xpack.fleet.agentDetails.statusLabel",{defaultMessage:"Status"}),description:l.a.createElement(X.a,{agent:e})},{title:d.i18n.translate("xpack.fleet.agentDetails.lastActivityLabel",{defaultMessage:"Last activity"}),description:e.last_checkin?l.a.createElement(u.FormattedRelative,{value:new Date(e.last_checkin)}):"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.hostIdLabel",{defaultMessage:"Agent ID"}),description:e.id},{title:d.i18n.translate("xpack.fleet.agentDetails.agentPolicyLabel",{defaultMessage:"Agent policy"}),description:t?l.a.createElement(y.e,{policy:t}):e.policy_id||"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.versionLabel",{defaultMessage:"Agent version"}),description:"string"==typeof(null===(a=e.local_metadata)||void 0===a||null===(n=a.elastic)||void 0===n||null===(i=n.agent)||void 0===i?void 0:i.version)?l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center",style:{minWidth:0}},l.a.createElement(c.EuiFlexItem,{grow:!1,className:"eui-textNoWrap"},e.local_metadata.elastic.agent.version),Object(C.j)(e,M)?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiToolTip,{position:"right",content:d.i18n.translate("xpack.fleet.agentList.agentUpgradeLabel",{defaultMessage:"Upgrade available"})},l.a.createElement(c.EuiIcon,{type:"alert",color:"warning"}))):null):"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.hostNameLabel",{defaultMessage:"Host name"}),description:"string"==typeof(null===(s=e.local_metadata)||void 0===s||null===(r=s.host)||void 0===r?void 0:r.hostname)?e.local_metadata.host.hostname:"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.logLevel",{defaultMessage:"Logging level"}),description:"string"==typeof(null===(g=e.local_metadata)||void 0===g||null===(m=g.elastic)||void 0===m||null===(p=m.agent)||void 0===p?void 0:p.log_level)?e.local_metadata.elastic.agent.log_level:"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.releaseLabel",{defaultMessage:"Agent release"}),description:"boolean"==typeof(null===(f=e.local_metadata)||void 0===f||null===(E=f.elastic)||void 0===E||null===(h=E.agent)||void 0===h?void 0:h.snapshot)?!0===e.local_metadata.elastic.agent.snapshot?"snapshot":"stable":"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.platformLabel",{defaultMessage:"Platform"}),description:"string"==typeof(null===(b=e.local_metadata)||void 0===b||null===(k=b.os)||void 0===k?void 0:k.platform)?e.local_metadata.os.platform:"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.monitorLogsLabel",{defaultMessage:"Monitor logs"}),description:Array.isArray(null==t?void 0:t.monitoring_enabled)&&null!=t&&null!==(v=t.monitoring_enabled)&&void 0!==v&&v.includes("logs")?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorLogsEnabledText",defaultMessage:"Enabled"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorLogsDisabledText",defaultMessage:"Disabled"})},{title:d.i18n.translate("xpack.fleet.agentDetails.monitorMetricsLabel",{defaultMessage:"Monitor metrics"}),description:Array.isArray(null==t?void 0:t.monitoring_enabled)&&null!=t&&null!==(x=t.monitoring_enabled)&&void 0!==x&&x.includes("metrics")?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorMetricsEnabledText",defaultMessage:"Enabled"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorMetricsDisabledText",defaultMessage:"Disabled"})}].map((({title:e,description:t})=>l.a.createElement(c.EuiFlexGroup,null,l.a.createElement(gt,{grow:3},l.a.createElement(c.EuiDescriptionListTitle,null,e)),l.a.createElement(gt,{grow:7},l.a.createElement(c.EuiDescriptionListDescription,{className:"eui-textTruncate"},t)))))))}));function pt(e){return"logfile"===e?"(datasets:!(elastic_agent.filebeat))":e.match(/\/metrics$/)?"(datasets:!(elastic_agent.metricbeat))":"osquery"===e?"(datasets:!(elastic_agent.osquerybeat))":e.match(/^synthetics\//)?"(datasets:!(elastic_agent.heartbeat))":"apm"===e?"(datasets:!(elastic_agent.apm_server))":"endpoint"===e?"(datasets:!(elastic_agent.endpoint_security))":""}const ft=m()(c.EuiAccordion).withConfig({displayName:"StyledEuiAccordion",componentId:"sc-12a1xr8-0"})([".ingest-integration-title-button{padding:",";}&.euiAccordion-isOpen .ingest-integration-title-button{border-bottom:1px solid ",";}.euiTableRow:last-child .euiTableRowCell{border-bottom:none;}.euiIEFlexWrapFix{min-width:0;}"],(e=>e.theme.eui.paddingSizes.m),(e=>e.theme.eui.euiColorLightShade)),Et=({id:e,title:t,children:a})=>l.a.createElement(c.EuiPanel,{paddingSize:"none"},l.a.createElement(ft,{id:e,arrowDisplay:"right",buttonClassName:"ingest-integration-title-button",buttonContent:t},a)),ht=Object(n.memo)((({agent:e,agentPolicy:t,packagePolicy:a})=>{const{getHref:i}=Object(o.ob)(),s=Object(n.useMemo)((()=>a.inputs.filter((e=>e.enabled))),[a.inputs]),r=[{field:"type",width:"100%",name:d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeLabel",{defaultMessage:"Input"}),render:e=>function(e){return"logfile"===e?d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeLogText",{defaultMessage:"Logs"}):"endpoint"===e?d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeEndpointText",{defaultMessage:"Endpoint"}):e.match(/\/metrics$/)?d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeMetricsText",{defaultMessage:"Metrics"}):e}(e)},{align:"right",name:d.i18n.translate("xpack.fleet.agentDetailsIntegrations.actionsLabel",{defaultMessage:"Actions"}),field:"type",width:"auto",render:t=>l.a.createElement(c.EuiToolTip,{content:d.i18n.translate("xpack.fleet.agentDetailsIntegrations.viewLogsButton",{defaultMessage:"View logs"})},l.a.createElement(c.EuiButtonIcon,{href:i("agent_details",{agentId:e.id,tabId:"logs",logQuery:pt(t)}),iconType:"editorAlignLeft","aria-label":d.i18n.translate("xpack.fleet.agentDetailsIntegrations.viewLogsButton",{defaultMessage:"View logs"})}))}];return l.a.createElement(Et,{id:a.id,title:l.a.createElement(c.EuiTitle,{size:"xs"},l.a.createElement("h3",null,l.a.createElement(c.EuiFlexGroup,{gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:!1},a.package?l.a.createElement(y.p,{packageName:a.package.name,version:a.package.version,size:"l",tryApi:!0}):l.a.createElement(y.p,{size:"l",packageName:"default",version:"0"})),l.a.createElement(c.EuiFlexItem,{className:"eui-textTruncate"},l.a.createElement(c.EuiLink,{className:"eui-textTruncate","data-test-subj":"agentPolicyDetailsLink",href:i("edit_integration",{policyId:t.id,packagePolicyId:a.id})},a.name)))))},l.a.createElement(c.EuiBasicTable,{tableLayout:"auto",items:s,columns:r}))})),bt=Object(n.memo)((({agent:e,agentPolicy:t})=>t&&t.package_policies?l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"m"},t.package_policies.map((a=>l.a.createElement(c.EuiFlexItem,{grow:!1,key:a.id},l.a.createElement(ht,{agent:e,agentPolicy:t,packagePolicy:a}))))):null)),yt=m()(c.EuiFlexItem).withConfig({displayName:"FlexItemWithMinWidth",componentId:"sc-1svqtoc-0"})(["min-width:0px;"]),kt=Object(n.memo)((({agent:e,agentPolicy:t})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{alignItems:"flexStart"},l.a.createElement(yt,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.overviewSectionTitle",defaultMessage:"Overview"}))),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(mt,{agent:e,agentPolicy:t})),l.a.createElement(yt,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.integrationsSectionTitle",defaultMessage:"Integrations"}))),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(bt,{agent:e,agentPolicy:t})))))),vt=({agent:e,agentPolicy:t})=>{var a,n;const{isInstalled:i,link:s,isLoading:r}=function(e){const{isLoading:t,data:a}=Object(o.gb)(I.FLEET_ELASTIC_AGENT_PACKAGE);return{isLoading:t,isInstalled:"installed"===(null==a?void 0:a.item.status),link:`${Object(o.lb)(`/dashboard/${I.FLEET_ELASTIC_AGENT_DETAILS_DASHBOARD_ID}`)}?_a=(query:(language:kuery,query:'elastic_agent.id:${e.id}'))`}}(e),d=null!==(a=null==t||null===(n=t.monitoring_enabled)||void 0===n?void 0:n.length)&&void 0!==a&&a,g=i&&!r&&d?{href:s}:{disabled:!0},m=l.a.createElement(c.EuiButton,F()({fill:!0},g,{isLoading:r}),l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.viewDashboardButtonLabel",defaultMessage:"View agent dashboard"}));return d?i?m:l.a.createElement(c.EuiToolTip,{content:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.viewDashboardButton.disabledNoIntegrationTooltip",defaultMessage:"Agent dashboard not found, you need to install the elastic_agent integration."})},m):l.a.createElement(c.EuiToolTip,{content:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.viewDashboardButton.disabledNoLogsAndMetricsTooltip",defaultMessage:"Logs and metrics for agent are not enabled in the agent policy."})},m)},xt=()=>{var e,t,a;const{params:{agentId:i,tabId:s=""}}=Object(r.useRouteMatch)(),{getHref:g}=Object(o.ob)(),{isLoading:m,isInitialRequest:p,error:f,data:E,resendRequest:h}=Object(o.cb)(i,{pollIntervalMs:5e3}),{isLoading:b,data:k,sendRequest:x}=Object(o.db)(null==E||null===(e=E.item)||void 0===e?void 0:e.policy_id),{application:{navigateToApp:M}}=Object(o.ub)(),F=Object(o.kb)(),I="true"===new URLSearchParams(Object(r.useLocation)().search).get("openReassignFlyout"),O=Object(n.useCallback)((()=>{F&&F.onDoneNavigateTo&&M(F.onDoneNavigateTo[0],F.onDoneNavigateTo[1])}),[F,M]),S=null==E||null===(t=E.item)||void 0===t||null===(a=t.local_metadata)||void 0===a?void 0:a.host,j=Object(n.useMemo)((()=>l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"s",alignItems:"flexStart"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiButtonEmpty,{iconType:"arrowLeft",href:g("agent_list"),flush:"left",size:"xs"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.viewAgentListTitle",defaultMessage:"View all agents"}))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{className:"eui-textBreakWord"},l.a.createElement("h1",null,m&&p?l.a.createElement(y.n,null):"object"==typeof S&&"string"==typeof(null==S?void 0:S.hostname)?S.hostname:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.agentDetailsTitle",defaultMessage:"Agent '{id}'",values:{id:i}})))))),[S,i,g,p,m]),C=Object(n.useMemo)((()=>{var e;return E&&E.item?l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiFlexGroup,{justifyContent:"flexEnd",alignItems:"center",gutterSize:"s",direction:"row"},!b&&!(null!=k&&null!==(e=k.item)&&void 0!==e&&e.is_managed)&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(dt,{agent:E.item,agentPolicy:null==k?void 0:k.item,assignFlyoutOpenByDefault:I,onCancelReassign:F&&F.onDoneNavigateTo?O:void 0})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(vt,{agent:null==E?void 0:E.item,agentPolicy:null==k?void 0:k.item})))):void 0}),[k,E,g,b]),w=Object(n.useMemo)((()=>[{id:"details",name:d.i18n.translate("xpack.fleet.agentDetails.subTabs.detailsTab",{defaultMessage:"Agent details"}),href:g("agent_details",{agentId:i,tabId:"details"}),isSelected:!s||"details"===s},{id:"logs",name:d.i18n.translate("xpack.fleet.agentDetails.subTabs.logsTab",{defaultMessage:"Logs"}),href:g("agent_details_logs",{agentId:i,tabId:"logs"}),isSelected:"logs"===s}]),[g,i,s]);return l.a.createElement(Se.Provider,{value:{refresh:()=>{h(),x()}}},l.a.createElement(v.c,{leftColumn:j,rightColumn:C,tabs:w},m&&p?l.a.createElement(y.n,null):f?l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.unexceptedErrorTitle",defaultMessage:"Error loading agent"}),error:f}):E&&E.item?l.a.createElement(Mt,{agent:E.item,agentPolicy:null==k?void 0:k.item}):l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.agentNotFoundErrorTitle",defaultMessage:"Agent not found"}),error:d.i18n.translate("xpack.fleet.agentDetails.agentNotFoundErrorDescription",{defaultMessage:"Cannot find agent ID {agentId}",values:{agentId:i}})})))},Mt=({agent:e,agentPolicy:t})=>(Object(o.T)("agent_details",{agentHost:"object"==typeof e.local_metadata.host&&"string"==typeof e.local_metadata.host.hostname?e.local_metadata.host.hostname:"-"}),l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:k.g.agent_details_logs,render:()=>l.a.createElement(ut,{agent:e,agentPolicy:t})}),l.a.createElement(r.Route,{path:k.g.agent_details,render:()=>l.a.createElement(kt,{agent:e,agentPolicy:t})}))),Ft=Object(r.withRouter)((({actionSection:e,title:t,modalClosePath:a,children:n})=>l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceAround"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiPageContent,null,l.a.createElement(c.EuiEmptyPrompt,{iconType:"logoBeats",title:l.a.createElement("h2",null,t),body:n,actions:e})))))),It=Object(u.injectI18n)((({intl:e})=>l.a.createElement(Ft,{title:e.formatMessage({id:"xpack.fleet.noAccess.accessDeniedTitle",defaultMessage:"Access denied"}),actionSection:[]},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.noAccess.accessDeniedDescription",defaultMessage:"You are not authorized to access Elastic Fleet. To use Elastic Fleet, you need a user role that contains All permissions for this application."}))))),Ot=({onClose:e})=>{const{getAssetsPath:t}=Object(o.ob)(),{notifications:a,cloud:i,docLinks:s}=Object(o.ub)(),r=!(null==i||!i.cloudId),[g,m]=Object(n.useState)(!1),[p,f]=Object(n.useState)(!1);Object(n.useEffect)((()=>{!async function(){try{const a={},s=await Object(o.r)({page:1,perPage:10,showInactive:!1});if(s.error)throw s.error;for(const r of null!==(t=null===(n=s.data)||void 0===n?void 0:n.items)&&void 0!==t?t:[]){var t,n,l,i;if(!r.policy_id||a[r.policy_id])continue;a[r.policy_id]=!0;if(null===(l=(null===(i=(await Object(o.u)(r.policy_id)).data)||void 0===i?void 0:i.item.package_policies).some((e=>{var t;return(null===(t=e.package)||void 0===t?void 0:t.name)===k.h})))||void 0===l||!l)return await Object(o.L)({has_seen_fleet_migration_notice:!0}),void e()}f(!0)}catch(e){a.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.fleetServerUpgradeModal.errorLoadingAgents",{defaultMessage:"Error loading agents"})})}}()}),[a.toasts,e]);const E=Object(n.useCallback)((async()=>{try{m(!g),await Object(o.L)({has_seen_fleet_migration_notice:!g})}catch(e){a.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.fleetServerUpgradeModal.failedUpdateTitle",{defaultMessage:"Error saving settings"})})}}),[g,m,a]);return p?l.a.createElement(c.EuiModal,{onClose:e},l.a.createElement(c.EuiModalHeader,null,l.a.createElement(c.EuiModalHeaderTitle,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.modalTitle",defaultMessage:"Enroll your agents into Fleet Server"}))),l.a.createElement(c.EuiModalBody,null,l.a.createElement(c.EuiImage,{size:"fullWidth",src:t("./announcement.jpg"),alt:d.i18n.translate("xpack.fleet.fleetServerUpgradeModal.announcementImageAlt",{defaultMessage:"Fleet Server upgrade announcement"})}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiText,null,r?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.cloudDescriptionMessage",defaultMessage:"Fleet Server is now available and it provides improved scalability and security. If you already had an APM instance on Elastic Cloud, we've upgraded it to APM & Fleet. If not, you can add one to your deployment for free. {existingAgentsMessage} To continue using Fleet, you must use Fleet Server and install the new version of Elastic Agent on each host.",values:{existingAgentsMessage:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.existingAgentText",defaultMessage:"Your existing Elastic Agents have been automatically unenrolled and have stopped sending data."}))}}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.onPremDescriptionMessage",defaultMessage:"Fleet Server is now available and it provides improved scalability and security. {existingAgentsMessage} To continue using Fleet, you must install a Fleet Server and the new version of Elastic Agent on each host. Learn more in our {link}.",values:{existingAgentsMessage:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.existingAgentText",defaultMessage:"Your existing Elastic Agents have been automatically unenrolled and have stopped sending data."})),link:l.a.createElement(c.EuiLink,{href:s.links.fleet.upgradeElasticAgent,external:!0,target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.fleetServerMigrationGuide",defaultMessage:"Fleet Server migration guide"}))}})),l.a.createElement(c.EuiSpacer,{size:"l"}),l.a.createElement(c.EuiText,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.breakingChangeMessage",defaultMessage:"This is a breaking change, which is why we are making it in a beta release. We are sorry for the inconvenience. Please share {link} if you have questions or need help.",values:{link:l.a.createElement(c.EuiLink,{href:"https://ela.st/fleet-feedback",target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.fleetFeedbackLink",defaultMessage:"feedback"}))}}))),l.a.createElement(c.EuiModalFooter,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiCheckbox,{id:"fleetServerModalCheckbox",label:d.i18n.translate("xpack.fleet.fleetServerUpgradeModal.checkboxLabel",{defaultMessage:"Do not show this message again"}),checked:g,onChange:E})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,onClick:e},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.closeButton",defaultMessage:"Close and get started"})))))):null},St=()=>{var e;Object(o.T)("agent_list");const t=Object(r.useHistory)(),{agents:a}=Object(o.V)(),i=Object(o.S)().fleet.all,s=Object(o.X)(),d=Object(o.Y)(),g=Object(o.ib)(),[m,p]=Object(n.useState)(!1),f=Object(n.useCallback)((()=>{p(!1)}),[p]);if(Object(n.useEffect)((()=>{var e;g.data&&!1===(null===(e=g.data)||void 0===e?void 0:e.item.has_seen_fleet_migration_notice)&&p(!0)}),[g.data]),!a.enabled)return null;if(!s.missingRequirements&&s.isLoading)return l.a.createElement(y.n,null);if(s.error)return l.a.createElement(v.d,null,l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentsInitializationErrorMessageTitle",defaultMessage:"Unable to initialize central management for Elastic Agents"}),error:s.error}));const E=1===(null==s||null===(e=s.missingRequirements)||void 0===e?void 0:e.length)&&"fleet_server"===s.missingRequirements[0],h=s.forceDisplayInstructions||E;if(!E&&s.missingRequirements&&s.missingRequirements.length>0)return l.a.createElement(Oe.b,{missingRequirements:s.missingRequirements});if(!i)return l.a.createElement(It,null);const b=h?l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>d.openEnrollmentFlyout(),"data-test-subj":"addAgentBtnTop"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addAgentButton",defaultMessage:"Add Agent"}))))):void 0;return l.a.createElement(r.Router,{history:t},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:k.g.agent_details},l.a.createElement(xt,null)),l.a.createElement(r.Route,{path:k.g.agents},l.a.createElement(v.a,{section:"agents",rightColumn:b},m&&l.a.createElement(Ot,{onClose:f}),h?l.a.createElement(Oe.a,{showEnrollmentRecommendation:!1}):l.a.createElement(Ie,null)))))};var jt=a(88),Ct=a(14);const wt=e=>{const{from:t,pkgkey:a,agentPolicyId:l}=e,{application:{navigateToApp:i}}=Object(o.ub)(),s=Object(o.kb)(),{getHref:r}=Object(o.ob)();return{cancelClickHandler:Object(n.useCallback)((e=>{null!=s&&s.onCancelNavigateTo&&(e.preventDefault(),i(...s.onCancelNavigateTo))}),[s,i]),cancelUrl:Object(n.useMemo)((()=>s&&s.onCancelUrl?s.onCancelUrl:"policy"===t&&l?r("policy_details",{policyId:l}):r("integration_details_overview",{pkgkey:a})),[s,t,l,r,a])}};var Tt=a(96),Lt=a(92),Pt=a(159);const At=m()(c.EuiSteps).withConfig({displayName:"StepsWithLessPadding",componentId:"sc-clu1jx-0"})([".euiStep__content{padding-bottom:",";}@media (max-width:","){margin-bottom:100px;}"],(e=>e.theme.eui.paddingSizes.m),(e=>e.theme.eui.euiBreakpoints.m)),_t=m()(c.EuiBottomBar).withConfig({displayName:"CustomEuiBottomBar",componentId:"sc-clu1jx-1"})(["z-index:50;"]),Dt=({from:e,queryParamsPolicyId:t})=>{var a,i;const{notifications:s}=Object(o.ub)(),{agents:{enabled:g}}=Object(o.V)(),{params:m}=Object(r.useRouteMatch)(),[p,f]=Object(n.useState)(),[E,h]=Object(n.useState)({name:"Agent policy 1",description:"",namespace:"default",monitoring_enabled:Object.values(I.dataTypes)}),[b,k]=Object(n.useState)(!0),v=Object(x.g)(E),[M,O]=Object(n.useState)(),S=null==p?void 0:p.id,{cancelClickHandler:j,cancelUrl:w}=wt({from:e,pkgkey:m.pkgkey,agentPolicyId:S});Object(n.useEffect)((()=>{g&&S&&(async()=>{const{data:e}=await Object(o.q)({policyId:S});void 0!==(null==e?void 0:e.results.total)&&L(e.results.total)})()}),[S,g]);const[T,L]=Object(n.useState)(0),[P,A]=Object(n.useState)(t?Tt.b.EXISTING:Tt.b.NEW),[_,D]=Object(n.useState)({name:"",description:"",namespace:"default",policy_id:"",enabled:!0,output_id:"",inputs:[]}),B=(e=>{const{packagePolicy:t,queryParamsPolicyId:a}=e,l=Object(o.kb)(),i=Object(n.useRef)(!0),{getPath:s}=Object(o.ob)(),c=Object(r.useHistory)(),{application:{navigateToApp:u}}=Object(o.ub)();return Object(n.useEffect)((()=>()=>{i.current=!1}),[]),Object(n.useCallback)(((e,n=[])=>{if(!i.current)return;const r=s("policy_details",{policyId:t.policy_id});if(null!=l&&l.onSaveNavigateTo&&e){const[t,i]=l.onSaveNavigateTo;if(null!=i&&i.path){const s=function({path:e,policy:t,paramsToApply:a,mappingOptions:n={}}){const[l,i]=e.split("?"),s=Object(Ct.parse)(i);a.forEach((e=>{const a=n[e];if(a){const[n,o]=(l=e,i=a,r=t.policy_id,i?"boolean"==typeof i&&i?[l,"true"]:[i.renameKey?i.renameKey:l,i.policyIdAsValue?r:"true"]:[]);n&&o&&(s[n]=o)}var l,i,r}));const r=Object(Ct.stringify)(s);return l+(r?`?${r}`:"")}({path:a?r:i.path,policy:e,mappingOptions:l.onSaveQueryParams,paramsToApply:n});u(t,{...i,path:s})}else u(...l.onSaveNavigateTo)}else c.push(r)}),[t.policy_id,s,u,c,l,a])})({packagePolicy:_,queryParamsPolicyId:t}),[z,N]=Object(n.useState)(),[R,U]=Object(n.useState)(!1),[H,q]=Object(n.useState)("VALID"),{pkgName:G,pkgVersion:W}=Object(I.splitPkgKey)(m.pkgkey),{data:$,error:V,isLoading:K}=Object(o.gb)(G,W),Y=Object(n.useMemo)((()=>{if($&&$.item)return $.item}),[$]),Q=Object(n.useCallback)((e=>{e?(f(e),Y&&U(!1)):(U(!0),f(void 0)),console.debug("Agent policy updated",e)}),[Y,f]),Z=(e,t)=>{e===Tt.b.NEW&&(t.name&&""!==t.name.trim()&&t.namespace&&""!==t.namespace.trim()?U(!1):U(!0))},X=Object(n.useCallback)((e=>{const t={...E,...e};h(t),Z(P,t)}),[h,E,P]),J=Object(n.useCallback)((e=>{A(e),Z(e,E)}),[A,E]),ee=!!z&&Object(Lt.f)(z),te=Object(n.useCallback)((e=>{if(Y){const t=Object(Lt.d)(e||_,Y,jt.safeLoad);return N(t),console.debug("Package policy validation results",t),t}}),[_,Y]),ae=Object(n.useCallback)((e=>{const t={..._,...e};D(t),console.debug("Package policy updated",t);const a=te(t),n=t.package,l=!!a&&Object(Lt.f)(a),i=t.policy_id&&""!==t.policy_id;!n||!i&&P!==Tt.b.NEW||l?q("INVALID"):q("VALID")}),[_,te,P]),ne=Object(n.useCallback)((({isValid:e,updatedPolicy:t})=>{ae(t),q((t=>"VALID"!==t||e?t:"INVALID"))}),[ae]),le=Object(n.useCallback)((async e=>{q("LOADING");const t=await Object(o.k)(e);return q(T?"SUBMITTED":"SUBMITTED_NO_AGENTS"),t}),[T]),ie=Object(n.useCallback)((async()=>{var e;let t;q("LOADING");const a=(null==_||null===(e=_.package)||void 0===e?void 0:e.name)===I.FLEET_SYSTEM_PACKAGE,n=await Object(o.i)(E,{withSysMonitoring:b&&!a});if(n.error)throw q("VALID"),n.error;return n.data&&(t=n.data.item.id,f(n.data.item),ae({policy_id:t})),t}),[E,ae,b,_]),se=Object(n.useCallback)((async()=>{var e;if("VALID"===H&&ee)return void q("INVALID");if(0!==T&&"CONFIRM"!==H)return void q("CONFIRM");let t;if(P===Tt.b.NEW)try{t=await ie()}catch(e){return void s.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"})})}q("LOADING");const{error:a,data:n}=await le({..._,policy_id:null!==(e=t)&&void 0!==e?e:_.policy_id});if(a)s.toasts.addError(a,{title:"Error"}),q("VALID");else{O(n.item);const e=T&&p;if(!e)return void q("SUBMITTED_NO_AGENTS");B(n.item),s.toasts.addSuccess({title:d.i18n.translate("xpack.fleet.createPackagePolicy.addedNotificationTitle",{defaultMessage:"'{packagePolicyName}' integration added.",values:{packagePolicyName:_.name}}),text:e?d.i18n.translate("xpack.fleet.createPackagePolicy.addedNotificationMessage",{defaultMessage:"Fleet will deploy updates to all agents that use the '{agentPolicyName}' policy.",values:{agentPolicyName:p.name}}):void 0,"data-test-subj":"packagePolicyCreateSuccessToast"})}}),[H,ee,T,le,B,p,s.toasts,_,P,ie]),re=Object(n.useMemo)((()=>{var e;return m.integration?null==Y||null===(e=Y.policy_templates)||void 0===e?void 0:e.find((e=>e.name===m.integration)):void 0}),[null==Y?void 0:Y.policy_templates,m]),oe=Object(n.useMemo)((()=>({from:e,cancelUrl:w,onCancel:j,agentPolicy:p,packageInfo:Y,integrationInfo:re})),[p,j,w,e,re,Y]),ce=Object(n.useMemo)((()=>l.a.createElement(Tt.e,{agentPolicy:p,updateAgentPolicy:Q,newAgentPolicy:E,updateNewAgentPolicy:X,withSysMonitoring:b,updateSysMonitoring:e=>k(e),validation:v,packageInfo:Y,setHasAgentPolicyError:U,updateSelectedTab:J,selectedAgentPolicyId:t})),[Y,p,Q,E,X,v,b,J,t]),ue=Object(o.wb)(null!==(a=null===(i=_.package)||void 0===i?void 0:i.name)&&void 0!==a?a:"","package-policy-create"),de=Object(n.useMemo)((()=>{var e;return K?l.a.createElement(y.n,null):Y?l.a.createElement(l.a.Fragment,null,l.a.createElement(Tt.d,{agentPolicy:p,packageInfo:Y,packagePolicy:_,updatePackagePolicy:ae,validationResults:z,submitAttempted:"INVALID"===H,integrationToEnable:null==re?void 0:re.name}),!ue&&l.a.createElement(Tt.c,{packageInfo:Y,showOnlyIntegration:null==re?void 0:re.name,packagePolicy:_,updatePackagePolicy:ae,validationResults:z,submitAttempted:"INVALID"===H}),ue&&(null===(e=_.package)||void 0===e?void 0:e.name)&&l.a.createElement(y.i,null,l.a.createElement(ue.Component,{newPolicy:_,onChange:ne}))):l.a.createElement("div",null)}),[K,p,Y,_,ae,z,H,null==re?void 0:re.name,ue,ne]),ge=[{title:d.i18n.translate("xpack.fleet.createPackagePolicy.stepConfigurePackagePolicyTitle",{defaultMessage:"Configure integration"}),"data-test-subj":"dataCollectionSetupStep",children:de},{title:d.i18n.translate("xpack.fleet.createPackagePolicy.stepSelectAgentPolicyTitle",{defaultMessage:"Where to add this integration?"}),children:ce}];return V?l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:V}):l.a.createElement(Pt.a,F()({},oe,{"data-test-subj":"createPackagePolicy"}),l.a.createElement(c.EuiErrorBoundary,null,"CONFIRM"===H&&p&&l.a.createElement(x.e,{agentCount:T,agentPolicy:p,onConfirm:se,onCancel:()=>q("VALID")}),"SUBMITTED_NO_AGENTS"===H&&p&&Y&&l.a.createElement(Pt.b,{packageInfo:Y,agentPolicy:p,onConfirm:()=>B(M,["openEnrollmentFlyout"]),onCancel:()=>B(M,["showAddAgentHelp"])}),Y&&l.a.createElement(Tt.a,{pkgTitle:(null==re?void 0:re.title)||Y.title,pkgkey:Object(C.n)(Y),integration:null==re?void 0:re.name}),l.a.createElement(At,{steps:ge}),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(_t,{"data-test-subj":"integrationsBottomBar"},l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},Y&&("INVALID"===H||R)?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorOnSaveText",defaultMessage:"Your integration policy has errors. Please fix them before saving."}):null),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",href:w,onClick:j,"data-test-subj":"createPackagePolicyCancelButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.cancelButton",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{onClick:se,isLoading:"LOADING"===H,disabled:"VALID"!==H||R||!z,iconType:"save",color:"primary",fill:!0,"data-test-subj":"createPackagePolicySaveButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.saveButton",defaultMessage:"Save and continue"})))))))))};var Bt=a(10);const zt="fleet-first-agent-policy",Nt=Object.freeze({id:zt,name:d.i18n.translate("xpack.fleet.createPackagePolicy.firstAgentPolicyNameText",{defaultMessage:"My first agent policy"}),namespace:"default",monitoring_enabled:["logs","metrics"]}),Rt=Bt.k.bind(null,Nt);const Ut=e=>{const{discover:t}=Object(Bt.Qb)(),[a,l]=Object(n.useState)(null);return Object(n.useEffect)((()=>{(async()=>{if(t&&t.locator){const a=await t.locator.getUrl({indexPatternId:"logs-*",timeRange:{from:"now-1h",to:"now",mode:"relative"},filters:[{meta:{alias:"Recently enrolled agents",index:"logs-*"},query:{terms:{"agent.id":e}}}]});l(a)}})()}),[t,e]),a};var Ht=a(296),qt=a.n(Ht);const Gt=m()("h1").withConfig({displayName:"CentralTitle",componentId:"sc-n46lf8-0"})(["text-align:center;"]),Wt=({children:e})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiTitle,{size:"l"},l.a.createElement(Gt,null,e)),l.a.createElement(c.EuiSpacer,{size:"xl"})),$t=m()(c.EuiText).withConfig({displayName:"SubtitleText",componentId:"sc-n46lf8-1"})(["max-width:250px;margin:0 auto;text-align:center;"]),Vt=m()(c.EuiStepNumber).withConfig({displayName:"CenteredEuiStepNumber",componentId:"sc-n46lf8-2"})(["margin:0 auto;"]),Kt=e=>l.a.createElement("div",{style:{margin:"0 auto"}},l.a.createElement(c.EuiImage,e)),Yt=({children:e})=>{const{width:t}=qt()(),a=Object(c.isWithinMaxBreakpoint)(t,"s");return l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:a?"xs":"l",alignItems:"center",justifyContent:"center",wrap:!0},e)},Qt=()=>{const{http:e}=Object(o.ub)(),t=e.basePath.prepend("/plugins/fleet/assets/");return l.a.createElement(c.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceEvenly",gutterSize:"none"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(Yt,null,l.a.createElement(c.EuiFlexItem,null,l.a.createElement(Vt,{status:"incomplete",number:1})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement("div",{style:{margin:"0 auto"}},l.a.createElement(Kt,{alt:"Illustration of installing the Elastic Agent",src:t+"1_install_agent.svg"}))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{textAlign:"center"},l.a.createElement("h4",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.installAgentStepTitle",defaultMessage:"Install Elastic Agent"}))),l.a.createElement($t,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.installAgentStep",defaultMessage:"Install agents on the hosts that you want to connect to Elastic."}))))),l.a.createElement(c.EuiShowFor,{sizes:["s","xs"]},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiSpacer,{size:"xl"}))),l.a.createElement(c.EuiHideFor,{sizes:["s","xs"]},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(Kt,{alt:"Illustration of an arrow pointing from left to right",src:t+"arrow_right_curve_over.svg"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(Yt,null,l.a.createElement(c.EuiFlexItem,null,l.a.createElement(Vt,{status:"incomplete",number:2})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(Kt,{alt:"Illustration of adding an integration",src:t+"2_add_integration.svg"})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{textAlign:"center"},l.a.createElement("h4",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.addIntegrationStepTitle",defaultMessage:"Add the integration"}))),l.a.createElement($t,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.addIntegrationStep",defaultMessage:"Make a few selections to finalize how Elastic receives your data."}))))),l.a.createElement(c.EuiShowFor,{sizes:["s","xs"]},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiSpacer,{size:"xl"}))),l.a.createElement(c.EuiHideFor,{sizes:["s","xs"]},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(Kt,{alt:"Illustration of an arrow pointing from left to right",src:t+"arrow_right_curve_under.svg"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(Yt,null,l.a.createElement(c.EuiFlexItem,null,l.a.createElement(Vt,{status:"incomplete",number:3})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(Kt,{alt:"Illustration of a dashboard with data",src:t+"3_confirm_data.svg"})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{textAlign:"center"},l.a.createElement("h4",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.confirmDataStepTitle",defaultMessage:"Confirm incoming data"}))),l.a.createElement($t,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.confirmDataStep",defaultMessage:"Explore and analyze the incoming data."}))))))},Zt=m()("div").withConfig({displayName:"NotObscuredByBottomBar",componentId:"sc-n46lf8-3"})(["padding-bottom:100px;"]),Xt=()=>{const{docLinks:e}=Object(o.ub)();return l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceAround"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiLink,{href:e.links.fleet.elasticAgent,target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.learnMoreLink",defaultMessage:"Learn more about installing Elastic Agent"}))))},Jt=({integrationInfo:e,packageInfo:t,isLoading:a,error:n,cancelUrl:i,cancelClickHandler:s,onNext:r})=>{if(n)return l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:n});const o=l.a.createElement(Wt,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.pageTitle",defaultMessage:"Ready to add your first integration?"}));return l.a.createElement(v.c,{topContent:o},l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"xxl"}),l.a.createElement(c.EuiSpacer,{size:"xxl"}),l.a.createElement(Qt,null),l.a.createElement(c.EuiSpacer,{size:"xxl"}),l.a.createElement(c.EuiSpacer,{size:"xxl"}),l.a.createElement(Zt,null,l.a.createElement(Xt,null)),l.a.createElement(na,{cancelUrl:i,cancelClickHandler:s,isLoading:a,onNext:r,noAnimation:!0,actionMessage:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.installAgentButton",defaultMessage:"Install Elastic Agent"})}),t&&l.a.createElement(Tt.a,{pkgTitle:(null==e?void 0:e.title)||t.title,pkgkey:Object(C.n)(t),integration:null==e?void 0:e.name})))},ea=m()(c.EuiBottomBar).withConfig({displayName:"CenteredRoundedBottomBar",componentId:"sc-1tr5jdr-0"})(["max-width:820px;margin:0 auto;border-radius:8px 8px 0px 0px;"]),ta=m()(ea).withConfig({displayName:"NoAnimationCenteredRoundedBottomBar",componentId:"sc-1tr5jdr-1"})(["animation-delay:-99s;#stop bottom bar flying in on step change"]),aa=m()("div").withConfig({displayName:"NotObscuredByBottomBar",componentId:"sc-1tr5jdr-2"})(["padding-bottom:100px;"]),na=({isLoading:e,loadingMessage:t,onNext:a,cancelClickHandler:n,cancelUrl:i,actionMessage:s,isDisabled:r=!1,noAnimation:o=!1})=>{const d=o?ta:ea;return l.a.createElement(d,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",size:"s",href:i,onClick:n},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.backButton",defaultMessage:"Go back"})))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"primary",fill:!0,size:"m",isDisabled:r,isLoading:!r&&e,onClick:a},e?t||l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.loading",defaultMessage:"Loading..."}):s))))},la=({onNext:e,cancelClickHandler:t,cancelUrl:a,noAnimation:n=!1})=>{const i=n?ta:ea;return l.a.createElement(i,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",size:"s",href:a,onClick:t},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentStandaloneBottomBar.backButton",defaultMessage:"Go back"})))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"primary",fill:!0,size:"m",onClick:e},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentStandaloneBottomBar.viewIncomingDataBtn",defaultMessage:"View incoming data"})))))},ia=({pkgkey:e})=>{const{getHref:t}=Object(Bt.Ib)();return l.a.createElement(ea,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",size:"s",href:t("integrations_all")},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.addAnotherIntegration",defaultMessage:"Add another integration"})))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"success",fill:!0,size:"m",href:t("integration_details_assets",{pkgkey:e})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.viewDataAssetsButtonText'",defaultMessage:"View assets"})))))},sa=({troubleshootLink:e,agentIds:t,integration:a})=>{const n=Ut(t);return l.a.createElement(ea,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",size:"s",href:e,iconType:"popout",target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.troubleshootLinkBottomBar",defaultMessage:"Troubleshooting guide"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"success",fill:!0,href:null!=n?n:""},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.discoverLogsLink",defaultMessage:"View incoming {integration} logs",values:{integration:null!=a?a:""}})))))},ra=e=>{const{packageInfo:t,integrationInfo:a,steps:n,currentStep:i,error:s}=e;if(s)return l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:s});const r=n[i].component,o=l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiTitle,{size:"l",className:"eui-textCenter"},l.a.createElement("h1",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.multiPageTitle",defaultMessage:"Set up {title} integration",values:{title:t.title}}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(ua,{currentStep:i,steps:n.map((e=>e.title))}),l.a.createElement(c.EuiSpacer,{size:"xl"}));return l.a.createElement(v.c,{topContent:o,restrictHeaderWidth:866,restrictWidth:866},l.a.createElement(r,e),t&&l.a.createElement(Tt.a,{pkgTitle:(null==a?void 0:a.title)||t.title,pkgkey:Object(C.n)(t),integration:null==a?void 0:a.name}))},oa=m()(c.EuiStepsHorizontal).withConfig({displayName:"NumberlessHorizontalSteps",componentId:"sc-13a0okp-0"})([".euiStepNumber{color:transparent;width:16px;height:16px;outline-color:#07c;}.euiStepHorizontal::before{width:calc(50% - 8px);top:32px;}.euiStepHorizontal::after{width:calc(50% - 8px);top:32px;}.euiStepHorizontal{padding:25px 16px 16px;}.euiStepHorizontal-isIncomplete .euiStepHorizontal__title{color:#69707d;}"]),ca=(e,t,a)=>e===t?a?"complete":"current":e>t?"complete":"incomplete",ua=({steps:e,currentStep:t=0,currentStepComplete:a=!1})=>{const n=e.map(((e,n)=>({title:e,status:ca(t,n,a),onClick:()=>{}})));return l.a.createElement(oa,{steps:n})};var da=a(110),ga=a(101),ma=a(128);const pa=e=>{const{cancelUrl:t,onNext:a,cancelClickHandler:i,setIsManaged:s,agentPolicy:r,enrollmentAPIKey:o,settings:d,enrolledAgentIds:g}=e,m=Object(Bt.Qb)(),{docLinks:p}=m,f=p.links.fleet.troubleshooting,E=Object(Bt.Gb)(),[h,b]=Object(n.useState)(!1),k=Object(n.useMemo)((()=>(null==d?void 0:d.fleet_server_hosts)||[]),[d]);if(!o)return l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:"Enrollment API key not found"});const v=Object(ma.a)(o.api_key,k,E),x=[Object(ga.g)({installCommand:v,apiKeyData:{item:o},selectedApiKeyId:o.id,isComplete:h||!!g.length,fullCopyButton:!0,onCopy:()=>b(!0)}),Object(ga.a)({selectedPolicyId:null==r?void 0:r.id,troubleshootLink:f,agentCount:g.length,showLoading:!0,poll:h})];return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiText,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addIntegration.installAgentStepTitle",defaultMessage:"These steps configure and enroll the Elastic Agent in Fleet to automatically deploy updates and centrally manage the agent. As an alternative to Fleet, advanced users can run agents in {standaloneLink}.",values:{standaloneLink:l.a.createElement(c.EuiLink,{onClick:()=>s(!1)},"standalone mode")}})),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiSteps,{steps:x}),!!g.length&&l.a.createElement(l.a.Fragment,null,l.a.createElement(aa,null),l.a.createElement(na,{cancelUrl:t,cancelClickHandler:i,onNext:a,actionMessage:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.addIntegrationButton",defaultMessage:"Add the integration"})})))};var fa=a(2);const Ea=e=>{const{setIsManaged:t,agentPolicy:a,cancelUrl:i,onNext:s,cancelClickHandler:r}=e,o=Object(Bt.Qb)(),d=Object(Bt.Gb)(),[g,m]=Object(n.useState)(""),[p,f]=Object(n.useState)(!1),[E,h]=Object(n.useState)(!1),[b,k]=Object(n.useState)();if(Object(n.useEffect)((()=>{!async function(){try{if(null==a||!a.id)return;const e={standalone:!0,kubernetes:!1},t=await Object(Bt.A)(null==a?void 0:a.id,e);if(t.error)throw t.error;if(!t.data)throw new Error("No data while fetching full agent policy");k(t.data.item)}catch(e){o.notifications.toasts.addError(e,{title:"Error"})}}()}),[o.http.basePath,null==a?void 0:a.id,o.notifications.toasts]),Object(n.useEffect)((()=>{b&&m(Object(fa.m)(b,jt.safeDump))}),[b]),!a)return l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:"Agent policy not provided"});const v=Object(ma.b)(d),x=o.http.basePath.prepend(`${fa.c.getInfoFullDownloadPath(null==a?void 0:a.id)}?standalone=true`),M=[Object(ga.d)({selectedPolicyId:null==a?void 0:a.id,yaml:g,downloadLink:x,isComplete:E,onCopy:()=>h(!0)}),Object(ga.h)({installCommand:v,isComplete:g&&p,fullCopyButton:!0,onCopy:()=>f(!0)})];return l.a.createElement(l.a.Fragment,null,l.a.createElement(ya,{setIsManaged:t}),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiSteps,{steps:M}),p&&l.a.createElement(l.a.Fragment,null,l.a.createElement(aa,null),l.a.createElement(la,{cancelUrl:i,onNext:s,cancelClickHandler:r})))},ha=({children:e})=>{const[t,a]=Object(n.useState)(!1);return l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",direction:"column"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",direction:"row"},l.a.createElement(c.EuiFlexItem,null),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{size:"s",iconType:t?"arrowUp":"arrowDown",iconSide:"right",onClick:()=>a(!t),flush:"left"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.stepConfigure.advancedOptionsToggleLinkText",defaultMessage:"Advanced options"}))))),t&&l.a.createElement(c.EuiFlexItem,null,e)))},ba=({error:e,title:t})=>l.a.createElement(y.g,{title:t||l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addIntegration.errorTitle",defaultMessage:"Error adding integration"}),error:e}),ya=({setIsManaged:e})=>l.a.createElement(c.EuiCallOut,{title:"Setting up to run Elastic Agent in standalone mode",color:"primary",iconType:"iInCircle"},l.a.createElement(c.EuiText,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addIntegration.standaloneWarning",defaultMessage:"Setting up integrations by running Elastic Agent in standalone mode is advanced. When possible, we recommend using {link} instead. ",values:{link:l.a.createElement(c.EuiLink,{href:"#"},"Fleet-managed agents")}})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiButton,{onClick:()=>e(!0),color:"primary"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addIntegration.switchToManagedButton",defaultMessage:"Enroll in Fleet instead (recommended)"})));var ka=a(24),va=a(300),xa=a.n(va),Ma=a(138);const Fa=({agentIds:e,troubleshootLink:t,packageInfo:a})=>{var n;const i=Ut(e);return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiTitle,null,l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.title",defaultMessage:"Confirming data is taking longer than expected"}))),l.a.createElement(c.EuiText,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.body",defaultMessage:"If the system is not generating data, it may help to generate some to ensure data is being collected correctly. If you're having trouble, see our {troubleshootLink}, or you may check later by viewing {discoverLink}.",values:{troubleshootLink:l.a.createElement(c.EuiLink,{external:!0,href:t,target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.troubleshootLink",defaultMessage:"troubleshooting guide"})),discoverLink:l.a.createElement(c.EuiLink,{external:!0,href:null!=i?i:"",target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.discoverLink",defaultMessage:"{integration} logs in Discover",values:{integration:null!==(n=null==a?void 0:a.title)&&void 0!==n?n:""}}))}})),l.a.createElement(aa,null),l.a.createElement(sa,{agentIds:e,troubleshootLink:t,integration:null==a?void 0:a.title}))},Ia=["agent.ephemeral_id","agent.id","elastic_agent.id","data_stream.namespace","@timestamp"],Oa=m()(c.EuiDescriptionList).withConfig({displayName:"CleanOverflowDescriptionList",componentId:"sc-1qg5bo1-0"})(["overflow:hidden;max-height:125px;word-break:break-all;white-space:pre-wrap;"]),Sa=m()("pre").withConfig({displayName:"CompressedPre",componentId:"sc-1qg5bo1-1"})(["&&&{background:none;padding:0 0;}"]),ja=({hit:e})=>{const t=xa()(Object(ka.getFlattenedObject)(e._source),Ia),a=Object.entries(t).map((([e,t])=>({title:`${e}:`,description:t})));return l.a.createElement("pre",null,l.a.createElement("code",null,l.a.createElement(Oa,{listItems:a,type:"inline",align:"left",compressed:!0})))},Ca=({hit:e})=>{const t=(null==e?void 0:e._source)||{},a=(null==t?void 0:t["@timestamp"])||"-";return l.a.createElement(c.EuiText,{size:"xs"},l.a.createElement(Sa,null,a?Object(c.formatDate)(a,"MMM D, YYYY @ HH:mm:ss.SSS"):"-"))},wa=({dataPreview:e})=>{const t=e.slice(0,5);return l.a.createElement(l.a.Fragment,null,t.map((e=>l.a.createElement("div",{id:e._id},l.a.createElement(c.EuiFlexGroup,{gutterSize:"xs"},l.a.createElement(c.EuiFlexItem,{style:{minWidth:"220px"}},l.a.createElement(Ca,{hit:e})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(ja,{hit:e}))),l.a.createElement(c.EuiHorizontalRule,{margin:"s"})))))},Ta=({agentIds:e,packageInfo:t,agentDataConfirmed:a,setAgentDataConfirmed:n,troubleshootLink:i})=>{const{incomingData:s,dataPreview:r,isLoading:o,hasReachedTimeout:g}=Object(Ma.b)(e,!0,5),{enrolledAgents:m,numAgentsWithData:p}=Object(Ma.a)(s,t);return!o&&m>0&&p>0&&n(!0),a?l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiCallOut,{"data-test-subj":"IncomingDataConfirmedCallOut",title:d.i18n.translate("xpack.fleet.confirmIncomingDataWithPreview.title",{defaultMessage:"Incoming data received from {numAgentsWithData} enrolled { numAgentsWithData, plural, one {agent} other {agents}}.",values:{numAgentsWithData:p}}),color:"success",iconType:"check"}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiText,null,l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataWithPreview.previewTitle",defaultMessage:"Preview of incoming data:"}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(wa,{dataPreview:r})):l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiText,null,l.a.createElement(c.EuiCallOut,{size:"m",color:"primary",iconType:c.EuiLoadingSpinner,title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataWithPreview.listening",defaultMessage:"Listening for incoming data from enrolled agents..."})}),l.a.createElement(c.EuiSpacer,{size:"m"}),g?l.a.createElement(Fa,{agentIds:e,troubleshootLink:i,packageInfo:t}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataWithPreview.loading",defaultMessage:"It might take a few minutes for the data to get to Elasticsearch. If you're not seeing any, try generating some to verify. If you're having trouble connecting, check out the {link}.",values:{link:l.a.createElement(c.EuiLink,{target:"_blank",external:!0,href:i},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollmentInstructions.troubleshootingLink",defaultMessage:"troubleshooting guide"}))}})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiLoadingContent,{lines:10}))},La=({troubleshootLink:e})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiText,null,l.a.createElement(c.EuiCallOut,{size:"m",color:"primary",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataStandalone.title",defaultMessage:"Data preview is not available for standalone agents. "})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataStandalone.description",defaultMessage:"You can check for agent data in the integration asset tab. If you're having trouble seeing data, check out the {link}.",values:{link:l.a.createElement(c.EuiLink,{target:"_blank",external:!0,href:e},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataStandalone.troubleshootingLink",defaultMessage:"troubleshooting guide"}))}})))),Pa={title:d.i18n.translate("xpack.fleet.createFirstPackagePolicy.installAgentStepTitle",{defaultMessage:"Install Elastic Agent"}),component:e=>{var t;const[a,i]=Object(n.useState)(e.isManaged),[s,r]=Object(n.useState)(!1),o=Object(da.b)((null===(t=e.agentPolicy)||void 0===t?void 0:t.id)||"",{noLowerTimeLimit:!0,pollImmediately:!0}),c=()=>{e.setEnrolledAgentIds(o),e.onNext()},u={...e,onNext:c,enrolledAgentIds:o,setIsManaged:s?i:e.setIsManaged};if(a)return l.a.createElement(pa,u);const d={...e,onNext:c,enrolledAgentIds:o,setIsManaged:e=>{e&&r(!0),i(e)}};return l.a.createElement(Ea,d)}},Aa={title:d.i18n.translate("xpack.fleet.createFirstPackagePolicy.addIntegrationStepTitle",{defaultMessage:"Add the integration"}),component:e=>{const{onNext:t,onBack:a,isManaged:i,setIsManaged:s,packageInfo:r,integrationInfo:g,agentPolicy:m}=e,[p,f]=Object(n.useState)(),{notifications:E}=Object(o.ub)(),[h,b]=Object(n.useState)("VALID"),[y,k]=Object(n.useState)(),[v,x]=Object(n.useState)({name:"",description:"",namespace:"default",policy_id:"",enabled:!0,output_id:"",inputs:[]}),M=Object(n.useCallback)((e=>{const t=Object(Lt.d)({...v,...e},r,jt.safeLoad);return k(t),console.debug("Package policy validation results",t),t}),[r,v]),F=Object(n.useCallback)((e=>{const t={...v,...e};x(t),console.debug("Package policy updated",t);const a=M(t),n=t.package,l=!!a&&Object(Lt.f)(a);b(n&&!l?"VALID":"INVALID")}),[v,M]),O=Object(n.useCallback)((async()=>{const e=!!y&&Object(Lt.f)(y);if("VALID"===h&&e)return void b("INVALID");b("LOADING");const{error:a}=await(async e=>{b("LOADING");const t=await Object(o.k)(e);return b("SUBMITTED"),t})(v);a?(E.toasts.addError(a,{title:"Error"}),b("VALID")):t()}),[y,h,v,E.toasts,t]);return Object(n.useEffect)((()=>{(async()=>{if(!m)return;const{packagePolicy:e,error:t}=await(async(e,t,a)=>{const{data:n,error:l}=await Object(o.y)({perPage:I.SO_SEARCH_LIMIT,page:1,kuery:`${T.r}.package.name:${t.name}`}),i={name:Object(I.getMaxPackageName)(t.name,null==n?void 0:n.items),description:"",namespace:"default",policy_id:e,enabled:!0,output_id:"",inputs:[]};return{packagePolicy:Object(C.m)(t,e,i.output_id,i.namespace,i.name,i.description,a),error:l}})(m.id,r,null==g?void 0:g.name);t&&f(t),F(e)})()}),[]),m?p?l.a.createElement(ba,{error:p}):l.a.createElement(l.a.Fragment,null,i?null:l.a.createElement(ya,{setIsManaged:s}),l.a.createElement(c.EuiSpacer,{size:"l"}),l.a.createElement(Tt.c,{packageInfo:r,showOnlyIntegration:null==g?void 0:g.name,packagePolicy:v,updatePackagePolicy:F,validationResults:y,submitAttempted:"INVALID"===h,noTopRule:!0}),y&&l.a.createElement(ha,null,l.a.createElement(Tt.d,{packageInfo:r,packagePolicy:v,updatePackagePolicy:F,validationResults:y,submitAttempted:"INVALID"===h,noAdvancedToggle:!0})),l.a.createElement(aa,null),l.a.createElement(na,{cancelClickHandler:i?a:()=>s(!0),onNext:O,isLoading:"LOADING"===h,isDisabled:"INVALID"===h,loadingMessage:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createFirstPackagePolicy.savingPackagePolicy",defaultMessage:"Saving policy..."}),actionMessage:i?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createFirstPackagePolicy.confirmIncomingDataButton",defaultMessage:"Confirm incoming data"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createFirstPackagePolicy.installAgentButton",defaultMessage:"Save and continue"})})):l.a.createElement(ba,{error:d.i18n.translate("xpack.fleet.addIntegration.noAgentPolicy",{defaultMessage:"Error creating agent policy."})})}},_a={title:d.i18n.translate("xpack.fleet.createFirstPackagePolicy.confirmDataStepTitle",{defaultMessage:"Confirm incoming data"}),component:e=>{const{enrolledAgentIds:t,packageInfo:a,isManaged:i}=e,s=Object(o.ub)(),[r,c]=Object(n.useState)(!1),{docLinks:u}=s,d=u.links.fleet.troubleshooting,g=l.a.createElement(l.a.Fragment,null,l.a.createElement(aa,null),l.a.createElement(ia,{pkgkey:`${a.name}-${a.version}`}));return i?l.a.createElement(l.a.Fragment,null,l.a.createElement(Ta,{agentIds:t,packageInfo:a,agentDataConfirmed:r,setAgentDataConfirmed:c,troubleshootLink:d}),!!r&&g):l.a.createElement(l.a.Fragment,null,l.a.createElement(La,{troubleshootLink:d}),g)}},Da=[Pa,Aa,_a],Ba=[Aa,Pa,_a],za=({from:e,queryParamsPolicyId:t})=>{const{params:a}=Object(r.useRouteMatch)(),{pkgName:i,pkgVersion:s}=Object(I.splitPkgKey)(a.pkgkey),[c,u]=Object(n.useState)(!0),[d,g]=Object(n.useState)(0),[m,p]=Object(n.useState)(!0),[f,E]=Object(n.useState)([]),{isLoading:h,data:b}=Object(o.ib)(),{data:y,error:k,isLoading:v}=Object(o.gb)(i,s),{agentPolicy:x,enrollmentAPIKey:M,error:F,isLoading:O}=function(e){const[t,a]=Object(n.useState)({isLoading:!0});return Object(n.useEffect)((()=>{(async()=>{var t;const n=e||zt,{data:l,error:i}=await(async e=>{var t;let a,n;try{a=await Object(Bt.z)(e),a.error&&(n=a.error)}catch(e){n=e}return n&&404!==n.statusCode?{error:n}:{data:null===(t=a)||void 0===t?void 0:t.data}})(n),s=null==l?void 0:l.item;if(e&&!s)return void a({isLoading:!1,error:new Error(`Agent policy ${n} not found`)});let r;if(i)return void a({isLoading:!1,error:i});if(!s){const{data:e,error:t}=await Rt();if(t)return void a({isLoading:!1,error:t});r=e.item}const o=s||r,{data:c,error:u}=await Object(Bt.x)({page:1,perPage:1,kuery:`policy_id:${n}`});if(u)return void a({isLoading:!1,error:u});if(!c||null===(t=c.items)||void 0===t||!t.length)return void a({isLoading:!1,error:new Error(`No enrollment API key found for policy ${n}`)});const d=c.items[0];a({isLoading:!1,created:!!r,agentPolicy:o,enrollmentAPIKey:d})})()}),[e]),t}(t),S=Object(n.useMemo)((()=>null==y?void 0:y.item),[y]),j=Object(n.useMemo)((()=>null==b?void 0:b.item),[b]),C=Object(n.useMemo)((()=>{var e;if(a.integration)return null==S||null===(e=S.policy_templates)||void 0===e?void 0:e.find((e=>e.name===a.integration))}),[null==S?void 0:S.policy_templates,a]),{cancelClickHandler:w,cancelUrl:T}=wt({from:e,pkgkey:a.pkgkey});if(c||!S)return l.a.createElement(Jt,{isLoading:v||h||O,error:k||F,integrationInfo:C,packageInfo:S,cancelUrl:T,cancelClickHandler:w,onNext:()=>{u(!1)}});const L=m?Da:Ba;return l.a.createElement(ra,{settings:j,agentPolicy:x,enrollmentAPIKey:M,currentStep:d,steps:L,packageInfo:S,integrationInfo:C,cancelUrl:T,cancelClickHandler:w,onNext:()=>{d!==L.length-1&&g(d+1)},onBack:()=>{0!==d?g(d-1):w(null)},isManaged:m,setIsManaged:e=>{p(e),g(0)},setEnrolledAgentIds:E,enrolledAgentIds:f})},Na=()=>{const{search:e}=Object(r.useLocation)(),{params:t}=Object(r.useRouteMatch)(),a=Object(n.useMemo)((()=>new URLSearchParams(e)),[e]),i=Object(n.useMemo)((()=>a.has("useMultiPageLayout")),[a]),s=Object(n.useMemo)((()=>{var e;return null!==(e=a.get("policyId"))&&void 0!==e?e:void 0}),[a]),o={from:"policyId"in t||s?"policy":"package",queryParamsPolicyId:s};return i?l.a.createElement(za,o):l.a.createElement(Dt,o)};var Ra=a(114);const Ua=e=>{const{onCancel:t,onConfirm:a,enrollmentKey:n}=e;return l.a.createElement(c.EuiConfirmModal,{title:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.title",{defaultMessage:"Revoke enrollment token"}),onCancel:t,onConfirm:a,cancelButtonText:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.deleteButton",{defaultMessage:"Revoke enrollment token"}),defaultFocusedButton:"confirm",buttonColor:"danger"},l.a.createElement(c.EuiCallOut,{title:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.description",{defaultMessage:"Are your sure you want to revoke {keyName}? New agents will no longer be able to be enrolled using this token.",values:{keyName:n.name}}),color:"danger"}))},Ha=({apiKeyId:e})=>{const{notifications:t}=Object(o.ub)(),[a,i]=Object(n.useState)("HIDDEN"),[s,r]=Object(n.useState)();return l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{color:"subdued",size:"xs"},"VISIBLE"===a?s:"•••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••")),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiToolTip,{content:"VISIBLE"===a?d.i18n.translate("xpack.fleet.enrollmentTokensList.hideTokenButtonLabel",{defaultMessage:"Hide token"}):d.i18n.translate("xpack.fleet.enrollmentTokensList.showTokenButtonLabel",{defaultMessage:"Show token"})},l.a.createElement(c.EuiButtonIcon,{"aria-label":"VISIBLE"===a?d.i18n.translate("xpack.fleet.enrollmentTokensList.hideTokenButtonLabel",{defaultMessage:"Hide token"}):d.i18n.translate("xpack.fleet.enrollmentTokensList.showTokenButtonLabel",{defaultMessage:"Show token"}),color:"text",onClick:async()=>{if("VISIBLE"===a)i("HIDDEN");else if("HIDDEN"===a)try{var n;i("LOADING");const t=await Object(o.v)(e);if(t.error)throw t.error;r(null===(n=t.data)||void 0===n?void 0:n.item.api_key),i("VISIBLE")}catch(e){t.toasts.addError(e,{title:"Error"}),i("HIDDEN")}},iconType:"VISIBLE"===a?"eyeClosed":"eye"}))))},qa=({apiKey:e,refresh:t})=>{const{notifications:a}=Object(o.ub)(),[i,s]=Object(n.useState)("CONFIRM_HIDDEN");return l.a.createElement(l.a.Fragment,null,"CONFIRM_VISIBLE"===i&&l.a.createElement(Ua,{enrollmentKey:e,onCancel:()=>s("CONFIRM_HIDDEN"),onConfirm:async()=>{try{const t=await Object(o.m)(e.id);if(t.error)throw t.error}catch(e){a.toasts.addError(e,{title:"Error"})}s("CONFIRM_HIDDEN"),t()}}),l.a.createElement(c.EuiToolTip,{content:d.i18n.translate("xpack.fleet.enrollmentTokensList.revokeTokenButtonLabel",{defaultMessage:"Revoke token"})},l.a.createElement(c.EuiButtonIcon,{"aria-label":d.i18n.translate("xpack.fleet.enrollmentTokensList.revokeTokenButtonLabel",{defaultMessage:"Revoke token"}),onClick:()=>s("CONFIRM_VISIBLE"),iconType:"trash",color:"danger"})))},Ga=()=>{var e,t,a;Object(o.T)("enrollment_tokens");const[i,s]=Object(n.useState)(!1),[r,g]=Object(n.useState)(""),{pagination:m,setPagination:p,pageSizeOptions:f}=Object(o.qb)(),E=Object(o.bb)({page:m.currentPage,perPage:m.pageSize,kuery:""!==r.trim()?r:void 0}),h=Object(o.Z)({page:1,perPage:k.n}),b=h.data?h.data.items:[],x=b.reduce(((e,t)=>(e[t.id]=t,e)),{}),M=null!==(e=null==E||null===(t=E.data)||void 0===t?void 0:t.total)&&void 0!==e?e:0,F=(null==E||null===(a=E.data)||void 0===a?void 0:a.items.filter((e=>{if(!b.length||!e.policy_id)return!1;const t=x[e.policy_id];return!(null!=t&&t.is_managed)})))||[],I=[{field:"name",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.nameTitle",{defaultMessage:"Name"}),render:e=>l.a.createElement("span",{className:"eui-textTruncate",title:e},e)},{field:"id",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.secretTitle",{defaultMessage:"Secret"}),width:"215px",render:e=>l.a.createElement(Ha,{apiKeyId:e})},{field:"policy_id",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.policyTitle",{defaultMessage:"Agent policy"}),render:e=>{const t=x[e],a=t?t.name:e;return l.a.createElement("span",{className:"eui-textTruncate",title:a},a)}},{field:"created_at",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.createdAtTitle",{defaultMessage:"Created on"}),width:"150px",render:e=>e?l.a.createElement(u.FormattedDate,{year:"numeric",month:"short",day:"2-digit",value:e}):null},{field:"active",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.activeTitle",{defaultMessage:"Active"}),width:"70px",align:"center",render:e=>l.a.createElement(c.EuiIcon,{size:"m",color:e?"success":"danger",type:"dot"})},{field:"actions",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.actionsTitle",{defaultMessage:"Actions"}),width:"70px",render:(e,t)=>{const a=b.find((e=>e.id===t.policy_id));return t.active&&!(null!=a&&a.is_managed)&&l.a.createElement(qa,{apiKey:t,refresh:()=>E.resendRequest()})}}],O=E.isLoading&&E.isInitialRequest||h.isLoading&&h.isInitialRequest;return l.a.createElement(v.a,{section:"enrollment_tokens"},i&&l.a.createElement(y.o,{agentPolicies:b,onClose:e=>{s(!1),E.resendRequest()}}),l.a.createElement(c.EuiText,{color:"subdued"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollmentTokensList.pageDescription",defaultMessage:"Create and revoke enrollment tokens. An enrollment token enables one or more agents to enroll in Fleet and send data."})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiFlexGroup,{alignItems:"center"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(Ra.a,{value:r,onChange:e=>{p({...m,currentPage:1}),g(e)},indexPattern:k.e})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>s(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollmentTokensList.newKeyButton",defaultMessage:"Create enrollment token"})))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiBasicTable,{loading:O,hasActions:!0,noItemsMessage:O?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollemntAPIKeyList.loadingTokensMessage",defaultMessage:"Loading enrollment tokens..."}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollemntAPIKeyList.emptyMessage",defaultMessage:"No enrollment tokens found."}),items:M?F:[],itemId:"id",columns:I,pagination:{pageIndex:m.currentPage-1,pageSize:m.pageSize,totalItemCount:M,pageSizeOptions:f},onChange:({page:e})=>{const t={...m,currentPage:e.index+1,pageSize:e.size};p(t)}}))},Wa=({fleetServerHosts:e})=>{const{docLinks:t}=Object(o.ub)(),{getHref:a}=Object(o.ob)(),i=Object(n.useMemo)((()=>[{render:e=>e,name:d.i18n.translate("xpack.fleet.settings.fleetServerHostUrlColumnTitle",{defaultMessage:"Host URL"})}]),[]);return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h4",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostSectionTitle",defaultMessage:"Fleet server hosts"}))),l.a.createElement(c.EuiSpacer,{size:"xs"}),l.a.createElement(c.EuiText,{color:"subdued",size:"m"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostSectionSubtitle",defaultMessage:"Specify the URLs that your agents will use to connect to a Fleet Server. If multiple URLs exist, Fleet will show the first provided URL for enrollment purposes. For more information, see the {guideLink} .",values:{guideLink:l.a.createElement(c.EuiLink,{href:t.links.fleet.guide,target:"_blank",external:!0},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetUserGuideLink",defaultMessage:"Fleet User Guide"}))}})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiBasicTable,{columns:i,items:e}),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiButtonEmpty,{iconType:"pencil",href:a("settings_edit_fleet_server_hosts"),"data-test-subj":"editHostsBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostEditButtonLabel",defaultMessage:"Edit hosts"})),l.a.createElement(c.EuiSpacer,{size:"m"}))},$a=l.a.memo((({output:e})=>{const t=Object(n.useMemo)((()=>{const t=[];return e.is_default&&t.push(l.a.createElement(Va,{key:"default-output"})),e.is_default_monitoring&&t.push(l.a.createElement(Ka,{key:"default-monitoring-output"})),t}),[e]);return l.a.createElement(c.EuiBadgeGroup,{gutterSize:"xs"},t.map(((e,t)=>e)))})),Va=()=>l.a.createElement(c.EuiBadge,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.outputs.defaultOutputBadgeTitle",defaultMessage:"Agent integrations"})),Ka=()=>l.a.createElement(c.EuiBadge,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.outputs.defaultMonitoringOutputBadgeTitle",defaultMessage:"Agent monitoring"})),Ya=m()(c.EuiFlexItem).withConfig({displayName:"NameFlexItemWithMaxWidth",componentId:"sc-zxtmo5-0"})(["max-width:250px;"]),Qa=m()(c.EuiFlexGroup).withConfig({displayName:"FlexGroupWithMinWidth",componentId:"sc-zxtmo5-1"})(["min-width:0px;"]),Za=({outputs:e,deleteOutput:t})=>{const{getHref:a}=Object(o.ob)(),i=Object(n.useMemo)((()=>[{render:e=>l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},l.a.createElement(Ya,{grow:!1},l.a.createElement("p",{title:e.name,className:"eui-textTruncate"},e.name)),e.is_preconfigured&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiIconTip,{content:d.i18n.translate("xpack.fleet.settings.outputsTable.managedTooltip",{defaultMessage:"This outputs is managed outside of Fleet."}),type:"lock",size:"m",color:"subdued"}))),width:"288px",name:d.i18n.translate("xpack.fleet.settings.outputsTable.nameColomnTitle",{defaultMessage:"Name"})},{width:"172px",render:e=>{return"elasticsearch"===(t=e.type)?d.i18n.translate("xpack.fleet.settings.outputsTable.elasticsearchTypeLabel",{defaultMessage:"Elasticsearch"}):t;var t},name:d.i18n.translate("xpack.fleet.settings.outputsTable.typeColomnTitle",{defaultMessage:"Type"})},{truncateText:!0,render:e=>l.a.createElement(Qa,{direction:"column",gutterSize:"xs"},(e.hosts||[]).map((e=>l.a.createElement(c.EuiFlexItem,{key:e},l.a.createElement("p",{title:e,className:"eui-textTruncate"},e))))),name:d.i18n.translate("xpack.fleet.settings.outputsTable.hostColomnTitle",{defaultMessage:"Hosts"})},{render:e=>l.a.createElement($a,{output:e}),width:"200px",name:d.i18n.translate("xpack.fleet.settings.outputSection.defaultColomnTitle",{defaultMessage:"Default"})},{width:"68px",render:e=>{const n=!e.is_default&&!e.is_default_monitoring&&!e.is_preconfigured;return l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},n&&l.a.createElement(c.EuiButtonIcon,{color:"text",iconType:"trash",onClick:()=>t(e),title:d.i18n.translate("xpack.fleet.settings.outputSection.deleteButtonTitle",{defaultMessage:"Delete"})})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonIcon,{color:"text",iconType:"pencil",href:a("settings_edit_outputs",{outputId:e.id}),title:d.i18n.translate("xpack.fleet.settings.outputSection.editButtonTitle",{defaultMessage:"Edit"}),"data-test-subj":"editOutputBtn"})))},name:d.i18n.translate("xpack.fleet.settings.outputSection.actionsColomnTitle",{defaultMessage:"Actions"})}]),[t,a]);return l.a.createElement(c.EuiBasicTable,{columns:i,items:e})},Xa=({outputs:e,deleteOutput:t})=>{const{getHref:a}=Object(o.ob)();return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h4",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.outputSectionTitle",defaultMessage:"Outputs"}))),l.a.createElement(c.EuiSpacer,{size:"xs"}),l.a.createElement(c.EuiText,{color:"subdued",size:"m"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.outputSectionSubtitle",defaultMessage:"Specify where agents will send data."})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(Za,{outputs:e,deleteOutput:t}),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiButtonEmpty,{iconType:"plusInCircle",href:a("settings_create_outputs"),"data-test-subj":"addOutputBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.outputCreateButtonLabel",defaultMessage:"Add output"})))},Ja=({settings:e,outputs:t,deleteOutput:a})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(Wa,{fleetServerHosts:e.fleet_server_hosts}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(Xa,{outputs:t,deleteOutput:a})),en=l.a.createContext(null);function tn(){const e=Object(n.useContext)(en);return{confirm:Object(n.useCallback)((async(t,a,n)=>{if(null===e)throw new Error("Context need to be provided to use useConfirmModal");return new Promise((l=>{e.showModal({title:t,description:a,onConfirm:()=>l(!0),onCancel:()=>l(!1),options:n})}))}),[e])}}const an=({children:e})=>{var t,a,i;const[s,r]=Object(n.useState)(!1),[o,u]=Object(n.useState)({onCancel:()=>{},onConfirm:()=>{}}),g=Object(n.useCallback)((({title:e,description:t,onConfirm:a,onCancel:n,options:l})=>{r(!0),u({title:e,description:t,onConfirm:()=>{r(!1),a()},onCancel:()=>{r(!1),n()},options:l})}),[]);return l.a.createElement(en.Provider,{value:{showModal:g}},s&&l.a.createElement(c.EuiPortal,null,l.a.createElement(c.EuiConfirmModal,{title:o.title,buttonColor:null===(t=o.options)||void 0===t?void 0:t.buttonColor,onCancel:o.onCancel,onConfirm:o.onConfirm,cancelButtonText:d.i18n.translate("xpack.fleet.settings.confirmModal.cancelButtonText",{defaultMessage:"Cancel"}),confirmButtonText:null!==(a=null===(i=o.options)||void 0===i?void 0:i.confirmButtonText)&&void 0!==a?a:d.i18n.translate("xpack.fleet.settings.confirmModal.confirmButtonText",{defaultMessage:"Save and deploy"}),defaultFocusedButton:"confirm"},o.description)),e)},nn=m.a.div.withConfig({displayName:"DraggableDiv",componentId:"sc-1vbljv8-0"})(["margin:",";"],(e=>e.theme.eui.euiSizeS));function ln(e){return null!=e&&e.length?e.map(((e,t)=>l.a.createElement(c.EuiFormErrorText,{key:t},e))):null}const sn=l.a.memo((({id:e,index:t,multiline:a,value:i,onChange:s,onDelete:r,placeholder:o,autoFocus:u,errors:m,disabled:p})=>{var f;const E=Object(n.useCallback)((()=>{r(t)}),[r,t]),h=(null!==(f=null==m?void 0:m.length)&&void 0!==f?f:0)>0,b=Object(g.useTheme)();return l.a.createElement(c.EuiDraggable,{spacing:"m",index:t,draggableId:e,isDragDisabled:p,customDragHandle:!0,style:{paddingLeft:0,paddingRight:0}},((e,t)=>l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1,style:t.isDragging?{background:b.eui.euiPanelBackgroundColorModifiers.plain}:{}},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(nn,F()({},e.dragHandleProps,{"aria-label":d.i18n.translate("xpack.fleet.settings.sortHandle",{defaultMessage:"Sort host handle"})}),l.a.createElement(c.EuiIcon,{color:"text",type:"grab"}))),l.a.createElement(c.EuiFlexItem,null,a?l.a.createElement(c.EuiTextArea,{fullWidth:!0,value:i,onChange:s,autoFocus:u,isInvalid:h,disabled:p,placeholder:o}):l.a.createElement(c.EuiFieldText,{fullWidth:!0,value:i,onChange:s,autoFocus:u,isInvalid:h,disabled:p,placeholder:o}),ln(m)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonIcon,{color:"text",onClick:E,iconType:"cross",disabled:p,"aria-label":d.i18n.translate("xpack.fleet.multiRowInput.deleteButton",{defaultMessage:"Delete row"})})))))})),rn=l.a.memo((({index:e,deletable:t,multiline:a,value:i,onChange:s,onDelete:r,placeholder:o,autoFocus:u,errors:g,disabled:m})=>{var p;const f=Object(n.useCallback)((()=>{r(e)}),[r,e]),E=(null!==(p=null==g?void 0:g.length)&&void 0!==p?p:0)>0;return l.a.createElement(l.a.Fragment,null,e>0&&l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"none"},l.a.createElement(c.EuiFlexItem,null,a?l.a.createElement(c.EuiTextArea,{fullWidth:!0,value:i,onChange:s,autoFocus:u,isInvalid:E,disabled:m,placeholder:o}):l.a.createElement(c.EuiFieldText,{fullWidth:!0,value:i,onChange:s,autoFocus:u,isInvalid:E,disabled:m,placeholder:o}),ln(g)),t&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonIcon,{color:"text",onClick:f,iconType:"cross",disabled:m,"aria-label":d.i18n.translate("xpack.fleet.multiRowInput.deleteButton",{defaultMessage:"Delete row"})}))))})),on=({id:e,value:t,onChange:a,helpText:i,label:s,isInvalid:r,errors:o,disabled:d,placeholder:g,multiline:m=!1,sortable:p=!0})=>{const[f,E]=Object(n.useState)(!1),h=Object(n.useMemo)((()=>t.length?t:[""]),[t]),b=Object(n.useMemo)((()=>h.map(((e,t)=>({value:e,onChange:e=>{const n=[...h];n[t]=e.target.value,a(n)}})))),[h,a]),y=Object(n.useMemo)((()=>o?o.reduce(((e,t)=>(void 0===t.index||(e[t.index]||(e[t.index]=[]),e[t.index].push(t.message)),e)),[]):[]),[o]),k=Object(n.useCallback)((e=>{y.splice(e,1),a([...h.slice(0,e),...h.slice(e+1)])}),[h,a,y]),v=Object(n.useCallback)((()=>{E(!0),a([...h,""])}),[h,a]),x=Object(n.useCallback)((({source:e,destination:t})=>{if(e&&t){const n=Object(c.euiDragDropReorder)(h,e.index,t.index),l=y[e.index];y.splice(e.index,1),y.splice(t.index,0,l),a(n)}}),[h,a,y]),M=Object(n.useMemo)((()=>o&&o.filter((e=>void 0===e.index)).map((({message:e})=>e))),[o]),F=p&&b.length>1;return l.a.createElement(c.EuiFormRow,{fullWidth:!0,label:s,isInvalid:r},l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFormHelpText,null,i),i&&l.a.createElement(c.EuiSpacer,{size:"m"}),F?l.a.createElement(c.EuiDragDropContext,{onDragEnd:x},l.a.createElement(c.EuiDroppable,{droppableId:`${e}Droppable`,spacing:"none"},b.map(((t,a)=>l.a.createElement(l.a.Fragment,{key:a},l.a.createElement(sn,{id:`${e}${a}Draggable`,index:a,onChange:t.onChange,onDelete:k,value:t.value,autoFocus:f,errors:y[a],disabled:d,placeholder:g})))))):b.map(((e,t)=>l.a.createElement(rn,{key:t,multiline:m,index:t,onChange:e.onChange,onDelete:k,value:e.value,autoFocus:f,errors:y[t],disabled:d,placeholder:g,deletable:b.length>1}))),ln(M),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiButtonEmpty,{disabled:d,size:"xs",flush:"left",iconType:"plusInCircle",onClick:v},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.multiRowInput.addRow",defaultMessage:"Add row"}))))};async function cn(e){var t,a,n;let l=`${k.c}.data_output_id:"${e.id}" or ${k.c}.monitoring_output_id:"${e.id}"`;e.is_default&&(l+=` or (not ${k.c}.data_output_id:*)`);const i=await Object(o.p)({kuery:l,page:1,perPage:k.n});if(i.error)throw i.error;const s=null!==(t=null===(a=i.data)||void 0===a||null===(n=a.items)||void 0===n?void 0:n.length)&&void 0!==t?t:0;let r=0;if(s>0){var c,u,d;const e=await Object(o.r)({page:1,perPage:0,showInactive:!1,kuery:null===(c=i.data)||void 0===c?void 0:c.items.map((e=>`policy_id:"${e.id}"`)).join(" or ")});if(e.error)throw e.error;r=null!==(u=null===(d=e.data)||void 0===d?void 0:d.total)&&void 0!==u?u:0}return{agentPolicyCount:s,agentCount:r}}const un=/^(https):\/\/[^\s$.?#].[^\s]*$/gm,dn=()=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.confirmModalTitle",defaultMessage:"Save and deploy changes?"}),gn=({agentCount:e,agentPolicyCount:t})=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.confirmModalText",defaultMessage:"This action will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{agents:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:e}})),policies:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:t}}))}});function mn(e){if(0===e.length)return[{message:d.i18n.translate("xpack.fleet.settings.fleetServerHostsEmptyError",{defaultMessage:"At least one URL is required"})}];const t=[],a={};return e.forEach(((e,n)=>{e?e.match(un)||t.push({message:d.i18n.translate("xpack.fleet.settings.fleetServerHostsError",{defaultMessage:"Invalid URL"}),index:n}):t.push({message:d.i18n.translate("xpack.fleet.settings.fleetServerHostsRequiredError",{defaultMessage:"Host URL is required"}),index:n});const l=a[e]||[];a[e]=[...l,n]})),Object.values(a).filter((({length:e})=>e>1)).forEach((e=>{e.forEach((e=>t.push({message:d.i18n.translate("xpack.fleet.settings.fleetServerHostsDuplicateError",{defaultMessage:"Duplicate URL"}),index:e})))})),t.length?t:e.length&&Object(I.isDiffPathProtocol)(e)?[{message:d.i18n.translate("xpack.fleet.settings.fleetServerHostsDifferentPathOrProtocolError",{defaultMessage:"Protocol and path must be the same for each URL"})}]:void 0}const pn=({onClose:e,fleetServerHosts:t})=>{const{docLinks:a}=Object(o.ub)(),i=function(e,t){const[a,i]=Object(n.useState)(!1),{notifications:s}=Object(o.ub)(),{confirm:r}=tn(),c=Object(o.U)("fleetServerHostsInput",e,mn),u=c.validate,g=Object(n.useCallback)((()=>u()),[u]),m=Object(n.useCallback)((async()=>{try{if(!g())return;const{agentCount:e,agentPolicyCount:a}=await async function(){var e,t,a,n;const l=await Object(o.p)({perPage:0});if(l.error)throw l.error;const i=null!==(e=null===(t=l.data)||void 0===t?void 0:t.total)&&void 0!==e?e:0,s=await Object(o.r)({page:1,perPage:0,showInactive:!1});if(s.error)throw s.error;return{agentPolicyCount:i,agentCount:null!==(a=null===(n=s.data)||void 0===n?void 0:n.total)&&void 0!==a?a:0}}();if(!await r(l.a.createElement(dn,null),l.a.createElement(gn,{agentCount:e,agentPolicyCount:a})))return;i(!0);const n=await Object(o.L)({fleet_server_hosts:c.value});if(n.error)throw n.error;s.toasts.addSuccess(d.i18n.translate("xpack.fleet.settings.fleetServerHostsFlyout.successToastTitle",{defaultMessage:"Settings saved"})),i(!1),t()}catch(e){i(!1),s.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.settings.fleetServerHostsFlyout.errorToastTitle",{defaultMessage:"An error happened while saving settings"})})}}),[c.value,g,s,r,t]);return{isLoading:a,isDisabled:a||!c.hasChanged||c.props.isInvalid,submit:m,fleetServerHostsInput:c}}(t,e);return l.a.createElement(c.EuiFlyout,{maxWidth:670,onClose:e},l.a.createElement(c.EuiFlyoutHeader,{hasBorder:!0},l.a.createElement(c.EuiTitle,{size:"m"},l.a.createElement("h2",{id:"FleetPackagePolicyPreviousVersionFlyoutTitle"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.title",defaultMessage:"Fleet Server hosts"})))),l.a.createElement(c.EuiFlyoutBody,null,l.a.createElement(c.EuiText,{color:"subdued"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.description",defaultMessage:"Specify the URLs that your agents will use to connect to a Fleet Server. If multiple URLs exist, Fleet shows the first provided URL for enrollment purposes. Fleet Server uses port 8220 by default. Refer to the {link}.",values:{link:l.a.createElement(c.EuiLink,{href:a.links.fleet.settingsFleetServerHostSettings,target:"_blank",external:!0},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.userGuideLink",defaultMessage:"Fleet and Elastic Agent Guide"}))}})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(on,F()({},i.fleetServerHostsInput.props,{id:"fleet-server-inputs",placeholder:d.i18n.translate("xpack.fleet.settings.fleetServerHostsFlyout.fleetServerHostsInputPlaceholder",{defaultMessage:"Specify host URL"})}))),l.a.createElement(c.EuiFlyoutFooter,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{onClick:()=>e(),flush:"left"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,isLoading:i.isLoading,isDisabled:i.isDisabled,onClick:i.submit,"data-test-subj":"saveApplySettingsBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))},fn=()=>{const{docLinks:e}=Object(o.ub)();return l.a.createElement(En,{iconType:"iInCircle",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.calloutTitle",defaultMessage:"Additional Logstash configuration required"})},l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.description",defaultMessage:"Add an Elastic Agent pipeline configuration to Logstash to receive events from the Elastic Agent framework. {documentationLink}.",values:{documentationLink:l.a.createElement(c.EuiLink,{external:!0,href:e.links.logstash.inputElasticAgent},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.documentationLink",defaultMessage:"Learn more"}))}}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(hn,null)))},En=({children:e,...t})=>{const[a,i]=Object(n.useState)(!1);return l.a.createElement(c.EuiCallOut,t,l.a.createElement(c.EuiSpacer,{size:"s"}),a?l.a.createElement(c.EuiButton,{onClick:()=>i(!1)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.collapseInstructionsButtonLabel",defaultMessage:"Collapse steps"})):l.a.createElement(c.EuiButton,{onClick:()=>i(!0),fill:!0},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.viewInstructionButtonLabel",defaultMessage:"View steps"})),a&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),e))},hn=()=>{const{docLinks:e}=Object(o.ub)(),t=function(){const[e,t]=Object(n.useState)(!1),[a,l]=Object(n.useState)(),{notifications:i}=Object(o.ub)(),s=Object(n.useCallback)((async()=>{try{var e;t(!0);const a=await Object(o.H)();if(a.error)throw a.error;l(null===(e=a.data)||void 0===e?void 0:e.api_key)}catch(e){i.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.settings.logstashInstructions.generateApiKeyError",{defaultMessage:"Impossible to generate an api key"})})}finally{t(!1)}}),[i.toasts]);return Object(n.useMemo)((()=>({isLoading:e,generateApiKey:s,apiKey:a})),[e,s,a])}(),a=Object(n.useMemo)((()=>{return[{children:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.apiKeyStepDescription",defaultMessage:"We recommend authorizing Logstash to output to Elasticsearch with minimal privileges for Elastic Agent."}),l.a.createElement(c.EuiSpacer,{size:"m"}),t.apiKey?l.a.createElement(c.EuiCodeBlock,{paddingSize:"m"},l.a.createElement("h5",null,"API Key"),t.apiKey,l.a.createElement("div",{className:"euiCodeBlock__controls"},l.a.createElement("div",{className:"euiCodeBlock__copyButton"},l.a.createElement(c.EuiCopy,{textToCopy:t.apiKey},(e=>l.a.createElement(c.EuiButtonIcon,{onClick:e,iconType:"copyClipboard",color:"text","aria-label":d.i18n.translate("xpack.fleet.settings.logstashInstructions.copyApiKeyButtonLabel",{defaultMessage:"Copy message"})})))))):l.a.createElement(c.EuiButton,{isLoading:t.isLoading,onClick:t.generateApiKey},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.generateApiKeyButtonLabel",defaultMessage:"Generate API key"})),l.a.createElement(c.EuiSpacer,{size:"m"}))},{children:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.addPipelineStepDescription",defaultMessage:"In your Logstash configuration directory, open the {pipelineFile} file and add the following configuration. Replace the path to your file.",values:{pipelineFile:l.a.createElement(c.EuiCode,null,"pipelines.yml")}}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiCodeBlock,{paddingSize:"m",language:"yaml",isCopyable:!0},'- pipeline.id: elastic-agent-pipeline\n  path.config: "/etc/path/to/elastic-agent-pipeline.conf"\n'))},{children:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.editPipelineStepDescription",defaultMessage:"Next, open the {pipelineConfFile} file and insert the following content:",values:{pipelineConfFile:l.a.createElement(c.EuiCode,null,"elastic-agent-pipeline.conf")}}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiCodeBlock,{paddingSize:"m",language:"yaml",isCopyable:!0},(a=t.apiKey,'input {\n  elastic_agent {\n    port => 5044\n    ssl => true\n    ssl_certificate_authorities => ["<ca_path>"]\n    ssl_certificate => "<server_cert_path>"\n    ssl_key => "<server_cert_key_in_pkcs8>"\n    ssl_verify_mode => "force_peer"\n  }\n}\n\noutput {\n  elasticsearch {\n    hosts => "<es_host>"\n    api_key => "<api_key>"\n    data_stream => true\n    ssl => true\n    # cacert => "<elasticsearch_ca_path>"\n  }\n}'.replace("<api_key>",a||"<api_key>"))))},{children:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.replaceStepDescription",defaultMessage:"Replace the parts between the brackets with your generated SSL certificate file paths. View {documentationLink} to generate the certificates.",values:{documentationLink:l.a.createElement(c.EuiLink,{external:!0,href:e.links.fleet.secureLogstash},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.ourDocumentationLink",defaultMessage:"our documentation"}))}}),l.a.createElement(c.EuiSpacer,{size:"m"}))},{children:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.saveAndRestartStepDescription",defaultMessage:"Save the pipeline and restart Logstash so the changes take effect."}),l.a.createElement(c.EuiSpacer,{size:"m"}))}];var a}),[t,e]);return l.a.createElement("ol",null,a.map(((e,t)=>l.a.createElement("li",{key:t},e.children))))},bn=m.a.div.withConfig({displayName:"CodeEditorContainer",componentId:"sc-11vyk7j-0"})(["min-height:0;position:relative;height:116px;"]),yn=m()(c.EuiTextColor).attrs((e=>({color:"subdued",size:"xs"}))).withConfig({displayName:"CodeEditorPlaceholder",componentId:"sc-11vyk7j-1"})(["position:absolute;top:0;left:0;font-family:Menlo,Monaco,'Courier New',monospace;font-size:12px;line-height:21px;pointer-events:none;"]),kn={minimap:{enabled:!1},ariaLabel:d.i18n.translate("xpack.fleet.settings.yamlCodeEditor",{defaultMessage:"YAML Code Editor"}),scrollBeyondLastLine:!1,wordWrap:"on",wrappingIndent:"indent",automaticLayout:!0,tabSize:2,lineNumbers:"off",lineNumbersMinChars:0,glyphMargin:!1,folding:!1,lineDecorationsWidth:0},vn=e=>{const{placeholder:t,disabled:a,...n}=e;return a?l.a.createElement(c.EuiCodeBlock,{style:{height:"116px"},language:"yaml",isCopyable:!1,paddingSize:"s"},l.a.createElement("pre",null,n.value)):l.a.createElement(bn,null,l.a.createElement(E.CodeEditor,F()({languageId:"yaml",width:"100%",height:"116px",options:kn},n)),(!n.value||""===n.value)&&l.a.createElement(yn,null,t))};function xn(e){const t=[],a={};if(e.forEach(((e,n)=>{try{if(!e)throw new Error("Host URL required");const t=new URL(e);if(!["http:","https:"].includes(t.protocol))throw new Error("Invalid protocol")}catch(e){t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.elasticHostError",{defaultMessage:"Invalid URL"}),index:n})}const l=a[e]||[];a[e]=[...l,n]})),Object.values(a).filter((({length:e})=>e>1)).forEach((e=>{e.forEach((e=>t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.elasticHostDuplicateError",{defaultMessage:"Duplicate URL"}),index:e})))})),0===e.length&&t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.elasticUrlRequiredError",{defaultMessage:"URL is required"})}),t.length)return t}function Mn(e){const t=[],a={};if(e.forEach(((e,n)=>{try{if(e.match(/^http([s]){0,1}:\/\//))return void t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.logstashHostProtocolError",{defaultMessage:"Host address must begin with a domain name or IP address"}),index:n});if(new URL(`http://${e}`).host!==e)throw new Error("Invalid host")}catch(a){0===e.length?t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.logstashHostRequiredError",{defaultMessage:"Host is required"}),index:n}):t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.logstashHostError",{defaultMessage:"Invalid Host"}),index:n})}const l=a[e]||[];a[e]=[...l,n]})),Object.values(a).filter((({length:e})=>e>1)).forEach((e=>{e.forEach((e=>t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.logstashHostDuplicateError",{defaultMessage:"Duplicate Host"}),index:e})))})),0===e.length&&t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.logstashHostRequiredError",{defaultMessage:"Host is required"})}),t.length)return t}function Fn(e){try{return void Object(jt.safeLoad)(e)}catch(e){return[d.i18n.translate("xpack.fleet.settings.outputForm.invalidYamlFormatErrorMessage",{defaultMessage:"Invalid YAML: {reason}",values:{reason:e.message}})]}}function In(e){if(!e||""===e)return[d.i18n.translate("xpack.fleet.settings.outputForm.nameIsRequiredErrorMessage",{defaultMessage:"Name is required"})]}function On(e){if(""!==e&&!e.match(/^[a-zA-Z0-9]+$/))return[d.i18n.translate("xpack.fleet.settings.outputForm.caTrusterdFingerprintInvalidErrorMessage",{defaultMessage:"CA trusted fingerprint should be a base64 CA sha256 fingerprint"})]}function Sn(e){if(!e||""===e)return[d.i18n.translate("xpack.fleet.settings.outputForm.sslCertificateRequiredErrorMessage",{defaultMessage:"SSL certificate is required"})]}function jn(e){if(!e||""===e)return[d.i18n.translate("xpack.fleet.settings.outputForm.sslKeyRequiredErrorMessage",{defaultMessage:"SSL key is required"})]}const Cn=()=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.confirmModalTitle",defaultMessage:"Save and deploy changes?"}),wn=({output:e,agentCount:t,agentPolicyCount:a})=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.confirmModalText",defaultMessage:"This action will update {outputName} output. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{outputName:l.a.createElement("strong",null,e.name),agents:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}});const Tn=()=>{const{docLinks:e}=Object(o.ub)();return l.a.createElement(c.EuiCallOut,{iconType:"alert",color:"warning",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.encryptionKeyRequired.calloutTitle",defaultMessage:"Additional setup required"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.encryptionKeyRequired.calloutDescription",defaultMessage:"You must configure an encryption key before configuring this output. {link}",values:{link:l.a.createElement(c.EuiLink,{href:e.links.kibana.secureSavedObject,target:"_blank",external:!0},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.encryptionKeyRequired.link",defaultMessage:"Learn more"}))}}))},Ln=[{value:"elasticsearch",text:"Elasticsearch"},{value:"logstash",text:"Logstash (beta)"}],Pn=({onClose:e,output:t})=>{Object(o.T)("settings");const a=function(e,t){var a,i,s,r,c,u,g,m,p,f,E,h,b,y,k,v;const x=!(null!==(a=Object(o.X)().missingOptionalFeatures)&&void 0!==a&&a.includes("encrypted_saved_object_encryption_key_required")),[M,F]=Object(n.useState)(!1),{notifications:I}=Object(o.ub)(),{confirm:O}=tn(),S=null!==(i=null==t?void 0:t.is_preconfigured)&&void 0!==i&&i,j=Object(o.jb)(null!==(s=null==t?void 0:t.name)&&void 0!==s?s:"",In,S),C=Object(o.jb)(null!==(r=null==t?void 0:t.type)&&void 0!==r?r:"elasticsearch",void 0,S),w=Object(o.jb)(null!==(c=null==t?void 0:t.config_yaml)&&void 0!==c?c:"",Fn,S),T=Object(o.vb)(null!==(u=null==t?void 0:t.is_default)&&void 0!==u&&u,S||(null==t?void 0:t.is_default)),L=Object(o.vb)(null!==(g=null==t?void 0:t.is_default_monitoring)&&void 0!==g&&g,S||(null==t?void 0:t.is_default_monitoring)),P=Object(o.jb)(null!==(m=null==t?void 0:t.ca_trusted_fingerprint)&&void 0!==m?m:"",On,S),A=Object(o.U)("esHostsComboxBox",null!==(p=null==t?void 0:t.hosts)&&void 0!==p?p:[],xn,S),_=Object(o.U)("logstashHostsComboxBox",null!==(f=null==t?void 0:t.hosts)&&void 0!==f?f:[],Mn,S),D=Object(o.U)("sslCertificateAuthoritiesComboxBox",null!==(E=null==t||null===(h=t.ssl)||void 0===h?void 0:h.certificate_authorities)&&void 0!==E?E:[],void 0,S),B=Object(o.jb)(null!==(b=null==t||null===(y=t.ssl)||void 0===y?void 0:y.certificate)&&void 0!==b?b:"",Sn,S),z=Object(o.jb)(null!==(k=null==t||null===(v=t.ssl)||void 0===v?void 0:v.key)&&void 0!==k?k:"",jn,S),N="logstash"===C.value,R={nameInput:j,typeInput:C,elasticsearchUrlInput:A,logstashHostsInput:_,additionalYamlConfigInput:w,defaultOutputInput:T,defaultMonitoringOutputInput:L,caTrustedFingerprintInput:P,sslCertificateInput:B,sslKeyInput:z,sslCertificateAuthoritiesInput:D},U=Object.values(R).some((e=>e.hasChanged)),H=Object(n.useCallback)((()=>{const e=j.validate(),t=A.validate(),a=_.validate(),n=w.validate(),l=P.validate(),i=B.validate(),s=z.validate();return N?a&&n&&e&&i&&s:t&&n&&e&&l}),[N,j,B,z,A,_,w,P]),q=Object(n.useCallback)((async()=>{try{if(!H())return;F(!0);const a=N?{name:j.value,type:C.value,hosts:_.value,is_default:T.value,is_default_monitoring:L.value,config_yaml:w.value,ssl:{certificate:B.value,key:z.value,certificate_authorities:D.value.filter((e=>""!==e))}}:{name:j.value,type:C.value,hosts:A.value,is_default:T.value,is_default_monitoring:L.value,config_yaml:w.value,ca_trusted_fingerprint:P.value};if(t){if(!await async function(e,t){const{agentCount:a,agentPolicyCount:n}=await cn(e);return t(l.a.createElement(Cn,null),l.a.createElement(wn,{agentCount:a,agentPolicyCount:n,output:e}))}(t,O))return void F(!1);const e=await Object(o.K)(t.id,a);if(e.error)throw e.error}else{const e=await Object(o.I)(a);if(e.error)throw e.error}e(),F(!1)}catch(e){F(!1),I.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.settings.outputForm.errorToastTitle",{defaultMessage:"Error while saving output"})})}}),[N,H,O,w.value,L.value,T.value,A.value,_.value,P.value,B.value,D.value,z.value,j.value,C.value,I.toasts,e,t]);return{inputs:R,submit:q,isLoading:M,hasEncryptedSavedObjectConfigured:x,isDisabled:M||S||t&&!U||N&&!x}}(e,t),i=a.inputs,{docLinks:s}=Object(o.ub)(),r="logstash"===i.typeInput.value,g="elasticsearch"===i.typeInput.value,m=r&&!a.hasEncryptedSavedObjectConfigured;return l.a.createElement(c.EuiFlyout,{maxWidth:670,onClose:e},l.a.createElement(c.EuiFlyoutHeader,{hasBorder:!0},l.a.createElement(c.EuiTitle,{size:"m"},l.a.createElement("h2",{id:"FleetEditOutputFlyoutTitle"},t?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.editTitle",defaultMessage:"Edit output"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.createTitle",defaultMessage:"Add new output"})))),l.a.createElement(c.EuiFlyoutBody,null,(null==t?void 0:t.is_preconfigured)&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiCallOut,{iconType:"lock",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.preconfiguredOutputCalloutTitle",defaultMessage:"This output is managed outside of Fleet"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.preconfiguredOutputCalloutDescription",defaultMessage:"Most actions related to this output are unavailable. Refer to your kibana config for more detail."})),l.a.createElement(c.EuiSpacer,{size:"m"})),l.a.createElement(c.EuiForm,null,l.a.createElement(c.EuiFormRow,F()({fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.nameInputLabel",defaultMessage:"Name"})},i.nameInput.formRowProps),l.a.createElement(c.EuiFieldText,F()({fullWidth:!0},i.nameInput.props,{placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.nameInputPlaceholder",{defaultMessage:"Specify name"})}))),l.a.createElement(c.EuiFormRow,{fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.typeInputLabel",defaultMessage:"Type"}),helpText:r&&l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editOutputFlyout.logstashTypeOutputBetaHelpText",defaultMessage:"Logstash output is in beta. Click {sendFeedback} to report bugs and suggest improvements.",values:{sendFeedback:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editOutputFlyout.sendFeedback",defaultMessage:"Send feedback"}))}})},l.a.createElement(c.EuiSelect,F()({fullWidth:!0},i.typeInput.props,{options:Ln,placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.typeInputPlaceholder",{defaultMessage:"Specify type"})}))),m&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(Tn,null)),r&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(fn,null),l.a.createElement(c.EuiSpacer,{size:"m"})),g&&l.a.createElement(on,F()({label:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.esHostsInputLabel",{defaultMessage:"Hosts"}),placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.esHostsInputPlaceholder",{defaultMessage:"Specify host URL"})},i.elasticsearchUrlInput.props)),r&&l.a.createElement(on,F()({placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.logstashHostsInputPlaceholder",{defaultMessage:"Specify host"}),sortable:!1,helpText:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.logstashHostsInputDescription",defaultMessage:"Specify the addresses that your agents will use to connect to Logstash. {guideLink}.",values:{guideLink:l.a.createElement(c.EuiLink,{href:s.links.fleet.settings,target:"_blank",external:!0},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetSettingsLink",defaultMessage:"Learn more"}))}}),label:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.logstashHostsInputLabel",{defaultMessage:"Logstash hosts"})},i.logstashHostsInput.props)),g&&l.a.createElement(c.EuiFormRow,F()({fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.caTrustedFingerprintInputLabel",defaultMessage:"Elasticsearch CA trusted fingerprint (optional)"})},i.caTrustedFingerprintInput.formRowProps),l.a.createElement(c.EuiFieldText,F()({fullWidth:!0},i.caTrustedFingerprintInput.props,{placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.caTrustedFingerprintInputPlaceholder",{defaultMessage:"Specify Elasticsearch CA trusted fingerprint"})}))),r&&l.a.createElement(on,F()({placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateAuthoritiesInputPlaceholder",{defaultMessage:"Specify certificate authority"}),label:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateAuthoritiesInputLabel",{defaultMessage:"Server SSL certificate authorities (optional)"}),multiline:!0,sortable:!1},i.sslCertificateAuthoritiesInput.props)),r&&l.a.createElement(c.EuiFormRow,F()({fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslCertificateInputLabel",defaultMessage:"Client SSL certificate"})},i.sslCertificateInput.formRowProps),l.a.createElement(c.EuiTextArea,F()({fullWidth:!0,rows:5},i.sslCertificateInput.props,{placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateInputPlaceholder",{defaultMessage:"Specify ssl certificate"})}))),r&&l.a.createElement(c.EuiFormRow,F()({fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslKeyInputLabel",defaultMessage:"Client SSL certificate key"})},i.sslKeyInput.formRowProps),l.a.createElement(c.EuiTextArea,F()({fullWidth:!0,rows:5},i.sslKeyInput.props,{placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslKeyInputPlaceholder",{defaultMessage:"Specify certificate key"})}))),l.a.createElement(c.EuiFormRow,F()({label:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.yamlConfigInputLabel",{defaultMessage:"Advanced YAML configuration"})},i.additionalYamlConfigInput.formRowProps,{fullWidth:!0}),l.a.createElement(vn,{value:i.additionalYamlConfigInput.value,onChange:i.additionalYamlConfigInput.setValue,disabled:i.additionalYamlConfigInput.props.disabled,placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.yamlConfigInputPlaceholder",{defaultMessage:"# YAML settings here will be added to the output section of each agent policy."})})),l.a.createElement(c.EuiFormRow,F()({fullWidth:!0},i.defaultOutputInput.formRowProps),l.a.createElement(c.EuiSwitch,F()({},i.defaultOutputInput.props,{label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.defaultOutputSwitchLabel",defaultMessage:"Make this output the default for {boldAgentIntegrations}.",values:{boldAgentIntegrations:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.agentIntegrationsBold",defaultMessage:"agent integrations"}))}})}))),l.a.createElement(c.EuiFormRow,F()({fullWidth:!0},i.defaultMonitoringOutputInput.formRowProps),l.a.createElement(c.EuiSwitch,F()({},i.defaultMonitoringOutputInput.props,{label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.defaultMontoringOutputSwitchLabel",defaultMessage:"Make this output the default for {boldAgentMonitoring}.",values:{boldAgentMonitoring:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.agentMonitoringBold",defaultMessage:"agent monitoring"}))}})}))))),l.a.createElement(c.EuiFlyoutFooter,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{onClick:e,flush:"left"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,isLoading:a.isLoading,isDisabled:a.isDisabled,onClick:a.submit,"data-test-subj":"saveApplySettingsBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))},An=()=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.confirmModalTitle",defaultMessage:"Delete and deploy changes?"}),_n=({output:e,agentCount:t,agentPolicyCount:a})=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.confirmModalText",defaultMessage:"This action will delete {outputName} output. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{outputName:l.a.createElement("strong",null,e.name),agents:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}}),Dn=(Bn=()=>{var e,t,a,i;Object(o.T)("settings");const s=Object(r.useHistory)(),u=Object(o.ib)(),g=Object(o.fb)(),{deleteOutput:m}=function(e){const{confirm:t}=tn(),{notifications:a}=Object(o.ub)();return{deleteOutput:Object(n.useCallback)((async n=>{try{const{agentCount:a,agentPolicyCount:i}=await cn(n);if(!await t(l.a.createElement(An,null),l.a.createElement(_n,{output:n,agentCount:a,agentPolicyCount:i}),{buttonColor:"danger",confirmButtonText:d.i18n.translate("xpack.fleet.settings.deleteOutputs.confirmButtonLabel",{defaultMessage:"Delete and deploy"})}))return;const s=await Object(o.n)(n.id);if(s.error)throw s.error;e()}catch(e){a.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.settings.deleteOutputs.errorToastTitle",{defaultMessage:"Error deleting output"})})}}),[t,a.toasts,e])}}(g.resendRequest),p=u.resendRequest,f=g.resendRequest,E=Object(n.useCallback)((()=>{p(),f(),s.replace(k.o.settings()[1])}),[s,p,f]);return u.isLoading&&u.isInitialRequest||null===(e=u.data)||void 0===e||!e.item||g.isLoading&&g.isInitialRequest||null===(t=g.data)||void 0===t||!t.items?l.a.createElement(v.a,{section:"settings"},l.a.createElement(y.n,null)):l.a.createElement(v.a,{section:"settings"},l.a.createElement(r.Router,{history:s},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:k.g.settings_edit_fleet_server_hosts},l.a.createElement(c.EuiPortal,null,l.a.createElement(pn,{onClose:E,fleetServerHosts:null!==(a=null===(i=u.data)||void 0===i?void 0:i.item.fleet_server_hosts)&&void 0!==a?a:[]}))),l.a.createElement(r.Route,{path:k.g.settings_create_outputs},l.a.createElement(c.EuiPortal,null,l.a.createElement(Pn,{onClose:E}))),l.a.createElement(r.Route,{path:k.g.settings_edit_outputs},(e=>{var t;const a=null===(t=g.data)||void 0===t?void 0:t.items.find((t=>e.match.params.outputId===t.id));return a?l.a.createElement(c.EuiPortal,null,l.a.createElement(Pn,{onClose:E,output:a})):l.a.createElement(r.Redirect,{to:k.g.settings})})))),l.a.createElement(Ja,{settings:u.data.item,outputs:g.data.items,deleteOutput:m}))},e=>l.a.createElement(an,null,l.a.createElement(Bn,e)));var Bn;const zn=({isAddIntegrationsPath:e,children:t})=>l.a.createElement(c.EuiErrorBoundary,null,e?l.a.createElement(v.c,{leftColumn:l.a.createElement(v.b,null)},t):l.a.createElement(v.a,null,l.a.createElement(v.d,null,t))),Nn=m()(c.EuiPanel).withConfig({displayName:"Panel",componentId:"sc-11e0awm-0"})(["max-width:500px;margin-right:auto;margin-left:auto;"]),Rn=Object(n.memo)((({error:e})=>"MISSING_SECURITY"===e?l.a.createElement(Oe.b,{missingRequirements:["security_required","api_keys"]}):"MISSING_PRIVILEGES"===e?l.a.createElement(Nn,{"data-test-subj":"missingPrivilegesPrompt"},l.a.createElement(c.EuiEmptyPrompt,{iconType:"securityApp",title:l.a.createElement("h2",{"data-test-subj":"missingPrivilegesPromptTitle"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.permissionDeniedErrorTitle",defaultMessage:"Permission denied"})),body:l.a.createElement("p",{"data-test-subj":"missingPrivilegesPromptMessage"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.permissionDeniedErrorMessage",defaultMessage:"You are not authorized to access Fleet. It requires the {roleName1} Kibana privilege for Fleet, and the {roleName2} or {roleName1} privilege for Integrations.",values:{roleName1:l.a.createElement(c.EuiCode,null,'"All"'),roleName2:l.a.createElement(c.EuiCode,null,'"Read"')}}))})):l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.permissionsRequestErrorMessageTitle",defaultMessage:"Unable to check permissions"}),error:d.i18n.translate("xpack.fleet.permissionsRequestErrorMessageDescription",{defaultMessage:"There was a problem checking Fleet permissions"})}))),Un=Object(n.memo)((({children:e})=>{Object(o.T)("base");const t=Object(o.ub)(),{notifications:a}=t,i=Object(o.S)().fleet.all,[s,c]=Object(n.useState)(!1),[g,m]=Object(n.useState)(),[p,f]=Object(n.useState)(!1),[E,h]=Object(n.useState)(null),b=!!Object(r.useRouteMatch)(k.g.add_integration_to_policy);return Object(n.useEffect)((()=>{(async()=>{c(!1),m(void 0),f(!1),h(null);try{var e;c(!0);const s=await Object(o.z)();if(c(!1),null!==(e=s.data)&&void 0!==e&&e.success){try{var t,n;const e=await Object(o.N)();e.error&&h(e.error),null!==(t=e.data)&&void 0!==t&&null!==(n=t.nonFatalErrors)&&void 0!==n&&n.length&&a.toasts.addError(e.data.nonFatalErrors[0],{title:d.i18n.translate("xpack.fleet.setup.uiPreconfigurationErrorTitle",{defaultMessage:"Configuration error"})}),i||m("MISSING_PRIVILEGES")}catch(e){h(e)}f(!0)}else{var l;m((null===(l=s.data)||void 0===l?void 0:l.error)||"REQUEST_ERROR")}}catch(e){m("REQUEST_ERROR")}})()}),[a.toasts,i]),s||g?l.a.createElement(zn,{isAddIntegrationsPath:b},s?l.a.createElement(y.n,null):l.a.createElement(Rn,{error:g})):!p||E?l.a.createElement(zn,{isAddIntegrationsPath:b},E?l.a.createElement(y.g,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.initializationErrorMessageTitle",defaultMessage:"Unable to initialize Fleet"}),error:E}):l.a.createElement(y.l,null)):l.a.createElement(l.a.Fragment,null,e)})),Hn=Object(n.memo)((({children:e,startServices:t,config:a,history:n,kibanaVersion:i,extensions:s,routerHistory:u,theme$:d})=>{const g=f()(t.uiSettings.get$("theme:darkMode"));return l.a.createElement(E.RedirectAppLinks,{application:t.application},l.a.createElement(t.i18n.Context,null,l.a.createElement(E.KibanaContextProvider,{services:{...t}},l.a.createElement(c.EuiErrorBoundary,null,l.a.createElement(o.b.Provider,{value:a},l.a.createElement(o.e.Provider,{value:i},l.a.createElement(E.KibanaThemeProvider,{theme$:d},l.a.createElement(h.EuiThemeProvider,{darkMode:g},l.a.createElement(o.f.Provider,{value:s},l.a.createElement(o.c,null,l.a.createElement(r.Router,{history:n},l.a.createElement(b.e,{notifications:t.notifications,theme$:d},l.a.createElement(o.d,null,e)))))))))))))})),qn=Object(n.memo)((({setHeaderActionMenu:e})=>{const t=Object(o.ub)(),{TopNavMenu:a}=t.navigation.ui,n=[{label:d.i18n.translate("xpack.fleet.appNavigation.sendFeedbackButton",{defaultMessage:"Send feedback"}),iconType:"popout",run:()=>window.open("https://ela.st/fleet-feedback")}];return l.a.createElement(a,{appName:d.i18n.translate("xpack.fleet.appTitle",{defaultMessage:"Fleet"}),config:n,setMenuMountPoint:e})})),Gn=Object(n.memo)((({setHeaderActionMenu:e})=>{var t;const a=Object(o.Y)(),n=Object(o.X)();return l.a.createElement(l.a.Fragment,null,l.a.createElement(qn,{setHeaderActionMenu:e}),l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:k.g.agents},l.a.createElement(St,null)),l.a.createElement(r.Route,{path:k.g.policies},l.a.createElement($,null)),l.a.createElement(r.Route,{path:k.g.enrollment_tokens},l.a.createElement(Ga,null)),l.a.createElement(r.Route,{path:k.g.data_streams},l.a.createElement(Q,null)),l.a.createElement(r.Route,{path:k.g.settings},l.a.createElement(Dn,null)),l.a.createElement(r.Route,{path:k.g.add_integration_to_policy},l.a.createElement(Na,null)),l.a.createElement(r.Route,{render:({location:e})=>{if(!(""===e.pathname&&e.hash.length>0))return l.a.createElement(r.Redirect,{to:k.g.agents});const t=e.hash.replace(/^#(\/fleet)?/,"");return l.a.createElement(r.Redirect,{to:{...e,pathname:t,hash:void 0}})}})),a.isEnrollmentFlyoutOpen&&l.a.createElement(c.EuiPortal,null,l.a.createElement(y.b,{defaultMode:!n.isReady||null!==(t=n.missingRequirements)&&void 0!==t&&t.includes("fleet_server")?"standalone":"managed",isIntegrationFlow:!0,onClose:()=>a.closeEnrollmentFlyout()})),a.isFleetServerFlyoutOpen&&l.a.createElement(c.EuiPortal,null,l.a.createElement(y.j,{onClose:()=>a.closeFleetServerFlyout()})))})),Wn=({isAllowed:e=!1,restrictedPath:t="/",...a})=>e?l.a.createElement(r.Route,a):l.a.createElement(r.Redirect,{to:{pathname:t}}),$n=({startServices:e,config:t,history:a,kibanaVersion:n,extensions:i,setHeaderActionMenu:s,theme$:r})=>l.a.createElement(Hn,{startServices:e,config:t,history:a,kibanaVersion:n,extensions:i,theme$:r},l.a.createElement(Un,null,l.a.createElement(Gn,{setHeaderActionMenu:s})));function Vn(e,{element:t,history:a,setHeaderActionMenu:n,theme$:i},r,o,c){return s.a.render(l.a.createElement($n,{startServices:e,config:r,history:a,kibanaVersion:o,extensions:c,setHeaderActionMenu:n,theme$:i}),t),()=>{s.a.unmountComponentAtNode(t)}}const Kn=e=>{e.chrome.docTitle.reset(),e.chrome.setBreadcrumbs([]),o.g.stop()}}}]);