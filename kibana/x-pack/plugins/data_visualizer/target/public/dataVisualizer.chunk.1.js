/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.dataVisualizer_bundle_jsonpfunction=window.dataVisualizer_bundle_jsonpfunction||[]).push([[1],{127:function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(128);case"v8light":return a(130)}},128:function(e,t,a){var r=a(49),n=a(129);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);r(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},129:function(e,t,a){(t=a(50)(!1)).push([e.i,".dvSearchPanel__controls{flex-direction:row;padding:8px}.dvSearchPanel__container{align-items:baseline}@media only screen and (max-width: 574px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}}@media only screen and (min-width: 575px) and (max-width: 767px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}}@media only screen and (min-width: 768px) and (max-width: 991px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}}@media only screen and (min-width: 992px) and (max-width: 1199px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}}\n",""]),e.exports=t},130:function(e,t,a){var r=a(49),n=a(131);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);r(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},131:function(e,t,a){(t=a(50)(!1)).push([e.i,".dvSearchPanel__controls{flex-direction:row;padding:8px}.dvSearchPanel__container{align-items:baseline}@media only screen and (max-width: 574px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}}@media only screen and (min-width: 575px) and (max-width: 767px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}}@media only screen and (min-width: 768px) and (max-width: 991px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}}@media only screen and (min-width: 992px) and (max-width: 1199px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}}\n",""]),e.exports=t},132:function(e,t,a){e.exports=a(13)(15)},133:function(e,t,a){e.exports=a(13)(13)},134:function(e,t,a){e.exports=a(13)(4)},135:function(e,t,a){e.exports=a(13)(18)},136:function(e,t,a){e.exports=a(13)(2564)},137:function(e,t,a){e.exports=a(13)(2572)},138:function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(139);case"v8light":return a(141)}},139:function(e,t,a){var r=a(49),n=a(140);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);r(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},140:function(e,t,a){(t=a(50)(!1)).push([e.i,".dataViewTitleHeader{min-width:300px;display:flex;flex-direction:row;align-items:center}@media only screen and (max-width: 574px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}@media only screen and (min-width: 575px) and (max-width: 767px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}@media only screen and (min-width: 768px) and (max-width: 991px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}@media only screen and (min-width: 992px) and (max-width: 1199px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}\n",""]),e.exports=t},141:function(e,t,a){var r=a(49),n=a(142);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);r(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},142:function(e,t,a){(t=a(50)(!1)).push([e.i,".dataViewTitleHeader{min-width:300px;display:flex;flex-direction:row;align-items:center}@media only screen and (max-width: 574px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}@media only screen and (min-width: 575px) and (max-width: 767px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}@media only screen and (min-width: 768px) and (max-width: 991px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}@media only screen and (min-width: 992px) and (max-width: 1199px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}\n",""]),e.exports=t},52:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r=(e,t=[])=>"object"==typeof e&&null!==e&&Object.keys(e).length>0&&(0===t.length||t.every((t=>({}.hasOwnProperty.call(e,t)))))},59:function(e,t,a){e.exports=a(13)(9)},60:function(e,t,a){"use strict";a.d(t,"c",(function(){return te})),a.d(t,"b",(function(){return ae})),a.d(t,"a",(function(){return ne}));var r=a(0),n=a.n(r),i=a(20),s=a(1),o=a(30),l=a(21),u=a(24),c=a.n(u),d=(a(32),a(52)),f=a(9),p=a(22);const m=e=>{const t={term:{_tier:{value:"data_frozen"}}};if(!e)return{bool:{must_not:[t]}};const a=Object(p.cloneDeep)(e);return delete a.match_all,Object(d.a)(a.bool)?Array.isArray(a.bool.must_not)?a.bool.must_not.push(t):(Object(d.a)(a.bool.must_not)&&(a.bool.must_not=[a.bool.must_not,t]),void 0===a.bool.must_not&&(a.bool.must_not=[t])):a.bool={must_not:[t]},a};var g=a(48),b=a(5);const h="exclude-frozen",v=({timefilter:e,dataView:t,query:a,disabled:n,callback:o})=>{const{services:{notifications:{toasts:u}}}=Object(g.a)(),p=Object(r.useCallback)((async(t,a,r)=>{try{const n=await async function(e,t,a,r,n){const i=t.getRuntimeMappings(),o=await async function({index:e,timeFieldName:t,query:a,runtimeMappings:r}){const n=JSON.stringify({index:e,timeFieldName:t,query:a,runtimeMappings:r}),i=await Object(f.a)();return await i.getHttp().fetch({path:"/internal/file_upload/time_field_range",method:"POST",body:n})}({index:t.title,timeFieldName:t.timeFieldName,query:r?m(a):a,...Object(d.a)(i)?{runtimeMappings:i}:{}});return o.start.epoch&&o.end.epoch?e.setTime({from:c()(o.start.epoch).toISOString(),to:c()(o.end.epoch).toISOString()}):null==n||n.addWarning({title:s.i18n.translate("xpack.dataVisualizer.index.fullTimeRangeSelector.noResults",{defaultMessage:"No results match your search criteria"})}),o}(e,t,a,r,u);"function"==typeof o&&o(n)}catch(e){u.addDanger(s.i18n.translate("xpack.dataVisualizer.index.fullTimeRangeSelector.errorSettingTimeRangeNotification",{defaultMessage:"An error occurred setting the time range."}))}}),[o,e,u]),[v,y]=Object(r.useState)(!1),[x,j]=function(e,t){var a;const{services:{storage:n}}=Object(g.a)(),[i,s]=Object(r.useState)(null!==(a=n.get(e))&&void 0!==a?a:"exclude-frozen");return[i,Object(r.useCallback)((t=>{try{n.set(e,t),s(t)}catch(e){throw new Error("Unable to update storage with provided value")}}),[e,n])]}("dataVisualizer.frozenDataTierPreference"),O=Object(r.useCallback)((e=>{j(e),p(t,a,e===h),S()}),[t,a,j,p]),S=()=>{y(!1)},E=Object(r.useMemo)((()=>[{id:h,label:s.i18n.translate("xpack.dataVisualizer.index.fullTimeRangeSelector.useFullDataExcludingFrozenMenuLabel",{defaultMessage:"Exclude frozen data tier"})},{id:"include-frozen",label:s.i18n.translate("xpack.dataVisualizer.index.fullTimeRangeSelector.useFullDataIncludingFrozenMenuLabel",{defaultMessage:"Include frozen data tier"})}]),[]),_=Object(r.useMemo)((()=>Object(b.jsx)(i.EuiPanel,null,Object(b.jsx)(i.EuiRadioGroup,{options:E,idSelected:x,onChange:O,compressed:!0}))),[E,x,O]),w=Object(r.useMemo)((()=>x===h?Object(b.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.fullTimeRangeSelector.useFullDataExcludingFrozenButtonTooltip",defaultMessage:"Use full range of data excluding frozen data tier."}):Object(b.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.fullTimeRangeSelector.useFullDataIncludingFrozenButtonTooltip",defaultMessage:"Use full range of data including frozen data tier, which might have slower search results."})),[x]);return Object(b.jsx)(i.EuiFlexGroup,{responsive:!1,gutterSize:"xs",alignItems:"center"},Object(b.jsx)(i.EuiToolTip,{content:w},Object(b.jsx)(i.EuiButton,{isDisabled:n,onClick:()=>p(t,a,!0),"data-test-subj":"dataVisualizerButtonUseFullData"},Object(b.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.index.fullTimeRangeSelector.useFullDataButtonLabel",defaultMessage:"Use full data"}))),Object(b.jsx)(i.EuiFlexItem,{grow:!1},Object(b.jsx)(i.EuiPopover,{id:"mlFullTimeRangeSelectorOption",button:Object(b.jsx)(i.EuiButtonIcon,{display:"base",size:"m",iconType:"boxesVertical","aria-label":s.i18n.translate("xpack.dataVisualizer.index.fullTimeRangeSelector.moreOptionsButtonAriaLabel",{defaultMessage:"More options"}),onClick:()=>{y(!v)}}),isOpen:v,closePopover:S,panelPaddingSize:"none",anchorPosition:"downRight"},_)))};var y=a(10),x=a(70),j=a(87),O=a(62),S=a(80),E=a(90);const _=({metricsStats:e,fieldsCountStats:t,showEmptyFields:a,toggleShowEmptyFields:r})=>Object(b.jsx)(i.EuiFlexGroup,{alignItems:"center",gutterSize:"xs","data-test-subj":"dataVisualizerFieldCountPanel",responsive:!1,className:"dvFieldCount__panel"},Object(b.jsx)(E.b,{fieldsCountStats:t}),Object(b.jsx)(E.a,{metricsStats:e}),Object(b.jsx)(i.EuiFlexItem,{className:"dvFieldCount__item"},Object(b.jsx)(i.EuiSwitch,{"data-test-subj":"dataVisualizerShowEmptyFieldsSwitch",label:Object(b.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.showEmptyFields",defaultMessage:"Show empty fields"}),checked:a,onChange:r})));var w=a(27),F=a(41);const N=({width:e,chartPoints:t,timeRangeEarliest:a,timeRangeLatest:n,interval:i})=>{const{services:{data:o,uiSettings:l,fieldFormats:u,charts:d}}=Object(g.a)(),f=d.theme.useChartsTheme(),p=d.theme.useChartsBaseTheme(),m=u.deserialize({id:"date"}),h=l.get("visualization:useLegacyTimeAxis",!1),v=s.i18n.translate("xpack.dataVisualizer.dataGrid.field.documentCountChart.seriesLabel",{defaultMessage:"document count"}),y={min:a,max:n},x=Object(r.useMemo)((()=>t.length<1?[{time:a,value:0}]:1===t.length?[...t,{time:i?Number(t[0].time)+i:a,value:0}]:t),[t,a,n,i]),j=Object(r.useCallback)((e=>{o.query.timefilter.timefilter.setTime({from:c()(e.from).toISOString(),to:c()(e.to).toISOString(),mode:"absolute"})}),[o]),O=function(e){return e.isDefault("dateFormat:tz")?c.a.tz.guess()||c()().format("Z"):e.get("dateFormat:tz","Browser")}(l);return Object(b.jsx)("div",{style:{width:null!=e?e:"100%"},"data-test-subj":"dataVisualizerDocumentCountChart"},Object(b.jsx)(w.Chart,{size:{width:"100%",height:120}},Object(b.jsx)(w.Settings,{xDomain:y,onBrushEnd:({x:e})=>{if(!e)return;const[t,a]=e;j({from:t,to:a})},onElementClick:([e])=>{const t=e[0].x;j({from:t,to:t+i})},theme:f,baseTheme:p}),Object(b.jsx)(w.Axis,{id:"bottom",position:w.Position.Bottom,showOverlappingTicks:!0,tickFormat:e=>m.convert(e),timeAxisLayerCount:h?0:2,style:h?{}:F.MULTILAYER_TIME_AXIS_STYLE}),Object(b.jsx)(w.Axis,{id:"left",position:w.Position.Left}),Object(b.jsx)(w.BarSeries,{id:"document_count",name:v,xScaleType:w.ScaleType.Time,yScaleType:w.ScaleType.Linear,xAccessor:"time",yAccessors:["value"],data:x,timeZone:O})))},T=({totalCount:e})=>Object(b.jsx)(i.EuiFlexItem,null,Object(b.jsx)(i.EuiText,{size:"s","data-test-subj":"dataVisualizerTotalDocCountHeader"},Object(b.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.totalDocCountLabel",defaultMessage:"Total documents: {strongTotalCount}",values:{strongTotalCount:Object(b.jsx)("strong",{"data-test-subj":"dataVisualizerTotalDocCount"},Object(b.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.totalDocCountNumber",defaultMessage:"{totalCount, plural, one {#} other {#}}",values:{totalCount:e}}))}}))),A=({documentCountStats:e,totalCount:t})=>{if(void 0===e)return void 0!==t?Object(b.jsx)(T,{totalCount:t}):null;const{timeRangeEarliest:a,timeRangeLatest:r}=e;if(void 0===a||void 0===r)return Object(b.jsx)(T,{totalCount:t});let i=[];if(void 0!==e.buckets){const t=null==e?void 0:e.buckets;i=Object.entries(t).map((([e,t])=>({time:+e,value:t})))}return Object(b.jsx)(n.a.Fragment,null,Object(b.jsx)(T,{totalCount:t}),Object(b.jsx)(N,{chartPoints:i,timeRangeEarliest:a,timeRangeLatest:r,interval:e.interval}))};var M=a(4),z=a(58);const I=[1e3,5e3,1e4,1e5,-1].map((e=>({value:String(e),inputDisplay:e>0?Object(b.jsx)("span",{"data-test-subj":`dataVisualizerShardSizeOption ${e}`},Object(b.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.sampleSizeOptionLabel",defaultMessage:"Sample size (per shard): {wrappedValue}",values:{wrappedValue:Object(b.jsx)("b",null,e)}})):Object(b.jsx)("span",{"data-test-subj":"dataVisualizerShardSizeOption all"},Object(b.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.allOptionLabel",defaultMessage:"Search all"}))}))),C=({samplerShardSize:e,setSamplerShardSize:t})=>Object(b.jsx)(i.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(b.jsx)(i.EuiFlexItem,{grow:!1,style:{width:310}},Object(b.jsx)(i.EuiSuperSelect,{options:I,valueOfSelected:String(e),onChange:e=>t(+e),"aria-label":s.i18n.translate("xpack.dataVisualizer.searchPanel.sampleSizeAriaLabel",{defaultMessage:"Select number of documents to sample"}),"data-test-subj":"dataVisualizerShardSizeSelect"})),Object(b.jsx)(i.EuiFlexItem,{grow:!1},Object(b.jsx)(i.EuiIconTip,{content:s.i18n.translate("xpack.dataVisualizer.searchPanel.queryBarPlaceholder",{defaultMessage:"Selecting a smaller sample size will reduce query run times and the load on the cluster."}),position:"right"})));var V=a(65);const k=({overallStats:e,setVisibleFieldNames:t,visibleFieldNames:a,showEmptyFields:n})=>{const i=Object(r.useMemo)((()=>{const t=[];return e&&Object.keys(e).forEach((a=>{const r=e[a];Array.isArray(r)&&r.length>0&&r.forEach((e=>{!0!==e.existsInDocs&&!0!==n||void 0===e.fieldName?t.push({value:e.fieldName,disabled:!0}):t.push({value:e.fieldName})}))})),t}),[e,n]),o=Object(r.useMemo)((()=>s.i18n.translate("xpack.dataVisualizer.index.fieldNameSelect",{defaultMessage:"Field name"})),[]);return Object(b.jsx)(V.a,{title:o,options:i,onChange:t,checkedOptions:a,dataTestSubj:"dataVisualizerFieldNameSelect"})};var R=a(71);const P=({indexedFieldTypes:e,setVisibleFieldTypes:t,visibleFieldTypes:a})=>{const n=Object(r.useMemo)((()=>e.map((e=>{var t;const a=null!==(t=z.b[e])&&void 0!==t?t:"";return{value:e,name:Object(b.jsx)(i.EuiFlexGroup,null,Object(b.jsx)(i.EuiFlexItem,{grow:!0}," ",a),e&&Object(b.jsx)(i.EuiFlexItem,{grow:!1},Object(b.jsx)(R.a,{type:e,tooltipEnabled:!1})))}}))),[e]),o=Object(r.useMemo)((()=>s.i18n.translate("xpack.dataVisualizer.index.fieldTypeSelect",{defaultMessage:"Field type"})),[]);return Object(b.jsx)(V.a,{title:o,options:n,onChange:t,checkedOptions:a,dataTestSubj:"dataVisualizerFieldTypeSelect"})};a(127);var q=a(69);const L=({dataView:e,searchString:t,searchQueryLanguage:a,samplerShardSize:n,setSamplerShardSize:o,overallStats:l,indexedFieldTypes:u,setVisibleFieldTypes:c,visibleFieldTypes:d,setVisibleFieldNames:f,visibleFieldNames:p,setSearchParams:m,showEmptyFields:h})=>{const{services:{uiSettings:v,notifications:{toasts:y},data:{query:x},unifiedSearch:{ui:{SearchBar:j}}}}=Object(g.a)(),[O,S]=Object(r.useState)({query:t||"",language:a});Object(r.useEffect)((()=>{S({query:t||"",language:a})}),[a,t,x.filterManager]);const E=({query:t,filters:a})=>{const r=null!=t?t:O,n=null!=a?a:x.filterManager.getFilters();try{var i;n&&x.filterManager.setFilters(n);const t=Object(q.a)(r,null!==(i=x.filterManager.getFilters())&&void 0!==i?i:[],e,v);m({searchQuery:t,searchString:r.query,queryLanguage:r.language,filters:n})}catch(e){console.log("Invalid syntax",JSON.stringify(e,null,2)),y.addError(e,{title:s.i18n.translate("xpack.dataVisualizer.searchPanel.invalidSyntax",{defaultMessage:"Invalid syntax"})})}};return Object(b.jsx)(i.EuiFlexGroup,{gutterSize:"s","data-test-subj":"dataVisualizerSearchPanel",className:"dvSearchPanel__container",responsive:!1},Object(b.jsx)(i.EuiFlexItem,{grow:9,className:"dvSearchBar"},Object(b.jsx)(j,{dataTestSubj:"dataVisualizerQueryInput",appName:"dataVisualizer",showFilterBar:!0,showDatePicker:!1,showQueryInput:!0,query:O,onQuerySubmit:e=>E({query:e.query}),onFiltersUpdated:e=>E({filters:e}),indexPatterns:[e],placeholder:s.i18n.translate("xpack.dataVisualizer.searchPanel.queryBarPlaceholderText",{defaultMessage:'Search… (e.g. status:200 AND extension:"PHP")'}),displayStyle:"inPage",isClearable:!0,customSubmitButton:Object(b.jsx)("div",null)})),Object(b.jsx)(i.EuiFlexItem,{grow:2,className:"dvSearchPanel__controls"},Object(b.jsx)(C,{samplerShardSize:n,setSamplerShardSize:o}),Object(b.jsx)(k,{overallStats:l,setVisibleFieldNames:f,visibleFieldNames:p,showEmptyFields:h}),Object(b.jsx)(P,{indexedFieldTypes:u,setVisibleFieldTypes:c,visibleFieldTypes:d})))};var D=a(67),B=a.n(D);const Q=({icon:e,iconAreaLabel:t,title:a,description:r,onClick:n,href:s,isDisabled:o,"data-test-subj":l})=>{const u={...s?{href:s}:{},...n?{onClick:n}:{}};return Object(b.jsx)(i.EuiPanel,{style:{cursor:o?"not-allowed":void 0},hasShadow:!1,hasBorder:!0},Object(b.jsx)(i.EuiLink,B()({style:{display:"block",pointerEvents:o?"none":void 0,background:"transparent",outline:"none"},"data-test-subj":l,color:"subdued"},u),Object(b.jsx)(i.EuiFlexGroup,{gutterSize:"l",responsive:!0},Object(b.jsx)(i.EuiFlexItem,{grow:!1,style:{paddingTop:"8px"}},"string"==typeof e?Object(b.jsx)(i.EuiIcon,{size:"xl",type:e,"aria-label":t}):e),Object(b.jsx)(i.EuiFlexItem,null,Object(b.jsx)(i.EuiTitle,{size:"s"},Object(b.jsx)("h3",null,a)),Object(b.jsx)(i.EuiText,{color:"subdued"},Object(b.jsx)("p",null,r))))))};var U=a(79);const $=({dataView:e,searchString:t,searchQueryLanguage:a,getAdditionalLinks:o})=>{const[u]=Object(y.f)("_g"),[c,d]=Object(r.useState)(""),[f,m]=Object(r.useState)(),{services:{data:h,application:{capabilities:v},discover:x}}=Object(g.a)();return Object(r.useEffect)((()=>{let r=!1;const n=e.id,i=e.title;return Array.isArray(o)&&void 0!==n&&Promise.all(o.map((async e=>{const t=await e({dataViewId:n,dataViewTitle:i});if(Array.isArray(t))return await Promise.all(t.map((async e=>({...e,canDisplay:await e.canDisplay(),href:await e.getUrl()}))))}))).then((e=>{m(Object(p.flatten)(e).filter(U.a).filter((e=>!0===e.canDisplay)))})),(async()=>{var e,i,s;if(null===(e=null===(i=v.discover)||void 0===i?void 0:i.show)||void 0===e||!e)return;if(!x.locator)return void console.error("Discover locator not available");const o=await x.locator.getUrl({indexPatternId:n,filters:null!==(s=h.query.filterManager.getFilters())&&void 0!==s?s:[],query:t&&void 0!==a?{query:t,language:a}:void 0,timeRange:null!=u&&u.time?u.time:void 0,refreshInterval:null!=u&&u.refreshInterval?u.refreshInterval:void 0});r||d(o)})(),()=>{r=!0}}),[e,t,a,u,v,x,h.query,o]),Object(b.jsx)("div",{"data-test-subj":"dataVisualizerActionsPanel"},c&&Object(b.jsx)(n.a.Fragment,null,Object(b.jsx)(i.EuiTitle,{size:"s"},Object(b.jsx)("h2",null,Object(b.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.index.actionsPanel.exploreTitle",defaultMessage:"Explore your data"}))),Object(b.jsx)(i.EuiSpacer,{size:"m"}),Object(b.jsx)(Q,{href:c,icon:"discoverApp",description:s.i18n.translate("xpack.dataVisualizer.index.actionsPanel.viewIndexInDiscoverDescription",{defaultMessage:"Explore the documents in your index."}),title:Object(b.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.index.actionsPanel.discoverAppTitle",defaultMessage:"Discover"}),"data-test-subj":"dataVisualizerViewInDiscoverCard"}),Object(b.jsx)(i.EuiSpacer,{size:"m"})),Array.isArray(f)&&f.map((e=>Object(b.jsx)(n.a.Fragment,null,Object(b.jsx)(Q,{href:e.href,icon:e.icon,description:e.description,title:e.title,"data-test-subj":e["data-test-subj"]}),Object(b.jsx)(i.EuiSpacer,{size:"m"})))))};var G=a(23),H=a(63);function W(e){H.a.next({lastRefresh:Date.now(),timeRange:e})}const K=()=>{var e;const{services:t}=Object(g.a)(),a=t.uiSettings,{timefilter:n,history:s}=t.data.query.timefilter,[l,u]=Object(y.f)("_g"),c=(d=s,function(){var e,t;return null!==(e=null===(t=d.get())||void 0===t?void 0:t.map((({from:e,to:t})=>({start:e,end:t}))))&&void 0!==e?e:[]});var d;const f=null!==(e=null==l?void 0:l.refreshInterval)&&void 0!==e?e:n.getRefreshInterval(),m=Object(r.useCallback)(Object(p.debounce)((e=>{u("refreshInterval",e,!0)}),200),[u]),[h,v]=Object(r.useState)(n.getTime()),[x,j]=Object(r.useState)(c()),[O,S]=Object(r.useState)(n.isAutoRefreshSelectorEnabled()),[E,_]=Object(r.useState)(n.isTimeRangeSelectorEnabled()),w=a.get("dateFormat"),F=a.get(o.UI_SETTINGS.TIMEPICKER_QUICK_RANGES),N=Object(r.useMemo)((()=>F.map((({from:e,to:t,display:a})=>({start:e,end:t,label:a})))),[F]);Object(r.useEffect)((()=>{const e=new G.Subscription,t=n.getRefreshIntervalUpdate$();void 0!==t&&e.add(t.subscribe((e=>{m(n.getRefreshInterval())})));const a=n.getTimeUpdate$();void 0!==a&&e.add(a.subscribe((e=>{v(n.getTime())})));const r=n.getEnabledUpdated$();return void 0!==r&&e.add(r.subscribe((e=>{S(n.isAutoRefreshSelectorEnabled()),_(n.isTimeRangeSelectorEnabled())}))),function(){e.unsubscribe()}}),[m,n]);const T=f.pause||!f.pause&&!f.value;return O||E?Object(b.jsx)("div",{className:"mlNavigationMenu__datePickerWrapper"},Object(b.jsx)(i.EuiSuperDatePicker,{start:h.from,end:h.to,isPaused:T,isAutoRefreshOnly:!E,refreshInterval:f.value,onTimeChange:function({start:e,end:t}){const a={from:e,to:t};n.setTime(a),v(a),j(c())},onRefresh:W,onRefreshChange:function({isPaused:e,refreshInterval:t}){m({pause:e,value:t})},recentlyUsedRanges:x,dateFormat:w,commonlyUsedRanges:N})):null};var Y=a(83);const Z=n.a.memo((({docLink:e})=>{const{chrome:t}=Object(g.a)().services;return Object(r.useEffect)((()=>{t.setHelpExtension({appName:Y.a,links:[{href:e,linkType:"documentation"}]})}),[t,e]),null}));function J(e){const{services:{dataViewFieldEditor:t,application:a}}=Object(g.a)(),{useNewFieldsApi:n,currentDataView:o}=e,l=!!(null==t?void 0:t.userPermissions.editIndexPattern())&&n,[u,c]=Object(r.useState)(!1),d=Object(r.useRef)();return Object(r.useEffect)((()=>()=>{d.current&&d.current()}),[]),void 0!==t&&o&&l?Object(b.jsx)(i.EuiPopover,{panelPaddingSize:"s",isOpen:u,closePopover:()=>{c(!1)},ownFocus:!0,"data-test-subj":"dataVisualizerDataViewManagementPopover",button:Object(b.jsx)(i.EuiButtonIcon,{color:"text",iconType:"boxesHorizontal","data-test-subj":"dataVisualizerDataViewManagementButton","aria-label":s.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.actionsPopoverLabel",{defaultMessage:"Data view settings"}),onClick:()=>{c(!u)}})},Object(b.jsx)(i.EuiContextMenuPanel,{"data-test-subj":"dataVisualizerDataViewManagementMenu",size:"s",items:[Object(b.jsx)(i.EuiContextMenuItem,{key:"add",icon:"indexOpen","data-test-subj":"dataVisualizerAddDataViewFieldAction",onClick:()=>{c(!1),d.current=t.openEditor({ctx:{dataView:o},onSave:()=>{const e={lastRefresh:Date.now()};H.a.next(e)}})}},s.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.addFieldButton",{defaultMessage:"Add field to data view"})),Object(b.jsx)(i.EuiContextMenuItem,{key:"manage",icon:"indexSettings","data-test-subj":"dataVisualizerManageDataViewAction",onClick:()=>{var t;c(!1),a.navigateToApp("management",{path:`/kibana/dataViews/dataView/${null===(t=e.currentDataView)||void 0===t?void 0:t.id}`})}},s.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.manageFieldButton",{defaultMessage:"Manage data view fields"}))]})):null}Z.displayName="HelpMenu";var X=a(85);a(138);const ee={match_all:{}};function te(){return{overallStats:{totalCount:0,aggregatableExistsFields:[],aggregatableNotExistsFields:[],nonAggregatableExistsFields:[],nonAggregatableNotExistsFields:[]},metricConfigs:[],totalMetricFieldCount:0,populatedMetricFieldCount:0,metricsLoaded:!1,nonMetricConfigs:[],nonMetricsLoaded:!1,documentCountStats:void 0}}const ae=e=>({pageIndex:0,pageSize:25,sortField:"fieldName",sortDirection:"asc",visibleFieldTypes:[],visibleFieldNames:[],samplerShardSize:5e3,searchString:"",searchQuery:ee,searchQueryLanguage:S.a.KUERY,filters:[],showDistributions:!0,showAllFields:!1,showEmptyFields:!1,...e}),re=ae(),ne=e=>{var t,a,n,l,u;const{services:c}=Object(g.a)(),{docLinks:d,notifications:f,uiSettings:p,data:m}=c,{toasts:h}=f,[S,E]=Object(y.e)(O.a,re),[w,F]=Object(y.f)("_g"),[N,T]=Object(r.useState)(e.currentSavedSearch),{currentDataView:I,currentSessionId:C,getAdditionalLinks:V}=e;Object(r.useEffect)((()=>{void 0!==(null==e?void 0:e.currentSavedSearch)&&T(null==e?void 0:e.currentSavedSearch)}),[null==e?void 0:e.currentSavedSearch]),Object(r.useEffect)((()=>{I.isTimeBased()||h.addWarning({title:s.i18n.translate("xpack.dataVisualizer.index.dataViewNotBasedOnTimeSeriesNotificationTitle",{defaultMessage:"The data view {dataViewTitle} is not based on a time series",values:{dataViewTitle:I.title}}),text:s.i18n.translate("xpack.dataVisualizer.index.dataViewNotBasedOnTimeSeriesNotificationDescription",{defaultMessage:"Anomaly detection only runs over time-based indices"})})}),[I,h]);const k=I.fields,R=Object(r.useMemo)((()=>{const e=[];return k.forEach((t=>{if(!M.h.includes(t.name)&&!0!==t.scripted){const a=Object(z.c)(t);void 0===a||e.includes(a)||e.push(a)}})),e.sort()}),[k]),P=Object(r.useCallback)((e=>{null!==N&&T(null),E({...S,searchQuery:e.searchQuery,searchString:e.searchString,searchQueryLanguage:e.queryLanguage,filters:e.filters})}),[N,S,E]),D=null!==(t=S.samplerShardSize)&&void 0!==t?t:re.samplerShardSize,B=null!==(a=S.visibleFieldTypes)&&void 0!==a?a:re.visibleFieldTypes,Q=null!==(n=S.visibleFieldNames)&&void 0!==n?n:re.visibleFieldNames,U=null!==(l=S.showEmptyFields)&&void 0!==l?l:re.showEmptyFields,G=Object(r.useMemo)((()=>({dataView:I,savedSearch:N,sessionId:C,visibleFieldNames:Q,allowEditDataView:!0})),[I.id,null==N?void 0:N.id,Q,C]),{configs:H,searchQueryLanguage:W,searchString:Y,overallStats:ee,searchQuery:te,documentCountStats:ae,metricsStats:ne,timefilter:ie,setLastRefresh:se,progress:oe,extendedColumns:le}=Object(X.a)(G,S,F);Object(r.useEffect)((()=>()=>{m.query.filterManager.removeAll()}),[I.id,m.query.filterManager]),Object(r.useEffect)((()=>{se(Date.now())}),[I.id,se]),Object(r.useEffect)((()=>{void 0!==(null==w?void 0:w.time)&&ie.setTime({from:w.time.from,to:w.time.to})}),[JSON.stringify(null==w?void 0:w.time),ie]),Object(r.useEffect)((()=>{void 0!==(null==w?void 0:w.refreshInterval)&&ie.setRefreshInterval(w.refreshInterval)}),[JSON.stringify(null==w?void 0:w.refreshInterval),ie]);const ue=Object(r.useCallback)(((e,t,a)=>{var r;const n=Object(o.generateFilters)(m.query.filterManager,e,t,a,String(I.id));n&&m.query.filterManager.addFilters(n);const i={query:Y||"",language:W},s=Object(q.a)({query:Y||"",language:W},null!==(r=m.query.filterManager.getFilters())&&void 0!==r?r:[],I,p);P({searchQuery:s,searchString:i.query,queryLanguage:i.language,filters:m.query.filterManager.getFilters()})}),[I,m.query.filterManager,W,Y,P,p]),ce=Object(r.useMemo)((()=>{let e=0,t=0;return Object.keys(ee).forEach((e=>{const a=ee[e];Array.isArray(a)&&a.length>0&&(t+=a.length)})),e=!0===U?t:ee.aggregatableExistsFields.length+ee.nonAggregatableExistsFields.length,{visibleFieldsCount:e,totalFieldsCount:t}}),[ee,U]),de=Object(r.useCallback)((function(e,t){return e.reduce(((e,a)=>{const r=t.find((e=>e.fieldName===a));return void 0!==r&&(e[a]=Object(b.jsx)(j.a,{item:r,dataView:I,combinedQuery:{searchQueryLanguage:W,searchString:Y},onAddFilter:ue})),e}),{})}),[I,W,Y,ue]),fe=Object(r.useRef)();Object(r.useEffect)((()=>{const e=fe;return()=>{e.current&&e.current()}}),[]),Object(r.useEffect)((()=>{null==m||m.query.queryString.setQuery({query:Y,language:W})}),[m,W,Y]);const pe=d.links.ml.guide;return Object(b.jsx)(r.Fragment,null,Object(b.jsx)(i.EuiPageBody,{"data-test-subj":"dataVisualizerIndexPage",paddingSize:"none",panelled:!1},Object(b.jsx)(i.EuiFlexGroup,{gutterSize:"m"},Object(b.jsx)(i.EuiFlexItem,null,Object(b.jsx)(i.EuiPageContentHeader,{className:"dataVisualizerPageHeader"},Object(b.jsx)(i.EuiPageContentHeaderSection,null,Object(b.jsx)("div",{className:"dataViewTitleHeader"},Object(b.jsx)(i.EuiTitle,null,Object(b.jsx)("h1",null,I.title)),Object(b.jsx)(J,{currentDataView:I,useNewFieldsApi:!0}))),Object(b.jsx)(i.EuiFlexGroup,{alignItems:"center",justifyContent:"flexEnd",gutterSize:"s","data-test-subj":"dataVisualizerTimeRangeSelectorSection"},void 0!==I.timeFieldName&&Object(b.jsx)(i.EuiFlexItem,{grow:!1},Object(b.jsx)(v,{dataView:I,query:void 0,disabled:!1,timefilter:ie})),Object(b.jsx)(i.EuiFlexItem,{grow:!1},Object(b.jsx)(K,null)))))),Object(b.jsx)(i.EuiSpacer,{size:"m"}),Object(b.jsx)(i.EuiPageContentBody,null,Object(b.jsx)(i.EuiFlexGroup,{gutterSize:"m"},Object(b.jsx)(i.EuiFlexItem,null,Object(b.jsx)(i.EuiPanel,{hasShadow:!1,hasBorder:!0},void 0!==(null==ee?void 0:ee.totalCount)&&Object(b.jsx)(i.EuiFlexItem,{grow:!0},Object(b.jsx)(A,{documentCountStats:ae,totalCount:ee.totalCount})),Object(b.jsx)(L,{dataView:I,searchString:Y,searchQuery:te,searchQueryLanguage:W,setSearchParams:P,samplerShardSize:D,setSamplerShardSize:e=>{E({...S,samplerShardSize:e})},overallStats:ee,indexedFieldTypes:R,setVisibleFieldTypes:e=>{E({...S,visibleFieldTypes:e})},visibleFieldTypes:B,visibleFieldNames:Q,setVisibleFieldNames:e=>{E({...S,visibleFieldNames:e})},showEmptyFields:U,onAddFilter:ue}),Object(b.jsx)(i.EuiSpacer,{size:"m"}),Object(b.jsx)(_,{showEmptyFields:U,toggleShowEmptyFields:()=>{E({...S,showEmptyFields:!S.showEmptyFields})},fieldsCountStats:ce,metricsStats:ne}),Object(b.jsx)(i.EuiSpacer,{size:"m"}),Object(b.jsx)(i.EuiProgress,{value:oe,max:100,size:"xs"}),Object(b.jsx)(x.a,{items:H,pageState:S,updatePageState:E,getItemIdToExpandedRowMap:de,extendedColumns:le,loading:oe<100,showPreviewByDefault:null===(u=S.showDistributions)||void 0===u||u,onChange:E}))),Object(b.jsx)(i.EuiFlexItem,{grow:!1,style:{width:"280px"}},Object(b.jsx)($,{dataView:I,searchQueryLanguage:W,searchString:Y,getAdditionalLinks:V}))))),Object(b.jsx)(Z,{docLink:pe}))}},62:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return n}));const r="DATA_VISUALIZER_INDEX_VIEWER",n=10},63:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r=new(a(23).Subject)},68:function(e,t,a){e.exports=a(13)(23)},69:function(e,t,a){"use strict";a.d(t,"a",(function(){return tt})),a.d(t,"b",(function(){return at}));var r={};a.r(r),a.d(r,"buildNode",(function(){return P})),a.d(r,"toElasticsearchQuery",(function(){return q}));var n={};a.r(n),a.d(n,"wildcardSymbol",(function(){return L})),a.d(n,"buildNode",(function(){return Q})),a.d(n,"test",(function(){return U})),a.d(n,"toElasticsearchQuery",(function(){return $})),a.d(n,"toQueryStringQuery",(function(){return G})),a.d(n,"hasLeadingWildcard",(function(){return H}));var i={};a.r(i),a.d(i,"buildNodeParams",(function(){return ee})),a.d(i,"toElasticsearchQuery",(function(){return te}));var s={};a.r(s),a.d(s,"buildNodeParams",(function(){return ae})),a.d(s,"toElasticsearchQuery",(function(){return re}));var o={};a.r(o),a.d(o,"buildNodeParams",(function(){return ne})),a.d(o,"toElasticsearchQuery",(function(){return ie}));var l={};a.r(l),a.d(l,"buildNodeParams",(function(){return se})),a.d(l,"toElasticsearchQuery",(function(){return oe}));var u={};a.r(u),a.d(u,"buildNodeParams",(function(){return le})),a.d(u,"toElasticsearchQuery",(function(){return ue}));var c={};a.r(c),a.d(c,"buildNodeParams",(function(){return ce})),a.d(c,"toElasticsearchQuery",(function(){return de}));var d={};a.r(d),a.d(d,"buildNodeParams",(function(){return fe})),a.d(d,"toElasticsearchQuery",(function(){return pe}));var f={};a.r(f),a.d(f,"buildNode",(function(){return ge})),a.d(f,"buildNodeWithArgumentNodes",(function(){return be})),a.d(f,"toElasticsearchQuery",(function(){return he}));var p,m,g=a(22),b=a.n(g),h=a(2),v=a.n(h),y=a(51),x=a.n(y),j=a(81),O=a.n(j),S=function(e,t){if("boolean"!=typeof t&&"boolean"===e.type){if([1,"true"].includes(t))return!0;if([0,"false"].includes(t))return!1;throw new Error("".concat(t," is not a valid boolean value for boolean field ").concat(e.name))}return"number"!=typeof t&&"number"===e.type?Number(t):t},E=function(e,t){var a=S(e,t);return{script:{source:_(e),lang:e.lang,params:{value:a}}}},_=function(e){return"painless"===e.lang?"boolean compare(Supplier s, def v) {return s.get() == v;}"+"compare(() -> { ".concat(e.script," }, params.value);"):"(".concat(e.script,") == value")};!function(e){e.CUSTOM="custom",e.PHRASES="phrases",e.PHRASE="phrase",e.EXISTS="exists",e.MATCH_ALL="match_all",e.QUERY_STRING="query_string",e.RANGE="range",e.RANGE_FROM_VALUE="range_from_value",e.SPATIAL_FILTER="spatial_filter"}(p||(p={})),function(e){e.APP_STATE="appState",e.GLOBAL_STATE="globalState"}(m||(m={}));var w={gt:">",gte:">=",lte:"<=",lt:"<"},F={gt:"boolean gt(Supplier s, def v) {return s.get() > v}",gte:"boolean gte(Supplier s, def v) {return s.get() >= v}",lte:"boolean lte(Supplier s, def v) {return s.get() <= v}",lt:"boolean lt(Supplier s, def v) {return s.get() < v}"},N={gt:"boolean gt(Supplier s, def v) {return s.get().toInstant().isAfter(Instant.parse(v))}",gte:"boolean gte(Supplier s, def v) {return !s.get().toInstant().isBefore(Instant.parse(v))}",lte:"boolean lte(Supplier s, def v) {return !s.get().toInstant().isAfter(Instant.parse(v))}",lt:"boolean lt(Supplier s, def v) {return s.get().toInstant().isBefore(Instant.parse(v))}"},T=function(e,t){var a=Object(g.mapValues)(Object(g.pickBy)(t,(function(e,t){return t in w})),(function(t){return"number"===e.type&&"string"==typeof t?parseFloat(t):t})),r=Object(g.map)(a,(function(t,a){return"("+e.script+")"+Object(g.get)(w,a)+a})).join(" && ");if("painless"===e.lang){var n="date"===e.type?N:F,i=Object(g.reduce)(a,(function(e,t,a){return e.concat(Object(g.get)(n,a))}),[]).join(" "),s=Object(g.map)(a,(function(t,a){return"".concat(a,"(() -> { ").concat(e.script," }, params.").concat(a,")")})).join(" && ");r="".concat(i).concat(s)}return{script:{source:r,params:a,lang:e.lang}}},A=function(e){return function(e){return Object(g.has)(e,"query.exists")}(e)?function(e){return e.query.exists&&e.query.exists.field}(e):function(e){var t=Object(g.has)(e,"query.match_phrase"),a=Object(g.get)(e,"query.match",[]),r=void 0!==Object.values(a).find((function(e){return"phrase"===e.type}));return t||r}(e)?function(e){var t,a,r=null!==(t=null!==(a=e.query.match_phrase)&&void 0!==a?a:e.query.match)&&void 0!==t?t:{};return Object.keys(r)[0]}(e):function(e){var t;return(null==e||null===(t=e.meta)||void 0===t?void 0:t.type)===p.PHRASES}(e)?function(e){return e.meta.key}(e):function(e){return Object(g.has)(e,"query.range")}(e)?function(e){return e.query.range&&Object.keys(e.query.range)[0]}(e):void 0},M=function(e){return Object(g.get)(e,"meta.disabled",!1)},z=function(e){return Object(g.omit)(e,["meta","$state"])};function I(e,t){if(function(e){var t,a,r=Object.keys(null!==(t=e.match||(null===(a=e.query)||void 0===a?void 0:a.match))&&void 0!==t?t:{})[0];return Boolean(r&&("phrase"===Object(g.get)(e,["query","match",r,"type"])||"phrase"===Object(g.get)(e,["match",r,"type"])))}(e)){var a=e.match||e.query.match,r=Object.keys(a)[0],n=Object(g.get)(a,[r]),i=n.query;if(t){var s=t.fields.find((function(e){return e.name===r}));s&&(i=S(s,n.query))}return{meta:e.meta,$state:e.$state,query:{match_phrase:v()({},r,Object(g.omit)(x()(x()({},n),{},{query:i}),"type"))}}}return e.query?e=Object(g.pick)(e,["meta","query","$state"]):e.query={},e.exists&&(e.query.exists=e.exists,delete e.exists),e.range&&(e.query.range=e.range,delete e.range),e.match_all&&(e.query.match_all=e.match_all,delete e.match_all),Object.keys(e).forEach((function(t){"meta"!==t&&"query"!==t&&"$state"!==t&&(e.query[t]=e[t],delete e[t])})),e}var C=a(68),V=a.n(C),k=a(59),R=a.n(k);function P(e){return{type:"literal",value:e}}function q(e){return e.value}var L="@kuery-wildcard@";function D(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function B(e){return e.replace(/[+-=&|><!(){}[\]^"~*?:\\/]/g,"\\$&")}function Q(e){return e.includes(L)?{type:"wildcard",value:e}:Re(e)}function U(e,t){var a=e.value.split(L).map(D).join("[\\s\\S]*");return new RegExp("^".concat(a,"$")).test(t)}function $(e){return e.value.split(L).join("*")}function G(e){return e.value.split(L).map(B).join("*")}function H(e){var t=e.value;return t.startsWith(L)&&t.replace(L,"").length>0}function W(e,t){if(!t)return[];if("literal"===e.type){var a=q(e),r=t.fields.find((function(e){return e.name===a}));return r?[r]:[]}return"wildcard"===e.type?t.fields.filter((function(t){return U(e,t.name)})):void 0}var K=a(42),Y=a.n(K);function Z(e){var t=Y.a.tz.guess();return"Browser"===e?t:e}function J(e){return function(e){var t,a=null==e?void 0:e.subType;return!(null==a||null===(t=a.nested)||void 0===t||!t.path)}(e)?e.subType:void 0}function X(e,t,a){var r=x()(x()({},e),{},{value:a?"".concat(a,".").concat(e.value):e.value});if(!t||"wildcard"===r.type&&!a)return r;var n=W(r,t).reduce((function(e,t){var r=J(t),n=null==r?void 0:r.nested.path;return a&&!n?[].concat(V()(e),["".concat(t.name,' is not a nested field but is in nested group "').concat(a,'" in the KQL expression.')]):n&&!a?[].concat(V()(e),["".concat(t.name," is a nested field, but is not in a nested group in the KQL expression.")]):n!==a?[].concat(V()(e),["Nested field ".concat(t.name," is being queried with the incorrect nested path. The correct path is ").concat(null==r?void 0:r.nested.path,".")]):e}),[]);if(n.length>0)throw new Error(n.join("\n"));return r}function ee(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Object(g.isUndefined)(e))throw new Error("fieldName is a required argument");if(Object(g.isUndefined)(t))throw new Error("value is a required argument");var r="string"==typeof e?Re(e):P(e),n="string"==typeof t?Re(t):P(t),i=P(a);return{arguments:[r,n,i]}}function te(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=R()(e.arguments,3),i=n[0],s=n[1],o=n[2],l="wildcard"===s.type&&s.value===L,u="wildcard"===i.type&&i.value===L,c=l&&u;if(c)return{match_all:{}};var d=X(i,t,null!=r&&r.nested?r.nested.path:void 0),f=Object(g.isUndefined)(s)?s:qe(s),p=o.value?"phrase":"best_fields";if(null===d.value)return"wildcard"===s.type?{query_string:{query:G(s)}}:{multi_match:{type:p,query:f,lenient:!0}};var m=t?W(d,t):[];if(m&&0===m.length&&m.push({name:qe(d),scripted:!1,type:""}),l&&(null==m||!m.length||(null==m?void 0:m.length)===(null==t?void 0:t.fields.length)))return{match_all:{}};var b=m.reduce((function(e,t){var n=function(e){var a=J(t);return"wildcard"!==d.type||null==a||!a.nested||null!=r&&r.nested?e:{nested:{path:a.nested.path,query:e,score_mode:"none"}}};if(!t.scripted){if(l)return[].concat(V()(e),[n({exists:{field:t.name}})]);if("wildcard"===s.type)return[].concat(V()(e),[n({query_string:{fields:[t.name],query:G(s)}})]);if("date"===t.type){var i=a.dateFormatTZ?{time_zone:Z(a.dateFormatTZ)}:{};return[].concat(V()(e),[n({range:v()({},t.name,x()({gte:f,lte:f},i))})])}var o="phrase"===p?"match_phrase":"match";return[].concat(V()(e),[n(v()({},o,v()({},t.name,f)))])}if(!l)return[].concat(V()(e),[{script:x()({},E(t,f))}])}),[]);return{bool:{should:b||[],minimum_should_match:1}}}function ae(e){return{arguments:e}}function re(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=a.filtersInMustClause,i=e.arguments||[],s=n?"must":"filter";return{bool:v()({},s,i.map((function(e){return qe(e,t,a,r)})))}}function ne(e){return{arguments:e}}function ie(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=e.arguments||[];return{bool:{should:n.map((function(e){return qe(e,t,a,r)})),minimum_should_match:1}}}function se(e){return{arguments:[e]}}function oe(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=R()(e.arguments,1),i=n[0];return{bool:{must_not:qe(i,t,a,r)}}}function le(e,t,a){return{arguments:[Re(e),t,ve.literal.buildNode(a)]}}function ue(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=R()(e.arguments,3),i=n[0],s=n[1],o=n[2],l=X(i,t,null!=r&&r.nested?r.nested.path:void 0),u=t?W(l,t):[];u&&0===u.length&&u.push({name:qe(l),scripted:!1,type:""});var c=u.map((function(e){var t=function(t){var a=J(e);return"wildcard"!==l.type||null==a||!a.nested||r.nested?t:{nested:{path:a.nested.path,query:t,score_mode:"none"}}},n=v()({},s,qe(o));if(e.scripted)return{script:T(e,n)};if("date"===e.type){var i=a.dateFormatTZ?{time_zone:Z(a.dateFormatTZ)}:{};return t({range:v()({},e.name,x()(x()({},n),i))})}return t({range:v()({},e.name,n)})}));return{bool:{should:c,minimum_should_match:1}}}function ce(e){return{arguments:[P(e)]}}function de(e,t){var a,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=R()(e.arguments,1),i=n[0],s=x()(x()({},i),{},{value:null!=r&&r.nested?"".concat(r.nested.path,".").concat(i.value):i.value}),o=q(s),l=null==t||null===(a=t.fields)||void 0===a?void 0:a.find((function(e){return e.name===o}));if(null!=l&&l.scripted)throw new Error("Exists query does not support scripted fields");return{exists:{field:o}}}function fe(e,t){return{arguments:["string"==typeof e?Re(e):P(e),t]}}function pe(e,t){var a,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=R()(e.arguments,2),s=i[0],o=i[1],l=qe(s),u=null!=n&&null!==(a=n.nested)&&void 0!==a&&a.path?"".concat(n.nested.path,".").concat(l):l;return{nested:{path:u,query:qe(o,t,r,x()(x()({},n),{},{nested:{path:u}})),score_mode:"none"}}}var me={is:i,and:s,or:o,not:l,range:u,exists:c,nested:d};function ge(e){var t=me[e];if(b.a.isUndefined(t))throw new Error('Unknown function "'.concat(e,'"'));for(var a=arguments.length,r=new Array(a>1?a-1:0),n=1;n<a;n++)r[n-1]=arguments[n];return x()({type:"function",function:e},t.buildNodeParams.apply(t,r))}function be(e,t){if(b.a.isUndefined(me[e]))throw new Error('Unknown function "'.concat(e,'"'));return{type:"function",function:e,arguments:t}}function he(e,t,a,r){return me[e.function].toElasticsearchQuery(e,t,a,r)}var ve={function:f,literal:r,wildcard:n},ye=a(132),xe=a.n(ye),je=a(133),Oe=a.n(je),Se=a(134),Ee=a.n(Se),_e=a(135),we=a.n(_e),Fe=a(136),Ne=a.n(Fe),Te=a(137),Ae=a.n(Te),Me=a(1),ze=Me.i18n.translate("esQuery.kql.errors.endOfInputText",{defaultMessage:"end of input"}),Ie={fieldName:Me.i18n.translate("esQuery.kql.errors.fieldNameText",{defaultMessage:"field name"}),value:Me.i18n.translate("esQuery.kql.errors.valueText",{defaultMessage:"value"}),literal:Me.i18n.translate("esQuery.kql.errors.literalText",{defaultMessage:"literal"}),whitespace:Me.i18n.translate("esQuery.kql.errors.whitespaceText",{defaultMessage:"whitespace"})},Ce=function(e){we()(a,e);var t=Ne()(a);function a(e,r){var n;Oe()(this,a);var i=e.message;if(e.expected){var s=e.expected.map((function(e){var t,a="other"===(t=e).type?t.description:"literal"===t.type?'"'.concat(t.text,'"'):"end"===t.type?"end of input":t.text||t.description||"";return Ie[a]||a})),o=Object(g.uniq)(s).filter((function(e){return void 0!==e})).sort().join(", ");i=Me.i18n.translate("esQuery.kql.errors.syntaxError",{defaultMessage:"Expected {expectedList} but {foundInput} found.",values:{expectedList:o,foundInput:e.found?'"'.concat(e.found,'"'):ze}})}var l=[i,r,Object(g.repeat)("-",e.location.start.offset)+"^"].join("\n");return n=t.call(this,l),v()(Ee()(n),"shortMessage",void 0),n.name="KQLSyntaxError",n.shortMessage=i,n}return xe()(a)}(Ae()(Error)),Ve=a(82),ke=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ve.parse;if(void 0===e)throw new Error("expression must be a string, got undefined instead");return a(e,x()(x()({},t),{},{helpers:{nodeTypes:ve}}))},Re=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ke(e,x()(x()({},t),{},{startRule:"Literal"}),Ve.parse)},Pe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return ke(e,t,Ve.parse)}catch(t){throw"SyntaxError"===t.name?new Ce(t,e):t}},qe=function e(t,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;if(!t||!t.type||!ve[t.type])return e(ve.function.buildNode("and",[]),a);var i=ve[t.type];return i.toElasticsearchQuery(t,a,r,n)};Object(g.flow)((function(e){return e.replace(/[\\():<>"*]/g,"\\$&")}),(function(e){return e.replace(/(\s+)(and|or)(\s+)/gi,"$1\\$2$3")}),(function(e){return e.replace(/not(\s+)/gi,"\\$&")}),(function(e){return e.replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n")}));var Le=function(){return qe.apply(void 0,arguments)};function De(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=t.map((function(e){return Pe(e.query,{allowLeadingWildcards:a})}));return Be(e,i,{dateFormatTZ:r,filtersInMustClause:n})}function Be(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=ve.function.buildNode("and",t),n=Le(r,e,a);return Object.assign({must:[],filter:[],should:[],must_not:[]},n.bool)}function Qe(e,t){var a,r;return null===(a=e.meta)||void 0===a||!a.key||!t||("custom"===(null===(r=e.meta)||void 0===r?void 0:r.type)?e.meta.index===t.id:t.fields.some((function(t){return t.name===e.meta.key})))}var Ue=function(e,t){if(!t)return e;var a=A(e);if(!a)return e;var r=t.fields.find((function(e){return e.name===a})),n=r&&J(r);if(!n)return e;var i=z(e);return{meta:e.meta,query:{nested:{path:n.nested.path,query:i.query||i}}}},$e=function(e){return function(t){return Object(g.isUndefined)(t.meta)||Object(g.isUndefined)(t.meta.negate)?!e:t.meta&&t.meta.negate===e}},Ge=function(e){return e.query||e},He=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e=e.filter((function(e){return e&&!M(e)}));var r=function(r){return e.filter((function(e){return!!e})).filter($e(r)).filter((function(e){return!a||Qe(e,t)})).map((function(e){return I(e,t)})).map((function(e){return Ue(e,t)})).map(z).map(Ge)};return{must:[],filter:r(!1),should:[],must_not:r(!0)}};function We(e,t,a){return{must:(e||[]).map((function(e){var r=function(e){return Object(g.isString)(e)?""===e.trim()?{match_all:{}}:{query_string:{query:e}}:e}(e.query);return function(e,t,a){return function(e){return Object(g.has)(e,"query_string.query")}(e)&&("string"==typeof t&&(t=JSON.parse(t)),Object(g.extend)(e.query_string,t),a&&Object(g.defaults)(e.query_string,{time_zone:Z(a)})),e}(r,t,a)})),filter:[],should:[],must_not:[]}}function Ke(e){return e.filter((function(e){return!e||"object"!==O()(e)||!Object(g.isEqual)(e,{match_all:{}})}))}var Ye=a(8),Ze=a(80),Je=a(52);const Xe={bool:{must:[{match_all:{}}]}};function et(){return Object(g.cloneDeep)(Xe)}function tt(e,t,a,r){let n=et();if(e&&e.language===Ze.a.KUERY){const r=Pe(e.query);if(""!==e.query&&(n=Le(r,a)),void 0!==n.bool){const e=He(t,a);Array.isArray(n.bool.filter)||(n.bool.filter=void 0===n.bool.filter?[]:[n.bool.filter]),Array.isArray(n.bool.must_not)||(n.bool.must_not=void 0===n.bool.must_not?[]:[n.bool.must_not]),n.bool.filter=[...n.bool.filter,...e.filter],n.bool.must_not=[...n.bool.must_not,...e.must_not]}}else n=function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{allowLeadingWildcards:!1,queryStringOptions:{},ignoreFilterIfFieldNotInIndex:!1};t=Array.isArray(t)?t:[t],a=Array.isArray(a)?a:[a];var n=t.filter((function(e){return Object(g.has)(e,"query")})),i=Object(g.groupBy)(n,"language"),s=De(e,i.kuery,r.allowLeadingWildcards,r.dateFormatTZ,r.filtersInMustClause),o=We(i.lucene,r.queryStringOptions,r.dateFormatTZ),l=He(a,e,r.ignoreFilterIfFieldNotInIndex);return{bool:{must:Ke([].concat(V()(s.must),V()(o.must),V()(l.must))),filter:Ke([].concat(V()(s.filter),V()(o.filter),V()(l.filter))),should:Ke([].concat(V()(s.should),V()(o.should),V()(l.should))),must_not:[].concat(V()(s.must_not),V()(o.must_not),V()(l.must_not))}}}(a,e?[e]:[],t||[],r?Object(Ye.getEsQueryConfig)(r):void 0);return n}function at({dataView:e,uiSettings:t,savedSearch:a,query:r,filters:n,filterManager:i}){if(!e||!a)return;const s=r,o=n;if(a&&"searchSource"in a&&(null==a?void 0:a.searchSource)instanceof Ye.SearchSource&&void 0!==a.searchSource.getParent()&&s){var l,u,c;const e=null!==(l=Object(g.cloneDeep)(null===(u=a.searchSource.getSearchRequestBody())||void 0===u?void 0:u.query))&&void 0!==l?l:et(),t=null===(c=a.searchSource.getField("index"))||void 0===c?void 0:c.timeFieldName;return Array.isArray(e.bool.filter)&&void 0!==t&&(e.bool.filter=e.bool.filter.filter((e=>{var a;return!(e.hasOwnProperty("range")&&null!==(a=e.range)&&void 0!==a&&a.hasOwnProperty(t))}))),{searchQuery:e,searchString:s.query,queryLanguage:s.language}}const d=function(e){var t;const a=(r=e,Object(Je.a)(r,["id","type","attributes"])?null==e||null===(t=e.attributes)||void 0===t?void 0:t.kibanaSavedObjectMeta:null==e?void 0:e.kibanaSavedObjectMeta);var r;const n="string"==typeof(null==a?void 0:a.searchSourceJSON)?JSON.parse(a.searchSourceJSON):void 0;return n&&Array.isArray(n.filter)&&n.filter.forEach((e=>{e.meta.indexRefName=void 0})),n}(a);if(!d&&s)return i&&o&&i.setFilters(o),{searchQuery:tt(s,Array.isArray(o)?o:[],e,t),searchString:s.query,queryLanguage:s.language};if(d){const a=null!=s?s:null==d?void 0:d.query,r=null!=o?o:null==d?void 0:d.filter;return i&&i.setFilters(r),{searchQuery:tt(a,Array.isArray(r)?r:[],e,t),searchString:a.query,queryLanguage:a.language}}}},80:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r={KUERY:"kuery",LUCENE:"lucene"}},81:function(e,t,a){e.exports=a(13)(45)},82:function(e,t,a){"use strict";function r(e,t,a,n){var i=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(i,r.prototype),i.expected=t,i.found=a,i.location=n,i.name="SyntaxError",i}function n(e,t,a){return a=a||" ",e.length>t?e:(t-=e.length,e+(a+=a.repeat(t)).slice(0,t))}!function(e,t){function a(){this.constructor=e}a.prototype=t.prototype,e.prototype=new a}(r,Error),r.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var a,r=null;for(a=0;a<e.length;a++)if(e[a].source===this.location.source){r=e[a].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,s=this.location.source+":"+i.line+":"+i.column;if(r){var o=this.location.end,l=n("",i.line.toString().length),u=r[i.line-1],c=i.line===o.line?o.column:u.length+1;t+="\n --\x3e "+s+"\n"+l+" |\n"+i.line+" | "+u+"\n"+l+" | "+n("",i.column-1)+n("",c-i.column,"^")}else t+="\n at "+s}return t},r.buildMessage=function(e,t){var a={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function s(e){return a[e.type](e)}return"Expected "+function(e){var t,a,r=e.map(s);if(r.sort(),r.length>0){for(t=1,a=1;t<r.length;t++)r[t-1]!==r[t]&&(r[a]=r[t],a++);r.length=a}switch(r.length){case 1:return r[0];case 2:return r[0]+" or "+r[1];default:return r.slice(0,-1).join(", ")+", or "+r[r.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:r,parse:function(e,t){var a,n={},i=(t=void 0!==t?t:{}).grammarSource,s={start:de,Literal:Ee},o=de,l='"',u="\\",c="@kuery-cursor@",d=/^[\\"]/,f=/^[^"]/,p=/^[\\():<>"*{}]/,m=/^[0-9a-f]/i,g=/^[ \t\r\n\xA0]/,b=ie("(",!1),h=ie(")",!1),v=ie(":",!1),y=ie("{",!1),x=ie("}",!1),j=oe("fieldName"),O=oe("value"),S=oe("OR"),E=ie("or",!0),_=oe("AND"),w=ie("and",!0),F=oe("NOT"),N=ie("not",!0),T=oe("literal"),A=ie('"',!1),M=ie("\\",!1),z=se(["\\",'"'],!1,!1),I=se(['"'],!0,!1),C={type:"any"},V=ie("*",!1),k=ie("\\t",!1),R=ie("\\r",!1),P=ie("\\n",!1),q=se(["\\","(",")",":","<",">",'"',"*","{","}"],!1,!1),L=ie("u",!1),D=se([["0","9"],["a","f"]],!1,!0),B=ie("<=",!1),Q=ie(">=",!1),U=ie("<",!1),$=ie(">",!1),G=oe("whitespace"),H=se([" ","\t","\r","\n"," "],!1,!1),W=ie("@kuery-cursor@",!1),K=function(e,t){return t},Y=function(e,t){return t},Z=function(){return ke},J=function(t,a,r){const{start:n,end:i}=ue(ee,X);return{type:"cursor",start:n.offset,end:i.offset-a.length,prefix:t.join(""),suffix:r.join(""),text:e.substring(ee,X).replace(a,"")}},X=0,ee=0,te=[{line:1,column:1}],ae=0,re=[],ne=0;if("startRule"in t){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');o=s[t.startRule]}function ie(e,t){return{type:"literal",text:e,ignoreCase:t}}function se(e,t,a){return{type:"class",parts:e,inverted:t,ignoreCase:a}}function oe(e){return{type:"other",description:e}}function le(t){var a,r=te[t];if(r)return r;for(a=t-1;!te[a];)a--;for(r={line:(r=te[a]).line,column:r.column};a<t;)10===e.charCodeAt(a)?(r.line++,r.column=1):r.column++,a++;return te[t]=r,r}function ue(e,t){var a=le(e),r=le(t);return{source:i,start:{offset:e,line:a.line,column:a.column},end:{offset:t,line:r.line,column:r.column}}}function ce(e){X<ae||(X>ae&&(ae=X,re=[]),re.push(e))}function de(){var e,t,a,r,i,s;for(e=X,t=[],a=Ce();a!==n;)t.push(a),a=Ce();return(a=fe())===n&&(a=null),(r=Te())!==n?(ee=e,i=a,e="cursor"===(s=r).type?{...s,suggestionTypes:["conjunction"]}:null!==i?i:qe.function.buildNode("is","*","*")):(X=e,e=n),e}function fe(){var e,t,a,r,i;if(e=X,(t=pe())!==n){if(a=[],r=X,je()!==n&&(i=pe())!==n?(ee=r,r=K(0,i)):(X=r,r=n),r!==n)for(;r!==n;)a.push(r),r=X,je()!==n&&(i=pe())!==n?(ee=r,r=K(0,i)):(X=r,r=n);else a=n;a!==n?(ee=e,e=function(e,t){const a=[e,...t];return ke&&a.find((e=>"cursor"===e.type))||Le("or",a)}(t,a)):(X=e,e=n)}else X=e,e=n;return e===n&&(e=pe()),e}function pe(){var e,t,a,r,i;if(e=X,(t=me())!==n){if(a=[],r=X,Oe()!==n&&(i=me())!==n?(ee=r,r=K(0,i)):(X=r,r=n),r!==n)for(;r!==n;)a.push(r),r=X,Oe()!==n&&(i=me())!==n?(ee=r,r=K(0,i)):(X=r,r=n);else a=n;a!==n?(ee=e,e=function(e,t){const a=[e,...t];return ke&&a.find((e=>"cursor"===e.type))||Le("and",a)}(t,a)):(X=e,e=n)}else X=e,e=n;return e===n&&(e=me()),e}function me(){var e,t,a;return e=X,Se()!==n&&(t=ge())!==n?(ee=e,e="cursor"===(a=t).type?a:Le("not",[a])):(X=e,e=n),e===n&&(e=ge()),e}function ge(){var t,a,r,i,s,o,l,u;if(t=X,40===e.charCodeAt(X)?(a="(",X++):(a=n,0===ne&&ce(b)),a!==n){for(r=[],i=Ce();i!==n;)r.push(i),i=Ce();(i=fe())!==n&&(s=Te())!==n?(41===e.charCodeAt(X)?(o=")",X++):(o=n,0===ne&&ce(h)),o!==n?(ee=t,l=i,t="cursor"===(u=s).type?{...u,suggestionTypes:["conjunction"]}:l):(X=t,t=n)):(X=t,t=n)}else X=t,t=n;return t===n&&(t=function(){var t,a,r,i,s,o,l,u,c,d;if(t=X,(a=be())!==n){for(r=[],i=Ce();i!==n;)r.push(i),i=Ce();if(58===e.charCodeAt(X)?(i=":",X++):(i=n,0===ne&&ce(v)),i!==n){for(s=[],o=Ce();o!==n;)s.push(o),o=Ce();if(123===e.charCodeAt(X)?(o="{",X++):(o=n,0===ne&&ce(y)),o!==n){for(l=[],u=Ce();u!==n;)l.push(u),u=Ce();(u=fe())!==n&&(c=Te())!==n?(125===e.charCodeAt(X)?(d="}",X++):(d=n,0===ne&&ce(x)),d!==n?(ee=t,t=function(e,t,a){return"cursor"===t.type?{...t,nestedPath:t.nestedPath?`${e.value}.${t.nestedPath}`:e.value}:"cursor"===a.type?{...a,suggestionTypes:["conjunction"]}:Le("nested",[e,t])}(a,u,c)):(X=t,t=n)):(X=t,t=n)}else X=t,t=n}else X=t,t=n}else X=t,t=n;return t===n&&(t=function(){var t;return t=function(){var t,a,r,i,s,o,l,u,c;if(t=X,(a=be())!==n){for(r=[],i=Ce();i!==n;)r.push(i),i=Ce();if(i=function(){var t,a;return t=X,"<="===e.substr(X,2)?(a="<=",X+=2):(a=n,0===ne&&ce(B)),a!==n&&(ee=t,a="lte"),(t=a)===n&&(t=X,">="===e.substr(X,2)?(a=">=",X+=2):(a=n,0===ne&&ce(Q)),a!==n&&(ee=t,a="gte"),(t=a)===n&&(t=X,60===e.charCodeAt(X)?(a="<",X++):(a=n,0===ne&&ce(U)),a!==n&&(ee=t,a="lt"),(t=a)===n&&(t=X,62===e.charCodeAt(X)?(a=">",X++):(a=n,0===ne&&ce($)),a!==n&&(ee=t,a="gt"),t=a))),t}(),i!==n){for(s=[],o=Ce();o!==n;)s.push(o),o=Ce();(o=Ee())!==n?(ee=t,l=a,u=i,t="cursor"===(c=o).type?{...c,suggestionTypes:["conjunction"]}:Le("range",[l,u,c])):(X=t,t=n)}else X=t,t=n}else X=t,t=n;return t}(),t===n&&(t=function(){var t,a,r,i,s,o,l,u;if(t=X,(a=be())!==n){for(r=[],i=Ce();i!==n;)r.push(i),i=Ce();if(58===e.charCodeAt(X)?(i=":",X++):(i=n,0===ne&&ce(v)),i!==n){for(s=[],o=Ce();o!==n;)s.push(o),o=Ce();(o=he())!==n?(ee=t,l=a,t="cursor"===(u=o).type?{...u,fieldName:l.value,suggestionTypes:["value","conjunction"]}:u(l)):(X=t,t=n)}else X=t,t=n}else X=t,t=n;return t}(),t===n&&(t=function(){var e,t;return e=X,(t=xe())!==n&&(ee=e,t=function(e){if("cursor"===e.type){const t=`${e.prefix}${e.suffix}`.trim();return{...e,fieldName:t,suggestionTypes:["field","operator","conjunction"]}}return e(De(null))}(t)),t}())),t}()),t}()),t}function be(){var e;return ne++,e=Ee(),ne--,e===n&&0===ne&&ce(j),e}function he(){var t,a,r,i,s,o,l,u;if(t=X,40===e.charCodeAt(X)?(a="(",X++):(a=n,0===ne&&ce(b)),a!==n){for(r=[],i=Ce();i!==n;)r.push(i),i=Ce();i=function(){var e,t,a,r,i;if(e=X,(t=ve())!==n){if(a=[],r=X,je()!==n&&(i=ve())!==n?(ee=r,r=Y(0,i)):(X=r,r=n),r!==n)for(;r!==n;)a.push(r),r=X,je()!==n&&(i=ve())!==n?(ee=r,r=Y(0,i)):(X=r,r=n);else a=n;a!==n?(ee=e,e=function(e,t){const a=[e,...t],r=ke&&a.find((e=>"cursor"===e.type));return r?{...r,suggestionTypes:["value"]}:e=>Le("or",a.map((t=>t(e))))}(t,a)):(X=e,e=n)}else X=e,e=n;return e===n&&(e=ve()),e}(),i!==n&&(s=Te())!==n?(41===e.charCodeAt(X)?(o=")",X++):(o=n,0===ne&&ce(h)),o!==n?(ee=t,l=i,t="cursor"===(u=s).type?{...u,suggestionTypes:["conjunction"]}:l):(X=t,t=n)):(X=t,t=n)}else X=t,t=n;return t===n&&(t=xe()),t}function ve(){var e,t,a,r,i;if(e=X,(t=ye())!==n){if(a=[],r=X,Oe()!==n&&(i=ye())!==n?(ee=r,r=Y(0,i)):(X=r,r=n),r!==n)for(;r!==n;)a.push(r),r=X,Oe()!==n&&(i=ye())!==n?(ee=r,r=Y(0,i)):(X=r,r=n);else a=n;a!==n?(ee=e,e=function(e,t){const a=[e,...t],r=ke&&a.find((e=>"cursor"===e.type));return r?{...r,suggestionTypes:["value"]}:e=>Le("and",a.map((t=>t(e))))}(t,a)):(X=e,e=n)}else X=e,e=n;return e===n&&(e=ye()),e}function ye(){var e,t,a;return e=X,Se()!==n&&(t=he())!==n?(ee=e,e="cursor"===(a=t).type?{...list,suggestionTypes:["value"]}:e=>Le("not",[a(e)])):(X=e,e=n),e===n&&(e=he()),e}function xe(){var e,t;return ne++,e=X,(t=_e())!==n&&(ee=e,t=function(e){if("cursor"===e.type)return e;const t=De(!0);return a=>Le("is",[a,e,t])}(t)),(e=t)===n&&(e=X,(t=Fe())!==n&&(ee=e,t=function(e){if("cursor"===e.type)return e;!Pe&&"wildcard"===e.type&&qe.wildcard.hasLeadingWildcard(e)&&function(e,t){throw function(e,t){return new r("Leading wildcards are disabled. See query:allowLeadingWildcards in Advanced Settings.",null,null,t)}(0,t=void 0!==t?t:ue(ee,X))}();const t=De(!1);return a=>Le("is",[a,e,t])}(t)),e=t),ne--,e===n&&(t=n,0===ne&&ce(O)),e}function je(){var t,a,r,i,s;if(ne++,t=X,a=[],(r=Ce())!==n)for(;r!==n;)a.push(r),r=Ce();else a=n;if(a!==n)if("or"===e.substr(X,2).toLowerCase()?(r=e.substr(X,2),X+=2):(r=n,0===ne&&ce(E)),r!==n){if(i=[],(s=Ce())!==n)for(;s!==n;)i.push(s),s=Ce();else i=n;i!==n?t=a=[a,r,i]:(X=t,t=n)}else X=t,t=n;else X=t,t=n;return ne--,t===n&&(a=n,0===ne&&ce(S)),t}function Oe(){var t,a,r,i,s;if(ne++,t=X,a=[],(r=Ce())!==n)for(;r!==n;)a.push(r),r=Ce();else a=n;if(a!==n)if("and"===e.substr(X,3).toLowerCase()?(r=e.substr(X,3),X+=3):(r=n,0===ne&&ce(w)),r!==n){if(i=[],(s=Ce())!==n)for(;s!==n;)i.push(s),s=Ce();else i=n;i!==n?t=a=[a,r,i]:(X=t,t=n)}else X=t,t=n;else X=t,t=n;return ne--,t===n&&(a=n,0===ne&&ce(_)),t}function Se(){var t,a,r,i;if(ne++,t=X,"not"===e.substr(X,3).toLowerCase()?(a=e.substr(X,3),X+=3):(a=n,0===ne&&ce(N)),a!==n){if(r=[],(i=Ce())!==n)for(;i!==n;)r.push(i),i=Ce();else r=n;r!==n?t=a=[a,r]:(X=t,t=n)}else X=t,t=n;return ne--,t===n&&(a=n,0===ne&&ce(F)),t}function Ee(){var e;return ne++,(e=_e())===n&&(e=Fe()),ne--,e===n&&0===ne&&ce(T),e}function _e(){var t,a,r,i,s,o,u;if(t=X,ee=X,(a=(a=Z())?void 0:n)!==n)if(34===e.charCodeAt(X)?(r=l,X++):(r=n,0===ne&&ce(A)),r!==n){for(i=[],s=we();s!==n;)i.push(s),s=we();if((s=Ve())!==n){for(o=[],u=we();u!==n;)o.push(u),u=we();34===e.charCodeAt(X)?(u=l,X++):(u=n,0===ne&&ce(A)),u!==n?(ee=t,t=J(i,s,o)):(X=t,t=n)}else X=t,t=n}else X=t,t=n;else X=t,t=n;if(t===n)if(t=X,34===e.charCodeAt(X)?(a=l,X++):(a=n,0===ne&&ce(A)),a!==n){for(r=[],i=we();i!==n;)r.push(i),i=we();34===e.charCodeAt(X)?(i=l,X++):(i=n,0===ne&&ce(A)),i!==n?(ee=t,t=De(r.join(""))):(X=t,t=n)}else X=t,t=n;return t}function we(){var t,a,r;return(t=Ae())===n&&(t=ze())===n&&(t=X,92===e.charCodeAt(X)?(a=u,X++):(a=n,0===ne&&ce(M)),a!==n?(d.test(e.charAt(X))?(r=e.charAt(X),X++):(r=n,0===ne&&ce(z)),r!==n?(ee=t,t=r):(X=t,t=n)):(X=t,t=n),t===n&&(t=X,a=X,ne++,r=Ve(),ne--,r===n?a=void 0:(X=a,a=n),a!==n?(f.test(e.charAt(X))?(r=e.charAt(X),X++):(r=n,0===ne&&ce(I)),r!==n?(ee=t,t=r):(X=t,t=n)):(X=t,t=n))),t}function Fe(){var e,t,a,r,i,s;if(e=X,ee=X,(t=(t=Z())?void 0:n)!==n){for(a=[],r=Ne();r!==n;)a.push(r),r=Ne();if((r=Ve())!==n){for(i=[],s=Ne();s!==n;)i.push(s),s=Ne();ee=e,e=J(a,r,i)}else X=e,e=n}else X=e,e=n;if(e===n){if(e=X,t=[],(a=Ne())!==n)for(;a!==n;)t.push(a),a=Ne();else t=n;t!==n&&(ee=e,t=function(e){const t=e.join("").trim();return"null"===t?De(null):"true"===t?De(!0):"false"===t?De(!1):e.includes(Qe)?Be(t):De(t)}(t)),e=t}return e}function Ne(){var t,a,r,i,s;return(t=Ae())===n&&(t=function(){var t,a,r;return t=X,92===e.charCodeAt(X)?(a=u,X++):(a=n,0===ne&&ce(M)),a!==n&&(r=Me())!==n?(ee=t,t=r):(X=t,t=n),t}(),t===n&&(t=ze())===n&&(t=function(){var t,a,r;return t=X,92===e.charCodeAt(X)?(a=u,X++):(a=n,0===ne&&ce(M)),a!==n?("or"===e.substr(X,2).toLowerCase()?(r=e.substr(X,2),X+=2):(r=n,0===ne&&ce(E)),r===n&&("and"===e.substr(X,3).toLowerCase()?(r=e.substr(X,3),X+=3):(r=n,0===ne&&ce(w)),r===n&&("not"===e.substr(X,3).toLowerCase()?(r=e.substr(X,3),X+=3):(r=n,0===ne&&ce(N)))),r!==n?(ee=t,t=r):(X=t,t=n)):(X=t,t=n),t}(),t===n&&(t=function(){var t,a;return t=X,42===e.charCodeAt(X)?(a="*",X++):(a=n,0===ne&&ce(V)),a!==n&&(ee=t,a=Qe),a}(),t===n&&(t=X,a=X,ne++,r=Me(),ne--,r===n?a=void 0:(X=a,a=n),a!==n?(r=X,ne++,i=function(){var e;return(e=je())===n&&(e=Oe())===n&&(e=Se()),e}(),ne--,i===n?r=void 0:(X=r,r=n),r!==n?(i=X,ne++,s=Ve(),ne--,s===n?i=void 0:(X=i,i=n),i!==n?(e.length>X?(s=e.charAt(X),X++):(s=n,0===ne&&ce(C)),s!==n?(ee=t,t=s):(X=t,t=n)):(X=t,t=n)):(X=t,t=n)):(X=t,t=n))))),t}function Te(){var e,t,a,r,i,s;if(e=X,ee=X,(t=(t=Z())?void 0:n)!==n){for(a=[],r=Ce();r!==n;)a.push(r),r=Ce();if((r=Ve())!==n){for(i=[],s=Ce();s!==n;)i.push(s),s=Ce();ee=e,e=J(a,r,i)}else X=e,e=n}else X=e,e=n;if(e===n)for(e=[],t=Ce();t!==n;)e.push(t),t=Ce();return e}function Ae(){var t,a;return t=X,"\\t"===e.substr(X,2)?(a="\\t",X+=2):(a=n,0===ne&&ce(k)),a!==n&&(ee=t,a="\t"),(t=a)===n&&(t=X,"\\r"===e.substr(X,2)?(a="\\r",X+=2):(a=n,0===ne&&ce(R)),a!==n&&(ee=t,a="\r"),(t=a)===n&&(t=X,"\\n"===e.substr(X,2)?(a="\\n",X+=2):(a=n,0===ne&&ce(P)),a!==n&&(ee=t,a="\n"),t=a)),t}function Me(){var t;return p.test(e.charAt(X))?(t=e.charAt(X),X++):(t=n,0===ne&&ce(q)),t}function ze(){var t,a,r;return t=X,92===e.charCodeAt(X)?(a=u,X++):(a=n,0===ne&&ce(M)),a!==n?(r=function(){var t,a,r,i,s,o,l,u,c;return t=X,117===e.charCodeAt(X)?(a="u",X++):(a=n,0===ne&&ce(L)),a!==n?(r=X,i=X,(s=Ie())!==n&&(o=Ie())!==n&&(l=Ie())!==n&&(u=Ie())!==n?i=s=[s,o,l,u]:(X=i,i=n),(r=i!==n?e.substring(r,X):i)!==n?(ee=t,c=r,t=String.fromCharCode(parseInt(c,16))):(X=t,t=n)):(X=t,t=n),t}(),r!==n?(ee=t,t=r):(X=t,t=n)):(X=t,t=n),t}function Ie(){var t;return m.test(e.charAt(X))?(t=e.charAt(X),X++):(t=n,0===ne&&ce(D)),t}function Ce(){var t;return ne++,g.test(e.charAt(X))?(t=e.charAt(X),X++):(t=n,0===ne&&ce(H)),ne--,t===n&&0===ne&&ce(G),t}function Ve(){var t,a;return t=X,ee=X,(Z()?void 0:n)!==n?(e.substr(X,14)===c?(a=c,X+=14):(a=n,0===ne&&ce(W)),a!==n?(ee=t,t=Re):(X=t,t=n)):(X=t,t=n),t}const{parseCursor:ke,cursorSymbol:Re,allowLeadingWildcards:Pe=!0,helpers:{nodeTypes:qe}}=t,Le=qe.function.buildNodeWithArgumentNodes,De=qe.literal.buildNode,Be=qe.wildcard.buildNode,{wildcardSymbol:Qe}=qe.wildcard;if((a=o())!==n&&X===e.length)return a;throw a!==n&&X<e.length&&ce({type:"end"}),Ue=re,$e=ae<e.length?e.charAt(ae):null,Ge=ae<e.length?ue(ae,ae+1):ue(ae,ae),new r(r.buildMessage(Ue,$e),Ue,$e,Ge);var Ue,$e,Ge}}},83:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r=a(1).i18n.translate("xpack.dataVisualizer.chrome.help.appName",{defaultMessage:"Data Visualizer"})},85:function(e,t,a){"use strict";a.d(t,"a",(function(){return ee}));var r=a(0),n=a(23),i=a(1),s=a(8),o=a(48),l=a(69),u=a(63),c=a(43),d=a(22),f=a(24),p=a.n(f),m=a(32),g=a.n(m);const b=new RegExp("^([0-9]*)\\s*("+g.a.units.join("|")+")$"),h=["ms","s","m","h"],v=["ms","s","m","h","d"],{duration:y}=p.a,x=g.a.unitsDesc,j=x.indexOf("w"),O=function(){const e=[[y(500,"ms"),y(100,"ms")],[y(5,"second"),y(1,"second")],[y(10,"second"),y(5,"second")],[y(15,"second"),y(10,"second")],[y(30,"second"),y(15,"second")],[y(1,"minute"),y(30,"second")],[y(5,"minute"),y(1,"minute")],[y(10,"minute"),y(5,"minute")],[y(15,"minute"),y(10,"minute")],[y(30,"minute"),y(10,"minute")],[y(1,"hour"),y(30,"minute")],[y(2,"hour"),y(1,"hour")],[y(4,"hour"),y(2,"hour")],[y(6,"hour"),y(4,"hour")],[y(8,"hour"),y(6,"hour")],[y(12,"hour"),y(8,"hour")],[y(24,"hour"),y(12,"hour")],[y(2,"d"),y(1,"d")],[y(4,"d"),y(2,"d")],[y(1,"week"),y(4,"d")],[y(1,"month"),y(1,"week")],[y(1,"year"),y(1,"month")],[1/0,y(1,"year")]].slice(0).reverse();function t(e,t,a){return function(r,n){const i=function(r,n){const i=n/r;let s;for(let r=0;r<e.length;r++){const n=e[r],o=t(n[0],n[1],i);if(null==o){if(!a)continue;if(s)return s;break}if(!a)return o;s=o}const o=Math.max(Math.floor(i),1);return p.a.duration(o,"ms")}(r,n);if(i)return p.a.duration(i._data)}}return{near:t(e,(function(e,t,a){if(e>a){if(e===1/0)return t;const r=e.asMilliseconds(),n=t.asMilliseconds();return Math.abs(r-a)<=Math.abs(n)?e:t}}),!0),lessThan:t(e,(function(e,t,a){if(t<a)return e!==1/0?e:t})),atLeast:t(e,(function(e,t,a){if(t<=a)return t}))}}();function S(e,t){this._timeBucketsConfig=e,this._fieldFormats=t,this.barTarget=this._timeBucketsConfig[s.UI_SETTINGS.HISTOGRAM_BAR_TARGET],this.maxBars=this._timeBucketsConfig[s.UI_SETTINGS.HISTOGRAM_MAX_BARS]}function E(e,t){const a=function(e){for(let t=0;t<x.length;t++){const a=x[t],r=e.as(a);if(r>=1&&Math.floor(r)===r){if(t<=j)continue;return{value:r,unit:a,expression:r+a}}}const t=e.as("ms");return{value:t,unit:"ms",expression:t+"ms"}}(e);e.esValue=a.value,e.esUnit=a.unit,e.expression=a.expression,e.overflow=t>e&&p.a.duration(e-t);const r=p.a.normalizeUnits(a.unit);return 1===a.value?e.description=r:e.description=`${a.value} ${r}s`,e}function _(e){return e&&"isValid"in e&&e.isValid()}S.prototype.setBarTarget=function(e){this.barTarget=e},S.prototype.setMaxBars=function(e){this.maxBars=e},S.prototype.setBounds=function(e){if(!e)return this.clearBounds();let t;t=Object(d.isPlainObject)(e)?[e.min,e.max]:Array.isArray(e)?e:[];const a=Object(d.sortBy)(t.map(Object(d.ary)(p.a,1)),Number);if(2!==a.length||!a.every(_))throw this.clearBounds(),new Error("invalid bounds set: "+e);if(this._lb=a.shift(),this._ub=a.pop(),this.getDuration().asSeconds()<0)throw new TypeError("Intervals must be positive")},S.prototype.clearBounds=function(){this._lb=this._ub=null},S.prototype.hasBounds=function(){return _(this._ub)&&_(this._lb)},S.prototype.getBounds=function(){if(this.hasBounds())return{min:this._lb,max:this._ub}},S.prototype.getDuration=function(){if(this.hasBounds())return p.a.duration(this._ub-this._lb,"ms")},S.prototype.setInterval=function(e){this.originalInterval=e;let t=e;if(t&&"auto"!==t){if(Object(d.isString)(t)&&(e=t,t=function(e,t=!1){const a=String(e).trim().match(b);if(!Array.isArray(a)||a.length<3)return null;try{const e=parseInt(a[1],10),r=a[2];return isNaN(e)||e<1&&-1===h.indexOf(r)||!0===t&&-1===v.indexOf(r)?null:Object(f.duration)(e,r)}catch(e){return null}}(t),0==+t&&(t=null)),!p.a.isDuration(t))throw new TypeError('"'+e+'" is not a valid interval.');this._i=t}else this._i="auto"},S.prototype.getInterval=function(){const e=this,t=e.getDuration();return E(function(a){if(!e.hasBounds())return a;const r=e.maxBars;let n;return t/a>r?(n=O.lessThan(r,t),+n==+a?a:(E(a,t),Object(d.assign)(n,{preScaled:a,scale:a/n,scaled:!0}))):a}(function(){const a=e._i;return p.a.isDuration(a)?a:O.near(e.barTarget,t)}()),t)},S.prototype.getIntervalToNearestMultiple=function(e){const t=this.getInterval(),a=t.asSeconds(),r=a%e;if(0===r)return t;let n=r>e/2?a+e-r:a-r;n=0===n?e:n;const i=p.a.duration(n,"seconds");E(i,this.getDuration());const s=t.preScaled;return void 0!==s&&s<i&&(i.preScaled=s,i.scale=s/i,i.scaled=!0),i},S.prototype.getScaledDateFormat=function(){const e=this.getInterval(),t=this._timeBucketsConfig["dateFormat:scaled"];for(let a=t.length-1;a>=0;a--){const r=t[a];if(!r[0]||e>=p.a.duration(r[0]))return r[1]}return this._timeBucketsConfig.dateFormat},S.prototype.getScaledDateFormatter=function(){return new(this._fieldFormats.getType(c.FIELD_FORMAT_IDS.DATE))({pattern:this.getScaledDateFormat()},this._timeBucketsConfig)};var w=a(4),F=a(58),N=a(44),T=a(45);const A=i.i18n.translate("xpack.dataVisualizer.index.lensChart.topValuesLabel",{defaultMessage:"Top values"}),M=i.i18n.translate("xpack.dataVisualizer.index.lensChart.countLabel",{defaultMessage:"Count"});function z(e,t,a,r){var n,s,o,l,c,d,f;const{lens:p,maps:m,data:g}=t,b=[],h=null!==(n=null==g?void 0:g.query.filterManager.getFilters())&&void 0!==n?n:[],v=()=>{const e={lastRefresh:Date.now()};u.a.next(e)};if(!0===(null===(s=t.application)||void 0===s||null===(o=s.capabilities)||void 0===o||null===(l=o.visualize)||void 0===l?void 0:l.show)&&void 0!==p){const t=null==p?void 0:p.canUseEditor();b.push({name:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInLensTitle",{defaultMessage:"Explore in Lens"}),description:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInLensDescription",{defaultMessage:"Explore in Lens"}),type:"icon",icon:"lensApp",available:e=>void 0!==function(e){let t;switch(e){case w.e.KEYWORD:t="string";break;case w.e.DATE:t="date";break;case w.e.NUMBER:t="number";break;case w.e.IP:t="ip";break;case w.e.BOOLEAN:t="string";break;default:t=void 0}return t}(e.type)&&t,onClick:t=>{const r=function(e,t,a,r){if(void 0===e||void 0===r.type||void 0===r.fieldName)return;const n=function(e,t,a){if(void 0!==t.fieldName)return e===w.e.DATE?function(e){return{columns:{col2:{dataType:"number",isBucketed:!1,label:M,operationType:"count",scale:"ratio",sourceField:T.DOCUMENT_FIELD_NAME},col1:{dataType:"date",isBucketed:!0,label:e.fieldName,operationType:"date_histogram",params:{interval:"auto"},scale:"interval",sourceField:e.fieldName}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"line",xAccessor:"col1"}}}(t):e===w.e.NUMBER?function(e,t){return void 0===t.timeFieldName?{columns:{col1:{label:e.fieldName,dataType:"number",isBucketed:!0,operationType:"range",params:{type:"histogram",maxBars:"auto",ranges:[]},sourceField:e.fieldName},col2:{label:M,dataType:"number",isBucketed:!1,sourceField:T.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar",xAccessor:"col1"}}:{columns:{col2:{dataType:"number",isBucketed:!1,label:i.i18n.translate("xpack.dataVisualizer.index.lensChart.averageOfLabel",{defaultMessage:"Average of {fieldName}",values:{fieldName:e.fieldName}}),operationType:"average",sourceField:e.fieldName},col1:{dataType:"date",isBucketed:!0,label:t.timeFieldName,operationType:"date_histogram",params:{interval:"auto"},scale:"interval",sourceField:t.timeFieldName}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"line",xAccessor:"col1"}}}(t,a):e===w.e.IP||e===w.e.KEYWORD?function(e){return{columns:{col1:{label:A,dataType:"string",isBucketed:!0,operationType:"terms",params:{orderBy:{type:"column",columnId:"col2"},size:10,orderDirection:"desc"},sourceField:e.fieldName},col2:{label:M,dataType:"number",isBucketed:!1,sourceField:T.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar",xAccessor:"col1"}}}(t):e===w.e.BOOLEAN?function(e){return{columns:{col1:{label:A,dataType:"string",isBucketed:!0,operationType:"terms",params:{orderBy:{type:"alphabetical"},size:2,orderDirection:"desc"},sourceField:e.fieldName},col2:{label:M,dataType:"number",isBucketed:!1,sourceField:T.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar",xAccessor:"col1"}}}(t):void 0}(r.type,r,e);return n?{visualizationType:"lnsXY",title:i.i18n.translate("xpack.dataVisualizer.index.lensChart.chartTitle",{defaultMessage:"Lens for {fieldName}",values:{fieldName:r.fieldName}}),references:[{id:e.id,name:"indexpattern-datasource-current-indexpattern",type:"index-pattern"},{id:e.id,name:"indexpattern-datasource-layer-layer1",type:"index-pattern"}],state:{datasourceStates:{indexpattern:{layers:{layer1:{columnOrder:["col1","col2"],columns:n.columns}}}},filters:a,query:{language:t.searchQueryLanguage,query:t.searchString},visualization:{axisTitlesVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},fittingFunction:"None",gridlinesVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},layers:[n.layer],legend:{isVisible:!0,position:"right"},preferredSeriesType:"line",tickLabelsVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},valueLabels:"hide"}}}:void 0}(e,a,h,t);r&&p.navigateToPrefilledEditor({id:`dataVisualizer-${t.fieldName}`,attributes:r})},"data-test-subj":"dataVisualizerActionViewInLensButton"})}var y;return null!=t&&t.uiActions&&m&&!0===(null===(c=t.application)||void 0===c||null===(d=c.capabilities)||void 0===d||null===(f=d.maps)||void 0===f?void 0:f.show)&&b.push({name:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInMapsTitle",{defaultMessage:"Explore in Maps"}),description:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInMapsDescription",{defaultMessage:"Explore in Maps"}),type:"icon",icon:"gisApp",available:e=>e.type===w.e.GEO_POINT||e.type===w.e.GEO_SHAPE,onClick:async a=>{if(null!=t&&t.uiActions&&e){const r={indexPatternId:e.id,fieldName:a.fieldName,contextualFields:[],originatingApp:w.a},n=await(null==t?void 0:t.uiActions.getTriggerCompatibleActions(N.VISUALIZE_GEO_FIELD_TRIGGER,r));n.length>0&&void 0!==n[0]&&(null==t||t.uiActions.getTrigger(N.VISUALIZE_GEO_FIELD_TRIGGER).exec(r))}},"data-test-subj":"dataVisualizerActionViewInMapsButton"}),void 0!==r&&null!==(y=t.dataViewFieldEditor)&&void 0!==y&&y.userPermissions.editIndexPattern()&&(b.push({name:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.editDataViewFieldTitle",{defaultMessage:"Edit data view field"}),description:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.editDataViewFieldDescription",{defaultMessage:"Edit data view field"}),type:"icon",icon:"indexEdit",onClick:a=>{var n;r.current=null===(n=t.dataViewFieldEditor)||void 0===n?void 0:n.openEditor({ctx:{dataView:e},fieldName:a.fieldName,onSave:v})},"data-test-subj":"dataVisualizerActionEditIndexPatternFieldButton"}),b.push({name:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.deleteDataViewFieldTitle",{defaultMessage:"Delete data view field"}),description:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.deleteIndexPatternFieldDescription",{defaultMessage:"Delete data view field"}),type:"icon",icon:"trash",available:e=>!0===e.deletable,onClick:a=>{var n;r.current=null===(n=t.dataViewFieldEditor)||void 0===n?void 0:n.openDeleteModal({ctx:{dataView:e},fieldName:a.fieldName,onDelete:v})},"data-test-subj":"dataVisualizerActionDeleteIndexPatternFieldButton"})),b}var I=a(60),C=a(25),V=a(20);function k(e,t,a,r){const n=[];return e&&t&&a&&n.push({range:{[e]:{gte:t,lte:a,format:"epoch_millis"}}}),r&&"object"==typeof r&&n.push(r),n}function R(e,t){return t<1?e:{sample:{sampler:{shard_size:t},aggs:e}}}function P(e){return e>0?["sample"]:[]}function q(e,t){return e.match(/^[a-zA-Z0-9-_.]+$/)?e:`field_${t}`}const L=1e5,D=5e3;var B=a(52);const Q=e=>Object(B.a)(e,["rawResponse"]);function U(e){return!0===(null==e?void 0:e.isBoom)}const $=e=>{if(function(e){var t;return e&&void 0!==(null===(t=e.error)||void 0===t?void 0:t.reason)}(e))return{message:e.error.reason,statusCode:e.status,fullError:e};if(function(e){return"string"==typeof e}(e))return{message:e};var t,a;if(function(e){var t;return e&&!0===U(null===(t=e.body)||void 0===t?void 0:t.message)}(e))return null===(t=e.body.message)||void 0===t||null===(a=t.output)||void 0===a?void 0:a.payload;if(U(e))return{message:e.output.payload.message,statusCode:e.output.payload.statusCode};if(void 0===(null==e?void 0:e.body)&&(null==e||!e.message))return{message:""};if("string"==typeof e.body)return{message:e.body};if(function(e){return"object"==typeof e.body&&"message"in e.body}(e)){var r,n;if("object"==typeof e.body.attributes&&"string"==typeof(null===(r=e.body.attributes.body)||void 0===r||null===(n=r.error)||void 0===n?void 0:n.reason)){var i,s,o;const t={message:e.body.attributes.body.error.reason,statusCode:e.body.statusCode,fullError:e.body.attributes.body};var l,u,c;return"object"!=typeof e.body.attributes.body.error.caused_by||"string"!=typeof(null===(i=e.body.attributes.body.error.caused_by)||void 0===i?void 0:i.reason)&&"string"!=typeof(null===(s=e.body.attributes.body.error.caused_by)||void 0===s||null===(o=s.caused_by)||void 0===o?void 0:o.reason)||(t.causedBy=(null===(l=e.body.attributes.body.error.caused_by)||void 0===l||null===(u=l.caused_by)||void 0===u?void 0:u.reason)||(null===(c=e.body.attributes.body.error.caused_by)||void 0===c?void 0:c.reason)),Array.isArray(e.body.attributes.body.error.root_cause)&&"object"==typeof e.body.attributes.body.error.root_cause[0]&&Object(B.a)(e.body.attributes.body.error.root_cause[0],["script"])&&(t.causedBy=e.body.attributes.body.error.root_cause[0].script,t.message+=`: '${e.body.attributes.body.error.root_cause[0].script}'`),t}return{message:e.body.message,statusCode:e.body.statusCode}}return function(e){return e&&void 0!==e.message&&"string"==typeof e.message}(e)?{message:e.message}:{message:""}},G=(e,t,a,r)=>{switch(a[0].type){case w.e.NUMBER:return((e,t,a,r)=>{const{samplerShardSize:i}=t,s=((e,t)=>{const{index:a,query:r,runtimeFieldMap:n,samplerShardSize:i}=e;let s=0;const o=Array.from(Array(20),(()=>s+=5)),l={};return t.forEach(((e,t)=>{const{safeFieldName:a}=e;l[`${a}_field_stats`]={filter:{exists:{field:e.fieldName}},aggs:{actual_stats:{stats:{field:e.fieldName}}}},l[`${a}_percentiles`]={percentiles:{field:e.fieldName,percents:o,keyed:!1}};const r={terms:{field:e.fieldName,size:10,order:{_count:"desc"}}};i<1&&e.cardinality>=L?l[`${a}_top`]={sampler:{shard_size:D},aggs:{top:r}}:l[`${a}_top`]=r})),{index:a,size:0,body:{query:r,aggs:R(l,i),...Object(B.a)(n)?{runtime_mappings:n}:{}}}})(t,a);return e.search({params:s},r).pipe(Object(C.catchError)((e=>Object(n.of)({fields:a,error:$(e)}))),Object(C.map)((e=>{if(!Q(e))return e;const t=e.rawResponse.aggregations,r=P(i),n=[];return a.forEach(((e,a)=>{const s=e.safeFieldName,o=Object(d.get)(t,[...r,`${s}_field_stats`,"doc_count"],0),l=Object(d.get)(t,[...r,`${s}_field_stats`,"actual_stats"],{}),u=[...r,`${s}_top`];i<1&&e.cardinality>=L&&u.push("top");const c=Object(d.get)(t,[...u,"buckets"],[]),f={fieldName:e.fieldName,count:o,min:Object(d.get)(l,"min",0),max:Object(d.get)(l,"max",0),avg:Object(d.get)(l,"avg",0),isTopValuesSampled:e.cardinality>=L||i>0,topValues:c,topValuesSampleSize:c.reduce(((e,t)=>e+t.doc_count),Object(d.get)(t,[...u,"sum_other_doc_count"],0)),topValuesSamplerShardSize:e.cardinality>=L?D:i};if(f.count>0){const e=Object(d.get)(t,[...r,`${s}_percentiles`,"values"],[]),a=Object(d.find)(e,{key:50});f.median=void 0!==a?a.value:0,f.distribution=((e,t,a)=>{const r={percentiles:[],minPercentile:0,maxPercentile:100};if(0===e.length)return r;let n=[],i=a;if(i>=0){r.minPercentile=0,r.maxPercentile=90,n=e.slice(0,e.length-2);const t=i+1.5*(Object(d.last)(n).value-i);for(let a=n.length;a<e.length&&e[a].value<t;a++)n.push(e[a]),r.maxPercentile+=5}else{const t=i;i=e[0].value,r.minPercentile=5,r.maxPercentile=95,n=e.slice(1,e.length-1);const a=Object(d.last)(n).value,s=.25*(a-i);i-t<s&&(n.splice(0,0,e[0]),r.minPercentile=0,i=t),e[e.length-1].value-a<s&&(n.push(e[e.length-1]),r.maxPercentile=100)}const s=n.length;let o=i,l=0;for(let e=0;e<s;e++){const t=n[e];t.value.toPrecision(15)!==o.toPrecision(15)?(l>0&&r.percentiles.push({percent:5*l,minValue:o,maxValue:o}),r.percentiles.push({percent:5,minValue:o,maxValue:t.value}),o=t.value,l=0):(l++,e===s-1&&r.percentiles.push({percent:5*l,minValue:o,maxValue:o}))}return r})(e,0,f.min)}n.push(f)})),n})))})(e,t,a,r);case w.e.KEYWORD:case w.e.IP:return((e,t,a,r)=>{const{samplerShardSize:i}=t,s=((e,t)=>{const{index:a,query:r,runtimeFieldMap:n,samplerShardSize:i}=e,s={};return t.forEach(((e,t)=>{const a=e.safeFieldName,r={terms:{field:e.fieldName,size:10,order:{_count:"desc"}}};i<1&&e.cardinality>=L?s[`${a}_top`]={sampler:{shard_size:D},aggs:{top:r}}:s[`${a}_top`]=r})),{index:a,size:0,body:{query:r,aggs:R(s,i),...Object(B.a)(n)?{runtime_mappings:n}:{}}}})(t,a);return e.search({params:s},r).pipe(Object(C.catchError)((e=>Object(n.of)({fields:a,error:$(e)}))),Object(C.map)((e=>{if(!Q(e))return e;const t=e.rawResponse.aggregations,r=P(i),n=[];return a.forEach(((e,a)=>{const s=e.safeFieldName,o=[...r,`${s}_top`];i<1&&e.cardinality>=L&&o.push("top");const l=Object(d.get)(t,[...o,"buckets"],[]),u={fieldName:e.fieldName,isTopValuesSampled:e.cardinality>=L||i>0,topValues:l,topValuesSampleSize:l.reduce(((e,t)=>e+t.doc_count),Object(d.get)(t,[...o,"sum_other_doc_count"],0)),topValuesSamplerShardSize:e.cardinality>=L?D:i};n.push(u)})),n})))})(e,t,a,r);case w.e.DATE:return((e,t,a,r)=>{const{samplerShardSize:i}=t,s=((e,t)=>{const{index:a,query:r,runtimeFieldMap:n,samplerShardSize:i}=e,s={};return t.forEach(((e,t)=>{const a=e.safeFieldName;s[`${a}_field_stats`]={filter:{exists:{field:e.fieldName}},aggs:{actual_stats:{stats:{field:e.fieldName}}}}})),{index:a,size:0,body:{query:r,aggs:R(s,i),...Object(B.a)(n)?{runtime_mappings:n}:{}}}})(t,a);return e.search({params:s},r).pipe(Object(C.catchError)((e=>Object(n.of)({fields:a,error:$(e)}))),Object(C.map)((e=>{if(!Q(e))return e;const t=e.rawResponse.aggregations,r=P(i);return a.map(((e,a)=>{const n=e.safeFieldName,i=Object(d.get)(t,[...r,`${n}_field_stats`,"doc_count"],0),s=Object(d.get)(t,[...r,`${n}_field_stats`,"actual_stats"],{});return{fieldName:e.fieldName,count:i,earliest:Object(d.get)(s,"min",0),latest:Object(d.get)(s,"max",0)}}))})))})(e,t,a,r);case w.e.BOOLEAN:return((e,t,a,r)=>{const{samplerShardSize:i}=t,s=((e,t)=>{const{index:a,query:r,runtimeFieldMap:n,samplerShardSize:i}=e,s={};return t.forEach(((e,t)=>{const a=e.safeFieldName;s[`${a}_value_count`]={filter:{exists:{field:e.fieldName}}},s[`${a}_values`]={terms:{field:e.fieldName,size:2}}})),{index:a,size:0,body:{query:r,aggs:R(s,i),...Object(B.a)(n)?{runtime_mappings:n}:{}}}})(t,a);return e.search({params:s},r).pipe(Object(C.catchError)((e=>Object(n.of)({fields:a,error:$(e)}))),Object(C.map)((e=>{if(!Q(e))return e;const t=e.rawResponse.aggregations,r=P(i);return a.map(((e,a)=>{const n=e.fieldName,i={fieldName:e.fieldName,count:Object(d.get)(t,[...r,`${n}_value_count`,"doc_count"],0),trueCount:0,falseCount:0};return Object(d.get)(t,[...r,`${n}_values`,"buckets"],[]).forEach((e=>{i[`${e.key_as_string}Count`]=e.doc_count})),i}))})))})(e,t,a,r);case w.e.TEXT:default:return((e,t,a,r)=>{const{maxExamples:i}=t;return Object(n.combineLatest)(a.map((s=>{const o=((e,t)=>{const{index:a,timeFieldName:r,earliestMs:n,latestMs:i,query:s,runtimeFieldMap:o,maxExamples:l}=e,u=Math.max(100,null!=l?l:10),c=k(r,n,i,s);return Array.isArray(c)&&c.push({exists:{field:t.fieldName}}),{index:a,size:u,body:{fields:[t.fieldName],_source:!1,query:{bool:{filter:c}},...Object(B.a)(o)?{runtime_mappings:o}:{}}}})(t,s);return e.search({params:o},r).pipe(Object(C.catchError)((e=>Object(n.of)({fieldName:s.fieldName,fields:a,error:$(e)}))),Object(C.map)((e=>{if(!Q(e))return e;const t=e.rawResponse,a={fieldName:s.fieldName,examples:[]};if(t.hits.total>0){const e=t.hits.hits;for(let t=0;t<e.length;t++){const r=Object(d.get)(e[t].fields,s.fieldName);if(Array.isArray(r)&&r.length>0){const e=r[0];if(void 0!==e&&-1===a.examples.indexOf(e)&&(a.examples.push(e),a.examples.length===i))break}}}return a})))})))})(e,t,a,r)}};var H=a(62),W=a(78);const K=(e,t,a,r,n,i,s,o,l)=>{const u=e,c=k(n,i,s,t),d=(e=>{return void 0!==(null==(t=e)?void 0:t.aggregations)?t.aggregations:void 0!==(null==t?void 0:t.aggs)?t.aggs:void 0;var t})(o),f=void 0!==d?{...d}:{},p={...Object(B.a)(l)?l:{},...Object(B.a)(o)&&Object(B.a)(o.runtime_mappings)?o.runtime_mappings:{}};return a.forEach(((e,t)=>{var a;const r=q(e,t);let n;f[`${r}_count`]={filter:{exists:{field:e}}},n=null!=o&&null!==(a=o.script_fields)&&void 0!==a&&a.hasOwnProperty(e)?f[`${r}_cardinality`]={cardinality:{script:null==o?void 0:o.script_fields[e].script}}:{cardinality:{field:e}},f[`${r}_cardinality`]=n})),{index:u,track_total_hits:!1,size:0,body:{query:{bool:{filter:c}},...Object(B.a)(f)?{aggs:R(f,r)}:{},...Object(B.a)(p)?{runtime_mappings:p}:{}}}},Y=(e,t,a,r,n,i,s)=>{const o=e,l=k(r,n,i,t),u={query:{bool:{filter:l}},...Object(B.a)(s)?{runtime_mappings:s}:{}};return Array.isArray(l)&&l.push({exists:{field:a}}),{index:o,size:0,body:u,track_total_hits:1}},Z=e=>{const{index:t,timeFieldName:a,earliest:r,latest:n,runtimeFieldMap:i,searchQuery:s,intervalMs:o,fieldsToFetch:l}=e;return{index:t,body:{query:{bool:{filter:k(a,r,n,s)}},...!l&&void 0!==a&&void 0!==o&&o>0?{aggs:{eventRate:{date_histogram:{field:a,fixed_interval:`${o}ms`,min_doc_count:1}}}}:{},...Object(B.a)(i)?{runtime_mappings:i}:{},track_total_hits:!0,size:0}}};const J=Object(I.c)();function X(e){return!w.h.includes(e)}const ee=(e,t,a)=>{const{services:c}=Object(o.a)(),{uiSettings:f,data:p}=c,{samplerShardSize:m,visibleFieldTypes:g,showEmptyFields:b}=t,[h,v]=Object(r.useState)(0),y=e.sessionId,{currentSavedSearch:x,currentDataView:j,currentQuery:O,currentFilters:E,visibleFieldNames:_,fieldsToFetch:N}=Object(r.useMemo)((()=>{var t;return{currentSavedSearch:null==e?void 0:e.savedSearch,currentDataView:e.dataView,currentQuery:null==e?void 0:e.query,visibleFieldNames:null!==(t=null==e?void 0:e.visibleFieldNames)&&void 0!==t?t:[],currentFilters:null==e?void 0:e.filters,fieldsToFetch:null==e?void 0:e.fieldsToFetch}}),[e]),{searchQueryLanguage:T,searchString:A,searchQuery:M}=Object(r.useMemo)((()=>{const e=Object(l.b)({dataView:j,uiSettings:f,savedSearch:x,query:O,filters:E,filterManager:p.query.filterManager});return void 0===e||""!==t.searchString?(t.filters&&p.query.filterManager.setFilters(t.filters),{searchQuery:t.searchQuery,searchString:t.searchString,searchQueryLanguage:t.searchQueryLanguage}):{searchQuery:e.searchQuery,searchString:e.searchString,searchQueryLanguage:e.queryLanguage}}),[null==x?void 0:x.id,j.id,t.searchString,t.searchQueryLanguage,JSON.stringify({searchQuery:t.searchQuery,currentQuery:O,currentFilters:E}),h]),R=Object(r.useMemo)((()=>new S({[s.UI_SETTINGS.HISTOGRAM_MAX_BARS]:f.get(s.UI_SETTINGS.HISTOGRAM_MAX_BARS),[s.UI_SETTINGS.HISTOGRAM_BAR_TARGET]:f.get(s.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:f.get("dateFormat"),"dateFormat:scaled":f.get("dateFormat:scaled")})),[f]),L=(({timeRangeSelector:e,autoRefreshSelector:t}={})=>{const{services:a}=Object(o.a)(),{timefilter:n}=a.data.query.timefilter;return Object(r.useEffect)((()=>{!0===e?n.enableTimeRangeSelector():!1===e&&n.disableTimeRangeSelector(),!0===t?n.enableAutoRefreshSelector():!1===t&&n.disableAutoRefreshSelector()}),[e,t,n]),n})({timeRangeSelector:void 0!==(null==j?void 0:j.timeFieldName),autoRefreshSelector:!0}),[D,Q]=Object(r.useState)(J.metricConfigs),[U,ee]=Object(r.useState)(J.metricsLoaded),[te,ae]=Object(r.useState)(),[re,ne]=Object(r.useState)(J.nonMetricConfigs),[ie,se]=Object(r.useState)(J.nonMetricsLoaded),oe=Object(r.useMemo)((()=>{const e=R,t=L;if(!e||!t||!j)return;const a=t.getActiveBounds();let r,n;var i,s;void 0!==a&&void 0!==j.timeFieldName&&(r=null===(i=a.min)||void 0===i?void 0:i.valueOf(),n=null===(s=a.max)||void 0===s?void 0:s.valueOf());const o=t.getActiveBounds();e.setInterval("auto"),o&&(e.setBounds(o),e.setBarTarget(75));const l=e.getInterval(),u=[],c=[],d=j.fields;return null==d||d.forEach((e=>{if(N&&!N.includes(e.name))return;const t=void 0!==e.displayName?e.displayName:e.name;w.h.includes(t)||(!0!==e.aggregatable||w.g.has(e.type)?c.push(e.name):u.push(e.name))})),{earliest:r,latest:n,aggInterval:l,intervalMs:null==l?void 0:l.asMilliseconds(),searchQuery:M,samplerShardSize:m,sessionId:y,index:j.title,timeFieldName:j.timeFieldName,runtimeFieldMap:j.getRuntimeMappings(),aggregatableFields:u,nonAggregatableFields:c,fieldsToFetch:N}}),[R,L,j.id,JSON.stringify(M),m,y,h,N]),{overallStats:le,progress:ue}=function(e,t){const{services:{data:a,notifications:{toasts:s}}}=Object(o.a)(),[l,u]=Object(r.useState)(Object(I.c)().overallStats),[c,f]=Object(r.useReducer)(((e,t)=>({...e,...t})),{isRunning:!1,loaded:0,total:100}),p=Object(r.useRef)(new AbortController),m=Object(r.useRef)(),g=Object(r.useCallback)((()=>{var r;if(null===(r=m.current)||void 0===r||r.unsubscribe(),p.current.abort(),p.current=new AbortController,!e||0===t)return;f({isRunning:!1,loaded:0,total:100,error:void 0});const{aggregatableFields:o,nonAggregatableFields:l,index:c,searchQuery:g,timeFieldName:b,earliest:h,latest:v,runtimeFieldMap:y,samplerShardSize:x}=e,j={abortSignal:p.current.signal,sessionId:null==e?void 0:e.sessionId},O=l.map((e=>a.search.search({params:Y(c,g,e,b,h,v,y)},j).pipe(Object(C.map)((t=>({...t,rawResponse:{...t.rawResponse,fieldName:e}})))))),S=Object(d.chunk)(o,30).map((e=>a.search.search({params:K(c,g,e,x,b,h,v,void 0,y)},j).pipe(Object(C.map)((t=>({...t,aggregatableFields:e})))))),E=function(e,t=H.b){return Object(n.from)(e).pipe(Object(C.mergeMap)(((e,t)=>e.pipe(Object(C.last)(),Object(C.map)((e=>({index:t,value:e}))))),t),Object(C.toArray)(),Object(C.map)((e=>e.sort(((e,t)=>e.index-t.index)).map((e=>e.value)))))}([a.search.search({params:Z(e)},j),...S,...O],H.b);m.current=E.subscribe({next:t=>{{var a;const r=[],n=[],i=t[0];t.forEach(((e,t)=>{var a;e&&(a=e,Object(B.a)(a,["aggregatableFields"])?r.push(e):n.push(e))}));const s=((e,t)=>{var a,r;if(!e)return;const n=null!==(a=null!==(r=e.hits.total.value)&&void 0!==r?r:e.hits.total)&&void 0!==a?a:0;if(void 0===t.intervalMs||void 0===t.earliest||void 0===t.latest)return{totalCount:n};const i={},s=Object(d.get)(e,["aggregations","eventRate","buckets"],[]);return Object(d.each)(s,(e=>{const t=e.key;i[t]=e.doc_count})),{interval:t.intervalMs,buckets:i,timeRangeEarliest:t.earliest,timeRangeLatest:t.latest,totalCount:n}})(null==i?void 0:i.rawResponse,e),c=null!==(a=null==s?void 0:s.totalCount)&&void 0!==a?a:0,f=((e,t,a,r,n)=>{const i={aggregatableExistsFields:[],aggregatableNotExistsFields:[]};return e&&0!==t.length?(e.forEach((({rawResponse:e,aggregatableFields:t})=>{const n=e.aggregations,s=P(a),o=a>0?Object(d.get)(n,["sample","doc_count"],0):r;t.forEach(((e,t)=>{const a=q(e,t),r=Object(d.get)(n,[...s,`${a}_count`,"doc_count"],0);if(r>0){const t=Object(d.get)(n,[...s,`${a}_cardinality`,"value"],0);i.aggregatableExistsFields.push({fieldName:e,existsInDocs:!0,stats:{sampleCount:o,count:r,cardinality:t}})}else i.aggregatableNotExistsFields.push({fieldName:e,existsInDocs:!1,stats:{}})}))})),i):i})(r,o,x,c),p=((e,t)=>{const a={nonAggregatableExistsFields:[],nonAggregatableNotExistsFields:[]};return e&&0!==t.length?(t.forEach((t=>{const r=e.find((e=>e.rawResponse.fieldName===t)),n=void 0!==r&&r.rawResponse.hits.total>0,i={fieldName:t,existsInDocs:n};!0===n?a.nonAggregatableExistsFields.push(i):a.nonAggregatableNotExistsFields.push(i)})),a):a})(n,l);u({documentCountStats:s,...p,...f,totalCount:c})}},error:t=>{!function(e,t,a){var r,n;500===a.statusCode?e.addError(a,{title:i.i18n.translate("xpack.dataVisualizer.index.dataLoader.internalServerErrorMessage",{defaultMessage:"Error loading data in index {index}. {message}. The request may have timed out. Try using a smaller sample size or narrowing the time range.",values:{index:t,message:null!==(r=a.error)&&void 0!==r?r:a.message}})}):e.addError(a,{title:i.i18n.translate("xpack.dataVisualizer.index.errorLoadingDataMessage",{defaultMessage:"Error loading data in index {index}. {message}.",values:{index:t,message:null!==(n=a.error)&&void 0!==n?n:a.message}})})}(s,e.index,$(t)),f({isRunning:!1,error:t})},complete:()=>{f({loaded:100,isRunning:!1})}})}),[a.search,e,s,t]),b=Object(r.useCallback)((()=>{var e;null===(e=m.current)||void 0===e||e.unsubscribe(),m.current=void 0,p.current.abort()}),[]);return Object(r.useEffect)((()=>(g(),b)),[g,b]),Object(r.useMemo)((()=>({progress:c,overallStats:l})),[l,c])}(oe,h),ce=function(e,t,a){const{services:{data:s,notifications:{toasts:l}}}=Object(o.a)(),[u,c]=Object(r.useState)(),[f,p]=Object(r.useReducer)(((e,t)=>({...e,...t})),{isRunning:!1,loaded:0,total:100}),m=Object(r.useRef)(new AbortController),g=Object(r.useRef)(),b=Object(r.useRef)(),h=Object(r.useCallback)((()=>{var r,o,u;if(null===(r=g.current)||void 0===r||r.unsubscribe(),null===(o=b.current)||void 0===o||o.unsubscribe(),m.current.abort(),m.current=new AbortController,p({isRunning:!1,loaded:0,total:100,error:void 0}),c(void 0),!e||!t||0===t.metricConfigs.length&&0===t.nonMetricConfigs.length)return void p({loaded:100,isRunning:!1});const{sortField:f,sortDirection:h}=a,v=V.Comparators.property(f,V.Comparators.default(h)),y=[...t.metricConfigs,...t.nonMetricConfigs].sort(v),x=Object(W.a)(y,a.visibleFieldNames,a.visibleFieldTypes),{pageIndex:j,pageSize:O}=a,S=null===(u=x.filteredFields)||void 0===u?void 0:u.slice(j*O,(j+1)*O).filter((e=>!0===e.existsInDocs));if(!S||0===S.length)return void p({loaded:100,isRunning:!1});const E=k(e.timeFieldName,e.earliest,e.latest,e.searchQuery),_={index:e.index,samplerShardSize:e.samplerShardSize,timeFieldName:e.timeFieldName,earliestMs:e.earliest,latestMs:e.latest,runtimeFieldMap:e.runtimeFieldMap,intervalMs:e.intervalMs,query:{bool:{filter:E}},maxExamples:10},w={abortSignal:m.current.signal,sessionId:null==e?void 0:e.sessionId},F=((e,t=10)=>{const a=[],r={};return e.forEach((e=>{const a=e.type;void 0===r[a]&&(r[a]=[[]]);let n=Object(d.last)(r[a]);n.length===t&&(n=[],r[a].push(n)),n.push(e)})),Object.values(r).forEach((e=>{a.push(...e)})),a})(S.map(((e,t)=>({fieldName:e.fieldName,type:e.type,cardinality:e.cardinality,safeFieldName:q(e.fieldName,t)}))),10),N=new n.Subject,T=new n.Subject,A=F.map((e=>G(s.search,_,e,w))).filter((e=>void 0!==e)),M=e=>{l.addError(e,{title:i.i18n.translate("xpack.dataVisualizer.index.errorFetchingFieldStatisticsMessage",{defaultMessage:"Error fetching field statistics"})}),p({isRunning:!1,error:e})},z=()=>{p({isRunning:!1})},I=new Map;g.current=Object(n.from)(A).pipe(Object(C.mergeMap)((e=>e),H.b)).subscribe({next:e=>{if(p({isRunning:!1,loaded:0,total:100,error:void 0}),e){const a=[];var t;Array.isArray(e)?e.forEach((e=>{void 0!==e.fieldName&&I.set(e.fieldName,e)})):a.push(...null!==(t=e.fields)&&void 0!==t?t:[]),c(I),p({loaded:I.size/S.length*100,isRunning:!0}),a.length>0&&(N.next(I),T.next(a))}},error:M,complete:z}),b.current=Object(n.combineLatest)([N,T.pipe(Object(C.switchMap)((e=>Object(n.combineLatest)(e.map((e=>G(s.search,_,[e],w))).filter((e=>void 0!==e))))))]).subscribe({next:e=>{const t=Object(d.cloneDeep)(e[0]),a=e[1];Array.isArray(a)&&(a.forEach((e=>{Array.isArray(e)&&1===e.length&&t.set(e[0].fields[0],e[0])})),c(t),p({loaded:t.size/S.length*100,isRunning:!0}))},error:M,complete:z})}),[s.search,l,t,a.pageSize,a.pageIndex,a.sortDirection,a.sortField]),v=Object(r.useCallback)((()=>{var e,t;null===(e=g.current)||void 0===e||e.unsubscribe(),g.current=void 0,null===(t=b.current)||void 0===t||t.unsubscribe(),b.current=void 0,m.current.abort(),p({isRunning:!1})}),[]);return Object(r.useEffect)((()=>(h(),v)),[h,v]),{progress:f,fieldStats:u,startFetch:h,cancelFetch:v}}(oe,Object(r.useMemo)((()=>{if(!(ue.loaded<100))return{metricConfigs:D.map((e=>{var t,a;return{fieldName:e.fieldName,type:e.type,cardinality:null!==(t=null===(a=e.stats)||void 0===a?void 0:a.cardinality)&&void 0!==t?t:0,existsInDocs:e.existsInDocs}})).filter((e=>void 0!==e)),nonMetricConfigs:re.map((e=>{var t,a;return{fieldName:e.fieldName,type:e.type,cardinality:null!==(t=null===(a=e.stats)||void 0===a?void 0:a.cardinality)&&void 0!==t?t:0,existsInDocs:e.existsInDocs}})).filter((e=>void 0!==e))}}),[D,re,ue.loaded]),t),de=Object(r.useMemo)((()=>.2*ue.loaded+.8*ce.progress.loaded),[ue.loaded,ce.progress.loaded]);Object(r.useEffect)((()=>{const e=Object(n.merge)(L.getTimeUpdate$(),L.getAutoRefreshFetch$(),u.a).subscribe((()=>{a&&a({time:L.getTime(),refreshInterval:L.getRefreshInterval()}),v(Date.now())}));return()=>{e.unsubscribe()}}));const fe=Object(r.useMemo)((()=>j.fields),[j]),pe=Object(r.useCallback)((()=>{const e=[],t=le.aggregatableExistsFields||[],a=fe.filter((e=>e.type===s.KBN_FIELD_TYPES.NUMBER&&void 0!==e.displayName&&!0===X(e.displayName))),r=a.filter((e=>t.find((t=>t.fieldName===e.spec.name))));if(!1===U)return void ee(!0);let n=le.aggregatableExistsFields;a.length!==r.length&&!0===U&&(n=n.concat(le.aggregatableNotExistsFields));const i=!0===U&&!0===b?a:r;i.forEach((t=>{var a;const r=n.find((e=>e.fieldName===t.spec.name));if(!r)return;const i={...r,fieldFormat:j.getFormatterForField(t),type:w.e.NUMBER,loading:null===(a=null==r?void 0:r.existsInDocs)||void 0===a||a,aggregatable:!0,deletable:void 0!==t.runtimeField};t.displayName!==i.fieldName&&(i.displayName=t.displayName),e.push(i)})),ae({totalMetricFieldsCount:a.length,visibleMetricsCount:i.length}),Q(e)}),[j,fe,U,le,b]),me=Object(r.useCallback)((()=>{const e=fe.filter((e=>e.type!==s.KBN_FIELD_TYPES.NUMBER&&void 0!==e.displayName&&!0===X(e.displayName))),t=[];let a=[];const r=le.aggregatableExistsFields||[],n=le.nonAggregatableExistsFields||[];if(e.forEach((e=>{const i=r.find((t=>t.fieldName===e.spec.name));if(void 0!==i)t.push(e),a.push(i);else{const r=n.find((t=>t.fieldName===e.spec.name));void 0!==r&&(t.push(e),a.push(r))}})),!1===ie)return void se(!0);e.length!==a.length&&!0===b&&(a=a.concat(le.aggregatableNotExistsFields,le.nonAggregatableNotExistsFields));const i=[];(b?e:t).forEach((e=>{var t;const r=a.find((t=>t.fieldName===e.spec.name)),n={...r||{},fieldFormat:j.getFormatterForField(e),aggregatable:e.aggregatable,loading:null===(t=null==r?void 0:r.existsInDocs)||void 0===t||t,deletable:void 0!==e.runtimeField},s=Object(F.c)(e);void 0!==s?n.type=s:(n.type=e.type,n.isUnsupportedType=!0),e.displayName!==n.fieldName&&(n.displayName=e.displayName),i.push(n)})),ne(i)}),[j,fe,ie,le,b]);Object(r.useEffect)((()=>{pe(),me()}),[le,b]);const ge=Object(r.useMemo)((()=>{const e=ce.fieldStats;let t=[...re,...D];return g&&g.length>0&&(t=t.filter((e=>g.findIndex((t=>t===e.type))>-1))),_&&_.length>0&&(t=t.filter((e=>_.findIndex((t=>t===e.fieldName))>-1))),e&&(t=t.map((t=>{var a;const r=null!==(a=e.get(t.fieldName))&&void 0!==a?a:{};return r?{...t,loading:!1,stats:{...t.stats,...r}}:t}))),t}),[re,D,g,_,ce.progress.loaded,t.pageIndex,t.pageSize]),be=Object(r.useRef)();Object(r.useEffect)((()=>{const e=be;return()=>{e.current&&e.current()}}),[]);const he=Object(r.useMemo)((()=>{const t=z(e.dataView,c,{searchQueryLanguage:T,searchString:A},e.allowEditDataView?be:void 0);if(Array.isArray(t)&&!(t.length<1))return[{name:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.actionsColumnLabel",{defaultMessage:"Actions"}),actions:t,width:"70px"}]}),[e.dataView,c,T,A,e.allowEditDataView]);return{progress:de,configs:ge,searchQueryLanguage:T,searchString:A,searchQuery:M,extendedColumns:he,documentCountStats:le.documentCountStats,metricsStats:te,overallStats:le,timefilter:L,setLastRefresh:v}}},87:function(e,t,a){"use strict";a.d(t,"a",(function(){return y}));var r=a(0),n=a(55),i=a(56),s=a(64),o=a(48),l=a(4),u=a(73),c=a(54),d=a(5);const f=({config:e,dataView:t,combinedQuery:a})=>{const{stats:f}=e,[p,m]=Object(r.useState)([]),{services:{maps:g,data:b}}=Object(o.a)();return Object(r.useEffect)((()=>{!async function(){if(void 0!==(null==t?void 0:t.id)&&void 0!==e&&void 0!==e.fieldName&&(e.type===l.e.GEO_POINT||e.type===l.e.GEO_SHAPE)){var r;const n={indexPatternId:t.id,geoFieldName:e.fieldName,geoFieldType:e.type,filters:null!==(r=b.query.filterManager.getFilters())&&void 0!==r?r:[],query:{query:a.searchString,language:a.searchQueryLanguage}},i=g?await g.createLayerDescriptors.createESSearchSourceLayerDescriptor(n):null;i&&m([...p,i])}}()}),[t,a,e,g,b.query]),void 0===(null==f?void 0:f.examples)?null:Object(d.jsx)(n.a,{dataTestSubj:"dataVisualizerIndexBasedMapContent"},Object(d.jsx)(i.a,{config:e}),Object(d.jsx)(s.a,{examples:f.examples}),Object(d.jsx)(c.a,{className:"dvPanel__wrapper dvMap__wrapper",grow:!0},Object(d.jsx)(u.a,{layerList:p})))};var p=a(86),m=a(20),g=a(21);const b=()=>Object(d.jsx)(r.Fragment,null,Object(d.jsx)(m.EuiText,{textAlign:"center"},Object(d.jsx)(m.EuiIcon,{type:"alert"})),Object(d.jsx)(m.EuiText,{textAlign:"center",size:"xs"},Object(d.jsx)(g.FormattedMessage,{id:"xpack.dataVisualizer.dataGrid.field.fieldNotInDocsLabel",defaultMessage:"This field does not appear in any documents for the selected time range"}))),h=()=>Object(d.jsx)(r.Fragment,null,Object(d.jsx)(m.EuiSpacer,{size:"xxl"}),Object(d.jsx)(m.EuiFlexGroup,{justifyContent:"spaceAround"},Object(d.jsx)(m.EuiFlexItem,{grow:!1},Object(d.jsx)(m.EuiLoadingSpinner,{size:"l"}))),Object(d.jsx)(m.EuiFlexGroup,{justifyContent:"spaceAround"},Object(d.jsx)(m.EuiFlexItem,{grow:!1},Object(d.jsx)(m.EuiText,{color:"subdued"},Object(d.jsx)(g.FormattedMessage,{id:"xpack.dataVisualizer.dataGrid.field.loadingLabel",defaultMessage:"Loading"})))));var v=a(77);const y=({item:e,dataView:t,combinedQuery:a,onAddFilter:r})=>{const n=e,{loading:i,type:s,existsInDocs:o,fieldName:u}=n;return Object(d.jsx)("div",{className:"dvExpandedRow","data-test-subj":`dataVisualizerFieldExpandedRow-${u}`},!0===i?Object(d.jsx)(h,null):function(){var e,i;if(!1===o)return Object(d.jsx)(b,null);if(null!==(e=n.stats)&&void 0!==e&&e.error)return Object(d.jsx)(v.a,{fieldName:u,error:null===(i=n.stats)||void 0===i?void 0:i.error});switch(s){case l.e.NUMBER:return Object(d.jsx)(p.e,{config:n,onAddFilter:r});case l.e.BOOLEAN:return Object(d.jsx)(p.a,{config:n});case l.e.DATE:return Object(d.jsx)(p.b,{config:n});case l.e.GEO_POINT:case l.e.GEO_SHAPE:return Object(d.jsx)(f,{config:n,dataView:t,combinedQuery:a});case l.e.IP:return Object(d.jsx)(p.c,{config:n,onAddFilter:r});case l.e.KEYWORD:return Object(d.jsx)(p.d,{config:n,onAddFilter:r});case l.e.TEXT:return Object(d.jsx)(p.g,{config:n});default:return Object(d.jsx)(p.f,{config:n})}}())}}}]);