/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.lens_bundle_jsonpfunction=window.lens_bundle_jsonpfunction||[]).push([[1,11],Array(80).concat([function(e,t,a){"use strict";a.r(t),a.d(t,"visualizationTypes",(function(){return d}));var n=a(0),i=a(21),l=a.n(i),s=(a(7),a(2)),r=a(91),o=a(92);const u=n.i18n.translate("xpack.lens.xyVisualization.barGroupLabel",{defaultMessage:"Bar"}),c=n.i18n.translate("xpack.lens.xyVisualization.lineGroupLabel",{defaultMessage:"Line and area"}),d=[{id:"bar",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M5 7a1 1 0 011 1v13a1 1 0 01-1 1H1a1 1 0 01-1-1V8a1 1 0 011-1h4zm16-7a1 1 0 011 1v20a1 1 0 01-1 1h-4a1 1 0 01-1-1V1a1 1 0 011-1h4z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M13 11a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1v-9a1 1 0 011-1h4zm16-7a1 1 0 011 1v16a1 1 0 01-1 1h-4a1 1 0 01-1-1V5a1 1 0 011-1h4z",className:"lensChartIcon__accent"})),label:n.i18n.translate("xpack.lens.xyVisualization.barLabel",{defaultMessage:"Bar vertical"}),groupLabel:u,sortPriority:4},{id:"bar_horizontal",icon:o.a,label:n.i18n.translate("xpack.lens.xyVisualization.barHorizontalLabel",{defaultMessage:"H. Bar"}),fullLabel:n.i18n.translate("xpack.lens.xyVisualization.barHorizontalFullLabel",{defaultMessage:"Bar horizontal"}),groupLabel:u},{id:"bar_stacked",icon:r.a,label:n.i18n.translate("xpack.lens.xyVisualization.stackedBarLabel",{defaultMessage:"Bar vertical stacked"}),groupLabel:u},{id:"bar_percentage_stacked",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M6 13v8a1 1 0 01-1 1H1a1 1 0 01-1-1v-8h6zm8-4v12a1 1 0 01-1 1H9a1 1 0 01-1-1V9h6zm8 4v8a1 1 0 01-1 1h-4a1 1 0 01-1-1v-8h6zm8 1v7a1 1 0 01-1 1h-4a1 1 0 01-1-1v-7h6z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M29 0a1 1 0 011 1v11h-6V1a1 1 0 011-1h4zM5 0a1 1 0 011 1v10H0V1a1 1 0 011-1h4zm16 0a1 1 0 011 1v10h-6V1a1 1 0 011-1h4zm-8 0a1 1 0 011 1v6H8V1a1 1 0 011-1h4z",className:"lensChartIcon__accent"})),label:n.i18n.translate("xpack.lens.xyVisualization.stackedPercentageBarLabel",{defaultMessage:"Bar vertical percentage"}),groupLabel:u},{id:"bar_horizontal_stacked",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M18 16v6H1a1 1 0 01-1-1v-4a1 1 0 011-1h17zm-3-8v6H1.222C.547 14 0 13.552 0 13V9c0-.552.547-1 1.222-1H15zm1-8v6H1.042C.466 6 0 5.552 0 5V1c0-.552.466-1 1.042-1H16z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M29 16a1 1 0 011 1v4a1 1 0 01-1 1h-9v-6h9zm-9.222-8C20.453 8 21 8.448 21 9v4c0 .552-.547 1-1.222 1H17V8h2.778zm3.18-8C23.534 0 24 .448 24 1v4c0 .552-.466 1-1.042 1H18V0h4.958z",className:"lensChartIcon__accent"})),label:n.i18n.translate("xpack.lens.xyVisualization.stackedBarHorizontalLabel",{defaultMessage:"H. Stacked bar"}),fullLabel:n.i18n.translate("xpack.lens.xyVisualization.stackedBarHorizontalFullLabel",{defaultMessage:"Bar horizontal stacked"}),groupLabel:u},{id:"bar_horizontal_percentage_stacked",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M20 16v6H1a1 1 0 01-1-1v-4a1 1 0 011-1h19zm-3-8v6H1.222C.547 14 0 13.552 0 13V9c0-.552.547-1 1.222-1H17zm1-8v6H1.042C.466 6 0 5.552 0 5V1c0-.552.466-1 1.042-1H18z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M29 16a1 1 0 011 1v4a1 1 0 01-1 1h-7v-6h7zm-.222-8C29.453 8 30 8.448 30 9v4c0 .552-.547 1-1.222 1H19V8h9.778zm.18-8C29.534 0 30 .448 30 1v4c0 .552-.466 1-1.042 1H20V0h8.958z",className:"lensChartIcon__accent"})),label:n.i18n.translate("xpack.lens.xyVisualization.stackedPercentageBarHorizontalLabel",{defaultMessage:"H. Percentage bar"}),fullLabel:n.i18n.translate("xpack.lens.xyVisualization.stackedPercentageBarHorizontalFullLabel",{defaultMessage:"Bar horizontal percentage"}),groupLabel:u},{id:"area",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M30 6v15a1 1 0 01-1 1H1a1 1 0 01-1-1v-2c1 0 3.5-4 6-4s5 3 6 3 3.23-6.994 5.865-6.997C20.5 11 23 11 24 11s3-5 6-5z",className:"lensChartIcon__accent"}),Object(s.jsx)("path",{d:"M6 1c3 0 5 6 6 6s3.5-3 6-3c1.667 0 2.944 2.333 3.833 6.999l.309.001c-1.013 0-2.27 0-3.593.002h-.684C15.231 11.007 13 18 12 18s-3.5-3-6-3-5 4-6 4V7c1-1.5 3-6 6-6z",className:"lensChartIcon__subdued"})),label:n.i18n.translate("xpack.lens.xyVisualization.areaLabel",{defaultMessage:"Area"}),groupLabel:c},{id:"area_stacked",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:31,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M0 15.213l.484.091.813.146.762.129C3.779 15.859 5.09 16 6 16c.986 0 1.712-.25 3.166-.966l.281-.14C10.802 14.217 11.381 14 12 14c.507 0 .988.146 1.89.571l1.209.592c1.28.617 1.977.837 2.901.837 1.028 0 1.75-.349 3.119-1.344l.89-.659C23.034 13.252 23.535 13 24 13c.581 0 1.232.185 2.598.718l1.1.436.568.217c.72.27 1.256.438 1.736.532L30 21a1 1 0 01-1 1H1a1 1 0 01-1-1v-5.787z",className:"lensChartIcon__accent"}),Object(s.jsx)("path",{d:"M24 1c1.334 0 3.334 1 6 3v8.842l-.324-.098c-.346-.11-.759-.262-1.273-.462l-1.101-.436-.568-.217-.536-.193C25.277 11.118 24.676 11 24 11c-1.028 0-1.75.349-3.119 1.344l-.89.659c-1.024.745-1.524.997-1.99.997-.508 0-.989-.146-1.89-.571l-1.21-.592c-1.28-.617-1.977-.837-2.9-.837-.987 0-1.713.25-3.167.966l-.281.14C7.198 13.783 6.619 14 6 14l-.334-.007c-1.182-.045-3.08-.317-5.665-.815V9c2 0 4.666 1 6 1 2 0 4-4 6-4s4 1 6 1 4-6 6-6z",className:"lensChartIcon__subdued"})),label:n.i18n.translate("xpack.lens.xyVisualization.stackedAreaLabel",{defaultMessage:"Area stacked"}),groupLabel:c},{id:"area_percentage_stacked",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M0 13v8a1 1 0 001 1h28a1 1 0 001-1V9.25c-1.251-.929-2.45-1.734-3.493-2.313a11.028 11.028 0 00-1.478-.703C24.592 6.072 24.25 6 24 6c-.262 0-.63.212-1.126.77-.472.53-.952 1.249-1.458 2.007l-.013.02c-.49.736-1.006 1.51-1.53 2.098C19.37 11.462 18.739 12 18 12c-1.062 0-2.112-.263-3.092-.508l-.03-.007C13.869 11.232 12.929 11 12 11c-.337 0-.729.171-1.2.525-.466.35-.94.822-1.446 1.329l-.015.015c-.49.489-1.01 1.01-1.539 1.406-.529.396-1.137.725-1.8.725-.657 0-1.57-.212-2.48-.424l-.058-.014C2.275 14.287 1.032 14 0 14v-1z",className:"lensChartIcon__accent"}),Object(s.jsx)("path",{d:"M29 0a1 1 0 011 1v6.012c-1.06-.764-2.085-1.437-3.007-1.95a11.93 11.93 0 00-1.616-.765C24.887 4.115 24.418 4 24 4c-.738 0-1.369.538-1.874 1.105-.523.589-1.039 1.362-1.529 2.098l-.013.02c-.506.758-.985 1.476-1.458 2.007-.495.558-.864.77-1.126.77-.928 0-1.867-.232-2.879-.485l-.029-.007C14.112 9.263 13.062 9 12 9c-.663 0-1.271.328-1.8.725-.528.396-1.05.917-1.538 1.406l-.015.015c-.507.507-.98.98-1.447 1.329-.471.354-.863.525-1.2.525-.528 0-1.328-.183-2.311-.412l-.034-.007C2.507 12.314 1.159 12 .001 12V1a1 1 0 011-1h28z",className:"lensChartIcon__subdued"})),label:n.i18n.translate("xpack.lens.xyVisualization.stackedPercentageAreaLabel",{defaultMessage:"Area percentage"}),groupLabel:c},{id:"line",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M23.434 16.456c.211.553.406.982.58 1.277l.073.119c.038.058.072.105.101.141.52-.04 1.07-.248 2.13-.77l.235-.117C28.198 16.283 28.953 16 30 16v2c-.507 0-.988.146-1.89.571l-1.209.592C25.621 19.78 24.924 20 24 20l-.174-.005c-1.251-.076-1.805-1.036-2.994-4.993L22.93 15c.18.563.335 1.012.505 1.455zM6 1c1.269 0 1.966.69 3.492 2.939l.774 1.146.272.387.26.358C11.419 6.658 11.788 7 12 7c.466 0 .967-.252 1.99-.997l.891-.659.458-.325C16.424 4.272 17.093 4 18 4c1.377 0 1.925.863 3.168 4.999L19.07 9a26.766 26.766 0 00-.505-1.457c-.24-.631-.46-1.1-.652-1.395l-.051-.074-.045-.06c-.452.064-.988.375-2.007 1.13l-.691.512-.458.325C13.576 8.728 12.907 9 12 9c-1.269 0-1.966-.69-3.492-2.939l-.774-1.146-.272-.387-.26-.358C6.581 3.342 6.213 3 6 3c-.294 0-.885.651-2.017 2.33l-.491.731-.326.475C1.859 8.409 1.175 9 0 9V7c.294 0 .885-.651 2.017-2.33l.491-.731.326-.475C4.141 1.591 4.825 1 6 1z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M0 21c1.123 0 1.852-.477 3.295-1.885l.758-.75.345-.33C5.208 17.275 5.648 17 6 17c.466 0 .967.252 1.99.997l.891.659.458.325C10.424 19.728 11.093 20 12 20c1.325 0 1.996-.772 3.546-3.444l.593-1.028.385-.646C17.328 13.562 17.796 13 18 13h6c1.333 0 1.978-.795 3.452-3.676l.692-1.37.358-.69C29.333 5.7 29.831 5 30 5V3c-1.333 0-1.978.795-3.452 3.676l-.692 1.37-.358.69C24.667 10.3 24.169 11 24 11h-6c-1.325 0-1.996.772-3.546 3.444l-.593 1.028-.385.646C12.672 17.438 12.204 18 12 18c-.466 0-.967-.252-1.99-.997l-.891-.659-.458-.325C7.576 15.272 6.907 15 6 15c-1.123 0-1.852.477-3.295 1.885l-.758.75-.345.33C.792 18.725.352 19 0 19v2z",className:"lensChartIcon__accent"})),label:n.i18n.translate("xpack.lens.xyVisualization.lineLabel",{defaultMessage:"Line"}),groupLabel:c,sortPriority:2}]},,,,,,,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(21),i=a.n(n),l=(a(7),a(2));const s=({title:e,titleId:t,...a})=>Object(l.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(l.jsx)("title",{id:t},e):null,Object(l.jsx)("path",{className:"lensChartIcon__subdued",d:"M6 13v8a1 1 0 01-1 1H1a1 1 0 01-1-1v-8h6zm8-4v12a1 1 0 01-1 1H9a1 1 0 01-1-1V9h6zm8 4v8a1 1 0 01-1 1h-4a1 1 0 01-1-1v-8h6zm8 1v7a1 1 0 01-1 1h-4a1 1 0 01-1-1v-7h6z"}),Object(l.jsx)("path",{d:"M29 1a1 1 0 011 1v10h-6V2a1 1 0 011-1h4zM5 7a1 1 0 011 1v3H0V8a1 1 0 011-1h4zm16-4a1 1 0 011 1v7h-6V4a1 1 0 011-1h4zm-8-3a1 1 0 011 1v6H8V1a1 1 0 011-1h4z",className:"lensChartIcon__accent"}))},function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(21),i=a.n(n),l=(a(7),a(2));const s=({title:e,titleId:t,...a})=>Object(l.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(l.jsx)("title",{id:t},e):null,Object(l.jsx)("path",{d:"M29 16a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1v-4a1 1 0 011-1h28zM22 0a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1V1a1 1 0 011-1h21z",className:"lensChartIcon__subdued"}),Object(l.jsx)("path",{d:"M0 9a1 1 0 011-1h15a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1V9z",className:"lensChartIcon__accent"}))},,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return d}));var n=a(69),i=a.n(n),l=a(7),s=a.n(l),r=a(2),o=["children"],u=s.a.createContext(null),c=function(e){var t,a=e.children,n=i()(e,o),l=n.coreStart,s=n.dataViewEditor,c=n.dataViews,d={addBasePath:l.http.basePath.prepend,canAccessFleet:l.application.capabilities.navLinks.integrations,canCreateNewDataView:s.userPermissions.editDataView(),currentAppId$:l.application.currentAppId$,dataViewsDocLink:null===(t=l.docLinks.links.indexPatterns)||void 0===t?void 0:t.introduction,hasDataView:c.hasData.hasDataView,hasESData:c.hasData.hasESData,hasUserDataView:c.hasData.hasUserDataView,kibanaGuideDocLink:l.docLinks.links.kibana.guide,navigateToUrl:l.application.navigateToUrl,openDataViewEditor:s.openEditor,setIsFullscreen:function(e){return l.chrome.setIsVisible(e)}};return Object(r.jsx)(u.Provider,{value:d},a)};function d(){var e=Object(l.useContext)(u);if(!e)throw new Error("AnalyticsNoDataPageContext is missing.  Ensure your component or React root is wrapped with AnalyticsNoDataPageContext.");return e}},,,,,,,,,,,function(e,t){e.exports={pow:function(e,t){if(null==t)throw new Error("Missing exponent");return Array.isArray(e)?e.map((e=>Math.pow(e,t))):Math.pow(e,t)}}},,,function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n={number:{decimalsToPattern:(e=2)=>0===e?"0,0":`0,0.${"0".repeat(e)}`},percent:{decimalsToPattern:(e=2)=>0===e?"0,0%":`0,0.${"0".repeat(e)}%`},bytes:{decimalsToPattern:(e=2)=>0===e?"0,0b":`0,0.${"0".repeat(e)}b`}}},,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(328);case"v8light":return a(330)}},,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){const n=a(230),i=a(233),l=["keyword","gray","hex"],s={};for(const e of Object.keys(i))s[[...i[e].labels].sort().join("")]=e;const r={};function o(e,t){if(!(this instanceof o))return new o(e,t);if(t&&t in l&&(t=null),t&&!(t in i))throw new Error("Unknown model: "+t);let a,u;if(null==e)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof o)this.model=e.model,this.color=[...e.color],this.valpha=e.valpha;else if("string"==typeof e){const t=n.get(e);if(null===t)throw new Error("Unable to parse color from string: "+e);this.model=t.model,u=i[this.model].channels,this.color=t.value.slice(0,u),this.valpha="number"==typeof t.value[u]?t.value[u]:1}else if(e.length>0){this.model=t||"rgb",u=i[this.model].channels;const a=Array.prototype.slice.call(e,0,u);this.color=p(a,u),this.valpha="number"==typeof e[u]?e[u]:1}else if("number"==typeof e)this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;const t=Object.keys(e);"alpha"in e&&(t.splice(t.indexOf("alpha"),1),this.valpha="number"==typeof e.alpha?e.alpha:0);const n=t.sort().join("");if(!(n in s))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=s[n];const{labels:l}=i[this.model],r=[];for(a=0;a<l.length;a++)r.push(e[l[a]]);this.color=p(r)}if(r[this.model])for(u=i[this.model].channels,a=0;a<u;a++){const e=r[this.model][a];e&&(this.color[a]=e(this.color[a]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}o.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(e){let t=this.model in n.to?this:this.rgb();t=t.round("number"==typeof e?e:1);const a=1===t.valpha?t.color:[...t.color,this.valpha];return n.to[t.model](a)},percentString(e){const t=this.rgb().round("number"==typeof e?e:1),a=1===t.valpha?t.color:[...t.color,this.valpha];return n.to.rgb.percent(a)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const e={},{channels:t}=i[this.model],{labels:a}=i[this.model];for(let n=0;n<t;n++)e[a[n]]=this.color[n];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray(){const e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject(){const e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round(e){return e=Math.max(e||0,0),new o([...this.color.map(u(e)),this.valpha],this.model)},alpha(e){return void 0!==e?new o([...this.color,Math.max(0,Math.min(1,e))],this.model):this.valpha},red:c("rgb",0,d(255)),green:c("rgb",1,d(255)),blue:c("rgb",2,d(255)),hue:c(["hsl","hsv","hsl","hwb","hcg"],0,(e=>(e%360+360)%360)),saturationl:c("hsl",1,d(100)),lightness:c("hsl",2,d(100)),saturationv:c("hsv",1,d(100)),value:c("hsv",2,d(100)),chroma:c("hcg",1,d(100)),gray:c("hcg",2,d(100)),white:c("hwb",1,d(100)),wblack:c("hwb",2,d(100)),cyan:c("cmyk",0,d(100)),magenta:c("cmyk",1,d(100)),yellow:c("cmyk",2,d(100)),black:c("cmyk",3,d(100)),x:c("xyz",0,d(95.047)),y:c("xyz",1,d(100)),z:c("xyz",2,d(108.833)),l:c("lab",0,d(100)),a:c("lab",1),b:c("lab",2),keyword(e){return void 0!==e?new o(e):i[this.model].keyword(this.color)},hex(e){return void 0!==e?new o(e):n.to.hex(this.rgb().round().color)},hexa(e){if(void 0!==e)return new o(e);const t=this.rgb().round().color;let a=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===a.length&&(a="0"+a),n.to.hex(t)+a},rgbNumber(){const e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity(){const e=this.rgb().color,t=[];for(const[a,n]of e.entries()){const e=n/255;t[a]=e<=.04045?e/12.92:((e+.055)/1.055)**2.4}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast(e){const t=this.luminosity(),a=e.luminosity();return t>a?(t+.05)/(a+.05):(a+.05)/(t+.05)},level(e){const t=this.contrast(e);return t>=7?"AAA":t>=4.5?"AA":""},isDark(){const e=this.rgb().color;return(2126*e[0]+7152*e[1]+722*e[2])/1e4<128},isLight(){return!this.isDark()},negate(){const e=this.rgb();for(let t=0;t<3;t++)e.color[t]=255-e.color[t];return e},lighten(e){const t=this.hsl();return t.color[2]+=t.color[2]*e,t},darken(e){const t=this.hsl();return t.color[2]-=t.color[2]*e,t},saturate(e){const t=this.hsl();return t.color[1]+=t.color[1]*e,t},desaturate(e){const t=this.hsl();return t.color[1]-=t.color[1]*e,t},whiten(e){const t=this.hwb();return t.color[1]+=t.color[1]*e,t},blacken(e){const t=this.hwb();return t.color[2]+=t.color[2]*e,t},grayscale(){const e=this.rgb().color,t=.3*e[0]+.59*e[1]+.11*e[2];return o.rgb(t,t,t)},fade(e){return this.alpha(this.valpha-this.valpha*e)},opaquer(e){return this.alpha(this.valpha+this.valpha*e)},rotate(e){const t=this.hsl();let a=t.color[0];return a=(a+e)%360,a=a<0?360+a:a,t.color[0]=a,t},mix(e,t){if(!e||!e.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof e);const a=e.rgb(),n=this.rgb(),i=void 0===t?.5:t,l=2*i-1,s=a.alpha()-n.alpha(),r=((l*s==-1?l:(l+s)/(1+l*s))+1)/2,u=1-r;return o.rgb(r*a.red()+u*n.red(),r*a.green()+u*n.green(),r*a.blue()+u*n.blue(),a.alpha()*i+n.alpha()*(1-i))}};for(const e of Object.keys(i)){if(l.includes(e))continue;const{channels:t}=i[e];o.prototype[e]=function(...t){return this.model===e?new o(this):t.length>0?new o(t,e):new o([...(a=i[this.model][e].raw(this.color),Array.isArray(a)?a:[a]),this.valpha],e);var a},o[e]=function(...a){let n=a[0];return"number"==typeof n&&(n=p(a,t)),new o(n,e)}}function u(e){return function(t){return function(e,t){return Number(e.toFixed(t))}(t,e)}}function c(e,t,a){e=Array.isArray(e)?e:[e];for(const n of e)(r[n]||(r[n]=[]))[t]=a;return e=e[0],function(n){let i;return void 0!==n?(a&&(n=a(n)),i=this[e](),i.color[t]=n,i):(i=this[e]().color[t],a&&(i=a(i)),i)}}function d(e){return function(t){return Math.max(0,Math.min(e,t))}}function p(e,t){for(let a=0;a<t;a++)"number"!=typeof e[a]&&(e[a]=0);return e}e.exports=o},function(e,t,a){"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},function(e,t,a){const n=a(136),i={};for(const e of Object.keys(n))i[n[e]]=e;const l={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};e.exports=l;for(const e of Object.keys(l)){if(!("channels"in l[e]))throw new Error("missing channels property: "+e);if(!("labels"in l[e]))throw new Error("missing channel labels property: "+e);if(l[e].labels.length!==l[e].channels)throw new Error("channel and label counts mismatch: "+e);const{channels:t,labels:a}=l[e];delete l[e].channels,delete l[e].labels,Object.defineProperty(l[e],"channels",{value:t}),Object.defineProperty(l[e],"labels",{value:a})}l.rgb.hsl=function(e){const t=e[0]/255,a=e[1]/255,n=e[2]/255,i=Math.min(t,a,n),l=Math.max(t,a,n),s=l-i;let r,o;l===i?r=0:t===l?r=(a-n)/s:a===l?r=2+(n-t)/s:n===l&&(r=4+(t-a)/s),r=Math.min(60*r,360),r<0&&(r+=360);const u=(i+l)/2;return o=l===i?0:u<=.5?s/(l+i):s/(2-l-i),[r,100*o,100*u]},l.rgb.hsv=function(e){let t,a,n,i,l;const s=e[0]/255,r=e[1]/255,o=e[2]/255,u=Math.max(s,r,o),c=u-Math.min(s,r,o),d=function(e){return(u-e)/6/c+.5};return 0===c?(i=0,l=0):(l=c/u,t=d(s),a=d(r),n=d(o),s===u?i=n-a:r===u?i=1/3+t-n:o===u&&(i=2/3+a-t),i<0?i+=1:i>1&&(i-=1)),[360*i,100*l,100*u]},l.rgb.hwb=function(e){const t=e[0],a=e[1];let n=e[2];const i=l.rgb.hsl(e)[0],s=1/255*Math.min(t,Math.min(a,n));return n=1-1/255*Math.max(t,Math.max(a,n)),[i,100*s,100*n]},l.rgb.cmyk=function(e){const t=e[0]/255,a=e[1]/255,n=e[2]/255,i=Math.min(1-t,1-a,1-n);return[100*((1-t-i)/(1-i)||0),100*((1-a-i)/(1-i)||0),100*((1-n-i)/(1-i)||0),100*i]},l.rgb.keyword=function(e){const t=i[e];if(t)return t;let a,l=1/0;for(const t of Object.keys(n)){const i=(r=n[t],((s=e)[0]-r[0])**2+(s[1]-r[1])**2+(s[2]-r[2])**2);i<l&&(l=i,a=t)}var s,r;return a},l.keyword.rgb=function(e){return n[e]},l.rgb.xyz=function(e){let t=e[0]/255,a=e[1]/255,n=e[2]/255;return t=t>.04045?((t+.055)/1.055)**2.4:t/12.92,a=a>.04045?((a+.055)/1.055)**2.4:a/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92,[100*(.4124*t+.3576*a+.1805*n),100*(.2126*t+.7152*a+.0722*n),100*(.0193*t+.1192*a+.9505*n)]},l.rgb.lab=function(e){const t=l.rgb.xyz(e);let a=t[0],n=t[1],i=t[2];return a/=95.047,n/=100,i/=108.883,a=a>.008856?a**(1/3):7.787*a+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,i=i>.008856?i**(1/3):7.787*i+16/116,[116*n-16,500*(a-n),200*(n-i)]},l.hsl.rgb=function(e){const t=e[0]/360,a=e[1]/100,n=e[2]/100;let i,l,s;if(0===a)return s=255*n,[s,s,s];i=n<.5?n*(1+a):n+a-n*a;const r=2*n-i,o=[0,0,0];for(let e=0;e<3;e++)l=t+1/3*-(e-1),l<0&&l++,l>1&&l--,s=6*l<1?r+6*(i-r)*l:2*l<1?i:3*l<2?r+(i-r)*(2/3-l)*6:r,o[e]=255*s;return o},l.hsl.hsv=function(e){const t=e[0];let a=e[1]/100,n=e[2]/100,i=a;const l=Math.max(n,.01);return n*=2,a*=n<=1?n:2-n,i*=l<=1?l:2-l,[t,100*(0===n?2*i/(l+i):2*a/(n+a)),(n+a)/2*100]},l.hsv.rgb=function(e){const t=e[0]/60,a=e[1]/100;let n=e[2]/100;const i=Math.floor(t)%6,l=t-Math.floor(t),s=255*n*(1-a),r=255*n*(1-a*l),o=255*n*(1-a*(1-l));switch(n*=255,i){case 0:return[n,o,s];case 1:return[r,n,s];case 2:return[s,n,o];case 3:return[s,r,n];case 4:return[o,s,n];case 5:return[n,s,r]}},l.hsv.hsl=function(e){const t=e[0],a=e[1]/100,n=e[2]/100,i=Math.max(n,.01);let l,s;s=(2-a)*n;const r=(2-a)*i;return l=a*i,l/=r<=1?r:2-r,l=l||0,s/=2,[t,100*l,100*s]},l.hwb.rgb=function(e){const t=e[0]/360;let a=e[1]/100,n=e[2]/100;const i=a+n;let l;i>1&&(a/=i,n/=i);const s=Math.floor(6*t),r=1-n;l=6*t-s,0!=(1&s)&&(l=1-l);const o=a+l*(r-a);let u,c,d;switch(s){default:case 6:case 0:u=r,c=o,d=a;break;case 1:u=o,c=r,d=a;break;case 2:u=a,c=r,d=o;break;case 3:u=a,c=o,d=r;break;case 4:u=o,c=a,d=r;break;case 5:u=r,c=a,d=o}return[255*u,255*c,255*d]},l.cmyk.rgb=function(e){const t=e[0]/100,a=e[1]/100,n=e[2]/100,i=e[3]/100;return[255*(1-Math.min(1,t*(1-i)+i)),255*(1-Math.min(1,a*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i))]},l.xyz.rgb=function(e){const t=e[0]/100,a=e[1]/100,n=e[2]/100;let i,l,s;return i=3.2406*t+-1.5372*a+-.4986*n,l=-.9689*t+1.8758*a+.0415*n,s=.0557*t+-.204*a+1.057*n,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,l=l>.0031308?1.055*l**(1/2.4)-.055:12.92*l,s=s>.0031308?1.055*s**(1/2.4)-.055:12.92*s,i=Math.min(Math.max(0,i),1),l=Math.min(Math.max(0,l),1),s=Math.min(Math.max(0,s),1),[255*i,255*l,255*s]},l.xyz.lab=function(e){let t=e[0],a=e[1],n=e[2];return t/=95.047,a/=100,n/=108.883,t=t>.008856?t**(1/3):7.787*t+16/116,a=a>.008856?a**(1/3):7.787*a+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,[116*a-16,500*(t-a),200*(a-n)]},l.lab.xyz=function(e){let t,a,n;a=(e[0]+16)/116,t=e[1]/500+a,n=a-e[2]/200;const i=a**3,l=t**3,s=n**3;return a=i>.008856?i:(a-16/116)/7.787,t=l>.008856?l:(t-16/116)/7.787,n=s>.008856?s:(n-16/116)/7.787,t*=95.047,a*=100,n*=108.883,[t,a,n]},l.lab.lch=function(e){const t=e[0],a=e[1],n=e[2];let i;return i=360*Math.atan2(n,a)/2/Math.PI,i<0&&(i+=360),[t,Math.sqrt(a*a+n*n),i]},l.lch.lab=function(e){const t=e[0],a=e[1],n=e[2]/360*2*Math.PI;return[t,a*Math.cos(n),a*Math.sin(n)]},l.rgb.ansi16=function(e,t=null){const[a,n,i]=e;let s=null===t?l.rgb.hsv(e)[2]:t;if(s=Math.round(s/50),0===s)return 30;let r=30+(Math.round(i/255)<<2|Math.round(n/255)<<1|Math.round(a/255));return 2===s&&(r+=60),r},l.hsv.ansi16=function(e){return l.rgb.ansi16(l.hsv.rgb(e),e[2])},l.rgb.ansi256=function(e){const t=e[0],a=e[1],n=e[2];return t===a&&a===n?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(a/255*5)+Math.round(n/255*5)},l.ansi16.rgb=function(e){let t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),t=t/10.5*255,[t,t,t];const a=.5*(1+~~(e>50));return[(1&t)*a*255,(t>>1&1)*a*255,(t>>2&1)*a*255]},l.ansi256.rgb=function(e){if(e>=232){const t=10*(e-232)+8;return[t,t,t]}let t;return e-=16,[Math.floor(e/36)/5*255,Math.floor((t=e%36)/6)/5*255,t%6/5*255]},l.rgb.hex=function(e){const t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},l.hex.rgb=function(e){const t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];let a=t[0];3===t[0].length&&(a=a.split("").map((e=>e+e)).join(""));const n=parseInt(a,16);return[n>>16&255,n>>8&255,255&n]},l.rgb.hcg=function(e){const t=e[0]/255,a=e[1]/255,n=e[2]/255,i=Math.max(Math.max(t,a),n),l=Math.min(Math.min(t,a),n),s=i-l;let r,o;return r=s<1?l/(1-s):0,o=s<=0?0:i===t?(a-n)/s%6:i===a?2+(n-t)/s:4+(t-a)/s,o/=6,o%=1,[360*o,100*s,100*r]},l.hsl.hcg=function(e){const t=e[1]/100,a=e[2]/100,n=a<.5?2*t*a:2*t*(1-a);let i=0;return n<1&&(i=(a-.5*n)/(1-n)),[e[0],100*n,100*i]},l.hsv.hcg=function(e){const t=e[1]/100,a=e[2]/100,n=t*a;let i=0;return n<1&&(i=(a-n)/(1-n)),[e[0],100*n,100*i]},l.hcg.rgb=function(e){const t=e[0]/360,a=e[1]/100,n=e[2]/100;if(0===a)return[255*n,255*n,255*n];const i=[0,0,0],l=t%1*6,s=l%1,r=1-s;let o=0;switch(Math.floor(l)){case 0:i[0]=1,i[1]=s,i[2]=0;break;case 1:i[0]=r,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=s;break;case 3:i[0]=0,i[1]=r,i[2]=1;break;case 4:i[0]=s,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=r}return o=(1-a)*n,[255*(a*i[0]+o),255*(a*i[1]+o),255*(a*i[2]+o)]},l.hcg.hsv=function(e){const t=e[1]/100,a=t+e[2]/100*(1-t);let n=0;return a>0&&(n=t/a),[e[0],100*n,100*a]},l.hcg.hsl=function(e){const t=e[1]/100,a=e[2]/100*(1-t)+.5*t;let n=0;return a>0&&a<.5?n=t/(2*a):a>=.5&&a<1&&(n=t/(2*(1-a))),[e[0],100*n,100*a]},l.hcg.hwb=function(e){const t=e[1]/100,a=t+e[2]/100*(1-t);return[e[0],100*(a-t),100*(1-a)]},l.hwb.hcg=function(e){const t=e[1]/100,a=1-e[2]/100,n=a-t;let i=0;return n<1&&(i=(a-n)/(1-n)),[e[0],100*n,100*i]},l.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},l.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},l.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},l.gray.hsl=function(e){return[0,0,e[0]]},l.gray.hsv=l.gray.hsl,l.gray.hwb=function(e){return[0,100,e[0]]},l.gray.cmyk=function(e){return[0,0,0,e[0]]},l.gray.lab=function(e){return[e[0],0,0]},l.gray.hex=function(e){const t=255&Math.round(e[0]/100*255),a=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(a.length)+a},l.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},function(e,t,a){const{get:n}=a(31),i=a(86),{functions:l}=a(255),{parse:s}=a(287),r=i((function(e,t){if(null==e)throw new Error("Missing expression");if("string"!=typeof e)throw new Error("Expression must be a string");try{return s(e,t)}catch(e){throw new Error(`Failed to parse expression. ${e.message}`)}}));function o(e,t,a){const i=Object.assign({},l,a);return function e(a){if("number"==typeof a)return a;if("function"===a.type)return function(t){const{name:a,args:n}=t,l=i[a];if(!l)throw new Error(`No such function: ${a}`);const s=n.map(e);return l.skipNumberValidation||u(s)?l(...s):NaN}(a);if("variable"===a.type){const e=function(e,t){const a=n(e,t);return void 0!==a?a:e[t]}(t,a.value);if(void 0===e)throw new Error(`Unknown variable: ${a.value}`);return e}if("namedArgument"===a.type)throw new Error(`Named arguments are not supported in tinymath itself, at ${a.name}`)}(e)}function u(e){return e.every((e=>Array.isArray(e)?u(e):"number"==typeof e&&!isNaN(e)))}e.exports={parse:r,evaluate:function(e,t={},a={}){return t=t||{},o(r(e),t,a)},interpret:o}},function(e,t){e.exports={add:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>e+t)):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e+t[a]))}return Array.isArray(e)?e.map((e=>e+t)):Array.isArray(t)?t.map((t=>t+e)):e+t}))}}},function(e,t){function a(e){if(Array.isArray(e))return e.length;throw new Error("Must pass an array")}e.exports={size:a},a.skipNumberValidation=!0},function(e,t){const a=(e,t)=>Math.log(e)/Math.log(t);e.exports={log:function(e,t=Math.E){if(t<=0)throw new Error("Base out of range");if(Array.isArray(e))return e.map((e=>{if(e<0)throw new Error("Must be greater than 0");return a(e,t)}));if(e<0)throw new Error("Must be greater than 0");return a(e,t)}}},function(e,t){e.exports={max:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>Math.max(e,t))):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>Math.max(e,t[a])))}return Array.isArray(e)?e.map((e=>Math.max(e,t))):Array.isArray(t)?t.map((t=>Math.max(t,e))):Math.max(e,t)}))}}},function(e,t){e.exports={transpose:function(e,t){const a=e[t].length;return e[t].map(((t,n)=>e.map((e=>{if(Array.isArray(e)){if(e.length!==a)throw new Error("Array length mismatch");return e[n]}return e}))))}}},function(e,t){e.exports={min:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>Math.min(e,t))):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>Math.min(e,t[a])))}return Array.isArray(e)?e.map((e=>Math.min(e,t))):Array.isArray(t)?t.map((t=>Math.min(t,e))):Math.min(e,t)}))}}},function(e,t){e.exports={subtract:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e-t[a]))}return Array.isArray(e)?e.map((e=>e-t)):Array.isArray(t)?t.map((t=>e-t)):e-t}}},,function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(7);t.default=function(e){n.useEffect(e,[])}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(332);case"v8light":return a(334)}},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(174);case"v8light":return a(176)}},function(e,t,a){var n=a(66),i=a(175);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDataTableContainer{height:100%}.lnsDataTableContainer .lnsTableCell{max-width:100%;overflow:hidden !important;text-overflow:ellipsis !important;white-space:nowrap !important;word-wrap:normal !important}.lnsTableCell--left{text-align:left}.lnsTableCell--right{text-align:right}.lnsTableCell--center{text-align:center}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(177);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDataTableContainer{height:100%}.lnsDataTableContainer .lnsTableCell{max-width:100%;overflow:hidden !important;text-overflow:ellipsis !important;white-space:nowrap !important;word-wrap:normal !important}.lnsTableCell--left{text-align:left}.lnsTableCell--right{text-align:right}.lnsTableCell--center{text-align:center}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(179);case"v8light":return a(181)}},function(e,t,a){var n=a(66),i=a(180);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisualizationContainer{scrollbar-color:rgba(152,162,179,0.5) rgba(0,0,0,0);scrollbar-width:thin;overflow:auto hidden;-webkit-user-select:text;user-select:text}.lnsVisualizationContainer::-webkit-scrollbar{width:16px;height:16px}.lnsVisualizationContainer::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsVisualizationContainer::-webkit-scrollbar-corner,.lnsVisualizationContainer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer{scrollbar-color:rgba(152,162,179,0.5) rgba(0,0,0,0);scrollbar-width:thin;position:relative;width:100%;height:100%;display:flex;overflow:auto}.lnsExpressionRenderer::-webkit-scrollbar{width:16px;height:16px}.lnsExpressionRenderer::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsExpressionRenderer::-webkit-scrollbar-corner,.lnsExpressionRenderer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer .lnsExpressionRenderer__component{position:static}.lnsEmbeddedError{flex-grow:1;display:flex;align-items:center;justify-content:center;overflow:auto}.lnsSelectableErrorMessage{-webkit-user-select:text;user-select:text}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(182);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisualizationContainer{scrollbar-color:rgba(105,112,125,0.5) rgba(0,0,0,0);scrollbar-width:thin;overflow:auto hidden;-webkit-user-select:text;user-select:text}.lnsVisualizationContainer::-webkit-scrollbar{width:16px;height:16px}.lnsVisualizationContainer::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsVisualizationContainer::-webkit-scrollbar-corner,.lnsVisualizationContainer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer{scrollbar-color:rgba(105,112,125,0.5) rgba(0,0,0,0);scrollbar-width:thin;position:relative;width:100%;height:100%;display:flex;overflow:auto}.lnsExpressionRenderer::-webkit-scrollbar{width:16px;height:16px}.lnsExpressionRenderer::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsExpressionRenderer::-webkit-scrollbar-corner,.lnsExpressionRenderer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer .lnsExpressionRenderer__component{position:static}.lnsEmbeddedError{flex-grow:1;display:flex;align-items:center;justify-content:center;overflow:auto}.lnsSelectableErrorMessage{-webkit-user-select:text;user-select:text}\n",""]),e.exports=t},,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(39),i=a(133),l=n.__importDefault(a(134));t.default=function(e,t){l.default(e,t,i.isDeepEqual)}},,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(203);case"v8light":return a(205)}},function(e,t,a){var n=a(66),i=a(204);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}.lnsDynamicColoringClickable{cursor:pointer}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(206);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}.lnsDynamicColoringClickable{cursor:pointer}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(208);case"v8light":return a(210)}},function(e,t,a){var n=a(66),i=a(209);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(211);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(213);case"v8light":return a(215)}},function(e,t,a){var n=a(66),i=a(214);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsPieToolbar__popover{width:400px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(216);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsPieToolbar__popover{width:400px}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(218);case"v8light":return a(220)}},function(e,t,a){var n=a(66),i=a(219);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(221);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}\n",""]),e.exports=t},,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(226);case"v8light":return a(228)}},function(e,t,a){var n=a(66),i=a(227);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsRowCompressedMargin+.lnsRowCompressedMargin{margin-top:8px}.lnsConfigPanelNoPadding{padding:0}.lnsConfigPanelDate__label{min-width:56px;text-align:center}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(229);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsRowCompressedMargin+.lnsRowCompressedMargin{margin-top:8px}.lnsConfigPanelNoPadding{padding:0}.lnsConfigPanelDate__label{min-width:56px;text-align:center}\n",""]),e.exports=t},function(e,t,a){var n=a(136),i=a(231),l=Object.hasOwnProperty,s={};for(var r in n)l.call(n,r)&&(s[n[r]]=r);var o=e.exports={to:{},get:{}};function u(e,t,a){return Math.min(Math.max(t,e),a)}function c(e){var t=Math.round(e).toString(16).toUpperCase();return t.length<2?"0"+t:t}o.get=function(e){var t,a;switch(e.substring(0,3).toLowerCase()){case"hsl":t=o.get.hsl(e),a="hsl";break;case"hwb":t=o.get.hwb(e),a="hwb";break;default:t=o.get.rgb(e),a="rgb"}return t?{model:a,value:t}:null},o.get.rgb=function(e){if(!e)return null;var t,a,i,s=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=t[2],t=t[1],a=0;a<3;a++){var r=2*a;s[a]=parseInt(t.slice(r,r+2),16)}i&&(s[3]=parseInt(i,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(i=(t=t[1])[3],a=0;a<3;a++)s[a]=parseInt(t[a]+t[a],16);i&&(s[3]=parseInt(i+i,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(a=0;a<3;a++)s[a]=parseInt(t[a+1],0);t[4]&&(t[5]?s[3]=.01*parseFloat(t[4]):s[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(t=e.match(/^(\w+)$/))?"transparent"===t[1]?[0,0,0,0]:l.call(n,t[1])?((s=n[t[1]])[3]=1,s):null:null;for(a=0;a<3;a++)s[a]=Math.round(2.55*parseFloat(t[a+1]));t[4]&&(t[5]?s[3]=.01*parseFloat(t[4]):s[3]=parseFloat(t[4]))}for(a=0;a<3;a++)s[a]=u(s[a],0,255);return s[3]=u(s[3],0,1),s},o.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(t){var a=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,u(parseFloat(t[2]),0,100),u(parseFloat(t[3]),0,100),u(isNaN(a)?1:a,0,1)]}return null},o.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(t){var a=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,u(parseFloat(t[2]),0,100),u(parseFloat(t[3]),0,100),u(isNaN(a)?1:a,0,1)]}return null},o.to.hex=function(){var e=i(arguments);return"#"+c(e[0])+c(e[1])+c(e[2])+(e[3]<1?c(Math.round(255*e[3])):"")},o.to.rgb=function(){var e=i(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},o.to.rgb.percent=function(){var e=i(arguments),t=Math.round(e[0]/255*100),a=Math.round(e[1]/255*100),n=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+t+"%, "+a+"%, "+n+"%)":"rgba("+t+"%, "+a+"%, "+n+"%, "+e[3]+")"},o.to.hsl=function(){var e=i(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},o.to.hwb=function(){var e=i(arguments),t="";return e.length>=4&&1!==e[3]&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},o.to.keyword=function(e){return s[e.slice(0,3)]}},function(e,t,a){"use strict";var n=a(232),i=Array.prototype.concat,l=Array.prototype.slice,s=e.exports=function(e){for(var t=[],a=0,s=e.length;a<s;a++){var r=e[a];n(r)?t=i.call(t,l.call(r)):t.push(r)}return t};s.wrap=function(e){return function(){return e(s(arguments))}}},function(e,t){e.exports=function(e){return!(!e||"string"==typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))}},function(e,t,a){const n=a(137),i=a(234),l={};Object.keys(n).forEach((e=>{l[e]={},Object.defineProperty(l[e],"channels",{value:n[e].channels}),Object.defineProperty(l[e],"labels",{value:n[e].labels});const t=i(e);Object.keys(t).forEach((a=>{const n=t[a];l[e][a]=function(e){const t=function(...t){const a=t[0];if(null==a)return a;a.length>1&&(t=a);const n=e(t);if("object"==typeof n)for(let e=n.length,t=0;t<e;t++)n[t]=Math.round(n[t]);return n};return"conversion"in e&&(t.conversion=e.conversion),t}(n),l[e][a].raw=function(e){const t=function(...t){const a=t[0];return null==a?a:(a.length>1&&(t=a),e(t))};return"conversion"in e&&(t.conversion=e.conversion),t}(n)}))})),e.exports=l},function(e,t,a){const n=a(137);function i(e,t){return function(a){return t(e(a))}}function l(e,t){const a=[t[e].parent,e];let l=n[t[e].parent][e],s=t[e].parent;for(;t[s].parent;)a.unshift(t[s].parent),l=i(n[t[s].parent][s],l),s=t[s].parent;return l.conversion=a,l}e.exports=function(e){const t=function(e){const t=function(){const e={},t=Object.keys(n);for(let a=t.length,n=0;n<a;n++)e[t[n]]={distance:-1,parent:null};return e}(),a=[e];for(t[e].distance=0;a.length;){const e=a.pop(),i=Object.keys(n[e]);for(let n=i.length,l=0;l<n;l++){const n=i[l],s=t[n];-1===s.distance&&(s.distance=t[e].distance+1,s.parent=e,a.unshift(n))}}return t}(e),a={},i=Object.keys(t);for(let e=i.length,n=0;n<e;n++){const e=i[n];null!==t[e].parent&&(a[e]=l(e,t))}return a}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(236);case"v8light":return a(238)}},function(e,t,a){var n=a(66),i=a(237);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(239);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(241);case"v8light":return a(243)}},function(e,t,a){var n=a(66),i=a(242);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(244);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(246);case"v8light":return a(248)}},function(e,t,a){var n=a(66),i=a(247);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsGaugeToolbar__popover{width:500px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(249);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsGaugeToolbar__popover{width:500px}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(251);case"v8light":return a(253)}},function(e,t,a){var n=a(66),i=a(252);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(254);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}\n",""]),e.exports=t},function(e,t,a){const{abs:n}=a(256),{add:i}=a(139),{cbrt:l}=a(257),{ceil:s}=a(258),{clamp:r}=a(259),{cos:o}=a(260),{count:u}=a(261),{cube:c}=a(262),{degtorad:d}=a(263),{divide:p}=a(264),{exp:m}=a(265),{first:g}=a(266),{fix:f}=a(267),{floor:b}=a(268),{last:h}=a(269),{log:x}=a(141),{log10:y}=a(270),{max:v}=a(142),{mean:j}=a(271),{median:O}=a(272),{min:k}=a(144),{mod:I}=a(273),{mode:T}=a(274),{multiply:M}=a(275),{pi:F}=a(276),{pow:w}=a(107),{radtodeg:C}=a(277),{random:_}=a(278),{range:S}=a(279),{round:E}=a(280),{sin:P}=a(281),{size:A}=a(140),{sqrt:L}=a(282),{square:D}=a(283),{subtract:N}=a(145),{sum:z}=a(284),{tan:B}=a(285),{unique:V}=a(286);e.exports={functions:{abs:n,add:i,cbrt:l,ceil:s,clamp:r,cos:o,count:u,cube:c,degtorad:d,divide:p,exp:m,first:g,fix:f,floor:b,last:h,log:x,log10:y,max:v,mean:j,median:O,min:k,mod:I,mode:T,multiply:M,pi:F,pow:w,radtodeg:C,random:_,range:S,round:E,sin:P,size:A,sqrt:L,square:D,subtract:N,sum:z,tan:B,unique:V}}},function(e,t){e.exports={abs:function(e){return Array.isArray(e)?e.map((e=>Math.abs(e))):Math.abs(e)}}},function(e,t){e.exports={cbrt:function(e){return Array.isArray(e)?e.map((e=>Math.cbrt(e))):Math.cbrt(e)}}},function(e,t){e.exports={ceil:function(e){return Array.isArray(e)?e.map((e=>Math.ceil(e))):Math.ceil(e)}}},function(e,t){const a=(e,t,a)=>{if(t>a)throw new Error("Min must be less than max");return Math.min(Math.max(e,t),a)};e.exports={clamp:function(e,t,n){if(null===n)throw new Error("Missing maximum value. You may want to use the 'min' function instead");if(null===t)throw new Error("Missing minimum value. You may want to use the 'max' function instead");if(Array.isArray(n)){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==n.length||e.length!==t.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e[i],t[i],n)))}if(Array.isArray(e)){if(e.length!==n.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e[i],t,n)))}if(Array.isArray(t)){if(t.length!==n.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e,t[i],n)))}return n.map((n=>a(e,t,n)))}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,n)=>a(e,t[n])))}return Array.isArray(e)?e.map((e=>a(e,t,n))):Array.isArray(t)?t.map((t=>a(e,t,n))):a(e,t,n)}}},function(e,t){e.exports={cos:function(e){return Array.isArray(e)?e.map((e=>Math.cos(e))):Math.cos(e)}}},function(e,t,a){const{size:n}=a(140);function i(e){return n(e)}e.exports={count:i},i.skipNumberValidation=!0},function(e,t,a){const{pow:n}=a(107);e.exports={cube:function(e){return n(e,3)}}},function(e,t){e.exports={degtorad:function(e){return Array.isArray(e)?e.map((e=>e*Math.PI/180)):e*Math.PI/180}}},function(e,t){e.exports={divide:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>{if(0===t[a])throw new Error("Cannot divide by 0");return e/t[a]}))}if(Array.isArray(t))return t.map((t=>e/t));if(0===t)throw new Error("Cannot divide by 0");return Array.isArray(e)?e.map((e=>e/t)):e/t}}},function(e,t){e.exports={exp:function(e){return Array.isArray(e)?e.map((e=>Math.exp(e))):Math.exp(e)}}},function(e,t){function a(e){return Array.isArray(e)?e[0]:e}e.exports={first:a},a.skipNumberValidation=!0},function(e,t){const a=e=>e>0?Math.floor(e):Math.ceil(e);e.exports={fix:function(e){return Array.isArray(e)?e.map((e=>a(e))):a(e)}}},function(e,t){e.exports={floor:function(e){return Array.isArray(e)?e.map((e=>Math.floor(e))):Math.floor(e)}}},function(e,t){function a(e){return Array.isArray(e)?e[e.length-1]:e}e.exports={last:a},a.skipNumberValidation=!0},function(e,t,a){const{log:n}=a(141);e.exports={log10:function(e){return n(e,10)}}},function(e,t,a){const{add:n}=a(139);e.exports={mean:function(...e){if(1===e.length)return Array.isArray(e[0])?n(e[0])/e[0].length:e[0];const t=n(...e);return Array.isArray(t)?t.map((t=>t/e.length)):t/e.length}}},function(e,t,a){const{transpose:n}=a(143),i=e=>{const t=e.length,a=Math.floor(t/2);return e.sort(((e,t)=>t-e)),t%2==0?(e[a]+e[a-1])/2:e[a]};e.exports={median:function(...e){if(1===e.length)return Array.isArray(e[0])?i(e[0]):e[0];const t=e.findIndex((e=>Array.isArray(e)));return-1!==t?n(e,t).map((e=>i(e))):i(e)}}},function(e,t){e.exports={mod:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>{if(0===t[a])throw new Error("Cannot divide by 0");return e%t[a]}))}if(Array.isArray(t))return t.map((t=>e%t));if(0===t)throw new Error("Cannot divide by 0");return Array.isArray(e)?e.map((e=>e%t)):e%t}}},function(e,t,a){const{transpose:n}=a(143),i=e=>{let t=0;const a={};return e.map((e=>{void 0===a[e]&&(a[e]=0),a[e]+=1,a[e]>t&&(t=a[e])})),Object.keys(a).filter((e=>a[e]===t)).map((e=>parseFloat(e))).sort(((e,t)=>e-t))};e.exports={mode:function(...e){if(1===e.length)return Array.isArray(e[0])?i(e[0]):e[0];const t=e.findIndex((e=>Array.isArray(e)));return-1!==t?n(e,t).map((e=>i(e))):i(e)}}},function(e,t){e.exports={multiply:function(...e){return e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e*t[a]))}return Array.isArray(e)?e.map((e=>e*t)):Array.isArray(t)?t.map((t=>t*e)):e*t}))}}},function(e,t){e.exports={pi:function(){return Math.PI}}},function(e,t){e.exports={radtodeg:function(e){return Array.isArray(e)?e.map((e=>180*e/Math.PI)):180*e/Math.PI}}},function(e,t){e.exports={random:function(e,t){if(null==e)return Math.random();if(null==t){if(e<0)throw new Error("Min is greater than max");return Math.random()*e}if(e>t)throw new Error("Min is greater than max");return Math.random()*(t-e)+e}}},function(e,t,a){const{max:n}=a(142),{min:i}=a(144),{subtract:l}=a(145);e.exports={range:function(...e){return l(n(...e),i(...e))}}},function(e,t){const a=(e,t)=>Math.round(e*Math.pow(10,t))/Math.pow(10,t);e.exports={round:function(e,t=0){return Array.isArray(e)?e.map((e=>a(e,t))):a(e,t)}}},function(e,t){e.exports={sin:function(e){return Array.isArray(e)?e.map((e=>Math.sin(e))):Math.sin(e)}}},function(e,t){e.exports={sqrt:function(e){if(Array.isArray(e))return e.map((e=>{if(e<0)throw new Error("Unable find the square root of a negative number");return Math.sqrt(e)}));if(e<0)throw new Error("Unable find the square root of a negative number");return Math.sqrt(e)}}},function(e,t,a){const{pow:n}=a(107);e.exports={square:function(e){return n(e,2)}}},function(e,t){const a=(e,t)=>e+t;e.exports={sum:function(...e){return e.reduce(((e,t)=>Array.isArray(t)?e+t.reduce(a,0):e+t),0)}}},function(e,t){e.exports={tan:function(e){return Array.isArray(e)?e.map((e=>Math.tan(e))):Math.tan(e)}}},function(e,t){function a(e){return Array.isArray(e)?e.filter(((t,a)=>e.indexOf(t)===a)).length:1}e.exports={unique:a},a.skipNumberValidation=!0},function(e,t,a){"use strict";function n(e,t,a,i){var l=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(l,n.prototype),l.expected=t,l.found=a,l.location=i,l.name="SyntaxError",l}function i(e,t,a){return a=a||" ",e.length>t?e:(t-=e.length,e+(a+=a.repeat(t)).slice(0,t))}!function(e,t){function a(){this.constructor=e}a.prototype=t.prototype,e.prototype=new a}(n,Error),n.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var a,n=null;for(a=0;a<e.length;a++)if(e[a].source===this.location.source){n=e[a].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,s=this.location.source+":"+l.line+":"+l.column;if(n){var r=this.location.end,o=i("",l.line.toString().length),u=n[l.line-1],c=l.line===r.line?r.column:u.length+1;t+="\n --\x3e "+s+"\n"+o+" |\n"+l.line+" | "+u+"\n"+o+" | "+i("",l.column-1)+i("",c-l.column,"^")}else t+="\n at "+s}return t},n.buildMessage=function(e,t){var a={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?l(e[0])+"-"+l(e[1]):l(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function l(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function s(e){return a[e.type](e)}return"Expected "+function(e){var t,a,n=e.map(s);if(n.sort(),n.length>0){for(t=1,a=1;t<n.length;t++)n[t-1]!==n[t]&&(n[a]=n[t],a++);n.length=a}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+i(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:n,parse:function(e,t){var a,i={},l=(t=void 0!==t?t:{}).grammarSource,s={start:me},r=me,o='"',u='\\"',c="'",d="\\'",p="-",m=/^[ \t\n\r]/,g=/^[0-9A-Za-z._@[\]\-]/,f=/^[^"]/,b=/^[^']/,h=/^[a-zA-Z_]/,x=/^[a-zA-Z_\-]/,y=/^[eE]/,v=/^[1-9]/,j=/^[0-9]/,O=ue("whitespace"),k=oe([" ","\t","\n","\r"],!1,!1),I=(oe([" "],!1,!1),oe(['"',"'"],!1,!1),oe([["A","Z"],["a","z"],"_","@",".","[","]","-"],!1,!1),oe([["0","9"],["A","Z"],["a","z"],".","_","@","[","]","-"],!1,!1)),T=ue("literal"),M=re('"',!1),F=re('\\"',!1),w=oe(['"'],!0,!1),C=re("'",!1),_=re("\\'",!1),S=oe(["'"],!0,!1),E=re("+",!1),P=re("-",!1),A=re("*",!1),L=re("/",!1),D=re("(",!1),N=re(")",!1),z=ue("arguments"),B=re(",",!1),V=oe([["a","z"],["A","Z"],"_"],!1,!1),R=re("=",!1),H=ue("function"),G=oe([["a","z"],["A","Z"],"_","-"],!1,!1),q=ue("number"),$=oe(["e","E"],!1,!1),W=ue("exponent"),U=re(".",!1),Y=re("0",!1),X=oe([["1","9"]],!1,!1),K=oe([["0","9"]],!1,!1),Z=function(e,t){return t},Q=function(e){return e.join("")},J=0,ee=0,te=[{line:1,column:1}],ae=0,ne=[],ie=0;if("startRule"in t){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');r=s[t.startRule]}function le(){return e.substring(ee,J)}function se(){return de(ee,J)}function re(e,t){return{type:"literal",text:e,ignoreCase:t}}function oe(e,t,a){return{type:"class",parts:e,inverted:t,ignoreCase:a}}function ue(e){return{type:"other",description:e}}function ce(t){var a,n=te[t];if(n)return n;for(a=t-1;!te[a];)a--;for(n={line:(n=te[a]).line,column:n.column};a<t;)10===e.charCodeAt(a)?(n.line++,n.column=1):n.column++,a++;return te[t]=n,n}function de(e,t){var a=ce(e),n=ce(t);return{source:l,start:{offset:e,line:a.line,column:a.column},end:{offset:t,line:n.line,column:n.column}}}function pe(e){J<ae||(J>ae&&(ae=J,ne=[]),ne.push(e))}function me(){return be()}function ge(){var t,a;for(ie++,t=[],m.test(e.charAt(J))?(a=e.charAt(J),J++):(a=i,0===ie&&pe(k));a!==i;)t.push(a),m.test(e.charAt(J))?(a=e.charAt(J),J++):(a=i,0===ie&&pe(k));return ie--,a=i,0===ie&&pe(O),t}function fe(){var t;return g.test(e.charAt(J))?(t=e.charAt(J),J++):(t=i,0===ie&&pe(I)),t}function be(){var t,a,n,l,s,r;if(t=J,ge(),(a=he())!==i){if(n=[],l=J,43===e.charCodeAt(J)?(s="+",J++):(s=i,0===ie&&pe(E)),s===i&&(45===e.charCodeAt(J)?(s=p,J++):(s=i,0===ie&&pe(P))),s!==i&&(r=he())!==i?l=s=[s,r]:(J=l,l=i),l!==i)for(;l!==i;)n.push(l),l=J,43===e.charCodeAt(J)?(s="+",J++):(s=i,0===ie&&pe(E)),s===i&&(45===e.charCodeAt(J)?(s=p,J++):(s=i,0===ie&&pe(P))),s!==i&&(r=he())!==i?l=s=[s,r]:(J=l,l=i);else n=i;n!==i?(l=ge(),ee=t,t=function(e,t){const a=t.reduce(((e,t)=>({type:"function",name:"+"===t[0]?"add":"subtract",args:[e,t[1]]})),e);return"object"==typeof a&&(a.location=Oe(se()),a.text=le()),a}(a,n)):(J=t,t=i)}else J=t,t=i;return t===i&&(t=he()),t}function he(){var t,a,n,l,s,r;if(t=J,ge(),(a=xe())!==i){for(n=[],l=J,42===e.charCodeAt(J)?(s="*",J++):(s=i,0===ie&&pe(A)),s===i&&(47===e.charCodeAt(J)?(s="/",J++):(s=i,0===ie&&pe(L))),s!==i&&(r=xe())!==i?l=s=[s,r]:(J=l,l=i);l!==i;)n.push(l),l=J,42===e.charCodeAt(J)?(s="*",J++):(s=i,0===ie&&pe(A)),s===i&&(47===e.charCodeAt(J)?(s="/",J++):(s=i,0===ie&&pe(L))),s!==i&&(r=xe())!==i?l=s=[s,r]:(J=l,l=i);l=ge(),ee=t,t=function(e,t){const a=t.reduce(((e,t)=>({type:"function",name:"*"===t[0]?"multiply":"divide",args:[e,t[1]]})),e);return"object"==typeof a&&(a.location=Oe(se()),a.text=le()),a}(a,n)}else J=t,t=i;return t===i&&(t=xe()),t}function xe(){var t;return(t=function(){var t,a,n,l;return t=J,ge(),40===e.charCodeAt(J)?(a="(",J++):(a=i,0===ie&&pe(D)),a!==i?(ge(),(n=be())!==i?(ge(),41===e.charCodeAt(J)?(l=")",J++):(l=i,0===ie&&pe(N)),l!==i?(ge(),ee=t,t=n):(J=t,t=i)):(J=t,t=i)):(J=t,t=i),t}())===i&&(t=function(){var t,a,n,l,s,r;if(ie++,t=J,ge(),a=[],x.test(e.charAt(J))?(n=e.charAt(J),J++):(n=i,0===ie&&pe(G)),n!==i)for(;n!==i;)a.push(n),x.test(e.charAt(J))?(n=e.charAt(J),J++):(n=i,0===ie&&pe(G));else a=i;return a!==i?(40===e.charCodeAt(J)?(n="(",J++):(n=i,0===ie&&pe(D)),n!==i?(ge(),l=function(){var t,a,n,l,s,r,o;if(ie++,t=J,(a=ye())!==i){for(n=[],l=J,s=ge(),44===e.charCodeAt(J)?(r=",",J++):(r=i,0===ie&&pe(B)),r!==i?(ge(),(o=ye())!==i?(ee=l,l=Z(0,o)):(J=l,l=i)):(J=l,l=i);l!==i;)n.push(l),l=J,s=ge(),44===e.charCodeAt(J)?(r=",",J++):(r=i,0===ie&&pe(B)),r!==i?(ge(),(o=ye())!==i?(ee=l,l=Z(0,o)):(J=l,l=i)):(J=l,l=i);l=ge(),44===e.charCodeAt(J)?(s=",",J++):(s=i,0===ie&&pe(B)),s===i&&(s=null),ee=t,t=[a].concat(n)}else J=t,t=i;return ie--,t===i&&(a=i,0===ie&&pe(z)),t}(),l===i&&(l=null),ge(),41===e.charCodeAt(J)?(s=")",J++):(s=i,0===ie&&pe(N)),s!==i?(ge(),ee=t,r=l,t={type:"function",name:a.join(""),args:r||[],location:Oe(se()),text:le()}):(J=t,t=i)):(J=t,t=i)):(J=t,t=i),ie--,t===i&&0===ie&&pe(H),t}())===i&&(t=function(){var t,a;return ie++,t=J,ge(),(a=ve())===i&&(a=function(){var t,a,n,l,s;if(t=J,ge(),34===e.charCodeAt(J)?(a=o,J++):(a=i,0===ie&&pe(M)),a!==i){for(n=[],l=J,e.substr(J,2)===u?(s=u,J+=2):(s=i,0===ie&&pe(F)),s!==i&&(ee=l,s='"'),(l=s)===i&&(f.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(w)));l!==i;)n.push(l),l=J,e.substr(J,2)===u?(s=u,J+=2):(s=i,0===ie&&pe(F)),s!==i&&(ee=l,s='"'),(l=s)===i&&(f.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(w)));34===e.charCodeAt(J)?(l=o,J++):(l=i,0===ie&&pe(M)),l!==i?(s=ge(),ee=t,t={type:"variable",value:n.join(""),location:Oe(se()),text:le()}):(J=t,t=i)}else J=t,t=i;if(t===i){if(t=J,ge(),39===e.charCodeAt(J)?(a=c,J++):(a=i,0===ie&&pe(C)),a!==i){for(n=[],l=J,e.substr(J,2)===d?(s=d,J+=2):(s=i,0===ie&&pe(_)),s!==i&&(ee=l,s="'"),(l=s)===i&&(b.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(S)));l!==i;)n.push(l),l=J,e.substr(J,2)===d?(s=d,J+=2):(s=i,0===ie&&pe(_)),s!==i&&(ee=l,s="'"),(l=s)===i&&(b.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(S)));39===e.charCodeAt(J)?(l=c,J++):(l=i,0===ie&&pe(C)),l!==i?(s=ge(),ee=t,t={type:"variable",value:n.join(""),location:Oe(se()),text:le()}):(J=t,t=i)}else J=t,t=i;if(t===i){if(t=J,ge(),a=[],(n=fe())!==i)for(;n!==i;)a.push(n),n=fe();else a=i;a!==i?(n=ge(),ee=t,t={type:"variable",value:a.join(""),location:Oe(se()),text:le()}):(J=t,t=i)}}return t}()),a!==i?(ge(),ee=t,t=a):(J=t,t=i),ie--,t===i&&0===ie&&pe(T),t}()),t}function ye(){var t,a,n,l,s,r;if(t=J,a=[],h.test(e.charAt(J))?(n=e.charAt(J),J++):(n=i,0===ie&&pe(V)),n!==i)for(;n!==i;)a.push(n),h.test(e.charAt(J))?(n=e.charAt(J),J++):(n=i,0===ie&&pe(V));else a=i;return a!==i?(n=ge(),61===e.charCodeAt(J)?(l="=",J++):(l=i,0===ie&&pe(R)),l!==i?(ge(),(s=ve())===i&&(s=function(){var t,a,n,l,s;if(t=J,34===e.charCodeAt(J)?(a=o,J++):(a=i,0===ie&&pe(M)),a!==i){for(n=[],l=J,e.substr(J,2)===u?(s=u,J+=2):(s=i,0===ie&&pe(F)),s!==i&&(ee=l,s='"'),(l=s)===i&&(f.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(w)));l!==i;)n.push(l),l=J,e.substr(J,2)===u?(s=u,J+=2):(s=i,0===ie&&pe(F)),s!==i&&(ee=l,s='"'),(l=s)===i&&(f.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(w)));34===e.charCodeAt(J)?(l=o,J++):(l=i,0===ie&&pe(M)),l!==i?(ee=t,t=Q(n)):(J=t,t=i)}else J=t,t=i;if(t===i){if(t=J,39===e.charCodeAt(J)?(a=c,J++):(a=i,0===ie&&pe(C)),a!==i){for(n=[],l=J,e.substr(J,2)===d?(s=d,J+=2):(s=i,0===ie&&pe(_)),s!==i&&(ee=l,s="'"),(l=s)===i&&(b.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(S)));l!==i;)n.push(l),l=J,e.substr(J,2)===d?(s=d,J+=2):(s=i,0===ie&&pe(_)),s!==i&&(ee=l,s="'"),(l=s)===i&&(b.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(S)));39===e.charCodeAt(J)?(l=c,J++):(l=i,0===ie&&pe(C)),l!==i?(ee=t,t=Q(n)):(J=t,t=i)}else J=t,t=i;if(t===i){if(t=J,a=[],(n=fe())!==i)for(;n!==i;)a.push(n),n=fe();else a=i;a!==i&&(ee=t,a=Q(a)),t=a}}return t}()),s!==i?(ge(),ee=t,r=s,t={type:"namedArgument",name:a.join(""),value:r,location:Oe(se()),text:le()}):(J=t,t=i)):(J=t,t=i)):(J=t,t=i),t===i&&(t=be()),t}function ve(){var t,a,n,l,s;return ie++,t=J,45===e.charCodeAt(J)?(a=p,J++):(a=i,0===ie&&pe(P)),a===i&&(a=null),n=function(){var t,a,n,l;if(48===e.charCodeAt(J)?(t="0",J++):(t=i,0===ie&&pe(Y)),t===i)if(t=J,v.test(e.charAt(J))?(a=e.charAt(J),J++):(a=i,0===ie&&pe(X)),a!==i){for(n=[],l=je();l!==i;)n.push(l),l=je();t=a=[a,n]}else J=t,t=i;return t}(),n!==i?(l=function(){var t,a,n,l;if(t=J,46===e.charCodeAt(J)?(a=".",J++):(a=i,0===ie&&pe(U)),a!==i){if(n=[],(l=je())!==i)for(;l!==i;)n.push(l),l=je();else n=i;n!==i?t=a=[a,n]:(J=t,t=i)}else J=t,t=i;return t}(),l===i&&(l=null),s=function(){var t,a,n,l,s;if(ie++,t=J,a=function(){var t;return y.test(e.charAt(J))?(t=e.charAt(J),J++):(t=i,0===ie&&pe($)),t}(),a!==i){if(45===e.charCodeAt(J)?(n=p,J++):(n=i,0===ie&&pe(P)),n===i&&(n=null),l=[],(s=je())!==i)for(;s!==i;)l.push(s),s=je();else l=i;l!==i?t=a=[a,n,l]:(J=t,t=i)}else J=t,t=i;return ie--,t===i&&(a=i,0===ie&&pe(W)),t}(),s===i&&(s=null),ee=t,t=parseFloat(le())):(J=t,t=i),ie--,t===i&&(a=i,0===ie&&pe(q)),t}function je(){var t;return j.test(e.charAt(J))?(t=e.charAt(J),J++):(t=i,0===ie&&pe(K)),t}function Oe(e){return{min:e.start.offset,max:e.end.offset}}if((a=r())!==i&&J===e.length)return a;throw a!==i&&J<e.length&&pe({type:"end"}),function(e,t,a){return new n(n.buildMessage(e,t),e,t,a)}(ne,ae<e.length?e.charAt(ae):null,ae<e.length?de(ae,ae+1):de(ae,ae))}}},,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(293);case"v8light":return a(295)}},function(e,t,a){var n=a(66),i=a(294);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsFormula{display:flex;flex-direction:column}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula{height:100%}.lnsFormula>*{flex:1;min-height:0}.lnsFormula>*+*{border-top:1px solid #343741}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editor{border-bottom:none;display:flex;flex-direction:column}.lnsFormula__editor>*+*{border-top:1px solid #343741}.lnsFormula__editorHeader,.lnsFormula__editorFooter{padding:8px 16px}.lnsFormula__editorFooter{z-index:1;background-color:#25262E}.lnsFormula__editorHeaderGroup,.lnsFormula__editorFooterGroup{display:block}.lnsFormula__editorContent{min-height:0;position:relative}.lnsIndexPatternDimensionEditor:not(.lnsIndexPatternDimensionEditor-isFullscreen) .lnsFormula__editorContent{height:200px}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editorContent{flex:1}.lnsFormula__editorPlaceholder{position:absolute;top:0;left:16px;right:0;color:#7a7f89;font-family:Menlo, Monaco, 'Courier New', monospace;pointer-events:none}.lnsFormula__warningText+.lnsFormula__warningText{margin-top:8px;border-top:1px solid #343741;padding-top:8px}.lnsFormula__editorHelp--inline{align-items:center;display:flex;padding:4px}.lnsFormula__editorHelp--inline>*+*{margin-left:4px}.lnsFormula__editorError{white-space:nowrap}.lnsFormula__docs{background:#1D1E24}.lnsFormula__docs--inline{display:flex;flex-direction:column;z-index:1}.lnsFormula__docs--overlay .lnsFormula__docsContent{height:40vh;width:min(75vh, 90vw)}.lnsFormula__docs--inline .lnsFormula__docsContent{flex:1;min-height:0}.lnsFormula__docsContent>*+*{border-left:1px solid #343741}.lnsFormula__docsSidebar{background:#25262E}.lnsFormula__docsSidebarInner{min-height:0}.lnsFormula__docsSidebarInner>*+*{border-top:1px solid #343741}.lnsFormula__docsSearch{padding:16px}.lnsFormula__docsNav{scrollbar-color:rgba(152,162,179,0.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden}.lnsFormula__docsNav::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsNav::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsNav::-webkit-scrollbar-corner,.lnsFormula__docsNav::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsNav:focus{outline:none}.lnsFormula__docsNav[tabindex='0']:focus:focus-visible{outline-style:auto}.lnsFormula__docsNavGroup{padding:16px}.lnsFormula__docsNavGroup+.lnsFormula__docsNavGroup{border-top:1px solid #343741}.lnsFormula__docsNavGroupLink{font-weight:inherit}.lnsFormula__docsText{scrollbar-color:rgba(152,162,179,0.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;padding:16px}.lnsFormula__docsText::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsText::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsText::-webkit-scrollbar-corner,.lnsFormula__docsText::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsText:focus{outline:none}.lnsFormula__docsText[tabindex='0']:focus:focus-visible{outline-style:auto}.lnsFormula__docsTextGroup,.lnsFormula__docsTextItem{margin-top:40px}.lnsFormula__docsTextGroup{border-top:1px solid #343741;padding-top:40px}.lnsFormulaOverflow{z-index:9001}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(296);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsFormula{display:flex;flex-direction:column}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula{height:100%}.lnsFormula>*{flex:1;min-height:0}.lnsFormula>*+*{border-top:1px solid #D3DAE6}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editor{border-bottom:none;display:flex;flex-direction:column}.lnsFormula__editor>*+*{border-top:1px solid #D3DAE6}.lnsFormula__editorHeader,.lnsFormula__editorFooter{padding:8px 16px}.lnsFormula__editorFooter{z-index:1;background-color:#F5F7FA}.lnsFormula__editorHeaderGroup,.lnsFormula__editorFooterGroup{display:block}.lnsFormula__editorContent{min-height:0;position:relative}.lnsIndexPatternDimensionEditor:not(.lnsIndexPatternDimensionEditor-isFullscreen) .lnsFormula__editorContent{height:200px}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editorContent{flex:1}.lnsFormula__editorPlaceholder{position:absolute;top:0;left:16px;right:0;color:#69707D;font-family:Menlo, Monaco, 'Courier New', monospace;pointer-events:none}.lnsFormula__warningText+.lnsFormula__warningText{margin-top:8px;border-top:1px solid #D3DAE6;padding-top:8px}.lnsFormula__editorHelp--inline{align-items:center;display:flex;padding:4px}.lnsFormula__editorHelp--inline>*+*{margin-left:4px}.lnsFormula__editorError{white-space:nowrap}.lnsFormula__docs{background:#fff}.lnsFormula__docs--inline{display:flex;flex-direction:column;z-index:1}.lnsFormula__docs--overlay .lnsFormula__docsContent{height:40vh;width:min(75vh, 90vw)}.lnsFormula__docs--inline .lnsFormula__docsContent{flex:1;min-height:0}.lnsFormula__docsContent>*+*{border-left:1px solid #D3DAE6}.lnsFormula__docsSidebar{background:#F5F7FA}.lnsFormula__docsSidebarInner{min-height:0}.lnsFormula__docsSidebarInner>*+*{border-top:1px solid #D3DAE6}.lnsFormula__docsSearch{padding:16px}.lnsFormula__docsNav{scrollbar-color:rgba(105,112,125,0.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden}.lnsFormula__docsNav::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsNav::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsNav::-webkit-scrollbar-corner,.lnsFormula__docsNav::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsNav:focus{outline:none}.lnsFormula__docsNav[tabindex='0']:focus:focus-visible{outline-style:auto}.lnsFormula__docsNavGroup{padding:16px}.lnsFormula__docsNavGroup+.lnsFormula__docsNavGroup{border-top:1px solid #D3DAE6}.lnsFormula__docsNavGroupLink{font-weight:inherit}.lnsFormula__docsText{scrollbar-color:rgba(105,112,125,0.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;padding:16px}.lnsFormula__docsText::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsText::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsText::-webkit-scrollbar-corner,.lnsFormula__docsText::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsText:focus{outline:none}.lnsFormula__docsText[tabindex='0']:focus:focus-visible{outline-style:auto}.lnsFormula__docsTextGroup,.lnsFormula__docsTextItem{margin-top:40px}.lnsFormula__docsTextGroup{border-top:1px solid #D3DAE6;padding-top:40px}.lnsFormulaOverflow{z-index:9001}\n",""]),e.exports=t},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(39),i=a(7),l=n.__importDefault(a(147));t.default=function(e){var t=i.useRef(e);t.current=e,l.default((function(){return function(){return t.current()}}))}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(299);case"v8light":return a(301)}},function(e,t,a){var n=a(66),i=a(300);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsFiltersOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;width:100%}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(302);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsFiltersOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;width:100%}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(304);case"v8light":return a(306)}},function(e,t,a){var n=a(66),i=a(305);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__filtersEditor{width:960px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(307);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__filtersEditor{width:960px}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(309);case"v8light":return a(311)}},function(e,t,a){var n=a(66),i=a(310);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnFieldSelect__option--incompatible{color:#343741}.lnFieldSelect__option--nonExistant{background-color:#25262E}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(312);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnFieldSelect__option--incompatible{color:#D3DAE6}.lnFieldSelect__option--nonExistant{background-color:#F5F7FA}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(314);case"v8light":return a(316)}},function(e,t,a){var n=a(66),i=a(315);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".kbnFieldButton{font-size:14px;font-size:1rem;line-height:1.71429rem;border-radius:6px;margin-bottom:4px;display:flex;align-items:center;transition:box-shadow 150ms cubic-bezier(0.694, 0.0482, 0.335, 1),background-color 150ms cubic-bezier(0.694, 0.0482, 0.335, 1)}.kbnFieldButton:focus-within,.kbnFieldButton-isActive{outline:2px solid currentColor}.kbnFieldButton:focus-within:focus-visible,.kbnFieldButton-isActive:focus-visible{outline-style:auto}.kbnFieldButton:focus-within:not(:focus-visible),.kbnFieldButton-isActive:not(:focus-visible){outline:none}.kbnFieldButton--isDraggable{background:#25262E}.kbnFieldButton--isDraggable:hover,.kbnFieldButton--isDraggable:focus,.kbnFieldButton--isDraggable:focus-within{box-shadow:0 0.9px 4px -1px rgba(0,0,0,0.2),0 2.6px 8px -1px rgba(0,0,0,0.15),0 5.7px 12px -1px rgba(0,0,0,0.125),0 15px 15px -1px rgba(0,0,0,0.1);border-radius:6px;z-index:2}.kbnFieldButton--isDraggable .kbnFieldButton__button:hover,.kbnFieldButton--isDraggable .kbnFieldButton__button:focus{cursor:grab}.kbnFieldButton__button{flex-grow:1;text-align:left;padding:8px;display:flex;align-items:flex-start;line-height:normal}.kbnFieldButton__fieldIcon{flex-shrink:0;line-height:0;margin-right:8px}.kbnFieldButton__name{flex-grow:1;word-break:break-word}.kbnFieldButton__infoIcon{flex-shrink:0;margin-left:4px}.kbnFieldButton__fieldAction{margin-right:8px}.kbnFieldButton--small{font-size:12px}.kbnFieldButton--small .kbnFieldButton__button{padding:4px}.kbnFieldButton--small .kbnFieldButton__fieldIcon,.kbnFieldButton--small .kbnFieldButton__fieldAction{margin-right:4px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(317);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".kbnFieldButton{font-size:14px;font-size:1rem;line-height:1.71429rem;border-radius:6px;margin-bottom:4px;display:flex;align-items:center;transition:box-shadow 150ms cubic-bezier(0.694, 0.0482, 0.335, 1),background-color 150ms cubic-bezier(0.694, 0.0482, 0.335, 1)}.kbnFieldButton:focus-within,.kbnFieldButton-isActive{outline:2px solid currentColor}.kbnFieldButton:focus-within:focus-visible,.kbnFieldButton-isActive:focus-visible{outline-style:auto}.kbnFieldButton:focus-within:not(:focus-visible),.kbnFieldButton-isActive:not(:focus-visible){outline:none}.kbnFieldButton--isDraggable{background:#fff}.kbnFieldButton--isDraggable:hover,.kbnFieldButton--isDraggable:focus,.kbnFieldButton--isDraggable:focus-within{box-shadow:0 0.9px 4px -1px rgba(0,0,0,0.08),0 2.6px 8px -1px rgba(0,0,0,0.06),0 5.7px 12px -1px rgba(0,0,0,0.05),0 15px 15px -1px rgba(0,0,0,0.04);border-radius:6px;z-index:2}.kbnFieldButton--isDraggable .kbnFieldButton__button:hover,.kbnFieldButton--isDraggable .kbnFieldButton__button:focus{cursor:grab}.kbnFieldButton__button{flex-grow:1;text-align:left;padding:8px;display:flex;align-items:flex-start;line-height:normal}.kbnFieldButton__fieldIcon{flex-shrink:0;line-height:0;margin-right:8px}.kbnFieldButton__name{flex-grow:1;word-break:break-word}.kbnFieldButton__infoIcon{flex-shrink:0;margin-left:4px}.kbnFieldButton__fieldAction{margin-right:8px}.kbnFieldButton--small{font-size:12px}.kbnFieldButton--small .kbnFieldButton__button{padding:4px}.kbnFieldButton--small .kbnFieldButton__fieldIcon,.kbnFieldButton--small .kbnFieldButton__fieldAction{margin-right:4px}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(319);case"v8light":return a(321)}},function(e,t,a){var n=a(66),i=a(320);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsRangesOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;width:100%}.lnsRangesOperation__popoverNumberField{width:14ch}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(322);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsRangesOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;width:100%}.lnsRangesOperation__popoverNumberField{width:14ch}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(324);case"v8light":return a(326)}},function(e,t,a){var n=a(66),i=a(325);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsHelpPopover__panel{max-width:480px}.lnsHelpPopover__content{scrollbar-color:rgba(152,162,179,0.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;-webkit-mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);max-height:40vh;padding:12px}.lnsHelpPopover__content::-webkit-scrollbar{width:16px;height:16px}.lnsHelpPopover__content::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsHelpPopover__content::-webkit-scrollbar-corner,.lnsHelpPopover__content::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsHelpPopover__content:focus{outline:none}.lnsHelpPopover__content[tabindex='0']:focus:focus-visible{outline-style:auto}.lnsHelpPopover__buttonIcon{margin-right:4px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(327);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsHelpPopover__panel{max-width:480px}.lnsHelpPopover__content{scrollbar-color:rgba(105,112,125,0.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;-webkit-mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);max-height:40vh;padding:12px}.lnsHelpPopover__content::-webkit-scrollbar{width:16px;height:16px}.lnsHelpPopover__content::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsHelpPopover__content::-webkit-scrollbar-corner,.lnsHelpPopover__content::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsHelpPopover__content:focus{outline:none}.lnsHelpPopover__content[tabindex='0']:focus:focus-visible{outline-style:auto}.lnsHelpPopover__buttonIcon{margin-right:4px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(329);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor{height:100%}.lnsIndexPatternDimensionEditor__header{position:sticky;top:0;background:#1D1E24;z-index:1000;padding:0 16px}.lnsIndexPatternDimensionEditor-isFullscreen{position:absolute;left:0;right:0;top:0;bottom:0}.lnsIndexPatternDimensionEditor-isFullscreen .lnsIndexPatternDimensionEditor__section{height:100%}.lnsIndexPatternDimensionEditor__section--padded{padding:16px}.lnsIndexPatternDimensionEditor__section--collapseNext{margin-bottom:-24px}.lnsIndexPatternDimensionEditor__section--shaded{background-color:#25262E;border-bottom:1px solid #343741}.lnsIndexPatternDimensionEditor__columns{column-count:2;column-gap:12px}.lnsIndexPatternDimensionEditor__operation .euiListGroupItem__label{width:100%}.lnsIndexPatternDimensionEditor__operation>button{padding-top:0;padding-bottom:0}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(331);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor{height:100%}.lnsIndexPatternDimensionEditor__header{position:sticky;top:0;background:#fff;z-index:1000;padding:0 16px}.lnsIndexPatternDimensionEditor-isFullscreen{position:absolute;left:0;right:0;top:0;bottom:0}.lnsIndexPatternDimensionEditor-isFullscreen .lnsIndexPatternDimensionEditor__section{height:100%}.lnsIndexPatternDimensionEditor__section--padded{padding:16px}.lnsIndexPatternDimensionEditor__section--collapseNext{margin-bottom:-24px}.lnsIndexPatternDimensionEditor__section--shaded{background-color:#F5F7FA;border-bottom:1px solid #D3DAE6}.lnsIndexPatternDimensionEditor__columns{column-count:2;column-gap:12px}.lnsIndexPatternDimensionEditor__operation .euiListGroupItem__label{width:100%}.lnsIndexPatternDimensionEditor__operation>button{padding-top:0;padding-bottom:0}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(333);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsInnerIndexPatternDataPanel{width:100%;height:100%;padding:16px 16px 0}.lnsInnerIndexPatternDataPanel__switcher{min-width:0}.lnsInnerIndexPatternDataPanel__header{display:flex;align-items:center;margin-bottom:8px}.lnsInnerIndexPatternDataPanel__titleTooltip{margin-right:4px}.lnsInnerIndexPatternDataPanel__fieldItems{padding:4px}.lnsInnerIndexPatternDataPanel__textField{padding-right:40px;padding-left:40px}.lnsInnerIndexPatternDataPanel__filterType{font-size:14px;padding:8px;border-bottom:1px solid #25262E}.lnsInnerIndexPatternDataPanel__filterTypeInner{display:flex;align-items:center}.lnsInnerIndexPatternDataPanel__filterTypeInner .lnsFieldListPanel__fieldIcon{margin-right:8px}.lnsChangeIndexPatternPopover{width:320px}.lnsChangeIndexPatternPopover__trigger{padding:0 16px}.lnsLayerPanelChartSwitch_title{font-weight:600;display:inline;padding-left:8px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(335);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsInnerIndexPatternDataPanel{width:100%;height:100%;padding:16px 16px 0}.lnsInnerIndexPatternDataPanel__switcher{min-width:0}.lnsInnerIndexPatternDataPanel__header{display:flex;align-items:center;margin-bottom:8px}.lnsInnerIndexPatternDataPanel__titleTooltip{margin-right:4px}.lnsInnerIndexPatternDataPanel__fieldItems{padding:4px}.lnsInnerIndexPatternDataPanel__textField{padding-right:40px;padding-left:40px}.lnsInnerIndexPatternDataPanel__filterType{font-size:14px;padding:8px;border-bottom:1px solid #F5F7FA}.lnsInnerIndexPatternDataPanel__filterTypeInner{display:flex;align-items:center}.lnsInnerIndexPatternDataPanel__filterTypeInner .lnsFieldListPanel__fieldIcon{margin-right:8px}.lnsChangeIndexPatternPopover{width:320px}.lnsChangeIndexPatternPopover__trigger{padding:0 16px}.lnsLayerPanelChartSwitch_title{font-weight:600;display:inline;padding-left:8px}\n",""]),e.exports=t},,,,,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(344);case"v8light":return a(346)}},function(e,t,a){var n=a(66),i=a(345);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsIndexPatternFieldList{-webkit-mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);scrollbar-color:rgba(152,162,179,0.5) rgba(0,0,0,0);scrollbar-width:thin;margin-left:-16px;position:relative;flex-grow:1;overflow:auto}.lnsIndexPatternFieldList::-webkit-scrollbar{width:16px;height:16px}.lnsIndexPatternFieldList::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsIndexPatternFieldList::-webkit-scrollbar-corner,.lnsIndexPatternFieldList::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsIndexPatternFieldList__accordionContainer{padding-top:8px;position:absolute;top:0;left:16px;right:4px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(347);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsIndexPatternFieldList{-webkit-mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);scrollbar-color:rgba(105,112,125,0.5) rgba(0,0,0,0);scrollbar-width:thin;margin-left:-16px;position:relative;flex-grow:1;overflow:auto}.lnsIndexPatternFieldList::-webkit-scrollbar{width:16px;height:16px}.lnsIndexPatternFieldList::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsIndexPatternFieldList::-webkit-scrollbar-corner,.lnsIndexPatternFieldList::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsIndexPatternFieldList__accordionContainer{padding-top:8px;position:absolute;top:0;left:16px;right:4px}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(349);case"v8light":return a(351)}},function(e,t,a){var n=a(66),i=a(350);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsFieldItem{width:100%}.lnsFieldItem.kbnFieldButton:focus-within,.lnsFieldItem.kbnFieldButton-isActive{outline:none}.lnsFieldItem.kbnFieldButton:focus-within:focus-visible,.lnsFieldItem.kbnFieldButton-isActive:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus{outline:none}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{background-color:rgba(54,162,239,0.2);outline:2px solid currentColor}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible .kbnFieldButton__name>span{outline-style:auto}.lnsFieldItem .kbnFieldButton__button:focus:not(:focus-visible) .kbnFieldButton__name>span{outline:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{text-decoration:underline}.lnsFieldItem .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.lnsFieldItem:hover:not([class*='isActive']){cursor:grab}.lnsFieldItem:hover:not([class*='isActive']) .lnsFieldItem__infoIcon{visibility:visible;opacity:1;transition:opacity 150ms ease-in-out 1s}.kbnFieldButton.lnsDragDrop_ghost .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.kbnFieldButton__name{transition:background-color 150ms ease-in-out}.lnsFieldItem--missing{background:#1D1E24;color:#98A2B3}.lnsFieldItem__topValue{margin-bottom:8px}.lnsFieldItem__topValue:last-of-type{margin-bottom:0}.lnsFieldItem__topValueProgress{background-color:#25262E}.lnsFieldItem__topValueProgress::-webkit-progress-bar{background-color:#25262E}.lnsFieldItem__fieldPanel{min-width:260px;max-width:300px}.lnsFieldItem__fieldPanelTitle{text-transform:none}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(352);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsFieldItem{width:100%}.lnsFieldItem.kbnFieldButton:focus-within,.lnsFieldItem.kbnFieldButton-isActive{outline:none}.lnsFieldItem.kbnFieldButton:focus-within:focus-visible,.lnsFieldItem.kbnFieldButton-isActive:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus{outline:none}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{background-color:rgba(0,119,204,0.1);outline:2px solid currentColor}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible .kbnFieldButton__name>span{outline-style:auto}.lnsFieldItem .kbnFieldButton__button:focus:not(:focus-visible) .kbnFieldButton__name>span{outline:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{text-decoration:underline}.lnsFieldItem .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.lnsFieldItem:hover:not([class*='isActive']){cursor:grab}.lnsFieldItem:hover:not([class*='isActive']) .lnsFieldItem__infoIcon{visibility:visible;opacity:1;transition:opacity 150ms ease-in-out 1s}.kbnFieldButton.lnsDragDrop_ghost .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.kbnFieldButton__name{transition:background-color 150ms ease-in-out}.lnsFieldItem--missing{background:rgba(152,162,179,0.1);color:#69707D}.lnsFieldItem__topValue{margin-bottom:8px}.lnsFieldItem__topValue:last-of-type{margin-bottom:0}.lnsFieldItem__topValueProgress{background-color:#F5F7FA}.lnsFieldItem__topValueProgress::-webkit-progress-bar{background-color:#F5F7FA}.lnsFieldItem__fieldPanel{min-width:260px;max-width:300px}.lnsFieldItem__fieldPanelTitle{text-transform:none}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(354);case"v8light":return a(356)}},function(e,t,a){var n=a(66),i=a(355);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisualizeGeoFieldWorkspacePanel__dragDrop{padding:40px 64px;border:1px solid #343741;border-radius:6px}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isDropTarget{border:1px dashed #343741;background-color:rgba(84,179,153,0.1)}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isActiveDropTarget{background-color:rgba(84,179,153,0.25);border:1px dashed #54B399}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(357);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisualizeGeoFieldWorkspacePanel__dragDrop{padding:40px 64px;border:1px solid #D3DAE6;border-radius:6px}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isDropTarget{border:1px dashed #D3DAE6;background-color:rgba(84,179,153,0.1)}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isActiveDropTarget{background-color:rgba(84,179,153,0.25);border:1px dashed #54B399}\n",""]),e.exports=t},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";e.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var n,i,l;if(Array.isArray(t)){if((n=t.length)!=a.length)return!1;for(i=n;0!=i--;)if(!e(t[i],a[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((n=(l=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(a,l[i]))return!1;for(i=n;0!=i--;){var s=l[i];if(!e(t[s],a[s]))return!1}return!0}return t!=t&&a!=a}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(422);case"v8light":return a(424)}},function(e,t,a){var n=a(66),i=a(423);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsAppWrapper{display:flex;flex-direction:column;flex-grow:1}.lnsApp{flex:1 1 auto;display:flex;flex-direction:column;height:100%;overflow:hidden}.lnsApp__frame{position:relative;display:flex;flex-direction:column;flex-grow:1}.lensChartIcon__subdued{fill:#7a7f89}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__subdued{fill:currentColor}.lensChartIcon__accent{fill:#54B399}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__accent{fill:#2a574a}.lensAnnotationIconNoFill{fill:none}.lensAnnotationIconFill{fill:#1D1E24}@media only screen and (min-width: 768px) and (max-width: 991px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width: 992px) and (max-width: 1199px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width: 1200px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width: 768px) and (max-width: 991px){.lnsNavItem__goBack::after{border-right:1px solid #343741;bottom:0;content:'';display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width: 992px) and (max-width: 1199px){.lnsNavItem__goBack::after{border-right:1px solid #343741;bottom:0;content:'';display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width: 1200px){.lnsNavItem__goBack::after{border-right:1px solid #343741;bottom:0;content:'';display:block;pointer-events:none;position:absolute;right:-8px;top:0}}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(425);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsAppWrapper{display:flex;flex-direction:column;flex-grow:1}.lnsApp{flex:1 1 auto;display:flex;flex-direction:column;height:100%;overflow:hidden}.lnsApp__frame{position:relative;display:flex;flex-direction:column;flex-grow:1}.lensChartIcon__subdued{fill:#69707D}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__subdued{fill:currentColor}.lensChartIcon__accent{fill:#54B399}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__accent{fill:#9ed4c5}.lensAnnotationIconNoFill{fill:none}.lensAnnotationIconFill{fill:#fff}@media only screen and (min-width: 768px) and (max-width: 991px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width: 992px) and (max-width: 1199px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width: 1200px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width: 768px) and (max-width: 991px){.lnsNavItem__goBack::after{border-right:1px solid #D3DAE6;bottom:0;content:'';display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width: 992px) and (max-width: 1199px){.lnsNavItem__goBack::after{border-right:1px solid #D3DAE6;bottom:0;content:'';display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width: 1200px){.lnsNavItem__goBack::after{border-right:1px solid #D3DAE6;bottom:0;content:'';display:block;pointer-events:none;position:absolute;right:-8px;top:0}}\n",""]),e.exports=t},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";a.r(t),a.d(t,"getDatatableRenderer",(function(){return C})),a.d(t,"getDatatableVisualization",(function(){return R})),a.d(t,"DatatableVisualization",(function(){return DatatableVisualization})),a.d(t,"supportedTypes",(function(){return oe})),a.d(t,"getMetricVisualization",(function(){return de})),a.d(t,"MetricVisualization",(function(){return MetricVisualization})),a.d(t,"getPieVisualization",(function(){return qe})),a.d(t,"PieVisualization",(function(){return PieVisualization})),a.d(t,"visualizationTypes",(function(){return $e.visualizationTypes})),a.d(t,"getXyVisualization",(function(){return kn})),a.d(t,"XyVisualization",(function(){return xy_visualization_XyVisualization})),a.d(t,"isBucketed",(function(){return Rn})),a.d(t,"filterOperationsAxis",(function(){return Hn})),a.d(t,"isCellValueSupported",(function(){return Gn})),a.d(t,"getHeatmapVisualization",(function(){return $n})),a.d(t,"HeatmapVisualization",(function(){return HeatmapVisualization})),a.d(t,"isNumericMetric",(function(){return ai})),a.d(t,"isNumericDynamicMetric",(function(){return ni})),a.d(t,"CHART_NAMES",(function(){return ii})),a.d(t,"getGaugeVisualization",(function(){return ri})),a.d(t,"GaugeVisualization",(function(){return gauge_GaugeVisualization})),a.d(t,"deleteColumn",(function(){return Os})),a.d(t,"columnToOperation",(function(){return cd})),a.d(t,"getSuffixFormatter",(function(){return wr})),a.d(t,"unitSuffixesLong",(function(){return Mr})),a.d(t,"suffixFormatterId",(function(){return Fr})),a.d(t,"getIndexPatternDatasource",(function(){return dd})),a.d(t,"createFormulaPublicApi",(function(){return md})),a.d(t,"IndexPatternDatasource",(function(){return indexpattern_datasource_IndexPatternDatasource})),a.d(t,"EditorFrame",(function(){return fd.a})),a.d(t,"initializeDatasources",(function(){return fd.d})),a.d(t,"getDatasourceLayers",(function(){return fd.b})),a.d(t,"persistedStateToExpression",(function(){return fd.e})),a.d(t,"getMissingIndexPattern",(function(){return fd.c})),a.d(t,"validateDatasourceAndVisualization",(function(){return fd.f})),a.d(t,"EditorFrameService",(function(){return service_EditorFrameService})),a.d(t,"Embeddable",(function(){return embeddable_Embeddable})),a.d(t,"getLensServices",(function(){return Zd})),a.d(t,"mountApp",(function(){return Qd})),a.d(t,"getLensAttributeService",(function(){return ep})),a.d(t,"setReportManager",(function(){return fn.b})),a.d(t,"stopReportManager",(function(){return fn.c})),a.d(t,"trackUiEvent",(function(){return fn.e})),a.d(t,"trackSuggestionEvent",(function(){return fn.d})),a.d(t,"LensReportManager",(function(){return fn.a})),a.d(t,"SaveModalContainer",(function(){return $d.SaveModalContainer})),a.d(t,"runSaveLensVisualization",(function(){return $d.runSaveLensVisualization})),a.d(t,"removePinnedFilters",(function(){return $d.removePinnedFilters}));var n=a(21),i=a.n(n),l=a(7),s=a.n(l),r=a(34),o=a.n(r),u=a(0),c=a(32),d=a(23),p=(a(173),a(77)),m=a(200),g=a.n(m),f=a(5),b=a(52),h=(a(178),a(33)),x=a.n(h),y=a(2);function v({children:e,className:t,...a}){return Object(y.jsx)("div",i()({"data-test-subj":"lnsVisualizationContainer",className:x()(t,"lnsVisualizationContainer")},a),e)}var j=a(68);const O=({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t},e):null,Object(y.jsx)("path",{d:"M11 18a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1h10zm0-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1h10zm0-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1V7a1 1 0 011-1h10zm18-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1V1a1 1 0 011-1h28z",className:"lensChartIcon__subdued"}),Object(y.jsx)("path",{d:"M20 18a1 1 0 011 1v2a1 1 0 01-.883.993L20 22h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm-9-6a1 1 0 011 1v2a1 1 0 01-.883.993L20 16h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm-9-6a1 1 0 011 1v2a1 1 0 01-.883.993L20 10h-5a1 1 0 01-1-1V7a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1V7a1 1 0 011-1h5z",className:"lensChartIcon__accent"}));var k=a(24),I=a(104);const T=s.a.createContext({}),M={border:"horizontal",header:"underline"},F=[10,20,30,50,100],w=e=>{var t,a,n;const i=Object(l.useRef)(null),s=e.interactive,[r,o]=Object(l.useState)({columns:e.args.columns,sortingColumnId:e.args.sortingColumnId,sortingDirection:e.args.sortingDirection}),[c,d]=Object(l.useState)(e.data),[m,h]=Object(l.useState)(void 0);Object(l.useEffect)((()=>{var t;h(e.args.pageSize?{pageIndex:0,pageSize:null!==(t=e.args.pageSize)&&void 0!==t?t:10}:void 0)}),[e.args.pageSize]),g()((()=>{o({columns:e.args.columns,sortingColumnId:e.args.sortingColumnId,sortingDirection:e.args.sortingDirection})}),[e.args.columns,e.args.sortingColumnId,e.args.sortingDirection]),g()((()=>{d(e.data)}),[e.data]);const w=Object(l.useRef)(c);w.current=c;const C=Object(l.useRef)(e.untransposedData);C.current=e.untransposedData;const _=null===(t=e.rowHasRowClickTriggerActions)||void 0===t?void 0:t.some((e=>e)),{getType:S,dispatchEvent:E,renderMode:P,formatFactory:A}=e,L=Object(l.useMemo)((()=>c.columns.reduce(((e,t)=>{var a;return{...e,[t.id]:A(null===(a=t.meta)||void 0===a?void 0:a.params)}}),{})),[c,A]),D=Object(l.useCallback)((e=>{E({name:"filter",data:e})}),[E]),N=Object(l.useCallback)((e=>{E({name:"edit",data:e})}),[E]),z=Object(l.useCallback)((e=>N({action:"pagesize",size:e})),[N]),B=Object(l.useCallback)((e=>{h((t=>{if(t)return{pageSize:null==t?void 0:t.pageSize,pageIndex:e}}))}),[h]),V=Object(l.useCallback)((e=>{E({name:"tableRowContextMenuClick",data:e})}),[E]),R=Object(l.useMemo)((()=>s?((e,t)=>(a,n,i,l,s=!1)=>{const r={negate:s,data:[{row:l,column:i,value:n,table:e.current}]};t(r)})(w,D):void 0),[w,D,s]),H=Object(l.useMemo)((()=>s?((e,t)=>(a,n=!1)=>{if(!t.current)return;const i=t.current,l={negate:n,data:a.map((({originalBucketColumn:e,value:t})=>{const a=i.columns.findIndex((t=>t.id===e.id));return{row:i.rows.findIndex((a=>a[e.id]===t)),column:a,value:t,table:i}}))};e(l)})(D,C):void 0),[D,C,s]),G=Object(l.useMemo)((()=>r.columns.filter(((e,t)=>{var a,n,i;const l=w.current.columns[t];return(null==l||null===(a=l.meta)||void 0===a||null===(n=a.sourceParams)||void 0===n?void 0:n.type)&&"buckets"===(null===(i=S(l.meta.sourceParams.type))||void 0===i?void 0:i.type)})).map((e=>e.columnId))),[w,r,S]),q=0===c.rows.length||G.length&&e.data.rows.every((e=>G.every((t=>null==e[t])))),$=Object(l.useMemo)((()=>r.columns.filter((e=>!!e.columnId&&!e.hidden)).map((e=>e.columnId))),[r]),{sortingColumnId:W,sortingDirection:U}=e.args,Y="edit"!==P,X=Object(l.useMemo)((()=>((e,t,a)=>n=>{const i=Object(k.d)(n.columnId);return t({...e,columns:e.columns.map((e=>e.columnId===n.columnId||e.originalColumnId===i?{...e,width:n.width}:e))}),a({action:"resize",columnId:i,width:n.width})})(r,o,N)),[N,o,r]),K=Object(l.useMemo)((()=>s?((e,t,a)=>n=>{const i=Object(k.d)(n.columnId);return t({...e,columns:e.columns.map((e=>e.columnId===n.columnId||e.originalColumnId===i?{...e,hidden:!0}:e))}),a({action:"toggle",columnId:i})})(r,o,N):void 0),[N,o,r,s]),Z=Object(l.useMemo)((()=>{const e={};for(const a of c.columns){var t;e[a.id]="number"===a.meta.type&&null!=a.meta.field||null==a.meta.field&&"number"==typeof(null===(t=c.rows.find((e=>null!=e[a.id])))||void 0===t?void 0:t[a.id])}return e}),[c]),Q=Object(l.useMemo)((()=>{const e={};return r.columns.forEach((t=>{t.alignment?e[t.columnId]=t.alignment:e[t.columnId]=Z[t.columnId]?"right":"left"})),e}),[r,Z]),J=Object(l.useMemo)((()=>Object(j.n)(r.columns.filter((({columnId:e})=>Z[e])).map((({columnId:e})=>e)),e.data,k.d)),[e.data,Z,r]),ee=null!==(a=e.args.headerRowHeight)&&void 0!==a?a:"single",te=null!==(n=e.args.headerRowHeightLines)&&void 0!==n?n:1,ae=Object(l.useMemo)((()=>{var e;return((e,t,a,n,i,l,s,r,o,c,d,p,m,g)=>{const f=t.columns.reduce(((e,{id:t,name:a,meta:n},i)=>(e[t]={name:a,index:i,meta:n},e)),{}),b=new Set(e),h=({rowIndex:e,columnId:a})=>{var n;const i=t.rows[e][a],l=null==f?void 0:f[a];return{rowValue:i,contentsIsDefined:null!=i,cellContent:r(null==l||null===(n=l.meta)||void 0===n?void 0:n.params).convert(i)}};return s.map((e=>{const t=b.has(e),{name:r,index:x}=f[e],v=t&&a?[({rowIndex:t,columnId:n,Component:i})=>{const{rowValue:l,contentsIsDefined:s,cellContent:r}=h({rowIndex:t,columnId:n}),o=u.i18n.translate("xpack.lens.table.tableCellFilter.filterForValueText",{defaultMessage:"Filter for value"}),c=u.i18n.translate("xpack.lens.table.tableCellFilter.filterForValueAriaLabel",{defaultMessage:"Filter for value: {cellContent}",values:{cellContent:r}});return s&&Object(y.jsx)(i,{"aria-label":c,"data-test-subj":"lensDatatableFilterFor",onClick:()=>{a(e,l,x,t),null==g||g()},iconType:"plusInCircle"},o)},({rowIndex:t,columnId:n,Component:i})=>{const{rowValue:l,contentsIsDefined:s,cellContent:r}=h({rowIndex:t,columnId:n}),o=u.i18n.translate("xpack.lens.table.tableCellFilter.filterOutValueText",{defaultMessage:"Filter out value"}),c=u.i18n.translate("xpack.lens.table.tableCellFilter.filterOutValueAriaLabel",{defaultMessage:"Filter out value: {cellContent}",values:{cellContent:r}});return s&&Object(y.jsx)(i,{"data-test-subj":"lensDatatableFilterOut","aria-label":c,onClick:()=>{a(e,l,x,t,!0),null==g||g()},iconType:"minusInCircle"},o)}]:void 0,j=l.columns.find((({columnId:t})=>t===e)),O=Boolean(null==j?void 0:j.originalColumnId),k=null==j?void 0:j.width,I=null==j?void 0:j.hidden,T=null==j?void 0:j.originalColumnId,M=[];if(M.push({color:"text",size:"xs",onClick:()=>o({columnId:T||e,width:void 0}),iconType:"empty",label:u.i18n.translate("xpack.lens.table.resize.reset",{defaultMessage:"Reset width"}),"data-test-subj":"lensDatatableResetWidth",isDisabled:null==k}),!O&&c&&M.push({color:"text",size:"xs",onClick:()=>c({columnId:T||e}),iconType:"eyeClosed",label:u.i18n.translate("xpack.lens.table.hide.hideLabel",{defaultMessage:"Hide"}),"data-test-subj":"lensDatatableHide",isDisabled:!I&&s.length<=1}),!i&&O&&null!=j&&j.bucketValues&&n){const e=null==j?void 0:j.bucketValues;M.push({color:"text",size:"xs",onClick:()=>n(e,!1),iconType:"plusInCircle",label:u.i18n.translate("xpack.lens.table.columnFilter.filterForValueText",{defaultMessage:"Filter for column"}),"data-test-subj":"lensDatatableHide"}),M.push({color:"text",size:"xs",onClick:()=>n(e,!0),iconType:"minusInCircle",label:u.i18n.translate("xpack.lens.table.columnFilter.filterOutValueText",{defaultMessage:"Filter out column"}),"data-test-subj":"lensDatatableHide"})}const F=d&&d[e],w="auto"===p||"custom"===p,C=Object(y.css)({..."custom"===p&&{WebkitLineClamp:m},...w&&{whiteSpace:"normal",display:"-webkit-box",WebkitBoxOrient:"vertical"},textAlign:F},"",""),_={id:e,cellActions:v,display:Object(y.jsx)("div",{css:C},r),displayAsText:r,actions:{showHide:!1,showMoveLeft:!1,showMoveRight:!1,showSortAsc:{label:u.i18n.translate("xpack.lens.table.sort.ascLabel",{defaultMessage:"Sort ascending"})},showSortDesc:{label:u.i18n.translate("xpack.lens.table.sort.descLabel",{defaultMessage:"Sort descending"})},additional:M}};return k&&(_.initialWidth=k),_}))})(G,c,R,H,Y,r,$,A,X,K,Q,ee,te,null===(e=i.current)||void 0===e?void 0:e.closeCellPopover)}),[G,c,R,H,Y,r,$,A,X,K,Q,ee,te]),ne=Object(l.useMemo)((()=>_&&V&&s?[{headerCellRender:()=>null,width:40,id:"trailingControlColumn",rowCellRender:function({rowIndex:e}){const{rowHasRowClickTriggerActions:t}=Object(l.useContext)(T);return Object(y.jsx)(f.EuiButtonIcon,{"aria-label":u.i18n.translate("xpack.lens.table.actionsLabel",{defaultMessage:"Show actions"}),iconType:t&&!t[e]?"empty":"boxesVertical",color:"text",onClick:()=>{V({rowIndex:e,table:w.current,columns:r.columns.map((e=>e.columnId))})}})}}]:[]),[w,V,r,_,s]),ie=Object(l.useMemo)((()=>((e,t,a,n,i,s)=>{const r=n.get("theme:darkMode");return({rowIndex:n,columnId:o,setCellProps:u})=>{var c,d;const{table:p,alignments:m,minMaxByColumnId:g,getColorForValue:f}=Object(l.useContext)(a),b=null==p||null===(c=p.rows[n])||void 0===c?void 0:c[o],h=null===(d=e[o])||void 0===d?void 0:d.convert(b,"html"),v=`lnsTableCell--${m&&m[o]}`,j=x()(v,{lnsTableCell:!i&&1===s}),{colorMode:O,palette:T}=t.columns.find((({columnId:e})=>e===o))||{};return Object(l.useEffect)((()=>{const e=Object(k.d)(o);if(null!=g&&g[e]&&"none"!==O&&null!=T&&T.params&&f){const t=f(Object(I.d)(b),T.params,g[e]);if(t){const e={["cell"===O?"backgroundColor":"color"]:t};"cell"===O&&t&&(e.color=Object(I.c)(t,r)),u({style:e})}}return()=>{null!=g&&g[e]&&u({style:{backgroundColor:void 0,color:void 0}})}}),[b,o,u,O,T,g,f]),Object(y.jsx)("div",{dangerouslySetInnerHTML:{__html:h},"data-test-subj":"lnsTableCellContent",className:j})}})(L,r,T,e.uiSettings,e.args.fitRowToContent,e.args.rowHeightLines)),[L,r,e.uiSettings,e.args.fitRowToContent,e.args.rowHeightLines]),le=Object(l.useMemo)((()=>({visibleColumns:$,setVisibleColumns:()=>{}})),[$]),se=Object(l.useMemo)((()=>((e,t,a)=>({columns:e&&"none"!==t?[{id:e,direction:t}]:[],onSort:t=>{const n=t.length<=1?t[0]:t[1],i=e!==((null==n?void 0:n.id)||""),l=n?n.direction:"none";return a({action:"sort",columnId:"none"!==l||i?null==n?void 0:n.id:void 0,direction:l})}}))(W,U,N)),[N,W,U]),re=Object(l.useMemo)((()=>{const t=r.columns.filter((e=>!!e.columnId&&!e.hidden)).map((t=>({columnId:t.columnId,summaryRowValue:t.summaryRowValue,...Object(k.c)(t.columnId,t,e.data)}))).filter((({summaryRow:e})=>"none"!==e));if(t.length){const e=Object.fromEntries(t.map((({summaryRowValue:e,summaryLabel:t,columnId:a})=>[a,""===t?`${e}`:`${t}: ${e}`])));return({columnId:t})=>{var a,n;const i=`lnsTableCell--${Q&&Q[t]}`,l=(null===(a=ae.find((({id:e})=>e===t)))||void 0===a||null===(n=a.displayAsText)||void 0===n?void 0:n.replace(/ /g,"-"))||t;return null!=e[t]?Object(y.jsx)("div",{className:`lnsTableCell ${i}`,"data-test-subj":`lnsDataTable-footer-${l}`},e[t]):null}}}),[r.columns,Q,e.data,ae]);if(q)return Object(y.jsx)(v,{className:"lnsDataTableContainer"},Object(y.jsx)(b.EmptyPlaceholder,{icon:O}));const oe=e.args.title||u.i18n.translate("xpack.lens.table.defaultAriaLabel",{defaultMessage:"Data table visualization"});return Object(y.jsx)(v,{className:"lnsDataTableContainer"},Object(y.jsx)(T.Provider,{value:{table:c,rowHasRowClickTriggerActions:e.rowHasRowClickTriggerActions,alignments:Q,minMaxByColumnId:J,getColorForValue:e.paletteService.get(p.a).getColorForValue}},Object(y.jsx)(f.EuiDataGrid,{"aria-label":oe,"data-test-subj":"lnsDataTable",rowHeightsOptions:{defaultHeight:e.args.fitRowToContent?"auto":e.args.rowHeightLines?{lineCount:e.args.rowHeightLines}:void 0},columns:ae,columnVisibility:le,trailingControlColumns:ne,rowCount:c.rows.length,renderCellValue:ie,gridStyle:M,sorting:se,pagination:m&&{...m,pageSizeOptions:F,onChangeItemsPerPage:z,onChangePage:B},onColumnResize:X,toolbarVisibility:!1,renderFooterCellValue:re,ref:i})))},C=e=>({name:"lens_datatable_renderer",displayName:u.i18n.translate("xpack.lens.datatable.visualizationName",{defaultMessage:"Datatable"}),help:"",validate:()=>{},reuseDomNode:!0,render:async(t,a,n)=>{const l=await e.getType,{hasCompatibleActions:s,isInteractive:r}=n;let u=[];s&&a.data&&(u=await Promise.all(a.data.rows.map((async(e,t)=>{try{return await s({name:"tableRowContextMenuClick",data:{rowIndex:t,table:a.data,columns:a.args.columns.map((e=>e.columnId))}})}catch{return!1}})))),o.a.render(Object(y.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(w,i()({},a,{formatFactory:e.formatFactory,dispatchEvent:n.event,renderMode:n.getRenderMode(),paletteService:e.paletteService,getType:l,rowHasRowClickTriggerActions:u,interactive:r(),uiSettings:e.uiSettings})))),t,(()=>{n.done()})),n.onDestroy((()=>o.a.unmountComponentAtNode(t)))}});var _=a(8);a(202);const S=[{text:u.i18n.translate("xpack.lens.collapse.none",{defaultMessage:"None"}),value:""},{text:u.i18n.translate("xpack.lens.collapse.sum",{defaultMessage:"Sum"}),value:"sum"},{text:u.i18n.translate("xpack.lens.collapse.min",{defaultMessage:"Min"}),value:"min"},{text:u.i18n.translate("xpack.lens.collapse.max",{defaultMessage:"Max"}),value:"max"},{text:u.i18n.translate("xpack.lens.collapse.avg",{defaultMessage:"Average"}),value:"avg"}];function E({value:e,onChange:t}){return Object(y.jsx)(f.EuiFormRow,{label:Object(y.jsx)(f.EuiToolTip,{delay:"long",position:"top",content:u.i18n.translate("xpack.lens.collapse.infoIcon",{defaultMessage:"Do not show this dimension in the visualization and aggregate all metric values which have the same value for this dimension into a single number."})},Object(y.jsx)("span",null,u.i18n.translate("xpack.lens.collapse.label",{defaultMessage:"Collapse by"}),"",Object(y.jsx)(f.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"}))),display:"columnCompressed",fullWidth:!0},Object(y.jsx)(f.EuiSelect,{compressed:!0,"data-test-subj":"indexPattern-terms-orderBy",options:S,value:e,onChange:e=>{t(e.target.value)}}))}const P=Object(f.htmlIdGenerator)()();function A(e,t,a){return e.columns.map((e=>e.columnId===t?{...e,...a}:e))}function L(e){var t,a;const{state:n,setState:i,frame:r,accessor:o}=e,c=n.columns.find((({columnId:e})=>o===e)),[d,m]=Object(l.useState)(!1),g=Object(l.useCallback)((e=>{i({...n,columns:A(n,o,{summaryLabel:e})})}),[o,i,n]),{inputValue:b,handleInputChange:h}=Object(j.p)({onChange:g,value:null==c?void 0:c.summaryLabel},{allowFalsyValue:!0});if(!c)return null;if(c.isTransposed)return null;const x=null===(t=r.activeData)||void 0===t?void 0:t[n.layerId],v=Object(k.f)(x,o),O=(null==c?void 0:c.alignment)||(v?"right":"left"),I=(null==c?void 0:c.colorMode)||"none",T="none"!==I,{summaryRow:M,summaryLabel:F}=Object(k.c)(o,c,x),w=r.datasourceLayers[n.layerId],C=Boolean(v&&!(null!=w&&null!==(a=w.getOperationForColumnId(o))&&void 0!==a&&a.isBucketed)),_=n.columns.filter((e=>!e.hidden)).length,S=n.columns.some((({isTransposed:e})=>e))?(null==x?void 0:x.columns.filter((({id:e})=>Object(k.d)(e)===o)).map((({id:e})=>e)))||[]:[o],L=Object(j.n)(S,x,k.d)[o],D=(null==c?void 0:c.palette)||{type:"palette",name:j.m.name},N=Object(j.l)(e.paletteService,D,L);return Object(y.jsx)(s.a.Fragment,null,"rows"===e.groupId&&Object(y.jsx)(E,{value:c.collapseFn||"",onChange:e=>{i({...n,columns:A(n,o,{collapseFn:e})})}}),Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.alignment.label",{defaultMessage:"Text alignment"})},Object(y.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.table.alignment.label",{defaultMessage:"Text alignment"}),"data-test-subj":"lnsDatatable_alignment_groups",name:"alignment",buttonSize:"compressed",options:[{id:`${P}left`,label:u.i18n.translate("xpack.lens.table.alignment.left",{defaultMessage:"Left"}),"data-test-subj":"lnsDatatable_alignment_groups_left"},{id:`${P}center`,label:u.i18n.translate("xpack.lens.table.alignment.center",{defaultMessage:"Center"}),"data-test-subj":"lnsDatatable_alignment_groups_center"},{id:`${P}right`,label:u.i18n.translate("xpack.lens.table.alignment.right",{defaultMessage:"Right"}),"data-test-subj":"lnsDatatable_alignment_groups_right"}],idSelected:`${P}${O}`,onChange:e=>{const t=e.replace(P,"");i({...n,columns:A(n,o,{alignment:t})})}})),!c.isTransposed&&Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.table.columnVisibilityLabel",{defaultMessage:"Hide column"}),display:"columnCompressedSwitch"},Object(y.jsx)(f.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.table.columnVisibilityLabel",{defaultMessage:"Hide column"}),showLabel:!1,"data-test-subj":"lns-table-column-hidden",checked:Boolean(null==c?void 0:c.hidden),disabled:!c.hidden&&_<=1,onChange:()=>{const e={...n,columns:n.columns.map((e=>e.columnId===o?{...e,hidden:!c.hidden}:e))};i(e)}})),v&&Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.lens.table.summaryRow.label",{defaultMessage:"Summary Row"}),display:"columnCompressed"},Object(y.jsx)(f.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"lnsDatatable_summaryrow_function",placeholder:u.i18n.translate("xpack.lens.indexPattern.fieldPlaceholder",{defaultMessage:"Field"}),options:Object(k.e)(),selectedOptions:[{label:Object(k.b)(M),value:M}],singleSelection:{asPlainText:!0},onChange:e=>{const t=e[0].value;i({...n,columns:A(n,o,{summaryRow:t})})}})),"none"!==M&&Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.summaryRow.customlabel",{defaultMessage:"Summary label"})},Object(y.jsx)(f.EuiFieldText,{compressed:!0,"data-test-subj":"lnsDatatable_summaryrow_label",value:null!=b?b:F,onChange:e=>{h(e.target.value)}}))),C&&Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.dynamicColoring.label",{defaultMessage:"Color by value"})},Object(y.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.table.dynamicColoring.label",{defaultMessage:"Color by value"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups",name:"dynamicColoring",buttonSize:"compressed",options:[{id:`${P}none`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.none",{defaultMessage:"None"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_none"},{id:`${P}cell`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.cell",{defaultMessage:"Cell"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_cell"},{id:`${P}text`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.text",{defaultMessage:"Text"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_text"}],idSelected:`${P}${I}`,onChange:e=>{const t=e.replace(P,""),a={colorMode:t};null!=c&&c.palette||"none"===t||(a.palette={...D,params:{...D.params,stops:N}}),null!=c&&c.palette&&"none"===t&&(a.palette=void 0),i({...n,columns:A(n,o,a)})}})),T&&Object(y.jsx)(f.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteTableGradient.label",{defaultMessage:"Color"})},Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(f.EuiColorPaletteDisplay,{"data-test-subj":"lnsDatatable_dynamicColoring_palette",palette:N.map((({color:e})=>e)),type:p.i,onClick:()=>{m(!d)}})),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiButtonEmpty,{"data-test-subj":"lnsDatatable_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:()=>{m(!d)},size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(y.jsx)(j.e,{siblingRef:e.panelRef,isOpen:d,handleClose:()=>m(!d)},Object(y.jsx)(p.b,{palettes:e.paletteService,activePalette:D,dataBounds:L,setPalette:e=>{i({...n,columns:A(n,o,{palette:e})})}})))))))}var D=a(11);const N=Object(f.htmlIdGenerator)()();function z(e){const{label:t,rowHeight:a,rowHeightLines:n,onChangeRowHeight:i,onChangeRowHeightLines:l,maxRowHeight:r}=e,o=[{id:`${N}single`,label:u.i18n.translate("xpack.lens.table.rowHeight.single",{defaultMessage:"Single"}),"data-test-subj":"lnsDatatable_rowHeight_single"},{id:`${N}auto`,label:u.i18n.translate("xpack.lens.table.rowHeight.auto",{defaultMessage:"Auto fit"}),"data-test-subj":"lnsDatatable_rowHeight_auto"},{id:`${N}custom`,label:u.i18n.translate("xpack.lens.table.rowHeight.custom",{defaultMessage:"Custom"}),"data-test-subj":"lnsDatatable_rowHeight_custom"}];return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{label:t,display:"columnCompressed","data-test-subj":e["data-test-subj"]},Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:t,name:"legendLocation",buttonSize:"compressed",options:o,idSelected:`${N}${null!=a?a:"single"}`,onChange:e=>{const t=e.replace(N,"");i(t)}}),"custom"===a?Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiSpacer,{size:"xs"}),Object(y.jsx)(f.EuiRange,{compressed:!0,fullWidth:!0,showInput:!0,min:1,max:null!=r?r:20,step:1,value:null!=n?n:2,onChange:e=>{const t=Number(e.currentTarget.value);l(t)},"data-test-subj":"lens-table-row-height-lineCountNumber"})):null)))}function B(e){var t;const{state:a,setState:n}=e,i=Object(l.useCallback)(((e,t,i)=>{const l="single"===e?1:"auto"!==e?2:void 0;n({...a,[t]:e,[i]:l})}),[n,a]),s=Object(l.useCallback)(((e,t)=>{n({...a,[t]:e})}),[n,a]),r=Object(l.useCallback)((()=>{var e;const t=null!==(e=a.paging)&&void 0!==e?e:{size:10,enabled:!1};n({...a,paging:{...t,enabled:!t.enabled}})}),[n,a]);return Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(y.jsx)(j.h,{title:u.i18n.translate("xpack.lens.table.valuesVisualOptions",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"none",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(y.jsx)(z,{rowHeight:a.headerRowHeight,rowHeightLines:a.headerRowHeightLines,label:u.i18n.translate("xpack.lens.table.visualOptionsHeaderRowHeightLabel",{defaultMessage:"Header row height"}),onChangeRowHeight:e=>i(e,"headerRowHeight","headerRowHeightLines"),onChangeRowHeightLines:e=>{s(e,"headerRowHeightLines")},"data-test-subj":"lnsHeaderHeightSettings",maxRowHeight:5}),Object(y.jsx)(z,{rowHeight:a.rowHeight,rowHeightLines:a.rowHeightLines,label:u.i18n.translate("xpack.lens.table.visualOptionsFitRowToContentLabel",{defaultMessage:"Cell row height"}),onChangeRowHeight:e=>i(e,"rowHeight","rowHeightLines"),onChangeRowHeightLines:e=>{s(e,"rowHeightLines")},"data-test-subj":"lnsRowHeightSettings"}),Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.table.visualOptionsPaginateTable",{defaultMessage:"Paginate table"}),display:"columnCompressedSwitch"},Object(y.jsx)(f.EuiToolTip,{content:u.i18n.translate("xpack.lens.table.visualOptionsPaginateTableTooltip",{defaultMessage:"Pagination is hidden if there are less than 10 items"}),position:"right"},Object(y.jsx)(f.EuiSwitch,{compressed:!0,"data-test-subj":"lens-table-pagination-switch",label:"",showLabel:!1,checked:Boolean(null===(t=a.paging)||void 0===t?void 0:t.enabled),onChange:r})))))}const V=u.i18n.translate("xpack.lens.datatable.label",{defaultMessage:"Table"}),R=({paletteService:e,theme:t})=>({id:"lnsDatatable",visualizationTypes:[{id:"lnsDatatable",icon:O,label:V,groupLabel:u.i18n.translate("xpack.lens.datatable.groupLabel",{defaultMessage:"Tabular"}),sortPriority:5}],getVisualizationTypeId:()=>"lnsDatatable",getLayerIds:e=>[e.layerId],clearLayer:e=>({...e,columns:[]}),getDescription:()=>({icon:O,label:V}),switchVisualizationType:(e,t)=>t,triggers:[_.VIS_EVENT_TO_TRIGGER.filter,_.VIS_EVENT_TO_TRIGGER.tableRowContextMenuClick],initialize:(e,t)=>t||{columns:[],layerId:e(),layerType:D.o.DATA},getSuggestions({table:e,state:t,keptLayerIds:a}){if(a.length>1||a.length&&e.layerId!==a[0]||t&&"unchanged"===e.changeType||e.columns.some((e=>e.operation.isStaticValue)))return[];const n={};t&&t.columns.forEach((e=>{n[e.columnId]=e}));const i=e.columns.findIndex((e=>{var t;return!(!n[e.columnId]||null!==(t=n[e.columnId])&&void 0!==t&&t.isTransposed)})),l=null==t?void 0:t.columns.some((e=>e.isTransposed));return[{title:"unchanged"===e.changeType?u.i18n.translate("xpack.lens.datatable.suggestionLabel",{defaultMessage:"As table"}):u.i18n.translate("xpack.lens.datatable.visualizationOf",{defaultMessage:"Table {operations}",values:{operations:e.label||e.columns.map((e=>e.operation.label)).join(u.i18n.translate("xpack.lens.datatable.conjunctionSign",{defaultMessage:" & ",description:"A character that can be used for conjunction of multiple enumarated items. Make sure to include spaces around it if needed."}))}}),score:Math.min(e.columns.length,10)/10*.4,state:{...t||{},layerId:e.layerId,layerType:D.o.DATA,columns:e.columns.map(((e,t)=>({...n[e.columnId]||{},isTransposed:l&&t<i,columnId:e.columnId})))},previewIcon:O,hide:!0}]},getConfiguration({state:e,frame:t,layerId:a}){const{sortedColumns:n,datasource:i}=H(e,t.datasourceLayers)||{},l={};return e.columns.forEach((e=>{l[e.columnId]=e})),n?{groups:[{groupId:"rows",groupLabel:u.i18n.translate("xpack.lens.datatable.breakdownRows",{defaultMessage:"Rows"}),groupTooltip:u.i18n.translate("xpack.lens.datatable.breakdownRows.description",{defaultMessage:"Split table rows by field. This is recommended for high cardinality breakdowns."}),layerId:e.layerId,accessors:n.filter((t=>{var a,n;return(null===(a=i.getOperationForColumnId(t))||void 0===a?void 0:a.isBucketed)&&!(null!==(n=e.columns.find((e=>e.columnId===t)))&&void 0!==n&&n.isTransposed)})).map((e=>({columnId:e,triggerIcon:l[e].hidden?"invisible":l[e].collapseFn?"aggregate":void 0}))),supportsMoreColumns:!0,filterOperations:e=>e.isBucketed,dataTestSubj:"lnsDatatable_rows",enableDimensionEditor:!0,hideGrouping:!0,nestingOrder:1},{groupId:"columns",groupLabel:u.i18n.translate("xpack.lens.datatable.breakdownColumns",{defaultMessage:"Columns"}),groupTooltip:u.i18n.translate("xpack.lens.datatable.breakdownColumns.description",{defaultMessage:"Split metric columns by field. It's recommended to keep the number of columns low to avoid horizontal scrolling."}),layerId:e.layerId,accessors:n.filter((t=>{var a,n;return(null===(a=i.getOperationForColumnId(t))||void 0===a?void 0:a.isBucketed)&&(null===(n=e.columns.find((e=>e.columnId===t)))||void 0===n?void 0:n.isTransposed)})).map((e=>({columnId:e}))),supportsMoreColumns:!0,filterOperations:e=>e.isBucketed,dataTestSubj:"lnsDatatable_columns",enableDimensionEditor:!0,hideGrouping:!0,nestingOrder:0},{groupId:"metrics",groupLabel:u.i18n.translate("xpack.lens.datatable.metrics",{defaultMessage:"Metrics"}),layerId:e.layerId,accessors:n.filter((e=>{var t;return!(null!==(t=i.getOperationForColumnId(e))&&void 0!==t&&t.isBucketed)})).map((e=>{var t,a;const n=l[e],i=null===(t=n.palette)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.stops,s=Boolean("none"!==n.colorMode&&i);return{columnId:e,triggerIcon:n.hidden?"invisible":s?"colorBy":void 0,palette:s&&i?i.map((({color:e})=>e)):void 0}})),supportsMoreColumns:!0,filterOperations:e=>!e.isBucketed,required:!0,dataTestSubj:"lnsDatatable_metrics",enableDimensionEditor:!0}]}:{groups:[]}},setDimension:({prevState:e,columnId:t,groupId:a,previousColumn:n})=>e.columns.some((e=>e.columnId===t||n&&e.columnId===n))?{...e,columns:e.columns.map((e=>e.columnId===t||e.columnId===n?{...e,columnId:t,isTransposed:"columns"===a}:e))}:{...e,columns:[...e.columns,{columnId:t,isTransposed:"columns"===a}]},removeDimension({prevState:e,columnId:t}){var a;return{...e,columns:e.columns.filter((e=>e.columnId!==t)),sorting:(null===(a=e.sorting)||void 0===a?void 0:a.columnId)===t?void 0:e.sorting}},renderDimensionEditor(a,n){Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(L,i()({},n,{paletteService:e})))),a)},getSupportedLayers:()=>[{type:D.o.DATA,label:u.i18n.translate("xpack.lens.datatable.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression(t,a,{title:n,description:i}={},l={}){var s,r,o,u,c,d,m;const{sortedColumns:g,datasource:f}=H(t,a,t.layerId)||{};if(null!=g&&g.length&&0===g.filter((e=>{var t;return!(null!==(t=f.getOperationForColumnId(e))&&void 0!==t&&t.isBucketed)})).length)return null;if(!l||0===Object.keys(l).length)return null;const b={};t.columns.forEach((e=>{b[e.columnId]=e}));const h=g.filter((e=>f.getOperationForColumnId(e))).map((e=>b[e])),x=l[t.layerId];return{type:"expression",chain:[...null!==(s=null==x?void 0:x.chain)&&void 0!==s?s:[],...h.filter((e=>e.collapseFn)).map((e=>({type:"function",function:"lens_collapse",arguments:{by:h.filter((t=>{var a;return t.columnId!==e.columnId&&(null===(a=f.getOperationForColumnId(t.columnId))||void 0===a?void 0:a.isBucketed)})).map((e=>e.columnId)),metric:h.filter((e=>{var t;return!(null!==(t=f.getOperationForColumnId(e.columnId))&&void 0!==t&&t.isBucketed)})).map((e=>e.columnId)),fn:[e.collapseFn]}}))),{type:"function",function:"lens_datatable",arguments:{title:[n||""],description:[i||""],columns:h.filter((e=>!e.collapseFn)).map((t=>{var a,n,i,l,s,r,o,u,c,d;const m={...null===(a=t.palette)||void 0===a?void 0:a.params,colors:((null===(n=t.palette)||void 0===n||null===(i=n.params)||void 0===i?void 0:i.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null===(l=t.palette)||void 0===l||null===(s=l.params)||void 0===s?void 0:s.name)?((null===(r=t.palette)||void 0===r||null===(o=r.params)||void 0===o?void 0:o.stops)||[]).map((({stop:e})=>e)):[],reverse:!1},g=f.getOperationForColumnId(t.columnId).sortingHint,b=null==t.summaryRow||"none"===t.summaryRow,h="number"===(null===(u=f.getOperationForColumnId(t.columnId))||void 0===u?void 0:u.dataType);return{type:"expression",chain:[{type:"function",function:"lens_datatable_column",arguments:{columnId:[t.columnId],hidden:void 0===t.hidden?[]:[t.hidden],width:void 0===t.width?[]:[t.width],isTransposed:void 0===t.isTransposed?[]:[t.isTransposed],transposable:[!(null!==(c=f.getOperationForColumnId(t.columnId))&&void 0!==c&&c.isBucketed)],alignment:void 0===t.alignment?[]:[t.alignment],colorMode:[h&&t.colorMode?t.colorMode:"none"],palette:[e.get(p.a).toExpression(m)],summaryRow:b?[]:[t.summaryRow],summaryLabel:b?[]:[null!==(d=t.summaryLabel)&&void 0!==d?d:Object(k.b)(t.summaryRow)],sortingHint:g?[g]:[]}}]}})),sortingColumnId:[(null===(r=t.sorting)||void 0===r?void 0:r.columnId)||""],sortingDirection:[(null===(o=t.sorting)||void 0===o?void 0:o.direction)||"none"],fitRowToContent:["auto"===t.rowHeight],headerRowHeight:[null!==(u=t.headerRowHeight)&&void 0!==u?u:"single"],rowHeightLines:[t.rowHeight&&"single"!==t.rowHeight?null!==(c=t.rowHeightLines)&&void 0!==c?c:2:1],headerRowHeightLines:[t.headerRowHeight&&"single"!==t.headerRowHeight?null!==(d=t.headerRowHeightLines)&&void 0!==d?d:2:1],pageSize:null!==(m=t.paging)&&void 0!==m&&m.enabled?[t.paging.size]:[]}}]}},getErrorMessages(e){},renderToolbar(e,a){Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(B,a))),e)},onEditAction(e,t){var a;switch(t.data.action){case"sort":return{...e,sorting:{columnId:t.data.columnId,direction:t.data.direction}};case"toggle":const n=t.data.columnId;return{...e,columns:e.columns.map((e=>e.columnId===n?{...e,hidden:!e.hidden}:e))};case"resize":const i=t.data.width,l=t.data.columnId;return{...e,columns:e.columns.map((e=>e.columnId===l?{...e,width:i}:e))};case"pagesize":return{...e,paging:{enabled:(null===(a=e.paging)||void 0===a?void 0:a.enabled)||!1,size:t.data.size}};default:return e}}});function H(e,t,a){const n=t[e.layerId],i=n.getTableSpec().map((({columnId:e})=>e));return{datasource:n,sortedColumns:Array.from(new Set(i.concat(e.columns.map((({columnId:e})=>e)))))}}class DatatableVisualization{setup(e,{expressions:t,formatFactory:n,editorFrame:i,charts:l}){i.registerVisualization((async()=>{const{getDatatableRenderer:i,getDatatableVisualization:s}=await Promise.resolve().then(a.bind(null,463)),r=await l.palettes.getPalettes();return t.registerRenderer((()=>i({formatFactory:n,theme:e.theme,getType:e.getStartServices().then((([e,{data:t}])=>t.search.aggs.types.get)),paletteService:r,uiSettings:e.uiSettings}))),s({paletteService:r,theme:e.theme})}))}}var G=a(38),q=a(42);const $=({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t},e):null,Object(y.jsx)("path",{d:"M25 0a1 1 0 011 1v14a1 1 0 01-1 1H5a1 1 0 01-1-1V1a1 1 0 011-1h20zm-9.878 3c-1.887 0-3.265 1.107-3.26 2.61-.005 1.054.67 1.938 1.672 2.157v.067l-.155.03a2.453 2.453 0 00-1.879 2.394C11.495 11.84 12.997 13 15.122 13c2.105 0 3.612-1.16 3.617-2.742-.005-1.217-.903-2.234-2.035-2.424v-.067l.162-.042c.896-.275 1.507-1.12 1.511-2.116C18.373 4.112 16.994 3 15.122 3zm0 5.542c1.036 0 1.796.665 1.806 1.592-.01.898-.718 1.507-1.806 1.507-1.103 0-1.816-.609-1.806-1.507-.01-.932.755-1.592 1.806-1.592zm0-4.164c.908 0 1.53.561 1.54 1.398-.01.85-.651 1.43-1.54 1.43-.903 0-1.55-.584-1.54-1.43-.01-.837.618-1.398 1.54-1.398z",className:"lensChartIcon__accent"}),Object(y.jsx)("path",{d:"M1 18h28a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1z",className:"lensChartIcon__subdued"}));function W({table:e,state:t,keptLayerIds:a}){return e.isMultiRow||a.length>1||a.length&&e.layerId!==a[0]||1!==e.columns.length||e.columns[0].operation.isBucketed||!oe.has(e.columns[0].operation.dataType)||e.columns[0].operation.isStaticValue||t&&"unchanged"===e.changeType?[]:[U(e)]}function U(e){const t=e.columns[0];return{title:e.label||t.operation.label,score:.1,previewIcon:$,state:{layerId:e.layerId,accessor:t.columnId,layerType:D.o.DATA}}}const Y={...j.m,maxSteps:5,name:"status",rangeType:"number",steps:3};a(207);const X=Object(f.htmlIdGenerator)()();function K(e){var t;const{state:a,setState:n,frame:i,accessor:r}=e,[o,c]=Object(l.useState)(!1),d=Object(l.useCallback)((()=>{c(!o)}),[o]),m=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],[g]=(null==m?void 0:m.rows)||[];if(null==r||null==g||!Object(k.f)(m,r))return null;const b=(null==a?void 0:a.colorMode)||q.ColorMode.None,h=b!==q.ColorMode.None,x={min:Math.min(2*g[r],0===g[r]?-50:0),max:Math.max(2*g[r],0===g[r]?100:0)},v=(null==a?void 0:a.palette)||{type:"palette",name:Y.name,params:{...Y,stops:void 0,colorStops:void 0,rangeMin:x.min,rangeMax:3*x.max/4}},O=Object(j.l)(e.paletteService,v,x);return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.metric.dynamicColoring.label",{defaultMessage:"Color by value"})},Object(y.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.metric.dynamicColoring.label",{defaultMessage:"Color by value"}),"data-test-subj":"lnsMetric_dynamicColoring_groups",name:"dynamicColoring",buttonSize:"compressed",options:[{id:`${X}None`,label:u.i18n.translate("xpack.lens.metric.dynamicColoring.none",{defaultMessage:"None"}),"data-test-subj":"lnsMetric_dynamicColoring_groups_none"},{id:`${X}Background`,label:u.i18n.translate("xpack.lens.metric.dynamicColoring.background",{defaultMessage:"Fill"}),"data-test-subj":"lnsMetric_dynamicColoring_groups_background"},{id:`${X}Labels`,label:u.i18n.translate("xpack.lens.metric.dynamicColoring.text",{defaultMessage:"Text"}),"data-test-subj":"lnsMetric_dynamicColoring_groups_labels"}],idSelected:`${X}${b}`,onChange:e=>{const t=e.replace(X,""),i={colorMode:t};null!=a&&a.palette||t===q.ColorMode.None||(i.palette={...v,params:{...v.params,stops:O.map(((e,t,a)=>({...e,stop:x.min+(0===t?0:a[t-1].stop)})))}}),null!=a&&a.palette&&t===q.ColorMode.None&&(i.palette=void 0),n({...a,...i})}})),h&&Object(y.jsx)(f.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteMetricGradient.label",{defaultMessage:"Color"})},Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(f.EuiColorPaletteDisplay,{"data-test-subj":"lnsMetric_dynamicColoring_palette",palette:O.map((({color:e})=>e)),type:p.i,onClick:d})),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiButtonEmpty,{"data-test-subj":"lnsMetric_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:d,size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(y.jsx)(j.e,{siblingRef:e.panelRef,isOpen:o,handleClose:d},Object(y.jsx)(p.b,{palettes:e.paletteService,activePalette:v,dataBounds:x,setPalette:e=>{e.name!==p.a&&e.params&&e.params.rangeMin!==x.min&&(e.params.rangeMin=x.min),n({...a,palette:e})},showRangeTypeSelector:!1}))))))}const Z=[{id:"top",label:u.i18n.translate("xpack.lens.metricChart.titlePositions.top",{defaultMessage:"Top"})},{id:"bottom",label:u.i18n.translate("xpack.lens.metricChart.titlePositions.bottom",{defaultMessage:"Bottom"})}],Q=({state:e,setState:t})=>{var a;return Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:Object(y.jsx)(s.a.Fragment,null,u.i18n.translate("xpack.lens.metricChart.titlePositionLabel",{defaultMessage:"Title position"}))},Object(y.jsx)(f.EuiButtonGroup,{isFullWidth:!0,"data-test-subj":"lnsMissingValuesSelect",legend:"This is a basic group",options:Z,idSelected:null!==(a=e.titlePosition)&&void 0!==a?a:"top",onChange:a=>{t({...e,titlePosition:a})},buttonSize:"compressed"}))},J="m",ee=[{id:"xs",label:u.i18n.translate("xpack.lens.metricChart.metricSize.extraSmall",{defaultMessage:"XS"})},{id:"s",label:u.i18n.translate("xpack.lens.metricChart.metricSize.small",{defaultMessage:"S"})},{id:"m",label:u.i18n.translate("xpack.lens.metricChart.metricSize.medium",{defaultMessage:"M"})},{id:"l",label:u.i18n.translate("xpack.lens.metricChart.metricSize.large",{defaultMessage:"L"})},{id:"xl",label:u.i18n.translate("xpack.lens.metricChart.metricSize.extraLarge",{defaultMessage:"XL"})},{id:"xxl",label:u.i18n.translate("xpack.lens.metricChart.metricSize.xxl",{defaultMessage:"XXL"})}],te=({state:e,setState:t})=>{var a;const n=ee.findIndex((t=>t.id===(e.size||J))),i=a=>{t({...e,size:ee[n+a].id})};return Object(y.jsx)(f.EuiSuperSelect,{append:Object(y.jsx)(f.EuiButtonIcon,{iconType:"plus",onClick:()=>i(1),isDisabled:n===ee.length-1}),prepend:Object(y.jsx)(f.EuiButtonIcon,{iconType:"minus",onClick:()=>i(-1),isDisabled:0===n}),"data-test-subj":"lnsMetricSizeSelect",compressed:!0,options:ee.map((e=>({value:e.id,dropdownDisplay:e.label,inputDisplay:e.label}))),valueOfSelected:null!==(a=e.size)&&void 0!==a?a:J,onChange:a=>{t({...e,size:a})},itemLayoutAlign:"top",hasDividers:!0,fullWidth:!0})},ae="left",ne=[{id:"left",label:u.i18n.translate("xpack.lens.metricChart.alignLabel.left",{defaultMessage:"Align left"}),iconType:"editorAlignLeft"},{id:"center",label:u.i18n.translate("xpack.lens.metricChart.alignLabel.center",{defaultMessage:"Align center"}),iconType:"editorAlignCenter"},{id:"right",label:u.i18n.translate("xpack.lens.metricChart.alignLabel.right",{defaultMessage:"Align right"}),iconType:"editorAlignRight"}],ie=({state:e,setState:t})=>{var a;return Object(y.jsx)(f.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.metricChart.titleAlignLabel",{defaultMessage:"Align"}),options:ne,idSelected:null!==(a=e.textAlign)&&void 0!==a?a:ae,onChange:a=>{t({...e,textAlign:a})},isIconOnly:!0,buttonSize:"compressed"})},le=({state:e,setState:t})=>Object(y.jsx)(f.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:Object(y.jsx)(s.a.Fragment,null,u.i18n.translate("xpack.lens.metricChart.textFormattingLabel",{defaultMessage:"Text formatting"}))},Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"s",responsive:!1},Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(te,{state:e,setState:t})),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(ie,{state:e,setState:t})))),se=({state:e,setState:t})=>Object(y.jsx)(j.i,{tooltipContent:u.i18n.translate("xpack.lens.shared.AppearanceLabel",{defaultMessage:"Appearance"}),condition:!0},Object(y.jsx)(j.h,{title:u.i18n.translate("xpack.lens.shared.metric.appearanceLabel",{defaultMessage:"Appearance"}),type:"visualOptions",groupPosition:"none",buttonDataTestSubj:"lnsMetricAppearanceButton"},Object(y.jsx)(le,{state:e,setState:t}),Object(y.jsx)(Q,{state:e,setState:t}))),re=Object(l.memo)((function(e){const{state:t,setState:a,frame:n}=e;return Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"m",justifyContent:"spaceBetween",responsive:!1},Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"none",responsive:!1},Object(y.jsx)(se,{state:t,setState:a,datasourceLayers:n.datasourceLayers}))))})),oe=(Object(f.htmlIdGenerator)()(),new Set(["string","boolean","number","ip","date"])),ue=e=>{const[t,a]=e.split(/(\d+)/).filter(Boolean);return{size:Number(t),sizeUnit:a}},ce=(e,t,a,n,i={})=>{var l,s,r,o,u,c,d,m,g,f;if(!t.accessor)return null;const[b]=Object.values(a),h=i[t.layerId],x=b&&b.getOperationForColumnId(t.accessor),y=(null===(l=t.palette)||void 0===l||null===(s=l.params)||void 0===s?void 0:s.stops)||[],v=(null===(r=t.palette)||void 0===r||null===(o=r.params)||void 0===o?void 0:o.name)===p.a,j="number"===(null==x?void 0:x.dataType),O={...null===(u=t.palette)||void 0===u?void 0:u.params,colors:y.map((({color:e})=>e)),stops:v||null==(null===(c=t.palette)||void 0===c||null===(d=c.params)||void 0===d?void 0:d.rangeMax)?y.map((({stop:e})=>e)):Object(p.m)(y,Math.max(null===(m=t.palette)||void 0===m||null===(g=m.params)||void 0===g?void 0:g.rangeMax,...y.map((({stop:e})=>e)))).map((({stop:e})=>e)),reverse:!1},k={xs:ue(G.euiThemeVars.euiFontSizeXS),s:ue(G.euiThemeVars.euiFontSizeS),m:ue(G.euiThemeVars.euiFontSizeM),l:ue(G.euiThemeVars.euiFontSizeL),xl:ue(G.euiThemeVars.euiFontSizeXL),xxl:ue(G.euiThemeVars.euiFontSizeXXL)},I=k[(null==t?void 0:t.size)||J],T={xs:2*k.xs.size,s:2.5*k.m.size,m:2.5*k.l.size,l:2.5*k.xl.size,xl:2.5*k.xxl.size,xxl:3*k.xxl.size}[(null==t?void 0:t.size)||J];return{type:"expression",chain:[...null!==(f=null==h?void 0:h.chain)&&void 0!==f?f:[],{type:"function",function:"metricVis",arguments:{labelPosition:[(null==t?void 0:t.titlePosition)||"top"],font:[{type:"expression",chain:[{type:"function",function:"font",arguments:{align:[(null==t?void 0:t.textAlign)||ae],size:[T],weight:["600"],lHeight:[1.5*T],sizeUnit:[I.sizeUnit]}}]}],labelFont:[{type:"expression",chain:[{type:"function",function:"font",arguments:{align:[(null==t?void 0:t.textAlign)||ae],size:[I.size],lHeight:[1.5*I.size],sizeUnit:[I.sizeUnit]}}]}],metric:[{type:"expression",chain:[{type:"function",function:"visdimension",arguments:{accessor:[t.accessor]}}]}],showLabels:[!(null!=n&&n.mode)||"full"===(null==n?void 0:n.mode)],colorMode:j?[(null==t?void 0:t.colorMode)||q.ColorMode.None]:[q.ColorMode.None],autoScale:[!0],colorFullBackground:[!0],palette:null!=t&&t.colorMode&&(null==t?void 0:t.colorMode)!==q.ColorMode.None?[e.get(p.a).toExpression(O)]:[]}}]}},de=({paletteService:e,theme:t})=>({id:"lnsMetric",visualizationTypes:[{id:"lnsMetric",icon:$,label:u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"}),groupLabel:u.i18n.translate("xpack.lens.metric.groupLabel",{defaultMessage:"Goal and single value"}),sortPriority:3}],getVisualizationTypeId:()=>"lnsMetric",clearLayer:e=>({...e,accessor:void 0}),getLayerIds:e=>[e.layerId],getDescription:()=>({icon:$,label:u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"})}),getSuggestions:W,initialize:(e,t)=>t||{layerId:e(),accessor:void 0,layerType:D.o.DATA},triggers:[_.VIS_EVENT_TO_TRIGGER.filter],getConfiguration(e){var t,a;const n=null!=e.state.palette,i=(null===(t=e.state.palette)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.stops)||[];return{groups:[{groupId:"metric",groupLabel:u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"}),layerId:e.state.layerId,accessors:e.state.accessor?[{columnId:e.state.accessor,triggerIcon:n?"colorBy":void 0,palette:n?i.map((({color:e})=>e)):void 0}]:[],supportsMoreColumns:!e.state.accessor,filterOperations:e=>!e.isBucketed&&oe.has(e.dataType),enableDimensionEditor:!0,required:!0}]}},getSupportedLayers:()=>[{type:D.o.DATA,label:u.i18n.translate("xpack.lens.metric.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression:(t,a,n,i)=>ce(e,t,a,{...n},i),toPreviewExpression:(t,a,n)=>ce(e,t,a,{mode:"reduced"},n),setDimension:({prevState:e,columnId:t})=>({...e,accessor:t}),removeDimension:({prevState:e})=>({...e,accessor:void 0,colorMode:q.ColorMode.None,palette:void 0}),renderToolbar(e,a){Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(re,{state:a.state,setState:a.setState,frame:a.frame}))),e)},renderDimensionEditor(a,n){Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(K,i()({},n,{paletteService:e})))),a)},getErrorMessages(e){}});class MetricVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getMetricVisualization:t}=await Promise.resolve().then(a.bind(null,463));return t({paletteService:await n.palettes.getPalettes(),theme:e.theme})}))}}var pe=a(36),me=a(35);const ge=u.i18n.translate("xpack.lens.pie.groupLabel",{defaultMessage:"Proportion"}),fe=[{value:D.c.DEFAULT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showCategoriesLabel",{defaultMessage:"Inside or outside"})},{value:D.c.INSIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.fitInsideOnlyLabel",{defaultMessage:"Inside only"})},{value:D.c.HIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.categoriesInLegendLabel",{defaultMessage:"Hide labels"})}],be=[{value:D.c.DEFAULT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showTreemapCategoriesLabel",{defaultMessage:"Show labels"})},{value:D.c.HIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.categoriesInLegendLabel",{defaultMessage:"Hide labels"})}],he=[{value:D.j.HIDDEN,inputDisplay:u.i18n.translate("xpack.lens.pieChart.hiddenNumbersLabel",{defaultMessage:"Hide from chart"})},{value:D.j.PERCENT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showPercentValuesLabel",{defaultMessage:"Show percent"})},{value:D.j.VALUE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showFormatterValuesLabel",{defaultMessage:"Show value"})}],xe=[{id:"emptySizeRatioOption-small",value:D.f.SMALL,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.small",{defaultMessage:"Small"})},{id:"emptySizeRatioOption-medium",value:D.f.MEDIUM,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.medium",{defaultMessage:"Medium"})},{id:"emptySizeRatioOption-large",value:D.f.LARGE,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.large",{defaultMessage:"Large"})}],ye={donut:{icon:({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t},e):null,Object(y.jsx)("path",{d:"M19.21 21.119a11 11 0 006.595-8.1c.11-.577-.355-1.082-.942-1.082H20.75c-.477 0-.878.342-1.046.788a5.028 5.028 0 11-6.474-6.474c.447-.168.788-.569.788-1.046V1.094c0-.588-.505-1.053-1.082-.943a11 11 0 106.272 20.968h.002z",className:"lensChartIcon__subdued"}),Object(y.jsx)("path",{d:"M22.778 3.176A11 11 0 0017.084.154C16.507.042 16 .507 16 1.095v4.116c0 .475.34.875.784 1.044l.14.055A5.026 5.026 0 0119.7 9.17c.168.445.568.784 1.044.784h4.115c.588 0 1.053-.506.942-1.084a11 11 0 00-3.023-5.694z",className:"lensChartIcon__accent"})),label:u.i18n.translate("xpack.lens.pie.donutLabel",{defaultMessage:"Donut"}),groupLabel:ge,maxBuckets:3,toolbarPopover:{categoryOptions:fe,numberOptions:he,emptySizeRatioOptions:xe},legend:{getShowLegendDefault:e=>e.length>1}},pie:{icon:({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t},e):null,Object(y.jsx)("path",{d:"M17.827 21.189a10.001 10.001 0 005.952-7.148c.124-.578-.343-1.091-.935-1.091H14a1 1 0 01-1-1V3.106c0-.592-.513-1.059-1.092-.935a10 10 0 105.919 19.018z",className:"lensChartIcon__subdued"}),Object(y.jsx)("path",{d:"M22.462 3.538A12.29 12.29 0 0016.094.16C15.512.048 15 .514 15 1.106V10a1 1 0 001 1h8.895c.591 0 1.057-.512.945-1.094a12.288 12.288 0 00-3.378-6.368z",className:"lensChartIcon__accent"})),label:u.i18n.translate("xpack.lens.pie.pielabel",{defaultMessage:"Pie"}),groupLabel:ge,maxBuckets:3,toolbarPopover:{categoryOptions:fe,numberOptions:he},legend:{getShowLegendDefault:e=>e.length>1}},treemap:{icon:({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t},e):null,Object(y.jsx)("path",{d:"M0 1a1 1 0 011-1h13a1 1 0 011 1v20a1 1 0 01-1 1H1a1 1 0 01-1-1V1z",className:"lensChartIcon__subdued"}),Object(y.jsx)("path",{d:"M17 1a1 1 0 011-1h11a1 1 0 011 1v12a1 1 0 01-1 1H18a1 1 0 01-1-1V1z",className:"lensChartIcon__accent"}),Object(y.jsx)("path",{d:"M29 16H18a1 1 0 00-1 1v4a1 1 0 001 1h11a1 1 0 001-1v-4a1 1 0 00-1-1z",className:"lensChartIcon__subdued"})),label:u.i18n.translate("xpack.lens.pie.treemaplabel",{defaultMessage:"Treemap"}),groupLabel:ge,maxBuckets:2,toolbarPopover:{categoryOptions:be,numberOptions:he},legend:{getShowLegendDefault:()=>!1}},mosaic:{icon:({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t}):null,Object(y.jsx)("path",{className:"lensChartIcon__subdued",d:"M2 0a1 1 0 00-1 1v2a1 1 0 001 1h6a1 1 0 001-1V1a1 1 0 00-1-1H2zM2 14a1 1 0 00-1 1v6a1 1 0 001 1h6a1 1 0 001-1v-6a1 1 0 00-1-1H2zM11 13a1 1 0 011-1h6a1 1 0 011 1v8a1 1 0 01-1 1h-6a1 1 0 01-1-1v-8zM12 0a1 1 0 100 2h6a1 1 0 100-2h-6zM21 15a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1h-6a1 1 0 01-1-1v-6zM22 0a1 1 0 00-1 1v4a1 1 0 001 1h6a1 1 0 001-1V1a1 1 0 00-1-1h-6z"}),Object(y.jsx)("path",{className:"lensChartIcon__accent",d:"M11 5a1 1 0 011-1h6a1 1 0 011 1v4a1 1 0 01-1 1h-6a1 1 0 01-1-1V5zM1 7a1 1 0 011-1h6a1 1 0 011 1v4a1 1 0 01-1 1H2a1 1 0 01-1-1V7zM22 8a1 1 0 00-1 1v2a1 1 0 001 1h6a1 1 0 001-1V9a1 1 0 00-1-1h-6z"})),label:u.i18n.translate("xpack.lens.pie.mosaiclabel",{defaultMessage:"Mosaic"}),groupLabel:ge,maxBuckets:2,isExperimental:!0,toolbarPopover:{categoryOptions:[],numberOptions:he},legend:{getShowLegendDefault:()=>!1},requiredMinDimensionCount:2},waffle:{icon:({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t}):null,Object(y.jsx)("path",{className:"lensChartIcon__accent",d:"M16 1a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V1zM4 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1v-2zM17 6a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V7a1 1 0 00-1-1h-2zM23 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1h-2zM5 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1H5zM4 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V7zM11 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1h-2zM10 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V7zM11 12a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM22 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V7z"}),Object(y.jsx)("path",{className:"lensChartIcon__subdued",d:"M22 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2zM4 19a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1v-2zM16 19a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2zM11 18a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM23 18a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM16 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2z"})),label:u.i18n.translate("xpack.lens.pie.wafflelabel",{defaultMessage:"Waffle"}),groupLabel:ge,maxBuckets:1,isExperimental:!0,toolbarPopover:{isDisabled:!0,categoryOptions:[],numberOptions:[]},legend:{flat:!0,showValues:!0,hideNestedLegendSwitch:!0,getShowLegendDefault:()=>!0}}},ve=(e,t)=>{var a,n,i,l,s;return"showValues"in(null===(a=ye[t])||void 0===a?void 0:a.legend)&&(null===(n=null!==(i=e.showValuesInLegend)&&void 0!==i?i:null===(l=ye[t])||void 0===l||null===(s=l.legend)||void 0===s?void 0:s.showValues)||void 0===n||n)},je=(e,t,a)=>{const n=e.rows.reduce(((e,a)=>Number(a[t])+e),0);return e.rows.some((e=>e[t]/n*100<a))};function Oe(e,t,a){return 0===a?{...e,...t}:{...t,...e}}function ke(e,t){const a={truncateText:!0};return e?function(e){return"layerId"in e}(e)?Object.values((null===(n=t[e.layerId])||void 0===n?void 0:n.getVisualDefaults())||{}).reduce(Oe,a):e.layers.flatMap((({layerId:e})=>{var a;return Object.values((null===(a=t[e])||void 0===a?void 0:a.getVisualDefaults())||{})})).reduce(Oe,a):a;var n}const Ie=(e,t)=>{const a=e.getTableSpec().map((({columnId:e})=>e)).filter((e=>t.groups.includes(e)));return Array.from(new Set(a.concat(t.groups)))},Te=e=>{const t=Object(me.buildExpressionFunction)("visdimension",{accessor:e});return Object(me.buildExpression)([t]).toAst()},Me=(e,t,a)=>{var n;return[{type:"expression",chain:[{type:"function",function:"partitionLabels",arguments:{show:[!t.isPreview&&a.categoryDisplay!==D.c.HIDE],position:a.categoryDisplay!==D.c.HIDE?[a.categoryDisplay]:[],values:[a.numberDisplay!==D.j.HIDDEN],valuesFormat:a.numberDisplay!==D.j.HIDDEN?[a.numberDisplay]:[],percentDecimals:[null!==(n=a.percentDecimals)&&void 0!==n?n:2]}}]}]},Fe=(...e)=>{const[t]=Me(...e),[a]=t.chain;return[{...t,chain:[{...a,percentDecimals:2}]}]},we=(e,t)=>t?[{type:"expression",chain:[{type:"function",function:"theme",arguments:{variable:["palette"],default:[e.get(t.name).toExpression(t.params)]}}]}]:[e.get("default").toExpression()],Ce=(e,t,a,n,i,l)=>{var s,r;return{labels:Me(0,t,n),buckets:a.map((e=>e.columnId)).map(Te),metric:n.metric?[Te(n.metric)]:[],legendDisplay:[t.isPreview?D.i.HIDE:n.legendDisplay],legendPosition:[n.legendPosition||pe.Position.Right],maxLegendLines:[null!==(s=n.legendMaxLines)&&void 0!==s?s:1],legendSize:n.legendSize?[n.legendSize]:[],nestedLegend:[!!n.nestedLegend],truncateLegend:[null!==(r=n.truncateLegend)&&void 0!==r?r:ke(e,i).truncateText],palette:we(l,e.palette)}};function _e(e,t,a,n={isPreview:!1},i){const l=e.layers[0],s=t[l.layerId],r=Ie(s,l).map((e=>({columnId:e,operation:s.getOperationForColumnId(e)}))).filter((e=>!!e.operation));if(!l.metric||!r.length)return null;const o=((e,...t)=>({[D.l.PIE]:()=>((...e)=>({type:"expression",chain:[{type:"function",function:"pieVis",arguments:{...Ce(...e),respectSourceOrder:[!1],startFromSecondLargestSlice:[!0]}}]}))(e,...t),[D.l.DONUT]:()=>((...e)=>{var t;const[,,,a]=e;return{type:"expression",chain:[{type:"function",function:"pieVis",arguments:{...Ce(...e),respectSourceOrder:[!1],isDonut:[!0],startFromSecondLargestSlice:[!0],emptySizeRatio:[null!==(t=a.emptySizeRatio)&&void 0!==t?t:D.f.SMALL]}}]}})(e,...t),[D.l.TREEMAP]:()=>((...e)=>{const[,,,t]=e;return{type:"expression",chain:[{type:"function",function:"treemapVis",arguments:{...Ce(...e),nestedLegend:[!!t.nestedLegend]}}]}})(e,...t),[D.l.MOSAIC]:()=>((...e)=>({type:"expression",chain:[{type:"function",function:"mosaicVis",arguments:{...Ce(...e),buckets:e[2].reverse().map((e=>e.columnId)).map(Te)}}]}))(e,...t),[D.l.WAFFLE]:()=>((...e)=>{const{buckets:t,nestedLegend:a,...n}=Ce(...e),[i,l,,s]=e;return{type:"expression",chain:[{type:"function",function:"waffleVis",arguments:{...n,bucket:t,labels:Fe(i,l,s),showValuesInLegend:[ve(s,i.shape)]}}]}})(e,...t)}[e.shape]()))(e,n,r,l,t,a),u=i[l.layerId];return{type:"expression",chain:[...u?u.chain:[],...o?o.chain:[]]}}var Se=a(31);function Ee(e){return e.some((e=>"interval"===e.operation.scale))}function Pe(e){const t=[D.l.TREEMAP,D.l.WAFFLE,D.l.MOSAIC];return!!e&&t.includes(e)}const Ae=Math.max(...Object.values(ye).map((({maxBuckets:e})=>e)));function Le({table:e,state:t,keptLayerIds:a,mainPalette:n,subVisualizationId:i}){if(function({table:e,keptLayerIds:t,state:a}){const n=(null==a||!a.shape||(i=a.shape,!["donut","pie","treemap","mosaic","waffle"].includes(i)))&&Ee(e.columns);var i;return t.length>1||t.length&&e.layerId!==t[0]||"reorder"===e.changeType||n||e.columns.some((e=>e.operation.isStaticValue))}({table:e,state:t,keptLayerIds:a}))return[];const[l,s]=Object(Se.partition)(e.columns.filter((e=>e.operation.isBucketed||"number"===e.operation.dataType)),(e=>e.operation.isBucketed));if(0===l.length&&0===s.length)return[];if(s.length>1||l.length>Ae)return[];const r=0===s.length||0===l.length,o=s.length>0?s[0].columnId:void 0;if(r&&t&&!i)return[];const c=[];if(l.length<=ye.pie.maxBuckets&&!Pe(i)){const a=function(e,t){var a;if(t)return t;let n;return 1===e.length||t||(n=D.l.PIE),null!==(a=n)&&void 0!==a?a:D.l.DONUT}(l,i),s={title:u.i18n.translate("xpack.lens.pie.suggestionLabel",{defaultMessage:"As {chartName}",values:{chartName:ye[a].label},description:"chartName is already translated"}),score:t&&!Pe(t.shape)?.6:.4,state:{shape:a,palette:n||(null==t?void 0:t.palette),layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,layerType:D.o.DATA}:{layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,numberDisplay:D.j.PERCENT,categoryDisplay:D.c.DEFAULT,legendDisplay:D.i.DEFAULT,nestedLegend:!1,layerType:D.o.DATA}]},previewIcon:"bullseye",hide:"reduced"===e.changeType||Ee(l)||t&&!Pe(t.shape)};c.push(s),c.push({...s,title:u.i18n.translate("xpack.lens.pie.suggestionLabel",{defaultMessage:"As {chartName}",values:{chartName:ye[a===D.l.PIE?D.l.DONUT:D.l.PIE].label},description:"chartName is already translated"}),score:.1,state:{...s.state,shape:a===D.l.PIE?D.l.DONUT:D.l.PIE},hide:!0})}return l.length<=ye.treemap.maxBuckets&&(!i||"treemap"===i)&&c.push({title:u.i18n.translate("xpack.lens.pie.treemapSuggestionLabel",{defaultMessage:"As Treemap"}),score:(null==t?void 0:t.shape)===D.l.TREEMAP?.7:.5,state:{shape:D.l.TREEMAP,palette:n||(null==t?void 0:t.palette),layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,categoryDisplay:t.layers[0].categoryDisplay===D.c.INSIDE?D.c.DEFAULT:t.layers[0].categoryDisplay,layerType:D.o.DATA}:{layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,numberDisplay:D.j.PERCENT,categoryDisplay:D.c.DEFAULT,legendDisplay:D.i.DEFAULT,nestedLegend:!1,layerType:D.o.DATA}]},previewIcon:"bullseye",hide:"reduced"===e.changeType||!t||Ee(l)||t&&t.shape===D.l.TREEMAP}),l.length<=ye.mosaic.maxBuckets&&(!i||i===D.l.MOSAIC)&&c.push({title:u.i18n.translate("xpack.lens.pie.mosaicSuggestionLabel",{defaultMessage:"As Mosaic"}),score:(null==t?void 0:t.shape)===D.l.MOSAIC?.7:.5,state:{shape:D.l.MOSAIC,palette:n||(null==t?void 0:t.palette),layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,categoryDisplay:D.c.DEFAULT,layerType:D.o.DATA}:{layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,numberDisplay:D.j.PERCENT,categoryDisplay:D.c.DEFAULT,legendDisplay:D.i.DEFAULT,nestedLegend:!1,layerType:D.o.DATA}]},previewIcon:"bullseye",hide:!0}),l.length<=ye.waffle.maxBuckets&&(!i||i===D.l.WAFFLE)&&c.push({title:u.i18n.translate("xpack.lens.pie.waffleSuggestionLabel",{defaultMessage:"As Waffle"}),score:(null==t?void 0:t.shape)===D.l.WAFFLE?.7:.5,state:{shape:D.l.WAFFLE,palette:n||(null==t?void 0:t.palette),layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,categoryDisplay:D.c.DEFAULT,layerType:D.o.DATA}:{layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,numberDisplay:D.j.PERCENT,categoryDisplay:D.c.DEFAULT,legendDisplay:D.i.DEFAULT,nestedLegend:!1,layerType:D.o.DATA}]},previewIcon:"bullseye",hide:!0}),[...c].map((e=>({...e,score:e.score+.05*l.length}))).sort(((e,t)=>t.score-e.score)).map((e=>({...e,hide:r||e.hide})))}a(212);const De=[{id:"pieLegendDisplay-default",value:D.i.DEFAULT,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.auto",{defaultMessage:"Auto"})},{id:"pieLegendDisplay-show",value:D.i.SHOW,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"pieLegendDisplay-hide",value:D.i.HIDE,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.hide",{defaultMessage:"Hide"})}],Ne=u.i18n.translate("xpack.lens.pieChart.emptySizeRatioLabel",{defaultMessage:"Inner area size"});function ze(e){var t,a,n,i,s,r,o;const{state:c,setState:d,frame:p}=e,m=c.layers[0],{categoryOptions:g,numberOptions:b,emptySizeRatioOptions:h,isDisabled:x}=ye[c.shape].toolbarPopover,v=m.legendSize,[O]=Object(l.useState)((()=>v===_.LegendSize.AUTO)),k=Object(l.useCallback)((e=>{d({...c,layers:[{...m,...e}]})}),[m,c,d]),I=Object(l.useCallback)((e=>k({categoryDisplay:e})),[k]),T=Object(l.useCallback)((e=>k({numberDisplay:e})),[k]),M=Object(l.useCallback)((e=>{k({percentDecimals:e})}),[k]),F=Object(l.useCallback)((e=>{k({legendDisplay:De.find((({id:t})=>t===e)).value})}),[k]),w=Object(l.useCallback)((e=>k({legendPosition:e})),[k]),C=Object(l.useCallback)((e=>k({nestedLegend:!m.nestedLegend})),[m,k]),S=Object(l.useCallback)((()=>{var e;const t=null===(e=m.truncateLegend)||void 0===e||e;k({truncateLegend:!t})}),[m,k]),E=Object(l.useCallback)((e=>k({legendMaxLines:e})),[k]),P=Object(l.useCallback)((e=>k({legendSize:e})),[k]),A=Object(l.useCallback)((()=>{k({showValuesInLegend:!ve(m,c.shape)})}),[m,c.shape,k]),L=Object(l.useCallback)((e=>{var t;const a=null==h||null===(t=h.find((({id:t})=>t===e)))||void 0===t?void 0:t.value;k({emptySizeRatio:a})}),[h,k]);if(!m)return null;const D=ke(c,p.datasourceLayers).truncateText;return Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(y.jsx)(j.h,{title:u.i18n.translate("xpack.lens.pieChart.valuesLabel",{defaultMessage:"Labels"}),isDisabled:Boolean(x),type:"labels",groupPosition:"left",buttonDataTestSubj:"lnsLabelsButton"},g.length?Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.labelPositionLabel",{defaultMessage:"Position"}),fullWidth:!0,display:"columnCompressed"},Object(y.jsx)(f.EuiSuperSelect,{compressed:!0,valueOfSelected:m.categoryDisplay,options:g,onChange:I})):null,b.length&&"hide"!==m.categoryDisplay?Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.numberLabels",{defaultMessage:"Values"}),fullWidth:!0,display:"columnCompressed"},Object(y.jsx)(f.EuiSuperSelect,{compressed:!0,valueOfSelected:m.numberDisplay,options:b,onChange:T})):null,b.length+g.length?Object(y.jsx)(f.EuiHorizontalRule,{margin:"s"}):null,Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.percentDecimalsLabel",{defaultMessage:"Maximum decimal places for percent"}),fullWidth:!0,display:"rowCompressed"},Object(y.jsx)(Be,{value:null!==(t=m.percentDecimals)&&void 0!==t?t:2,setValue:M}))),null!=h&&h.length?Object(y.jsx)(j.h,{title:u.i18n.translate("xpack.lens.pieChart.visualOptionsLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"center",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(y.jsx)(f.EuiFormRow,{label:Ne,display:"columnCompressed",fullWidth:!0},Object(y.jsx)(f.EuiButtonGroup,{isFullWidth:!0,name:"emptySizeRatio",buttonSize:"compressed",legend:Ne,options:h,idSelected:null!==(a=null===(n=h.find((({value:e})=>e===m.emptySizeRatio)))||void 0===n?void 0:n.id)&&void 0!==a?a:"emptySizeRatioOption-small",onChange:L,"data-test-subj":"lnsEmptySizeRatioButtonGroup"}))):null,Object(y.jsx)(j.c,{legendOptions:De,mode:m.legendDisplay,onDisplayChange:F,valueInLegend:ve(m,c.shape),renderValueInLegendSwitch:null!==(i="showValues"in(null===(s=ye[c.shape])||void 0===s?void 0:s.legend))&&void 0!==i&&i,onValueInLegendChange:A,position:m.legendPosition,onPositionChange:w,renderNestedLegendSwitch:!(null!==(r=ye[c.shape])&&void 0!==r&&r.legend.hideNestedLegendSwitch),nestedLegend:Boolean(m.nestedLegend),onNestedLegendChange:C,shouldTruncate:null!==(o=m.truncateLegend)&&void 0!==o?o:D,onTruncateLegendChange:S,maxLines:null==m?void 0:m.legendMaxLines,onMaxLinesChange:E,legendSize:v,onLegendSizeChange:P,showAutoLegendSizeOption:O}))}const Be=({value:e,setValue:t})=>{const{inputValue:a,handleInputChange:n}=Object(j.p)({value:e,onChange:t},{allowFalsyValue:!0});return Object(y.jsx)(f.EuiRange,{"data-test-subj":"indexPattern-dimension-formatDecimals",value:a,min:0,max:10,showInput:!0,compressed:!0,onChange:e=>{n(Number(e.currentTarget.value))}})};function Ve(e){return Object(y.jsx)(j.f,{palettes:e.paletteService,activePalette:e.state.palette,setPalette:t=>{e.setState({...e.state,palette:t})}})}function Re(e){return{layerId:e,groups:[],metric:void 0,numberDisplay:D.j.PERCENT,categoryDisplay:D.c.DEFAULT,legendDisplay:D.i.DEFAULT,nestedLegend:!1,layerType:D.o.DATA}}const He=e=>e.isBucketed,Ge=e=>!e.isBucketed&&"number"===e.dataType&&!e.isStaticValue,qe=({paletteService:e,kibanaTheme:t})=>({id:"lnsPie",visualizationTypes:Object.entries(ye).map((([e,t])=>({id:e,icon:t.icon,label:t.label,groupLabel:t.groupLabel,showExperimentalBadge:t.isExperimental}))),getVisualizationTypeId:e=>e.shape,getLayerIds:e=>e.layers.map((e=>e.layerId)),clearLayer:e=>({shape:e.shape,layers:e.layers.map((e=>Re(e.layerId)))}),getDescription(e){var t;return null!==(t=ye[e.shape])&&void 0!==t?t:ye.pie},switchVisualizationType:(e,t)=>({...t,shape:e}),triggers:[_.VIS_EVENT_TO_TRIGGER.filter],initialize:(e,t,a)=>t||{shape:D.l.DONUT,layers:[Re(e())],palette:a},getMainPalette:e=>e?e.palette:void 0,getSuggestions:Le,getConfiguration({state:t,frame:a,layerId:n}){const i=t.layers.find((e=>e.layerId===n));if(!i)return{groups:[]};const l=a.datasourceLayers[i.layerId],s=Ie(l,i).map((e=>({columnId:e})));return s.length&&((e,{shape:t,palette:a},n)=>{const i="mosaic"===t?e.length-1:0;i>=0&&(e[i]={columnId:e[i].columnId,triggerIcon:"colorBy",palette:n.get((null==a?void 0:a.name)||"default").getCategoricalColors(10,null==a?void 0:a.params)})})(s,t,e),{groups:[(()=>{const e={required:!0,groupId:"groups",accessors:s,enableDimensionEditor:!0,filterOperations:He};switch(t.shape){case"donut":case"pie":return{...e,groupLabel:u.i18n.translate("xpack.lens.pie.sliceGroupLabel",{defaultMessage:"Slice by"}),supportsMoreColumns:s.length<ye.pie.maxBuckets,dataTestSubj:"lnsPie_sliceByDimensionPanel"};default:return{...e,groupLabel:u.i18n.translate("xpack.lens.pie.treemapGroupLabel",{defaultMessage:"Group by"}),supportsMoreColumns:s.length<ye[t.shape].maxBuckets,dataTestSubj:"lnsPie_groupByDimensionPanel",requiredMinDimensionCount:ye[t.shape].requiredMinDimensionCount}}})(),{groupId:"metric",groupLabel:u.i18n.translate("xpack.lens.pie.groupsizeLabel",{defaultMessage:"Size by"}),accessors:i.metric?[{columnId:i.metric}]:[],supportsMoreColumns:!i.metric,filterOperations:Ge,required:!0,dataTestSubj:"lnsPie_sizeByDimensionPanel"}]}},setDimension:({prevState:e,layerId:t,columnId:a,groupId:n})=>({...e,layers:e.layers.map((e=>e.layerId!==t?e:"groups"===n?{...e,groups:[...e.groups.filter((e=>e!==a)),a]}:{...e,metric:a}))}),removeDimension:({prevState:e,layerId:t,columnId:a})=>({...e,layers:e.layers.map((e=>e.layerId!==t?e:e.metric===a?{...e,metric:void 0}:{...e,groups:e.groups.filter((e=>e!==a))}))}),renderDimensionEditor(a,n){Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(Ve,i()({},n,{paletteService:e})))),a)},getSupportedLayers:()=>[{type:D.o.DATA,label:u.i18n.translate("xpack.lens.pie.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){var a;return null==t||null===(a=t.layers.find((({layerId:t})=>t===e)))||void 0===a?void 0:a.layerType},toExpression:(t,a,n,i)=>function(e,t,a,n={},i={}){return _e(e,t,a,{...n,isPreview:!1},i)}(t,a,e,n,i),toPreviewExpression:(t,a,n)=>function(e,t,a,n={}){return _e(e,t,a,{isPreview:!0},n)}(t,a,e,n),renderToolbar(e,a){Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(ze,a))),e)},getWarningMessages(e,t){if(0===(null==e?void 0:e.layers.length)||!t.activeData)return;const a=[];for(const s of e.layers){var n,i,l;const{layerId:r,metric:o}=s,u=null===(n=t.activeData[r])||void 0===n?void 0:n.rows,d=null===(i=t.activeData[r])||void 0===i?void 0:i.columns.find((({meta:e})=>"number"===(null==e?void 0:e.type)));if(!u||!o)break;d&&"waffle"===e.shape&&s.groups.length&&je(t.activeData[r],d.id,1)&&a.push(Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.pie.smallValuesWarningMessage",defaultMessage:"Waffle charts are unable to effectively display small field values. To display all field values, use the Data table or Treemap."}));const p=null===(l=t.datasourceLayers[r].getOperationForColumnId(o))||void 0===l?void 0:l.label;u.some((e=>Array.isArray(e[o])))&&a.push(Object(y.jsx)(c.FormattedMessage,{key:p||o,id:"xpack.lens.pie.arrayValues",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(y.jsx)("strong",null,p||o)}}))}return a},getErrorMessages(e){}});class PieVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getPieVisualization:t}=await Promise.resolve().then(a.bind(null,463));return t({paletteService:await n.palettes.getPalettes(),kibanaTheme:e.theme})}))}}var $e=a(80),We=a(28),Ue=a(92);const Ye=({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t},e):null,Object(y.jsx)("path",{d:"M24 16l.186-.002.345-.02.266-.03.334-.058.193-.043.25-.067.223-.07.215-.074.209-.079.305-.124c.166-.07.34-.148.524-.234l.285-.135 1.202-.588c.428-.203.728-.326.966-.396.146-.044.27-.067.384-.076L30 14v7a1 1 0 01-1 1H1a1 1 0 01-1-1v-2c1 0 3.5-4 6-4s5 3 6 3 3.23-7.994 5.865-7.997L19.032 10l.541 1.205.272.595.29.612c.517 1.069.955 1.842 1.391 2.391.08.1.16.194.241.28.095.101.189.191.283.272l.143.114c.218.164.446.284.69.368.207.071.426.116.662.14l.14.012.154.008L24 16zm6-12v6l-.186.002-.345.02-.266.03-.331.057-.196.044-.25.067-.304.097-.134.047a9.492 9.492 0 00-.386.15l-.128.053c-.166.07-.34.148-.524.234l-.285.135-1.264.618-.352.159-.187.078-.256.095-.178.054a13.872 13.872 0 01-.38-.687l-.16-.311-.233-.47-.016-.472H24c1 0 3-6 6-6z",className:"lensChartIcon__accent"}),Object(y.jsx)("path",{d:"M30 13c-.507 0-.988.146-1.89.571l-1.209.592C25.621 14.78 24.924 15 24 15c-1.384 0-2.003-.865-3.516-4.206l-.637-1.42-.346-.749-.213-.445C18.572 6.698 18.127 6 18 6c-.466 0-.967.252-1.99.997l-.891.659-.458.325C13.576 8.728 12.907 9 12 9c-1.269 0-1.966-.69-3.492-2.939l-.774-1.146-.272-.387-.26-.358C6.581 3.342 6.213 3 6 3c-.294 0-.885.651-2.017 2.33l-.491.731-.326.475C1.859 8.409 1.175 9 0 9V7c.294 0 .885-.651 2.017-2.33l.491-.731.326-.475C4.141 1.591 4.825 1 6 1c1.269 0 1.966.69 3.492 2.939l.774 1.146.272.387.26.358C11.419 6.658 11.788 7 12 7c.466 0 .967-.252 1.99-.997l.891-.659.458-.325C16.424 4.272 17.093 4 18 4c1.384 0 2.003.865 3.516 4.206l.637 1.42.346.749.213.445C23.428 12.302 23.873 13 24 13c.507 0 .988-.146 1.89-.571l1.209-.592C28.379 11.22 29.076 11 30 11v2z",className:"lensChartIcon__subdued"}),Object(y.jsx)("path",{d:"M6 13v7.889C6 21.503 5.552 22 5 22H1c-.552 0-1-.497-1-1.111V13a1 1 0 011-1h4a1 1 0 011 1zm8-1v9a1 1 0 01-1 1H9a1 1 0 01-1-1v-9a1 1 0 011-1h4a1 1 0 011 1zm8 5v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4a1 1 0 011-1h4a1 1 0 011 1zm8 2v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2a1 1 0 011-1h4a1 1 0 011 1z",className:"lensChartIcon__subdued"}));var Xe=a(91);function Ke(e,{isHorizontal:t}){const a=u.i18n.translate("xpack.lens.xyChart.verticalAxisLabel",{defaultMessage:"Vertical axis"}),n=u.i18n.translate("xpack.lens.xyChart.horizontalAxisLabel",{defaultMessage:"Horizontal axis"});if("x"===e)return t?a:n;if("y"===e)return t?n:a;const i=u.i18n.translate("xpack.lens.xyChart.verticalLeftAxisLabel",{defaultMessage:"Vertical left axis"}),l=u.i18n.translate("xpack.lens.xyChart.verticalRightAxisLabel",{defaultMessage:"Vertical right axis"}),s=u.i18n.translate("xpack.lens.xyChart.horizontalLeftAxisLabel",{defaultMessage:"Horizontal top axis"}),r=u.i18n.translate("xpack.lens.xyChart.horizontalRightAxisLabel",{defaultMessage:"Horizontal bottom axis"});return"yLeft"===e?t?r:i:t?s:l}function Ze(e,t,a){return n=>{const i=a[n.layerId];if(!n.xAccessor)return!1;const l=null==i?void 0:i.getOperationForColumnId(n.xAccessor);return Boolean(l&&(!t||l.dataType===t)&&l.scale===e)}}const Qe=e=>e.layerType===We.layerTypes.DATA||!e.layerType,Je=e=>(e||[]).filter((e=>Qe(e))),et=e=>e.layerType===We.layerTypes.REFERENCELINE,tt=e=>(e||[]).filter((e=>et(e))),at=e=>e.layerType===We.layerTypes.ANNOTATIONS,nt=e=>(e||[]).filter((e=>at(e)));function it(e){var t;if(!e.layers.length)return null!==(t=$e.visualizationTypes.find((t=>t.id===e.preferredSeriesType)))&&void 0!==t?t:$e.visualizationTypes[0];const a=Je(null==e?void 0:e.layers),n=$e.visualizationTypes.find((e=>e.id===(null==a?void 0:a[0].seriesType))),i=Object(Se.uniq)(a.map((e=>e.seriesType)));return n&&1===i.length?n:"mixed"}function lt(e){if(!e)return{icon:st,label:u.i18n.translate("xpack.lens.xyVisualization.xyLabel",{defaultMessage:"XY"})};const t=it(e);return"mixed"===t&&xt(e.layers)?{icon:Ue.a,label:u.i18n.translate("xpack.lens.xyVisualization.mixedBarHorizontalLabel",{defaultMessage:"Mixed bar horizontal"})}:"mixed"===t?{icon:Ye,label:u.i18n.translate("xpack.lens.xyVisualization.mixedLabel",{defaultMessage:"Mixed XY"})}:{icon:t.icon||st,label:t.fullLabel||t.label}}const st=Xe.a,rt="bar_stacked",ot={type:We.layerTypes.DATA,label:u.i18n.translate("xpack.lens.xyChart.addDataLayerLabel",{defaultMessage:"Visualization"}),icon:Ye};function ut(e,t,a){const n=t.map((e=>e+1)).join(", ");switch(e){case"Break down":return{shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureSplitShort",{defaultMessage:"Missing {axis}.",values:{axis:"Break down by axis"}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureSplitLong",{defaultMessage:"{layers, plural, one {Layer} other {Layers}} {layersList} {layers, plural, one {requires} other {require}} a field for the {axis}.",values:{layers:t.length,layersList:n,axis:"Break down by axis"}})};case"Y":return{shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureYShort",{defaultMessage:"Missing {axis}.",values:{axis:Ke("y",{isHorizontal:a})}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureYLong",{defaultMessage:"{layers, plural, one {Layer} other {Layers}} {layersList} {layers, plural, one {requires} other {require}} a field for the {axis}.",values:{layers:t.length,layersList:n,axis:Ke("y",{isHorizontal:a})}})}}return{shortMessage:"",longMessage:""}}const ct={[We.layerTypes.DATA]:({layerId:e,seriesType:t})=>({layerId:e,layerType:We.layerTypes.DATA,accessors:[],seriesType:t}),[We.layerTypes.REFERENCELINE]:({layerId:e})=>({layerId:e,layerType:We.layerTypes.REFERENCELINE,accessors:[]}),[We.layerTypes.ANNOTATIONS]:({layerId:e})=>({layerId:e,layerType:We.layerTypes.ANNOTATIONS,annotations:[]})};function dt({layerId:e,layerType:t=We.layerTypes.DATA,seriesType:a}){return ct[t]({layerId:e,seriesType:a})}function pt(e,t){return e.layers.filter((({layerType:e=We.layerTypes.DATA})=>!t||e===t))}function mt(e,t,a){return t.every(a)||!t.some(a)?{valid:!0}:{valid:!1,payload:ut(e,t.reduce(((e,t,n)=>(a(t)&&e.push(n),e)),[]),xt(t))}}const gt=e=>!e.isBucketed&&"number"===e.dataType,ft=e=>gt(e)&&!e.isStaticValue,bt=e=>e.isBucketed;function ht(e){return"bar_horizontal"===e||"bar_horizontal_stacked"===e||"bar_horizontal_percentage_stacked"===e}function xt(e){return Je(e).every((e=>ht(e.seriesType)))}function yt(e){const t=$e.visualizationTypes.find((t=>t.id===e));if(!t)throw new Error(`Unknown series type ${e}`);return t.icon||"empty"}const vt=(e,t)=>{const a={};return e.accessors.concat(Qe(e)&&e.splitAccessor?[e.splitAccessor]:[]).forEach((e=>{const n=t.getOperationForColumnId(e);null!=n&&n.label&&(a[e]=n.label)})),a},jt={document:0,date:1,string:2,ip:3,boolean:4,number:5,histogram:6,geo_point:7,geo_shape:8,murmur3:9};function Ot({table:e,state:t,keptLayerIds:a,subVisualizationId:n,mainPalette:i,isFromContext:l}){const s=!e.isMultiRow||e.columns.length<=1||e.columns.every((e=>"number"!==e.operation.dataType))||e.columns.some((e=>!jt.hasOwnProperty(e.operation.dataType)));if(s&&"unchanged"===e.changeType&&t)return $e.visualizationTypes.map((e=>{const a=e.id;return{seriesType:a,score:0,state:{...t,preferredSeriesType:a,layers:t.layers.map((e=>({...e,seriesType:a})))},previewIcon:yt(a),title:e.label,hide:!0}}));if(s&&t&&!n||e.columns.some((e=>e.operation.isStaticValue&&!l))||e.columns.some((e=>!e.operation.isBucketed&&"number"!==e.operation.dataType)))return[];const r=function(e,t,a,n,i){const[l,s]=Object(Se.partition)(e.columns,(e=>e.operation.isBucketed));if(1===l.length||2===l.length){const[l,r]=function(e,t){const a=t&&Je(t.layers).find((({layerId:t})=>t===e.layerId)),n=e.columns.filter((e=>e.operation.isBucketed)),i=It([...n].reverse());if(!a||"initial"===e.changeType)return i;if("reorder"===e.changeType)return n;const l=i.findIndex((({columnId:e})=>e===a.xAccessor)),s=l>-1&&i[l].operation.scale;if(s&&("interval"===s||"interval"!==i[0].operation.scale)){const[e]=i.splice(l,1);i.unshift(e)}const r=i.findIndex((({columnId:e})=>e===a.splitAccessor));if(r>-1){const[e]=i.splice(r,1);i.push(e)}return i}(e,a);return Tt({layerId:e.layerId,changeType:e.changeType,xValue:l,yValues:s,splitBy:r,currentState:a,tableLabel:e.label,keptLayerIds:t,requestedSeriesType:n,mainPalette:i})}if(0===l.length){const[l,[r,o]]=Object(Se.partition)(It(s),(e=>"number"===e.operation.dataType&&!e.operation.isBucketed));return Tt({layerId:e.layerId,changeType:e.changeType,xValue:r,yValues:l,splitBy:o,currentState:a,tableLabel:e.label,keptLayerIds:t,requestedSeriesType:n,mainPalette:i})}}(e,a,t,n,i);return r&&r instanceof Array?r:r?[r]:[]}function kt(e){switch(e){case"bar_horizontal":return"bar";case"bar_horizontal_stacked":return"bar_stacked";case"bar":default:return"bar_horizontal";case"bar_horizontal_percentage_stacked":return"bar_percentage_stacked";case"bar_percentage_stacked":return"bar_horizontal_percentage_stacked"}}function It(e){return[...e].sort(((e,t)=>jt[e.operation.dataType]-jt[t.operation.dataType]))}function Tt({layerId:e,changeType:t,xValue:a,yValues:n,splitBy:i,currentState:l,tableLabel:s,keptLayerIds:r,requestedSeriesType:o,mainPalette:c}){const d=function(e,t,a){const n=e.map((e=>e.operation.label)).join(u.i18n.translate("xpack.lens.xySuggestions.yAxixConjunctionSign",{defaultMessage:" & ",description:"A character that can be used for conjunction of multiple enumarated items. Make sure to include spaces around it if needed."})),i=(null==t?void 0:t.operation.label)||u.i18n.translate("xpack.lens.xySuggestions.emptyAxisTitle",{defaultMessage:"(empty)"});return a||("date"===(null==t?void 0:t.operation.dataType)?u.i18n.translate("xpack.lens.xySuggestions.dateSuggestion",{defaultMessage:"{yTitle} over {xTitle}",description:'Chart description for charts over time, like "Transfered bytes over log.timestamp"',values:{xTitle:i,yTitle:n}}):u.i18n.translate("xpack.lens.xySuggestions.nonDateSuggestion",{defaultMessage:"{yTitle} of {xTitle}",description:'Chart description for a value of some groups, like "Top URLs of top 5 countries"',values:{xTitle:i,yTitle:n}}))}(n,a,s),p=o||function(e,t,a){const n="bar_stacked",i=_t(e,t),l=!(!i||!Qe(i))&&i.seriesType||e&&e.preferredSeriesType||n;return a&&a.operation.scale&&"ordinal"===a.operation.scale?l.startsWith("bar")?l:n:l}(l,e,a),m={currentState:l,seriesType:p,layerId:e,title:d,yValues:n,splitBy:i,changeType:t,xValue:a,keptLayerIds:r,mainPalette:i?c:void 0};if(!l&&"unchanged"===t)return $e.visualizationTypes.map((e=>({...wt({...m,seriesType:e.id,hide:"bar_stacked"!==e.id||void 0}),title:e.label}))).sort(((e,t)=>"bar_stacked"===e.state.preferredSeriesType?-1:1));if(!l||"unchanged"!==t)return wt(m);const g=[];if(!p.includes("bar")||a&&"ordinal"!==a.operation.scale){const e=function(e){switch(e){case"area":case"bar":case"bar_stacked":return"line";default:return"bar_stacked"}}(p);g.push(wt({...m,seriesType:e,title:e.startsWith("bar")?u.i18n.translate("xpack.lens.xySuggestions.barChartTitle",{defaultMessage:"Bar chart"}):u.i18n.translate("xpack.lens.xySuggestions.lineChartTitle",{defaultMessage:"Line chart"})}))}else g.push(wt({...m,title:u.i18n.translate("xpack.lens.xySuggestions.flipTitle",{defaultMessage:"Flip"}),seriesType:kt(p)}));if("line"!==p&&i&&!p.includes("percentage")&&g.push(wt({...m,seriesType:Mt(p),title:p.endsWith("stacked")?u.i18n.translate("xpack.lens.xySuggestions.unstackedChartTitle",{defaultMessage:"Unstacked"}):u.i18n.translate("xpack.lens.xySuggestions.stackedChartTitle",{defaultMessage:"Stacked"})})),"line"!==p&&p.includes("stacked")&&!p.includes("percentage")){var f;const e={...m};"ordinal"!==(null===(f=e.xValue)||void 0===f?void 0:f.operation.scale)||e.splitBy||(e.splitBy=e.xValue,delete e.xValue),g.push(wt({...m,hide:!e.splitBy,seriesType:Ft(p),title:u.i18n.translate("xpack.lens.xySuggestions.asPercentageTitle",{defaultMessage:"Percentage"})}))}return g.concat($e.visualizationTypes.filter((e=>!g.find((t=>t.state.preferredSeriesType===e.id)))).map((e=>({...wt({...m,seriesType:e.id}),hide:!0}))))}function Mt(e){switch(e){case"area":return"area_stacked";case"area_stacked":return"area";case"bar":return"bar_stacked";case"bar_stacked":return"bar";default:return e}}function Ft(e){switch(e){case"area_stacked":return"area_percentage_stacked";case"bar_stacked":return"bar_percentage_stacked";case"bar_horizontal_stacked":return"bar_horizontal_percentage_stacked";default:return e}}function wt({currentState:e,seriesType:t,layerId:a,title:n,yValues:i,splitBy:l,changeType:s,xValue:r,keptLayerIds:o,hide:u,mainPalette:c}){var d,p,m;t.includes("percentage")&&"ordinal"===(null===(d=r)||void 0===d?void 0:d.operation.scale)&&!l&&(l=r,r=void 0);const g=_t(e,a)||null,f=i.map((e=>e.columnId)),b={...g||{},palette:c||(g&&"palette"in g?g.palette:void 0),layerId:a,seriesType:t,xAccessor:null===(p=r)||void 0===p?void 0:p.columnId,splitAccessor:null===(m=l)||void 0===m?void 0:m.columnId,accessors:f,yConfig:g&&"yConfig"in g&&g.yConfig?g.yConfig.filter((({forAccessor:e})=>-1!==f.indexOf(e))):void 0,layerType:D.o.DATA},h=e?e.layers.filter((e=>o.includes(e.layerId)||e.layerType===D.o.ANNOTATIONS)).map((e=>e.layerId===a?b:e)).map((e=>({...e,seriesType:t}))):[],x={legend:e?e.legend:{isVisible:!0,position:pe.Position.Right},valueLabels:(null==e?void 0:e.valueLabels)||"hide",fittingFunction:(null==e?void 0:e.fittingFunction)||"None",curveType:null==e?void 0:e.curveType,fillOpacity:null==e?void 0:e.fillOpacity,xTitle:null==e?void 0:e.xTitle,yTitle:null==e?void 0:e.yTitle,yRightTitle:null==e?void 0:e.yRightTitle,hideEndzones:null==e?void 0:e.hideEndzones,valuesInLegend:null==e?void 0:e.valuesInLegend,yLeftExtent:null==e?void 0:e.yLeftExtent,yRightExtent:null==e?void 0:e.yRightExtent,yLeftScale:null==e?void 0:e.yLeftScale,yRightScale:null==e?void 0:e.yRightScale,axisTitlesVisibilitySettings:(null==e?void 0:e.axisTitlesVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},tickLabelsVisibilitySettings:(null==e?void 0:e.tickLabelsVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},labelsOrientation:(null==e?void 0:e.labelsOrientation)||{x:0,yLeft:0,yRight:0},gridlinesVisibilitySettings:(null==e?void 0:e.gridlinesVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},preferredSeriesType:t,layers:g&&Object.keys(g).length?h:[...h,b]};return{title:n,score:Ct(i,l,s),hide:null!=u?u:!e&&"unchanged"!==s&&"extended"!==s||e&&"reduced"===s||0===i.length||!r&&!l,state:x,previewIcon:yt(t)}}function Ct(e,t,a){const n="unchanged"===a?.5:1;return((e.length>1?2:1)+(t?1:0))/3*n}function _t(e,t){return e&&e.layers.find((e=>e.layerId===t))}const St=({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t},e):null,Object(y.jsx)("path",{d:"M5 1.5a.5.5 0 111 0v7a.5.5 0 01-1 0v-7zM15.39 11.39a1.5 1.5 0 010 2.12l-2.122 2.122a.5.5 0 11-.707-.707l2.121-2.122a.5.5 0 000-.707l-2.121-2.12a.5.5 0 11.707-.708l2.121 2.121zM3.439 9.269a.5.5 0 010 .707l-2.122 2.121a.5.5 0 000 .707l2.122 2.121a.5.5 0 01-.707.708L.61 13.51a1.5 1.5 0 010-2.121l2.122-2.121a.5.5 0 01.707 0zM8 3a.5.5 0 01.5.5v5a.5.5 0 01-1 0v-5A.5.5 0 018 3zM11 5.5a.5.5 0 00-1 0v3a.5.5 0 001 0v-3z"}),Object(y.jsx)("path",{d:"M3.5 12a.5.5 0 000 1h9a.5.5 0 000-1h-9z"})),Et=({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t},e):null,Object(y.jsx)("path",{d:"M7.378 3.585a.5.5 0 00.353-.854L5.61.611a1.5 1.5 0 00-2.121 0L1.367 2.73a.5.5 0 00.708.707l2.12-2.12a.5.5 0 01.708 0l2.121 2.12a.5.5 0 00.354.147z"}),Object(y.jsx)("path",{d:"M5.046 3.088v4.129l.005.04v5.658a.5.5 0 01-.992.09l-.01-.09V8.786l-.004-.04V3.087a.5.5 0 01.992-.09l.01.09z"}),Object(y.jsx)("path",{d:"M4.55 15.829a1.5 1.5 0 001.06-.44l2.122-2.121a.5.5 0 10-.707-.707l-2.121 2.121a.5.5 0 01-.708 0l-2.12-2.121a.5.5 0 00-.708.707l2.121 2.121a1.5 1.5 0 001.061.44zM13.5 4a.5.5 0 01.5.5v7a.5.5 0 11-1 0v-7a.5.5 0 01.5-.5zM10.5 6.5a.5.5 0 011 0v5a.5.5 0 11-1 0v-5zM8.5 8a.5.5 0 00-.5.5v3a.5.5 0 101 0v-3a.5.5 0 00-.5-.5z"})),Pt=({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t},e):null,Object(y.jsx)("path",{d:"M8.622 3.585a.5.5 0 01-.353-.854L10.39.611a1.5 1.5 0 012.121 0l2.122 2.12a.5.5 0 11-.707.707l-2.122-2.12a.5.5 0 00-.707 0l-2.121 2.12a.5.5 0 01-.354.147z"}),Object(y.jsx)("path",{d:"M11.95 12.915V8.786l.005-.04V3.087a.5.5 0 00-.992-.09l-.01.09v4.129l-.004.04v5.658a.5.5 0 00.992.09l.01-.09z"}),Object(y.jsx)("path",{d:"M11.45 15.829a1.5 1.5 0 01-1.06-.44l-2.122-2.121a.5.5 0 11.707-.707l2.121 2.121a.5.5 0 00.707 0l2.122-2.121a.5.5 0 01.707.707l-2.121 2.121a1.5 1.5 0 01-1.061.44zM2.5 4a.5.5 0 00-.5.5v7a.5.5 0 101 0v-7a.5.5 0 00-.5-.5zM5.5 6.5a.5.5 0 00-1 0v5a.5.5 0 101 0v-5zM7.5 8a.5.5 0 01.5.5v3a.5.5 0 11-1 0v-3a.5.5 0 01.5-.5z"})),At=({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t},e):null,Object(y.jsx)("path",{d:"M4.99991 7.49999C4.99991 7.22384 5.22376 6.99999 5.49991 6.99999C5.77605 6.99999 5.99991 7.22384 5.99991 7.49999V14.5C5.99991 14.7761 5.77605 15 5.49991 15C5.22376 15 4.99991 14.7761 4.99991 14.5V7.49999Z"}),Object(y.jsx)("path",{d:"M15.3893 2.38929C15.6706 2.67059 15.8287 3.05212 15.8287 3.44995C15.8287 3.84777 15.6706 4.2293 15.3893 4.51061L13.268 6.63193C13.1742 6.7257 13.0471 6.77838 12.9145 6.77838C12.7818 6.77838 12.6547 6.7257 12.5609 6.63193C12.4671 6.53816 12.4145 6.41098 12.4145 6.27838C12.4145 6.14577 12.4671 6.01859 12.5609 5.92482L14.6822 3.8035C14.776 3.70973 14.8287 3.58256 14.8287 3.44995C14.8287 3.31734 14.776 3.19016 14.6822 3.09639L12.5609 0.975075C12.4671 0.881307 12.4145 0.754129 12.4145 0.621522C12.4145 0.488914 12.4671 0.361736 12.5609 0.267968C12.6547 0.1742 12.7819 0.121521 12.9145 0.121521C13.0471 0.121521 13.1742 0.1742 13.268 0.267968L15.3893 2.38929Z"}),Object(y.jsx)("path",{d:"M3.43867 0.26864C3.53243 0.362408 3.58511 0.489585 3.58511 0.622193C3.58511 0.754801 3.53243 0.881978 3.43867 0.975746L1.31735 3.09707C1.22358 3.19083 1.1709 3.31801 1.1709 3.45062C1.1709 3.58323 1.22358 3.71041 1.31735 3.80417L3.43867 5.92549C3.53243 6.01926 3.58511 6.14644 3.58511 6.27905C3.58511 6.41166 3.53243 6.53883 3.43867 6.6326C3.3449 6.72637 3.21772 6.77905 3.08511 6.77905C2.9525 6.77905 2.82533 6.72637 2.73156 6.6326L0.610239 4.51128C0.328934 4.22998 0.170898 3.84844 0.170898 3.45062C0.170898 3.0528 0.328934 2.67126 0.610238 2.38996L2.73156 0.26864C2.82533 0.174871 2.9525 0.122192 3.08511 0.122192C3.21772 0.122192 3.3449 0.174871 3.43867 0.26864Z"}),Object(y.jsx)("path",{d:"M7.99991 6.99999C8.27605 6.99999 8.49991 7.22384 8.49991 7.49999V12.5C8.49991 12.7761 8.27605 13 7.99991 13C7.72377 13 7.49991 12.7761 7.49991 12.5V7.49999C7.49991 7.22384 7.72377 6.99999 7.99991 6.99999Z"}),Object(y.jsx)("path",{d:"M10.9999 7.49999C10.9999 7.22384 10.776 6.99999 10.4999 6.99999C10.2238 6.99999 9.99991 7.22384 9.99991 7.49999V10.5C9.99991 10.7761 10.2238 11 10.4999 11C10.776 11 10.9999 10.7761 10.9999 10.5V7.49999Z"}),Object(y.jsx)("path",{d:"M3.50015 2.99999C3.22401 2.99999 3.00015 3.22384 3.00015 3.49999C3.00015 3.77613 3.22401 3.99999 3.50015 3.99999H12.5002C12.7763 3.99999 13.0002 3.77613 13.0002 3.49999C13.0002 3.22384 12.7763 2.99999 12.5002 2.99999H3.50015Z"}));function Lt(e,t){return e.id===t.id}function Dt(e,t){const a={auto:[],left:[],right:[],bottom:[]};return null==e||e.forEach((e=>{const n=null==t?void 0:t[e.layerId];e.accessors.forEach((t=>{var i,l,s,r;const o=(null===(i=e.yConfig)||void 0===i||null===(l=i.find((e=>e.forAccessor===t)))||void 0===l?void 0:l.axisMode)||"auto";let u=(null==n||null===(s=n.columns.find((e=>e.id===t)))||void 0===s||null===(r=s.meta)||void 0===r?void 0:r.params)||{id:"number"};e.seriesType.includes("percentage")&&"percent"!==u.id&&(u={id:"percent",params:{pattern:"0.[00]%"}}),a[o].push({layer:e.layerId,accessor:t,fieldFormat:u})}))})),a.auto.forEach((e=>{0===a.left.length||t&&a.left.every((t=>Lt(t.fieldFormat,e.fieldFormat)))?a.left.push(e):0===a.right.length||t&&a.left.every((t=>Lt(t.fieldFormat,e.fieldFormat)))?a.right.push(e):a.right.length>=a.left.length?a.left.push(e):a.right.push(e)})),a}a(217);const Nt=[{id:"xy_axis_orientation_horizontal",value:0,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.horizontal",{defaultMessage:"Horizontal"})},{id:"xy_axis_orientation_vertical",value:-90,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.vertical",{defaultMessage:"Vertical"})},{id:"xy_axis_orientation_angled",value:-45,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.angled",{defaultMessage:"Angled"})}],zt=()=>{},Bt=Object(f.htmlIdGenerator)()(),Vt=({layers:e,axis:t,axisTitle:a,updateTitleState:n,toggleTickLabelsVisibility:i,toggleGridlinesVisibility:s,isDisabled:r,areTickLabelsVisible:o,areGridlinesVisible:c,isAxisTitleVisible:d,orientation:p,setOrientation:m,setEndzoneVisibility:g,endzonesVisible:b,extent:h,setExtent:x,hasBarOrAreaOnAxis:v,hasPercentageAxis:O,dataBounds:k,useMultilayerTimeAxis:I,scale:T,setScale:M})=>{var F,w;const C=!(null==e||!e.length)&&xt(e),_=((e,t)=>{switch(e){case"yLeft":return{icon:t?St:Et,groupPosition:"left",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.bottomAxisLabel",{defaultMessage:"Bottom axis"}):u.i18n.translate("xpack.lens.xyChart.leftAxisLabel",{defaultMessage:"Left axis"}),buttonDataTestSubj:"lnsLeftAxisButton"};case"yRight":return{icon:t?At:Pt,groupPosition:"right",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.topAxisLabel",{defaultMessage:"Top axis"}):u.i18n.translate("xpack.lens.xyChart.rightAxisLabel",{defaultMessage:"Right axis"}),buttonDataTestSubj:"lnsRightAxisButton"};default:return{icon:t?Et:St,groupPosition:"center",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.leftAxisLabel",{defaultMessage:"Left axis"}):u.i18n.translate("xpack.lens.xyChart.bottomAxisLabel",{defaultMessage:"Bottom axis"}),buttonDataTestSubj:"lnsBottomAxisButton"}}})(t,C),{inputValue:S,handleInputChange:E}=Object(j.p)({value:h,onChange:x||zt}),[P,A]=Object(l.useState)(S),{inclusiveZeroError:L,boundaryError:D}=function(e,t){return{inclusiveZeroError:t&&e&&(void 0!==t.lowerBound&&t.lowerBound>0||(void 0!==t.upperBound&&t.upperBound)<0),boundaryError:t&&void 0!==t.lowerBound&&void 0!==t.upperBound&&t.upperBound<=t.lowerBound}}(v,P);return Object(l.useEffect)((()=>{!x||L||D||!P||Object(Se.isEqual)(P,S)||E(P)}),[P,L,D,E,S,x]),Object(y.jsx)(j.h,{title:_.popoverTitle,type:_.icon,groupPosition:_.groupPosition,isDisabled:r,buttonDataTestSubj:_.buttonDataTestSubj,panelClassName:"lnsVisToolbarAxis__popover"},Object(y.jsx)(j.a,{axis:t,axisTitle:a,updateTitleState:n,isAxisTitleVisible:d}),Object(y.jsx)(f.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.Gridlines",{defaultMessage:"Gridlines"}),fullWidth:!0},Object(y.jsx)(f.EuiSwitch,{compressed:!0,"data-test-subj":`lnsshow${t}AxisGridlines`,label:u.i18n.translate("xpack.lens.xyChart.Gridlines",{defaultMessage:"Gridlines"}),onChange:()=>s(t),checked:c,showLabel:!1})),Object(y.jsx)(f.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.tickLabels",{defaultMessage:"Tick labels"}),fullWidth:!0},Object(y.jsx)(f.EuiSwitch,{compressed:!0,"data-test-subj":`lnsshow${t}AxisTickLabels`,label:u.i18n.translate("xpack.lens.xyChart.tickLabels",{defaultMessage:"Tick labels"}),onChange:()=>i(t),checked:o,showLabel:!1})),!I&&o&&Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.label",{defaultMessage:"Orientation"})},Object(y.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.axisOrientation.label",{defaultMessage:"Orientation"}),"data-test-subj":"lnsXY_axisOrientation_groups",name:"axisOrientation",buttonSize:"compressed",options:Nt,idSelected:Nt.find((({value:e})=>e===p)).id,onChange:e=>{const a=Nt.find((({id:t})=>t===e)).value;m(t,a)}})),g&&Object(y.jsx)(f.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.showEnzones",{defaultMessage:"Show partial data markers"}),fullWidth:!0},Object(y.jsx)(f.EuiSwitch,{compressed:!0,"data-test-subj":"lnsshowEndzones",label:u.i18n.translate("xpack.lens.xyChart.showEnzones",{defaultMessage:"Show partial data markers"}),onChange:()=>g(!Boolean(b)),checked:Boolean(b),showLabel:!1})),M&&Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.setScale",{defaultMessage:"Axis scale"}),fullWidth:!0},Object(y.jsx)(f.EuiSelect,{compressed:!0,fullWidth:!0,"data-test-subj":"lnsshowEndzones","aria-label":u.i18n.translate("xpack.lens.xyChart.setScale",{defaultMessage:"Axis scale"}),options:[{text:u.i18n.translate("xpack.lens.xyChart.scaleLinear",{defaultMessage:"Linear"}),value:"linear"},{text:u.i18n.translate("xpack.lens.xyChart.scaleLog",{defaultMessage:"Logarithmic"}),value:"log"},{text:u.i18n.translate("xpack.lens.xyChart.scaleSquare",{defaultMessage:"Square root"}),value:"sqrt"}],onChange:e=>M(e.target.value),value:T})),P&&x&&Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.axisExtent.label",{defaultMessage:"Bounds"}),helpText:v?u.i18n.translate("xpack.lens.xyChart.axisExtent.disabledDataBoundsMessage",{defaultMessage:"Only line charts can be fit to the data bounds"}):void 0},Object(y.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.axisExtent.label",{defaultMessage:"Bounds"}),"data-test-subj":"lnsXY_axisBounds_groups",name:"axisBounds",buttonSize:"compressed",options:[{id:`${Bt}full`,label:u.i18n.translate("xpack.lens.xyChart.axisExtent.full",{defaultMessage:"Full"}),"data-test-subj":"lnsXY_axisExtent_groups_full"},{id:`${Bt}dataBounds`,label:u.i18n.translate("xpack.lens.xyChart.axisExtent.dataBounds",{defaultMessage:"Data"}),"data-test-subj":"lnsXY_axisExtent_groups_DataBounds",isDisabled:v},{id:`${Bt}custom`,label:u.i18n.translate("xpack.lens.xyChart.axisExtent.custom",{defaultMessage:"Custom"}),"data-test-subj":"lnsXY_axisExtent_groups_custom",isDisabled:O}],idSelected:`${Bt}${v&&"dataBounds"===P.mode||O?"full":P.mode}`,onChange:e=>{const t=e.replace(Bt,"");A({...P,mode:t,lowerBound:"custom"===t&&k?Math.min(0,k.min):void 0,upperBound:"custom"===t&&k?k.max:void 0})}})),"custom"===(null==P?void 0:P.mode)&&!O&&Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,isInvalid:L||D,label:" ",helpText:!v||L&&!D?void 0:u.i18n.translate("xpack.lens.xyChart.inclusiveZero",{defaultMessage:"Bounds must include zero."}),error:D?u.i18n.translate("xpack.lens.xyChart.boundaryError",{defaultMessage:"Lower bound has to be larger than upper bound"}):v&&L?u.i18n.translate("xpack.lens.xyChart.inclusiveZero",{defaultMessage:"Bounds must include zero."}):void 0},Object(y.jsx)(f.EuiFormControlLayoutDelimited,{"data-test-subj":"lnsXY_axisExtent_customBounds",startControl:Object(y.jsx)(f.EuiFieldNumber,{compressed:!0,value:null!==(F=P.lowerBound)&&void 0!==F?F:"",isInvalid:L||D,"data-test-subj":"lnsXY_axisExtent_lowerBound",onChange:e=>{const t=Number(e.target.value);""===e.target.value||Number.isNaN(Number(t))?A({...P,lowerBound:void 0}):A({...P,lowerBound:t})},onBlur:()=>{void 0===P.lowerBound&&k&&A({...P,lowerBound:Math.min(0,k.min)})},step:"any",controlOnly:!0}),endControl:Object(y.jsx)(f.EuiFieldNumber,{compressed:!0,value:null!==(w=P.upperBound)&&void 0!==w?w:"","data-test-subj":"lnsXY_axisExtent_upperBound",onChange:e=>{const t=Number(e.target.value);""===e.target.value||Number.isNaN(Number(t))?A({...P,upperBound:void 0}):A({...P,upperBound:t})},onBlur:()=>{void 0===P.upperBound&&k&&A({...P,upperBound:k.max})},step:"any",controlOnly:!0}),compressed:!0})))},Rt=[{id:"None",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.none",{defaultMessage:"Hide"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.none",{defaultMessage:"Do not fill gaps"})},{id:"Zero",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.zero",{defaultMessage:"Zero"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.zero",{defaultMessage:"Fill gaps with zeros"})},{id:"Linear",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.linear",{defaultMessage:"Linear"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.linear",{defaultMessage:"Fill gaps with a line"})},{id:"Carry",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.carry",{defaultMessage:"Last"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.carry",{defaultMessage:"Fill gaps with the last value"})},{id:"Lookahead",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.lookahead",{defaultMessage:"Next"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.lookahead",{defaultMessage:"Fill gaps with the next value"})}],Ht=[{id:"None",title:u.i18n.translate("xpack.lens.endValue.none",{defaultMessage:"Hide"}),description:u.i18n.translate("xpack.lens.endValueDescription.none",{defaultMessage:"Do not extend series to the edge of the chart"})},{id:"Zero",title:u.i18n.translate("xpack.lens.endValue.zero",{defaultMessage:"Zero"}),description:u.i18n.translate("xpack.lens.endValueDescription.zero",{defaultMessage:"Extend series as zero to the edge of the chart"})},{id:"Nearest",title:u.i18n.translate("xpack.lens.endValue.nearest",{defaultMessage:"Nearest"}),description:u.i18n.translate("xpack.lens.endValueDescription.nearest",{defaultMessage:"Extend series with the first/last value to the edge of the chart"})}],Gt=({onFittingFnChange:e,fittingFunction:t,emphasizeFitting:a,onEmphasizeFittingChange:n,onEndValueChange:i,endValue:l,isFittingEnabled:r=!0})=>Object(y.jsx)(s.a.Fragment,null,r&&Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",label:Object(y.jsx)(s.a.Fragment,null,u.i18n.translate("xpack.lens.xyChart.missingValuesLabel",{defaultMessage:"Missing values"})," ",Object(y.jsx)(f.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.xyChart.missingValuesLabelHelpText",{defaultMessage:"By default, area and line charts hide the gaps in the data. To fill the gap, make a selection."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"}))},Object(y.jsx)(f.EuiSuperSelect,{"data-test-subj":"lnsMissingValuesSelect",compressed:!0,options:Rt.map((({id:e,title:t,description:a})=>({value:e,dropdownDisplay:Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)("strong",null,t),Object(y.jsx)(f.EuiText,{size:"xs",color:"subdued"},Object(y.jsx)("p",null,a))),inputDisplay:t}))),valueOfSelected:t||"None",onChange:t=>e(t),itemLayoutAlign:"top",hasDividers:!0})),t&&"None"!==t&&Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.endValuesLabel",{defaultMessage:"End values"})},Object(y.jsx)(f.EuiSuperSelect,{"data-test-subj":"lnsEndValuesSelect",compressed:!0,options:Ht.map((({id:e,title:t,description:a})=>({value:e,dropdownDisplay:Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)("strong",null,t),Object(y.jsx)(f.EuiText,{size:"xs",color:"subdued"},Object(y.jsx)("p",null,a))),inputDisplay:t}))),valueOfSelected:l||"None",onChange:e=>i(e),itemLayoutAlign:"top",hasDividers:!0})),Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.xyChart.missingValuesStyle",{defaultMessage:"Show as dotted line"}),display:"columnCompressedSwitch"},Object(y.jsx)(f.EuiSwitch,{showLabel:!1,label:u.i18n.translate("xpack.lens.xyChart.missingValuesStyle",{defaultMessage:"Show as dotted line"}),checked:!a,onChange:()=>{n(!a)},compressed:!0}))))),qt=({onChange:e,value:t,isCurveTypeEnabled:a=!0})=>a?Object(y.jsx)(f.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.curveStyleLabel",{defaultMessage:"Curve lines"})},Object(y.jsx)(f.EuiSwitch,{showLabel:!1,label:"Curved",checked:"CURVE_MONOTONE_X"===t,compressed:!0,onChange:t=>{t.target.checked?e("CURVE_MONOTONE_X"):e("LINEAR")},"data-test-subj":"lnsCurveStyleToggle"})):null,$t=({onChange:e,value:t,isFillOpacityEnabled:a=!0})=>{const{inputValue:n,handleInputChange:i}=Object(j.p)({value:t,onChange:e});return a?Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.fillOpacityLabel",{defaultMessage:"Fill opacity"}),fullWidth:!0},Object(y.jsx)(f.EuiRange,{"data-test-subj":"lnsFillOpacity",value:n,min:.1,max:1,step:.1,showInput:!0,compressed:!0,fullWidth:!0,onChange:e=>{i(Number(e.currentTarget.value))}}))):null},Wt=({state:e,setState:t,datasourceLayers:a})=>{var n,i;const l=Je(e.layers),s=l.some((({seriesType:e})=>"area_percentage_stacked"===e)),r=l.some((({seriesType:e})=>["area_stacked","area","line"].includes(e))),o=l.some((({seriesType:e})=>["bar","bar_horizontal"].includes(e))),c=l.some((({seriesType:e})=>["area_stacked","area","area_percentage_stacked"].includes(e))),d=Boolean(function(e=[],t){return!!t&&e.filter((({accessors:e})=>e.length)).some((({layerId:e,xAccessor:a})=>{if(!a)return!1;const n=t[e].getOperationForColumnId(a);return n&&n.isBucketed&&n.scale&&"ordinal"!==n.scale}))}(l,a)),p=!r&&o&&!d,m=r,g=r||s,f=function({isAreaPercentage:e,isHistogramSeries:t}){return t?u.i18n.translate("xpack.lens.xyChart.valuesHistogramDisabledHelpText",{defaultMessage:"This setting cannot be changed on histograms."}):e?u.i18n.translate("xpack.lens.xyChart.valuesPercentageDisabledHelpText",{defaultMessage:"This setting cannot be changed on percentage area charts."}):u.i18n.translate("xpack.lens.xyChart.valuesStackedDisabledHelpText",{defaultMessage:"This setting cannot be changed on stacked or percentage bar charts"})}({isAreaPercentage:s,isHistogramSeries:d}),b=!p&&!m&&!g;return Object(y.jsx)(j.i,{tooltipContent:f,condition:b},Object(y.jsx)(j.h,{title:u.i18n.translate("xpack.lens.shared.curveLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"left",buttonDataTestSubj:"lnsVisualOptionsButton",isDisabled:b},Object(y.jsx)(qt,{isCurveTypeEnabled:g,value:null==e?void 0:e.curveType,onChange:a=>{t({...e,curveType:a})}}),Object(y.jsx)(j.j,{isVisible:p,valueLabels:null!==(n=null==e?void 0:e.valueLabels)&&void 0!==n?n:"hide",onValueLabelChange:a=>{t({...e,valueLabels:a})}}),Object(y.jsx)(Gt,{isFittingEnabled:m,fittingFunction:null==e?void 0:e.fittingFunction,emphasizeFitting:null==e?void 0:e.emphasizeFitting,endValue:null==e?void 0:e.endValue,onFittingFnChange:a=>{t({...e,fittingFunction:a})},onEmphasizeFittingChange:a=>{t({...e,emphasizeFitting:a})},onEndValueChange:a=>{t({...e,endValue:a})}}),Object(y.jsx)($t,{isFillOpacityEnabled:c,value:null!==(i=null==e?void 0:e.fillOpacity)&&void 0!==i?i:.3,onChange:a=>{t({...e,fillOpacity:a})}})))};function Ut(e){return null!=e&&"empty"!==e}const Yt=e=>{var t;return e.value?Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiIcon,{type:null!==(t=e.icon)&&void 0!==t?t:e.value})),Object(y.jsx)(f.EuiFlexItem,null,e.label)):null};function Xt({value:e,onChange:t,customIconSet:a,defaultIcon:n="empty"}){var i;const l=a.find((t=>e===t.value))||a.find((e=>e.value===n));return Object(y.jsx)(f.EuiComboBox,{fullWidth:!0,"data-test-subj":"lns-icon-select",isClearable:!1,options:a,selectedOptions:[{label:l.label,value:l.value}],onChange:e=>{t(e[0].value)},singleSelection:{asPlainText:!0},renderOption:Yt,compressed:!0,prepend:Ut(l.value)?Object(y.jsx)(f.EuiIcon,{type:null!==(i=l.icon)&&void 0!==i?i:l.value}):void 0})}var Kt=a(43),Zt=a(40),Qt=a.n(Zt);const Jt=({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({width:"30",height:"22",viewBox:"0 0 30 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t},e):null,Object(y.jsx)("g",null,Object(y.jsx)("path",{className:"lensChartIcon__subdued",d:"M16 8a1 1 0 011-1h4a1 1 0 011 1v13a1 1 0 01-1 1h-4a1 1 0 01-1-1V8zM1 9a1 1 0 00-1 1v11a1 1 0 001 1h4a1 1 0 001-1V10a1 1 0 00-1-1H1zM9 16a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1v-4a1 1 0 00-1-1H9zM25 11a1 1 0 00-1 1v9a1 1 0 001 1h4a1 1 0 001-1v-9a1 1 0 00-1-1h-4z"}),Object(y.jsx)("path",{className:"lensChartIcon__accent",d:"M10 1a1 1 0 011-1h3a1 1 0 011 1h3v4h-3a1 1 0 01-1-1h-2v9a1 1 0 11-2 0V1z"})));var ea=a(79);const ta=u.i18n.translate("xpack.lens.xyChart.defaultAnnotationLabel",{defaultMessage:"Event"}),aa=u.i18n.translate("xpack.lens.xyChart.defaultRangeAnnotationLabel",{defaultMessage:"Event range"});function na(e,t){const a=e.map((({layerId:e})=>e)),{activeData:n,dateRange:i}=t,l=Qt()(i.fromDate).valueOf(),s=Qt()(i.toDate).valueOf(),r=Qt()((l+s)/2).toISOString();if(!n||Object.entries(n).filter((([e])=>a.includes(e))).every((([,{rows:e}])=>!e||!e.length)))return r;const o=(a.reduce(((t,a)=>{var i,l,s,r;const o=null===(i=e.find((e=>e.layerId===a)))||void 0===i?void 0:i.xAccessor,u=null===(l=n[a])||void 0===l||null===(s=l.rows)||void 0===s||null===(r=s[0])||void 0===r?void 0:r[o];return u&&u<t?u:t}),864e13)+a.reduce(((t,a)=>{var i,l,s,r,o,u;const c=null===(i=e.find((e=>e.layerId===a)))||void 0===i?void 0:i.xAccessor,d=null===(l=n[a])||void 0===l||null===(s=l.rows)||void 0===s||null===(r=s[(null==n||null===(o=n[a])||void 0===o||null===(u=o.rows)||void 0===u?void 0:u.length)-1])||void 0===r?void 0:r[c];return d&&d>t?d:t}),-864e13))/2;return l<o&&s>o?Qt()(o).toISOString():r}const ia=(e,t)=>{const a=Je((null==e?void 0:e.layers)||[]),n=Boolean(a.length&&a.every((e=>e.xAccessor&&Ze("interval","date",(null==t?void 0:t.datasourceLayers)||{})(e)))),i=e&&n?[{groupId:"xAnnotations",columnId:Object(ea.a)()}]:void 0;return{type:D.o.ANNOTATIONS,label:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabel",{defaultMessage:"Annotations"}),icon:Jt,disabled:!n,toolTipContent:n?void 0:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabelDisabledHelp",{defaultMessage:"Annotations require a time based chart to work. Add a date histogram."}),initialDimensions:i,noDatasource:!0}},la=e=>e.annotations.map((e=>(e=>({columnId:e.id,triggerIcon:e.isHidden?"invisible":"color",color:(null==e?void 0:e.color)||(Object(Kt.isRangeAnnotation)(e)?Kt.defaultAnnotationRangeColor:Kt.defaultAnnotationColor)}))(e))),sa=e=>{const t=nt(e),a={},n={};return t.forEach((e=>{e.annotations&&e.annotations.forEach((e=>{a[e.id]=(e=>{let t=e;for(;n[t]>=0;){const a=++n[t];t=u.i18n.translate("xpack.lens.uniqueLabel",{defaultMessage:"{label} [{num}]",values:{label:e,num:a}})}return n[t]=0,t})(e.label)}))})),a},ra=({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({viewBox:"0 0 16 12",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t},e):null,Object(y.jsx)("g",null,Object(y.jsx)("path",{className:"lensChartIcon__subdued",d:"M3.2 4.79997C3.2 4.50542 2.96122 4.26663 2.66667 4.26663H0.533333C0.238784 4.26663 0 4.50542 0 4.79997V6.39997H3.2V4.79997ZM3.2 9.59997H0V13.3333C0 13.6279 0.238784 13.8666 0.533333 13.8666H2.66667C2.96122 13.8666 3.2 13.6279 3.2 13.3333V9.59997ZM8.53333 9.59997H11.7333V13.3333C11.7333 13.6279 11.4946 13.8666 11.2 13.8666H9.06667C8.77211 13.8666 8.53333 13.6279 8.53333 13.3333V9.59997ZM11.7333 6.39997H8.53333V2.66663C8.53333 2.37208 8.77211 2.1333 9.06667 2.1333H11.2C11.4946 2.1333 11.7333 2.37208 11.7333 2.66663V6.39997ZM12.8 9.59997V13.3333C12.8 13.6279 13.0388 13.8666 13.3333 13.8666H15.4667C15.7612 13.8666 16 13.6279 16 13.3333V9.59997H12.8ZM16 6.39997V5.86663C16 5.57208 15.7612 5.3333 15.4667 5.3333H13.3333C13.0388 5.3333 12.8 5.57208 12.8 5.86663V6.39997H16ZM7.46667 11.2C7.46667 10.9054 7.22789 10.6666 6.93333 10.6666H4.8C4.50544 10.6666 4.26667 10.9054 4.26667 11.2V13.3333C4.26667 13.6279 4.50544 13.8666 4.8 13.8666H6.93333C7.22789 13.8666 7.46667 13.6279 7.46667 13.3333V11.2Z"}),Object(y.jsx)("rect",{y:"7.4668",width:"16",height:"1.06667",rx:"0.533334",className:"lensChartIcon__accent"})));function oa(e,t,a){const n=e.some(Ze("interval","number",t)),{right:i,left:l}=Dt(e,a);return{x:e.some((({xAccessor:e})=>null!=e))&&n,yLeft:l.length>0,yRight:i.length>0}}function ua(e,t,{activeData:a},n){if(!a)return 100;const{dataLayers:i,untouchedDataLayers:l,accessors:s}=function(e,t,a){switch(e){case"x":{const e=t.filter((({xAccessor:e})=>e));return{dataLayers:e.map((({accessors:e,xAccessor:t,...a})=>({...a,accessors:[t]}))),untouchedDataLayers:e,accessors:e.map((({xAccessor:e})=>e))}}case"yLeft":case"yRight":{const n="yLeft"===e?"left":"right",{[n]:i}=Dt(t,a),l=new Set(i.map((({layer:e})=>e))),s=t.filter((({layerId:e})=>l.has(e)));return{dataLayers:s,untouchedDataLayers:s,accessors:i.map((({accessor:e})=>e))}}}}(t,e,a);if("x"===t&&i.length&&!l.some(n))return 100;const r=function(e,t,a,n=!0,i=!0){if(e.length&&t.length){if(e.some((({seriesType:e})=>function(e){return"bar_percentage_stacked"===e||"bar_horizontal_percentage_stacked"===e||"area_percentage_stacked"===e}(e))))return.75;const{min:l,max:s}=function(e,t,a,n=!0){const i=new Set(t);let l,s;const[r,o]=Object(Se.partition)(e,(({seriesType:e})=>function(e){return e.includes("stacked")}(e)&&n));for(const{layerId:e,accessors:t}of o){const n=a[e];if(n)for(const e of t)if(i.has(e))for(const t of n.rows){const a=t[e];"number"==typeof a&&(s=null!=s?Math.max(a,s):a,l=null!=l?Math.min(a,l):a)}}const u={};for(const{layerId:e,accessors:t,xAccessor:n}of r){const l=a[e];if(l)for(const e of t)if(i.has(e))for(const t of l.rows){const a=t[e];let i="shared";var c;n&&(i=t[n]),"number"==typeof a&&(u[i]=null!==(c=u[i])&&void 0!==c?c:0,u[i]+=a)}}for(const e of Object.values(u))s=Math.max(e,s||0,0),l=Math.min(e,l||0,0);return{min:l,max:s}}(e,t,a,i);if(null!=l&&null!=s&&isFinite(l)&&isFinite(s)){const e=n?Math.min(0,l):l;return Number((e+.75*(s-e)).toFixed(2))}}}(i,s,a,"x"!==t,"x"!==t);return null!=r?r:100}const ca=(e,t)=>{const a=function(e,t,a,n){if(!t)return[];const i=oa(Je(t.layers),a,n);return[{id:"yReferenceLineLeft",label:"yLeft"},{id:"yReferenceLineRight",label:"yRight"},{id:"xReferenceLine",label:"x"}].filter((({label:e})=>i[e]))}(0,e,(null==t?void 0:t.datasourceLayers)||{},null==t?void 0:t.activeData),n=(null==e?void 0:e.layers)||[],i=Je(n),l=i.filter((({accessors:e,xAccessor:t})=>e.length||t)),s=Ze("interval","number",(null==t?void 0:t.datasourceLayers)||{}),r=e?a.map((({id:e,label:a})=>({groupId:e,columnId:Object(ea.a)(),dataType:"number",label:Ke(a,{isHorizontal:xt(n)}),staticValue:ua(i,a,{activeData:null==t?void 0:t.activeData},s)}))):void 0;return{type:D.o.REFERENCELINE,label:u.i18n.translate("xpack.lens.xyChart.addReferenceLineLayerLabel",{defaultMessage:"Reference lines"}),icon:ra,disabled:!l.length||!i.some(s)&&i.every((({accessors:e})=>!e.length)),toolTipContent:l.length?void 0:u.i18n.translate("xpack.lens.xyChart.addReferenceLineLayerLabelDisabledHelp",{defaultMessage:"Add some data to enable reference layer"}),initialDimensions:r}},da=(e,t=ma)=>({columnId:e,triggerIcon:"color",color:t}),pa=({state:e,frame:t,layer:a,sortedAccessors:n})=>{const i=n.reduce(((e,t,a)=>(e[t]=a,e)),{}),{bottom:l,left:s,right:r}=Object(Se.groupBy)([...a.yConfig||[]].sort((({forAccessor:e},{forAccessor:t})=>i[e]-i[t])),(({axisMode:e})=>e)),o=function(e,t,a,n){if(!t)return[];const i=oa(Je(t.layers),a,n);return e.filter((({label:e,config:t})=>i[e]||(null==t?void 0:t.length))).map((e=>({...e,valid:i[e.label]})))}([{config:s,id:"yReferenceLineLeft",label:"yLeft",dataTestSubj:"lnsXY_yReferenceLineLeftPanel"},{config:r,id:"yReferenceLineRight",label:"yRight",dataTestSubj:"lnsXY_yReferenceLineRightPanel"},{config:l,id:"xReferenceLine",label:"x",dataTestSubj:"lnsXY_xReferenceLinePanel"}],e,t.datasourceLayers,t.activeData),c=xt(e.layers);return{groups:o.map((({config:e=[],id:t,label:a,dataTestSubj:n,valid:i})=>({groupId:t,groupLabel:Ke(a,{isHorizontal:c}),accessors:e.map((({forAccessor:e,color:t})=>da(e,t))),filterOperations:gt,supportsMoreColumns:!0,required:!1,enableDimensionEditor:!0,supportStaticValue:!0,paramEditorCustomProps:{label:u.i18n.translate("xpack.lens.indexPattern.staticValue.label",{defaultMessage:"Reference line value"})},supportFieldFormat:!1,dataTestSubj:n,invalid:!i,invalidMessage:"x"===a?u.i18n.translate("xpack.lens.configure.invalidBottomReferenceLineDimension",{defaultMessage:"This reference line is assigned to an axis that no longer exists or is no longer valid. You may move this reference line to another available axis or remove it."}):u.i18n.translate("xpack.lens.configure.invalidReferenceLineDimension",{defaultMessage:"This reference line is assigned to an axis that no longer exists. You may move this reference line to another available axis or remove it."}),requiresPreviousColumnOnDuplicate:!0})))}},ma=G.euiLightVars.euiColorDarkShade;function ga(e,t,a){const n={};return e.filter((e=>Qe(e))).forEach((e=>{var t;const a=(null===(t=e.palette)||void 0===t?void 0:t.name)||"default";n[a]||(n[a]=[]),n[a].push(e)})),Object(Se.mapValues)(n,(e=>{const n=e.map(((e,n)=>{var i;if(e.collapseFn||!e.splitAccessor)return{numberOfSeries:e.accessors.length,splits:[]};const l=e.splitAccessor,s=null===(i=t.tables[e.layerId])||void 0===i?void 0:i.columns.find((({id:e})=>e===l)),r=s&&a(s.meta.params),o=s&&t.tables[e.layerId]?Object(Se.uniq)(t.tables[e.layerId].rows.map((e=>{let t=e[l];var a;return t=t&&!(e=>null!=e&&"object"!=typeof e)(t)?null!==(a=null==r?void 0:r.convert(t))&&void 0!==a?a:t:String(t),t}))):[];return{numberOfSeries:(o.length||1)*e.accessors.length,splits:o}}));return{totalSeriesCount:n.reduce(((e,t)=>e+t.numberOfSeries),0),getRank(t,a,i){const l=e.findIndex((e=>t.layerId===e.layerId)),s=n[l].splits.indexOf(a);return(0===l?0:n.slice(0,l).reduce(((e,t)=>e+t.numberOfSeries),0))+(t.splitAccessor&&-1!==s?s*t.accessors.length:0)+t.accessors.indexOf(i)}}}))}function fa(e){return{columnId:e,triggerIcon:"disabled"}}function ba(e,t,a,n,i){var l;if(et(e))return da(t);if(at(e)){const a=e.annotations.find((e=>e.id===t));return{columnId:t,triggerIcon:null!=a&&a.isHidden?"invisible":"color",color:Object(Kt.isRangeAnnotation)(a)?Kt.defaultAnnotationRangeColor:Kt.defaultAnnotationColor}}const s=Qe(e)&&!e.collapseFn&&e.splitAccessor,r=e.palette||{type:"palette",name:"default"},o=null===(l=a[r.name])||void 0===l?void 0:l.totalSeriesCount;if(s)return fa(t);const u=vt(e,n.datasourceLayers[e.layerId]),c=a[r.name].getRank(e,u[t]||t,t),d=null!=o?i.get(r.name).getCategoricalColor([{name:u[t]||t,rankAtDepth:c,totalSeriesAtDepth:o}],{maxDepth:1,totalSeries:o},r.params):void 0;return{columnId:t,triggerIcon:d?"color":"disabled",color:null!=d?d:void 0}}const ha=(e,t)=>{const a=e?e.getTableSpec().map((({columnId:e})=>e)).filter((e=>t.accessors.includes(e))):t.accessors;return Array.from(new Set(a.concat(t.accessors)))},xa=(e,t,a,n={},i,l)=>{if(!e||!e.layers.length)return null;const s={};return e.layers.forEach((e=>{s[e.layerId]={};const a=t[e.layerId];a&&a.getTableSpec().forEach((a=>{const n=t[e.layerId].getOperationForColumnId(a.columnId);s[e.layerId][a.columnId]=n}))})),ja(e,s,t,a,i,l)},ya={[D.o.DATA]:e=>({...e,hide:!0}),[D.o.REFERENCELINE]:e=>{var t;return{...e,hide:!0,yConfig:null===(t=e.yConfig)||void 0===t?void 0:t.map((({...e})=>({...e,lineWidth:1,icon:void 0,textVisibility:!1})))}},[D.o.ANNOTATIONS]:e=>({...e,hide:!0})};function va(e,t){if(!e)return t;if("ordinal"===e.scale)return pe.ScaleType.Ordinal;if("interval"===e.scale||"ratio"===e.scale)return"date"===e.dataType?pe.ScaleType.Time:pe.ScaleType.Linear;switch(e.dataType){case"boolean":case"string":case"ip":return pe.ScaleType.Ordinal;case"date":return pe.ScaleType.Time;default:return pe.ScaleType.Linear}}const ja=(e,t,a,n,i,l)=>{var s,r,o,u,c,d,p,m,g,f,b,h,x,y,v,j,O,k,I,T,M,F,w,C,S;const E=Je(e.layers).filter((e=>Boolean(e.accessors.length))).map((e=>({...e,accessors:ha(a[e.layerId],e)}))),P=tt(e.layers).filter((e=>Boolean(e.accessors.length))),A=sa(e.layers),L=nt(e.layers).filter((e=>Boolean(e.annotations.length))).map((e=>({...e,annotations:e.annotations.map((e=>({...e,label:A[e.id]})))})));return E.length?{type:"expression",chain:[{type:"function",function:"layeredXyVis",arguments:{xTitle:[e.xTitle||""],yTitle:[e.yTitle||""],yRightTitle:[e.yRightTitle||""],legend:[{type:"expression",chain:[{type:"function",function:"legendConfig",arguments:{isVisible:[e.legend.isVisible],showSingleSeries:e.legend.showSingleSeries?[e.legend.showSingleSeries]:[],position:e.legend.isInside?[]:[e.legend.position],isInside:e.legend.isInside?[e.legend.isInside]:[],legendSize:e.legend.isInside?[]:e.legend.position===pe.Position.Top||e.legend.position===pe.Position.Bottom?[_.LegendSize.AUTO]:e.legend.legendSize?[e.legend.legendSize]:[],horizontalAlignment:e.legend.horizontalAlignment&&e.legend.isInside?[e.legend.horizontalAlignment]:[],verticalAlignment:e.legend.verticalAlignment&&e.legend.isInside?[e.legend.verticalAlignment]:[],floatingColumns:e.legend.floatingColumns&&e.legend.isInside?[Math.min(5,e.legend.floatingColumns)]:[],maxLines:e.legend.maxLines?[e.legend.maxLines]:[],shouldTruncate:[null!==(s=e.legend.shouldTruncate)&&void 0!==s?s:ke(e,a).truncateText]}}]}],fittingFunction:[e.fittingFunction||"None"],endValue:[e.endValue||"None"],emphasizeFitting:[e.emphasizeFitting||!1],curveType:[e.curveType||"LINEAR"],fillOpacity:[e.fillOpacity||.3],yLeftExtent:[Fa(e.yLeftExtent,E)],yRightExtent:[Fa(e.yRightExtent,E)],yLeftScale:[e.yLeftScale||"linear"],yRightScale:[e.yRightScale||"linear"],axisTitlesVisibilitySettings:[{type:"expression",chain:[{type:"function",function:"axisTitlesVisibilityConfig",arguments:{x:[null===(r=null==e||null===(o=e.axisTitlesVisibilitySettings)||void 0===o?void 0:o.x)||void 0===r||r],yLeft:[null===(u=null==e||null===(c=e.axisTitlesVisibilitySettings)||void 0===c?void 0:c.yLeft)||void 0===u||u],yRight:[null===(d=null==e||null===(p=e.axisTitlesVisibilitySettings)||void 0===p?void 0:p.yRight)||void 0===d||d]}}]}],tickLabelsVisibilitySettings:[{type:"expression",chain:[{type:"function",function:"tickLabelsConfig",arguments:{x:[null===(m=null==e||null===(g=e.tickLabelsVisibilitySettings)||void 0===g?void 0:g.x)||void 0===m||m],yLeft:[null===(f=null==e||null===(b=e.tickLabelsVisibilitySettings)||void 0===b?void 0:b.yLeft)||void 0===f||f],yRight:[null===(h=null==e||null===(x=e.tickLabelsVisibilitySettings)||void 0===x?void 0:x.yRight)||void 0===h||h]}}]}],gridlinesVisibilitySettings:[{type:"expression",chain:[{type:"function",function:"gridlinesConfig",arguments:{x:[null===(y=null==e||null===(v=e.gridlinesVisibilitySettings)||void 0===v?void 0:v.x)||void 0===y||y],yLeft:[null===(j=null==e||null===(O=e.gridlinesVisibilitySettings)||void 0===O?void 0:O.yLeft)||void 0===j||j],yRight:[null===(k=null==e||null===(I=e.gridlinesVisibilitySettings)||void 0===I?void 0:I.yRight)||void 0===k||k]}}]}],labelsOrientation:[{type:"expression",chain:[{type:"function",function:"labelsOrientationConfig",arguments:{x:[null!==(T=null==e||null===(M=e.labelsOrientation)||void 0===M?void 0:M.x)&&void 0!==T?T:0],yLeft:[null!==(F=null==e||null===(w=e.labelsOrientation)||void 0===w?void 0:w.yLeft)&&void 0!==F?F:0],yRight:[null!==(C=null==e||null===(S=e.labelsOrientation)||void 0===S?void 0:S.yRight)&&void 0!==C?C:0]}}]}],valueLabels:[(null==e?void 0:e.valueLabels)||"hide"],hideEndzones:[(null==e?void 0:e.hideEndzones)||!1],valuesInLegend:[(null==e?void 0:e.valuesInLegend)||!1],layers:[...E.map((e=>Ia(e,a[e.layerId],t,n,i[e.layerId]))),...P.map((e=>Oa(e,a[e.layerId],i[e.layerId]))),...L.map((e=>ka(e,l)))]}}]}:null},Oa=(e,t,a)=>({type:"expression",chain:[{type:"function",function:"referenceLineLayer",arguments:{layerId:[e.layerId],yConfig:e.yConfig?e.yConfig.map((e=>Ma(e,ma))):[],accessors:e.accessors,columnToLabel:[JSON.stringify(vt(e,t))],...a?{table:[a]}:{}}}]}),ka=(e,t)=>({type:"expression",chain:[{type:"function",function:"extendedAnnotationLayer",arguments:{hide:[Boolean(e.hide)],layerId:[e.layerId],annotations:e.annotations?e.annotations.map((e=>t.toExpression(e))):[]}}]}),Ia=(e,t,a,n,i)=>{const l=vt(e,t),s=null==t?void 0:t.getOperationForColumnId(e.xAccessor),r=Boolean(s&&s.isBucketed&&s.scale&&"ordinal"!==s.scale);return{type:"expression",chain:[{type:"function",function:"extendedDataLayer",arguments:{layerId:[e.layerId],hide:[Boolean(e.hide)],xAccessor:e.xAccessor?[e.xAccessor]:[],xScaleType:[va(a[e.layerId][e.xAccessor],pe.ScaleType.Linear)],isHistogram:[r],splitAccessor:e.collapseFn||!e.splitAccessor?[]:[e.splitAccessor],yConfig:e.yConfig?e.yConfig.map((e=>Ta(e))):[],seriesType:[e.seriesType],accessors:e.accessors,columnToLabel:[JSON.stringify(l)],...i?{table:[{...i,chain:[...i.chain,...e.collapseFn?[{type:"function",function:"lens_collapse",arguments:{by:e.xAccessor?[e.xAccessor]:[],metric:e.accessors,fn:[e.collapseFn]}}]:[]]}]}:{},palette:[{type:"expression",chain:[e.palette?{type:"function",function:"theme",arguments:{variable:["palette"],default:[n.get(e.palette.name).toExpression(e.palette.params)]}}:{type:"function",function:"system_palette",arguments:{name:["default"]}}]}]}}]}},Ta=(e,t)=>({type:"expression",chain:[{type:"function",function:"yConfig",arguments:{forAccessor:[e.forAccessor],axisMode:e.axisMode?[e.axisMode]:[],color:e.color?[e.color]:t?[t]:[]}}]}),Ma=(e,t)=>({type:"expression",chain:[{type:"function",function:"extendedYConfig",arguments:{forAccessor:[e.forAccessor],axisMode:e.axisMode?[e.axisMode]:[],color:e.color?[e.color]:t?[t]:[],lineStyle:[e.lineStyle||"solid"],lineWidth:[e.lineWidth||1],fill:[e.fill||"none"],icon:Ut(e.icon)?[e.icon]:[],iconPosition:Ut(e.icon)||e.textVisibility?[e.iconPosition||"auto"]:["auto"],textVisibility:[e.textVisibility||!1]}}]}),Fa=(e,t)=>{var a;return{type:"expression",chain:[{type:"function",function:"axisExtentConfig",arguments:{mode:[null!==(a=null==e?void 0:e.mode)&&void 0!==a?a:"full"],lowerBound:void 0!==(null==e?void 0:e.lowerBound)?[null==e?void 0:e.lowerBound]:[],upperBound:void 0!==(null==e?void 0:e.upperBound)?[null==e?void 0:e.upperBound]:[]}}]}};function wa(e,t,a){const n=[...e.layers];return n[a]=t,{...e,layers:n}}const Ca=[{id:"xy_legend_auto",value:"auto",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.auto",{defaultMessage:"Auto"})},{id:"xy_legend_show",value:"show",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"xy_legend_hide",value:"hide",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.hide",{defaultMessage:"Hide"})}];function _a(e,t,a){var n;return Boolean(null===(n=e.find((e=>e.groupId===t)))||void 0===n?void 0:n.series.some((({layer:e})=>Je(null==a?void 0:a.layers).find((t=>t.layerId===e&&t.seriesType.includes("percentage"))))))}const Sa={x:"xTitle",yLeft:"yTitle",yRight:"yRightTitle"},Ea=Object(l.memo)((function(e){var t,a,n,i,s,r,o,c,d,p,m,g,b,h,x,v,O,k,I,T,M,F,w,C,S,E;const{state:P,setState:A,frame:L,useLegacyTimeAxis:D}=e,N=Je(null==P?void 0:P.layers),z=!(null==P||!P.layers.length)&&xt(P.layers),B=function(e,t,a,n){const i=Dt(e,a),l=[];return i.left.length>0&&l.push({groupId:"left",position:t?"bottom":"left",formatter:void 0,series:i.left.map((({fieldFormat:e,...t})=>t))}),i.right.length>0&&l.push({groupId:"right",position:t?"top":"right",formatter:void 0,series:i.right.map((({fieldFormat:e,...t})=>t))}),l}(N,z,L.activeData),V=function(e,t){const a={};return t.forEach((t=>{let n=Number.MAX_VALUE,i=Number.MIN_VALUE;t.series.forEach((t=>{var a;null==e||null===(a=e[t.layer])||void 0===a||a.rows.forEach((e=>{const a=e[t.accessor];Number.isNaN(a)||(a<n&&(n=a),a>i&&(i=a))}))})),n!==Number.MAX_VALUE&&i!==Number.MIN_VALUE&&(a[t.groupId]={min:Math.round(100*(n+Number.EPSILON))/100,max:Math.round(100*(i+Number.EPSILON))/100})})),a}(L.activeData,B),R={x:null===(t=null==P||null===(a=P.tickLabelsVisibilitySettings)||void 0===a?void 0:a.x)||void 0===t||t,yLeft:null===(n=null==P||null===(i=P.tickLabelsVisibilitySettings)||void 0===i?void 0:i.yLeft)||void 0===n||n,yRight:null===(s=null==P||null===(r=P.tickLabelsVisibilitySettings)||void 0===r?void 0:r.yRight)||void 0===s||s},H=e=>{const t={...R,[e]:!R[e]};A({...P,tickLabelsVisibilitySettings:t})},G={x:null===(o=null==P||null===(c=P.gridlinesVisibilitySettings)||void 0===c?void 0:c.x)||void 0===o||o,yLeft:null===(d=null==P||null===(p=P.gridlinesVisibilitySettings)||void 0===p?void 0:p.yLeft)||void 0===d||d,yRight:null===(m=null==P||null===(g=P.gridlinesVisibilitySettings)||void 0===g?void 0:g.yRight)||void 0===m||m},q=e=>{const t={...G,[e]:!G[e]};A({...P,gridlinesVisibilitySettings:t})},$={x:null!==(b=null==P||null===(h=P.labelsOrientation)||void 0===h?void 0:h.x)&&void 0!==b?b:0,yLeft:null!==(x=null==P||null===(v=P.labelsOrientation)||void 0===v?void 0:v.yLeft)&&void 0!==x?x:0,yRight:null!==(O=null==P||null===(k=P.labelsOrientation)||void 0===k?void 0:k.yRight)&&void 0!==O?O:0},W=(e,t)=>{const a={...$,[e]:t};A({...P,labelsOrientation:a})},U=Object(l.useMemo)((()=>{var e,t,a,n,i,l;return{x:null===(e=null==P||null===(t=P.axisTitlesVisibilitySettings)||void 0===t?void 0:t.x)||void 0===e||e,yLeft:null===(a=null==P||null===(n=P.axisTitlesVisibilitySettings)||void 0===n?void 0:n.yLeft)||void 0===a||a,yRight:null===(i=null==P||null===(l=P.axisTitlesVisibilitySettings)||void 0===l?void 0:l.yRight)||void 0===i||i}}),[null==P||null===(I=P.axisTitlesVisibilitySettings)||void 0===I?void 0:I.x,null==P||null===(T=P.axisTitlesVisibilitySettings)||void 0===T?void 0:T.yLeft,null==P||null===(M=P.axisTitlesVisibilitySettings)||void 0===M?void 0:M.yRight]),Y=Object(l.useCallback)((({title:e,visible:t},a)=>A({...P,[Sa[a]]:e,axisTitlesVisibilitySettings:{...U,[a]:t}})),[U,A,P]),X=N.every((t=>!t.xAccessor||"ordinal"!==va(e.frame.datasourceLayers[t.layerId].getOperationForColumnId(t.xAccessor),pe.ScaleType.Linear))),K=N.every((t=>t.xAccessor&&"time"===va(e.frame.datasourceLayers[t.layerId].getOperationForColumnId(t.xAccessor),pe.ScaleType.Linear)))?e=>{A({...P,hideEndzones:!e})}:void 0,Z=null==P||!P.legend.isVisible||null!=P&&P.legend.showSingleSeries?null!=P&&P.legend.isVisible?"show":"hide":"auto",Q=Boolean(null===(F=B.find((e=>"left"===e.groupId)))||void 0===F||null===(w=F.series)||void 0===w?void 0:w.some((e=>{var t;const a=null===(t=N.find((t=>t.layerId===e.layer)))||void 0===t?void 0:t.seriesType;return(null==a?void 0:a.includes("bar"))||(null==a?void 0:a.includes("area"))}))),J=Object(l.useCallback)((e=>{A({...P,yLeftExtent:e})}),[A,P]),ee=Boolean(null===(C=B.find((e=>"right"===e.groupId)))||void 0===C||null===(S=C.series)||void 0===S?void 0:S.some((e=>{var t;const a=null===(t=N.find((t=>t.layerId===e.layer)))||void 0===t?void 0:t.seriesType;return(null==a?void 0:a.includes("bar"))||(null==a?void 0:a.includes("area"))}))),te=Object(l.useCallback)((e=>{A({...P,yRightExtent:e})}),[A,P]),ae=N.filter((e=>e.seriesType.includes("bar"))),ne=ae.length>1||ae.some((e=>e.accessors.length>1||e.splitAccessor)),ie=N.some((({xAccessor:t,layerId:a,seriesType:n,splitAccessor:i})=>{if(!t)return!1;const l=e.frame.datasourceLayers[a].getOperationForColumnId(t);return va(l,pe.ScaleType.Linear)===pe.ScaleType.Time&&(null==l?void 0:l.isBucketed)&&(n.includes("stacked")||!i)&&(n.includes("stacked")||!n.includes("bar")||!ne)})),le=ke(P,e.frame.datasourceLayers).truncateText,se=P.legend.legendSize,[re]=Object(l.useState)((()=>se===_.LegendSize.AUTO));return Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(y.jsx)(Wt,{state:P,setState:A,datasourceLayers:L.datasourceLayers}),Object(y.jsx)(j.c,{legendOptions:Ca,mode:Z,location:null!=P&&P.legend.isInside?"inside":"outside",onLocationChange:e=>{A({...P,legend:{...P.legend,isInside:"inside"===e}})},onDisplayChange:e=>{const t=Ca.find((({id:t})=>t===e)).value;"auto"===t?A({...P,legend:{...P.legend,isVisible:!0,showSingleSeries:!1}}):"show"===t?A({...P,legend:{...P.legend,isVisible:!0,showSingleSeries:!0}}):"hide"===t&&A({...P,legend:{...P.legend,isVisible:!1,showSingleSeries:!1}})},position:null==P?void 0:P.legend.position,horizontalAlignment:null==P?void 0:P.legend.horizontalAlignment,verticalAlignment:null==P?void 0:P.legend.verticalAlignment,floatingColumns:null==P?void 0:P.legend.floatingColumns,onFloatingColumnsChange:e=>{A({...P,legend:{...P.legend,floatingColumns:e}})},maxLines:null==P?void 0:P.legend.maxLines,onMaxLinesChange:e=>{A({...P,legend:{...P.legend,maxLines:e}})},shouldTruncate:null!==(E=null==P?void 0:P.legend.shouldTruncate)&&void 0!==E?E:le,onTruncateLegendChange:()=>{var e;const t=null!==(e=null==P?void 0:P.legend.shouldTruncate)&&void 0!==e?e:le;A({...P,legend:{...P.legend,shouldTruncate:!t}})},onPositionChange:e=>{A({...P,legend:{...P.legend,position:e}})},onAlignmentChange:e=>{const[t,a]=e.split("_"),n=t,i=a;A({...P,legend:{...P.legend,verticalAlignment:n,horizontalAlignment:i}})},renderValueInLegendSwitch:X,valueInLegend:null==P?void 0:P.valuesInLegend,onValueInLegendChange:()=>{A({...P,valuesInLegend:!P.valuesInLegend})},legendSize:se,onLegendSizeChange:e=>{A({...P,legend:{...P.legend,legendSize:e}})},showAutoLegendSizeOption:re}))),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(y.jsx)(j.i,{tooltipContent:z?u.i18n.translate("xpack.lens.xyChart.bottomAxisDisabledHelpText",{defaultMessage:"This setting only applies when bottom axis is enabled."}):u.i18n.translate("xpack.lens.xyChart.leftAxisDisabledHelpText",{defaultMessage:"This setting only applies when left axis is enabled."}),condition:0===Object.keys(B.find((e=>"left"===e.groupId))||{}).length},Object(y.jsx)(Vt,{axis:"yLeft",layers:null==P?void 0:P.layers,axisTitle:null==P?void 0:P.yTitle,updateTitleState:Y,areTickLabelsVisible:R.yLeft,toggleTickLabelsVisibility:H,areGridlinesVisible:G.yLeft,toggleGridlinesVisibility:q,isDisabled:0===Object.keys(B.find((e=>"left"===e.groupId))||{}).length,orientation:$.yLeft,setOrientation:W,isAxisTitleVisible:U.yLeft,extent:(null==P?void 0:P.yLeftExtent)||{mode:"full"},setExtent:J,hasBarOrAreaOnAxis:Q,dataBounds:V.left,hasPercentageAxis:_a(B,"left",P),scale:null==P?void 0:P.yLeftScale,setScale:e=>{A({...P,yLeftScale:e})}})),Object(y.jsx)(Vt,{axis:"x",layers:null==P?void 0:P.layers,axisTitle:null==P?void 0:P.xTitle,updateTitleState:Y,areTickLabelsVisible:R.x,toggleTickLabelsVisibility:H,areGridlinesVisible:G.x,toggleGridlinesVisibility:q,orientation:$.x,setOrientation:W,isAxisTitleVisible:U.x,endzonesVisible:!(null!=P&&P.hideEndzones),setEndzoneVisibility:K,hasBarOrAreaOnAxis:!1,hasPercentageAxis:!1,useMultilayerTimeAxis:ie&&!D&&!z}),Object(y.jsx)(j.i,{tooltipContent:z?u.i18n.translate("xpack.lens.xyChart.topAxisDisabledHelpText",{defaultMessage:"This setting only applies when top axis is enabled."}):u.i18n.translate("xpack.lens.xyChart.rightAxisDisabledHelpText",{defaultMessage:"This setting only applies when right axis is enabled."}),condition:0===Object.keys(B.find((e=>"right"===e.groupId))||{}).length},Object(y.jsx)(Vt,{axis:"yRight",layers:null==P?void 0:P.layers,axisTitle:null==P?void 0:P.yRightTitle,updateTitleState:Y,areTickLabelsVisible:R.yRight,toggleTickLabelsVisibility:H,areGridlinesVisible:G.yRight,toggleGridlinesVisibility:q,isDisabled:0===Object.keys(B.find((e=>"right"===e.groupId))||{}).length,orientation:$.yRight,setOrientation:W,hasPercentageAxis:_a(B,"right",P),isAxisTitleVisible:U.yRight,extent:(null==P?void 0:P.yRightExtent)||{mode:"full"},setExtent:te,hasBarOrAreaOnAxis:ee,dataBounds:V.right,scale:null==P?void 0:P.yRightScale,setScale:e=>{A({...P,yRightScale:e})}})))))}));var Pa=a(105),Aa=a.n(Pa);const La={auto:u.i18n.translate("xpack.lens.configPanel.color.tooltip.auto",{defaultMessage:"Lens automatically picks colors for you unless you specify a custom color."}),custom:u.i18n.translate("xpack.lens.configPanel.color.tooltip.custom",{defaultMessage:"Clear the custom color to return to Auto mode."}),disabled:u.i18n.translate("xpack.lens.configPanel.color.tooltip.disabled",{defaultMessage:"Individual series cannot be custom colored when the layer includes a Break down by."})};const Da=e=>{var t,a;return e&&((a=e)&&""!==a&&/^#/.test(a)&&function(e){try{return Aa()(e),!0}catch(e){return!1}}(a))&&(null===(t=Aa()(e))||void 0===t?void 0:t.alpha())||1},Na=({label:e,disableHelpTooltip:t,disabled:a,setConfig:n,defaultColor:i,overwriteColor:r,showAlpha:o})=>{const[c,d]=Object(l.useState)(r||i),[p,m]=Object(l.useState)(r||i),[g,b]=Object(l.useState)(Da(c)),h=Object(l.useRef)(!1);Object(l.useEffect)((()=>{h.current||r&&p&&r.toUpperCase()!==p.toUpperCase()&&(d(r),m(r.toUpperCase()),b(Da(r))),h.current=!1}),[p,r,i]);const x=null!=e?e:u.i18n.translate("xpack.lens.xyChart.seriesColor.label",{defaultMessage:"Series color"}),v=Object(y.jsx)(f.EuiColorPicker,{fullWidth:!0,"data-test-subj":"indexPattern-dimension-colorPicker",compressed:!0,isClearable:Boolean(r),onChange:(e,t)=>{d(e),h.current=!0,t.isValid&&(m(t.hex.toUpperCase()),b(Da(t.hex)),n({color:t.hex})),""===e&&n({color:void 0})},color:a?"":c,disabled:a,placeholder:(null==i?void 0:i.toUpperCase())||u.i18n.translate("xpack.lens.xyChart.seriesColor.auto",{defaultMessage:"Auto"}),"aria-label":x,showAlpha:o,swatches:1===g?Object(f.euiPaletteColorBlind)():Object(f.euiPaletteColorBlind)().map((e=>Aa()(e).alpha(g).hex()))});return Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:Object(y.jsx)(j.i,{delay:"long",position:"top",tooltipContent:c&&!a?La.custom:La.auto,condition:!t},Object(y.jsx)("span",null,x,!t&&Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"}))))},a?Object(y.jsx)(f.EuiToolTip,{position:"top",content:La.disabled,delay:"long",anchorClassName:"eui-displayBlock"},v):v)},za=u.i18n.translate("xpack.lens.xyChart.markerPosition.above",{defaultMessage:"Top"}),Ba=u.i18n.translate("xpack.lens.xyChart.markerPosition.below",{defaultMessage:"Bottom"}),Va=u.i18n.translate("xpack.lens.xyChart.markerPosition.left",{defaultMessage:"Left"}),Ra=u.i18n.translate("xpack.lens.xyChart.markerPosition.right",{defaultMessage:"Right"});function Ha({isHorizontal:e,axisMode:t}){const a={id:`${pn}auto`,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsXY_markerPosition_auto"};return"bottom"===t?[{id:`${pn}below`,label:e?Va:Ba,"data-test-subj":"lnsXY_markerPosition_below"},a,{id:`${pn}above`,label:e?Ra:za,"data-test-subj":"lnsXY_markerPosition_above"}]:[{id:`${pn}left`,label:e?Ba:Va,"data-test-subj":"lnsXY_markerPosition_left"},a,{id:`${pn}right`,label:e?za:Ra,"data-test-subj":"lnsXY_markerPosition_right"}]}function Ga({currentConfig:e,setConfig:t,customIconSet:a}){return Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.lineMarker.textVisibility",{defaultMessage:"Text decoration"}),display:"columnCompressed",fullWidth:!0},Object(y.jsx)(f.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.lineMarker.textVisibility",{defaultMessage:"Text decoration"}),"data-test-subj":"lns-lineMarker-text-visibility",name:"textVisibilityStyle",buttonSize:"compressed",options:[{id:`${pn}none`,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.textVisibility.none",{defaultMessage:"None"}),"data-test-subj":"lnsXY_textVisibility_none"},{id:`${pn}name`,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.textVisibility.name",{defaultMessage:"Name"}),"data-test-subj":"lnsXY_textVisibility_name"}],idSelected:`${pn}${Boolean(null==e?void 0:e.textVisibility)?"name":"none"}`,onChange:e=>{t({textVisibility:e===`${pn}name`})},isFullWidth:!0}))}function qa({currentConfig:e,setConfig:t,customIconSet:a,defaultIcon:n="empty"}){return Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.icon",{defaultMessage:"Icon decoration"})},Object(y.jsx)(Xt,{defaultIcon:n,customIconSet:a,value:null==e?void 0:e.icon,onChange:e=>{t({icon:e})}}))}function $a({currentConfig:e,setConfig:t,isHorizontal:a}){return Object(y.jsx)(s.a.Fragment,null,Ut(null==e?void 0:e.icon)||null!=e&&e.textVisibility?Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,isDisabled:!(Ut(null==e?void 0:e.icon)||null!=e&&e.textVisibility),label:u.i18n.translate("xpack.lens.xyChart.lineMarker.position",{defaultMessage:"Decoration position"})},Object(y.jsx)(j.i,{tooltipContent:u.i18n.translate("xpack.lens.lineMarker.positionRequirementTooltip",{defaultMessage:"You must select an icon or show the name in order to alter its position"}),condition:!(Ut(null==e?void 0:e.icon)||null!=e&&e.textVisibility),position:"top",delay:"regular",display:"block"},Object(y.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.lineMarker.position",{defaultMessage:"Decoration position"}),"data-test-subj":"lnsXY_markerPosition",name:"markerPosition",isDisabled:!(Ut(null==e?void 0:e.icon)||null!=e&&e.textVisibility),buttonSize:"compressed",options:Ha({isHorizontal:a,axisMode:e.axisMode}),idSelected:`${pn}${(null==e?void 0:e.iconPosition)||"auto"}`,onChange:e=>{const a=e.replace(pn,"");t({iconPosition:a})}}))):null)}const Wa=({currentConfig:e,setConfig:t,isHorizontal:a})=>Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.lineStyle.label",{defaultMessage:"Line"})},Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"s",justifyContent:"spaceBetween",responsive:!1},Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(Ya,{value:(null==e?void 0:e.lineWidth)||1,onChange:e=>{t({lineWidth:e})}})),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.xyChart.lineStyle.label",{defaultMessage:"Line"}),"data-test-subj":"lnsXY_line_style",name:"lineStyle",buttonSize:"compressed",options:[{id:`${pn}solid`,label:u.i18n.translate("xpack.lens.xyChart.lineStyle.solid",{defaultMessage:"Solid"}),"data-test-subj":"lnsXY_line_style_solid",iconType:"lineSolid"},{id:`${pn}dashed`,label:u.i18n.translate("xpack.lens.xyChart.lineStyle.dashed",{defaultMessage:"Dashed"}),"data-test-subj":"lnsXY_line_style_dashed",iconType:"lineDashed"},{id:`${pn}dotted`,label:u.i18n.translate("xpack.lens.xyChart.lineStyle.dotted",{defaultMessage:"Dotted"}),"data-test-subj":"lnsXY_line_style_dotted",iconType:"lineDotted"}],idSelected:`${pn}${(null==e?void 0:e.lineStyle)||"solid"}`,onChange:e=>{const a=e.replace(pn,"");t({lineStyle:a})},isIconOnly:!0})))));function Ua(e,t,a,n){return""===e?t:Math.max(1,Math.min(e,10))}const Ya=({value:e,onChange:t})=>{const[a,n]=Object(l.useState)(String(e));return Object(y.jsx)(f.EuiFieldNumber,{"data-test-subj":"lnsXYThickness",value:a,fullWidth:!0,min:1,max:10,step:1,append:"px",compressed:!0,onChange:({currentTarget:{value:e}})=>{n(e);const a=""===e?"":Number(e),i=Ua(Number(e),Number(e));a===i&&t(i)},onBlur:()=>{if(a!==String(e)){const i=Ua(""===a?a:Number(a),e);t(i),n(String(i))}}})},Xa=[{value:"empty",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.noIconLabel",{defaultMessage:"None"})},{value:"asterisk",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.asteriskIconLabel",{defaultMessage:"Asterisk"})},{value:"bell",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bellIconLabel",{defaultMessage:"Bell"})},{value:"bolt",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.boltIconLabel",{defaultMessage:"Bolt"})},{value:"bug",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bugIconLabel",{defaultMessage:"Bug"})},{value:"editorComment",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.commentIconLabel",{defaultMessage:"Comment"})},{value:"alert",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.alertIconLabel",{defaultMessage:"Alert"})},{value:"flag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.flagIconLabel",{defaultMessage:"Flag"})},{value:"tag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.tagIconLabel",{defaultMessage:"Tag"})}],Ka=e=>{var t;const{state:a,setState:n,layerId:r,accessor:o}=e,c=xt(a.layers),d=a.layers.findIndex((e=>e.layerId===r)),{inputValue:p,handleInputChange:m}=Object(j.p)({value:a,onChange:n}),g=p.layers.find((e=>e.layerId===r)),f=null==g||null===(t=g.yConfig)||void 0===t?void 0:t.find((e=>e.forAccessor===o)),b=Object(l.useCallback)((e=>{if(null==e)return;const t=[...g.yConfig||[]],a=t.findIndex((e=>e.forAccessor===o));-1!==a?t[a]={...t[a],...e}:t.push({forAccessor:o,...e}),m(wa(p,{...g,yConfig:t},d))}),[o,d,p,g,m]);return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(Ga,{setConfig:b,currentConfig:f}),Object(y.jsx)(qa,{setConfig:b,currentConfig:f,customIconSet:Xa}),Object(y.jsx)($a,{isHorizontal:c,setConfig:b,currentConfig:f}),Object(y.jsx)(Wa,{isHorizontal:c,setConfig:b,currentConfig:f}),Object(y.jsx)(Qa,{isHorizontal:c,setConfig:b,currentConfig:f}),Object(y.jsx)(Na,i()({},e,{overwriteColor:null==f?void 0:f.color,defaultColor:ma,setConfig:b,disableHelpTooltip:!0,label:u.i18n.translate("xpack.lens.xyChart.lineColor.label",{defaultMessage:"Color"})})))};function Za({isHorizontal:e,axisMode:t}){const a=u.i18n.translate("xpack.lens.xyChart.fill.above",{defaultMessage:"Above"}),n=u.i18n.translate("xpack.lens.xyChart.fill.below",{defaultMessage:"Below"}),i=u.i18n.translate("xpack.lens.xyChart.fill.before",{defaultMessage:"Before"}),l=u.i18n.translate("xpack.lens.xyChart.fill.after",{defaultMessage:"After"}),s="bottom"===t||e?l:a,r="bottom"===t||e?i:n;return[{id:`${pn}none`,label:u.i18n.translate("xpack.lens.xyChart.fill.none",{defaultMessage:"None"}),"data-test-subj":"lnsXY_fill_none"},{id:`${pn}above`,label:s,"data-test-subj":"lnsXY_fill_above"},{id:`${pn}below`,label:r,"data-test-subj":"lnsXY_fill_below"}]}const Qa=({currentConfig:e,setConfig:t,isHorizontal:a})=>Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.fill.label",{defaultMessage:"Fill"})},Object(y.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.fill.label",{defaultMessage:"Fill"}),"data-test-subj":"lnsXY_fill",name:"fill",buttonSize:"compressed",options:Za({isHorizontal:a,axisMode:null==e?void 0:e.axisMode}),idSelected:`${pn}${(null==e?void 0:e.fill)||"none"}`,onChange:e=>{const a=e.replace(pn,"");t({fill:a})}}));a(225);var Ja=a(12),en=a(135),tn=a.n(en);const an=[{value:"asterisk",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.asteriskIconLabel",{defaultMessage:"Asterisk"})},{value:"alert",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.alertIconLabel",{defaultMessage:"Alert"})},{value:"bell",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bellIconLabel",{defaultMessage:"Bell"})},{value:"bolt",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.boltIconLabel",{defaultMessage:"Bolt"})},{value:"bug",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bugIconLabel",{defaultMessage:"Bug"})},{value:"circle",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.circleIconLabel",{defaultMessage:"Circle"}),icon:({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t},e):null,Object(y.jsx)("circle",{strokeWidth:"1",stroke:"currentColor",cx:"8",cy:"8",className:x()("lensAnnotationIconNoFill",a.className),r:"7"})),canFill:!0},{value:"editorComment",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.commentIconLabel",{defaultMessage:"Comment"})},{value:"flag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.flagIconLabel",{defaultMessage:"Flag"})},{value:"heart",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.heartLabel",{defaultMessage:"Heart"})},{value:"mapMarker",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.mapMarkerLabel",{defaultMessage:"Map Marker"})},{value:"pinFilled",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.mapPinLabel",{defaultMessage:"Map Pin"})},{value:"starEmpty",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.starLabel",{defaultMessage:"Star"})},{value:"tag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.tagIconLabel",{defaultMessage:"Tag"})},{value:"triangle",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.triangleIconLabel",{defaultMessage:"Triangle"}),icon:({title:e,titleId:t,...a})=>Object(y.jsx)("svg",i()({width:"16",height:"16",fill:"none",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(y.jsx)("title",{id:t},e):null,Object(y.jsx)("path",{strokeWidth:"1",stroke:"currentColor",d:"M 6.9 11.612 C 7.64533 12.7953 8.39067 12.7953 9.136 11.612 L 13.11 5.3 C 13.8553 4.11667 13.4827 3.525 11.992 3.525 L 4.044 3.525 C 2.55333 3.525 2.18067 4.11667 2.926 5.3 Z",className:x()("lensAnnotationIconNoFill",a.className)})),shouldRotate:!0,canFill:!0}],nn=(e=Kt.defaultAnnotationColor)=>new tn.a(Object(f.transparentize)(e,.1)).hexa(),ln=(e=Kt.defaultAnnotationRangeColor)=>new tn.a(Object(f.transparentize)(e,1)).hex(),sn=(e,{activeData:t,dateRange:a},n)=>{var i;const l=Qt()(e).valueOf(),s=.1*(Qt()(a.toDate).valueOf()-Qt()(a.fromDate).valueOf()),r=Qt()(l+s).toISOString(),o=n.map((({layerId:e})=>e));if(!o.length||!t||Object.entries(t).filter((([e])=>o.includes(e))).every((([,{rows:e}])=>!e||!e.length)))return r;const u=null==t?void 0:t[o[0]].columns.find((e=>e.id===n[0].xAccessor));if(!u)return r;const c=null===(i=Ja.search.aggs.getDateHistogramMetaDataByDatatableColumn(u))||void 0===i?void 0:i.interval;if(!c)return r;const d=Ja.search.aggs.parseInterval(c);return d?Qt()(l+3*d.as("milliseconds")).toISOString():r},rn=e=>{var t;const{state:a,setState:n,layerId:r,accessor:o,frame:c}=e,d=xt(a.layers),{inputValue:p,handleInputChange:m}=Object(j.p)({value:a,onChange:n}),g=p.layers.findIndex((e=>e.layerId===r)),b=p.layers.find((e=>e.layerId===r)),h=null===(t=b.annotations)||void 0===t?void 0:t.find((e=>e.id===o)),x=Object(Kt.isRangeAnnotation)(h),v=Object(l.useCallback)((e=>{if(null==e)return;const t=[...b.annotations||[]],a=t.findIndex((e=>e.id===o));if(-1===a)throw new Error("should never happen because annotation is created before config panel is opened");t[a]=(e=>Object(Kt.isRangeAnnotation)(e)?Object(Se.pick)(e,["label","key","id","isHidden","color","outside"]):Object(Se.pick)(e,["id","label","key","isHidden","lineStyle","lineWidth","color","icon","textVisibility"]))({...t[a],...e}),m(wa(p,{...b,annotations:t},g))}),[o,g,p,b,m]);return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(j.b,{title:u.i18n.translate("xpack.lens.xyChart.placement",{defaultMessage:"Placement"})},x?Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(un,{dataTestSubj:"lns-xyAnnotation-fromTime",prependLabel:u.i18n.translate("xpack.lens.xyChart.annotationDate.from",{defaultMessage:"From"}),value:Qt()(null==h?void 0:h.key.timestamp),onChange:e=>{if(e){const t=Qt()(null==h?void 0:h.key.endTimestamp).valueOf();if(t<e.valueOf()){const a=t-Qt()(null==h?void 0:h.key.timestamp).valueOf();v({key:{...(null==h?void 0:h.key)||{type:"range"},timestamp:e.toISOString(),endTimestamp:Qt()(e.valueOf()+a).toISOString()}})}else v({key:{...(null==h?void 0:h.key)||{type:"range"},timestamp:e.toISOString()}})}},label:u.i18n.translate("xpack.lens.xyChart.annotationDate",{defaultMessage:"Annotation date"})}),Object(y.jsx)(un,{dataTestSubj:"lns-xyAnnotation-toTime",prependLabel:u.i18n.translate("xpack.lens.xyChart.annotationDate.to",{defaultMessage:"To"}),value:Qt()(null==h?void 0:h.key.endTimestamp),onChange:e=>{if(e){const t=Qt()(null==h?void 0:h.key.timestamp).valueOf();if(t>e.valueOf()){const a=Qt()(null==h?void 0:h.key.endTimestamp).valueOf()-t;v({key:{...(null==h?void 0:h.key)||{type:"range"},endTimestamp:e.toISOString(),timestamp:Qt()(e.valueOf()-a).toISOString()}})}else v({key:{...(null==h?void 0:h.key)||{type:"range"},endTimestamp:e.toISOString()}})}}})):Object(y.jsx)(un,{dataTestSubj:"lns-xyAnnotation-time",label:u.i18n.translate("xpack.lens.xyChart.annotationDate",{defaultMessage:"Annotation date"}),value:Qt()(null==h?void 0:h.key.timestamp),onChange:e=>{e&&v({key:{...(null==h?void 0:h.key)||{type:"point_in_time"},timestamp:e.toISOString()}})}}),Object(y.jsx)(on,{annotation:h,onChange:v,frame:c,state:a})),Object(y.jsx)(j.b,{title:u.i18n.translate("xpack.lens.xyChart.appearance",{defaultMessage:"Appearance"})},Object(y.jsx)(j.d,{value:(null==h?void 0:h.label)||ta,defaultValue:ta,onChange:e=>{v({label:e})}}),!x&&Object(y.jsx)(qa,{setConfig:v,defaultIcon:"triangle",currentConfig:{axisMode:"bottom",...h},customIconSet:an}),!x&&Object(y.jsx)(Ga,{setConfig:v,currentConfig:{axisMode:"bottom",...h}}),!x&&Object(y.jsx)(Wa,{isHorizontal:d,setConfig:v,currentConfig:h}),x&&Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.xyChart.fillStyle",{defaultMessage:"Fill"}),display:"columnCompressed",fullWidth:!0},Object(y.jsx)(f.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.xyChart.fillStyle",{defaultMessage:"Fill"}),"data-test-subj":"lns-xyAnnotation-fillStyle",name:"fillStyle",buttonSize:"compressed",options:[{id:"lens_xyChart_fillStyle_inside",label:u.i18n.translate("xpack.lens.xyChart.fillStyle.inside",{defaultMessage:"Inside"}),"data-test-subj":"lnsXY_fillStyle_inside"},{id:"lens_xyChart_fillStyle_outside",label:u.i18n.translate("xpack.lens.xyChart.fillStyle.outside",{defaultMessage:"Outside"}),"data-test-subj":"lnsXY_fillStyle_inside"}],idSelected:"lens_xyChart_fillStyle_"+(Boolean(null==h?void 0:h.outside)?"outside":"inside"),onChange:e=>{v({outside:"lens_xyChart_fillStyle_outside"===e})},isFullWidth:!0})),Object(y.jsx)(Na,i()({},e,{overwriteColor:null==h?void 0:h.color,defaultColor:x?Kt.defaultAnnotationRangeColor:Kt.defaultAnnotationColor,showAlpha:x,setConfig:v,disableHelpTooltip:!0,label:u.i18n.translate("xpack.lens.xyChart.lineColor.label",{defaultMessage:"Color"})})),Object(y.jsx)(cn,{value:Boolean(null==h?void 0:h.isHidden),onChange:e=>v({isHidden:e.target.checked})})))},on=({annotation:e,onChange:t,frame:a,state:n})=>{const i=Object(Kt.isRangeAnnotation)(e);return Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",className:"lnsRowCompressedMargin"},Object(y.jsx)(f.EuiSwitch,{"data-test-subj":"lns-xyAnnotation-rangeSwitch",label:Object(y.jsx)(f.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.xyChart.applyAsRange",{defaultMessage:"Apply as range"})),checked:i,onChange:()=>{if(i){const a={key:{type:"point_in_time",timestamp:e.key.timestamp},id:e.id,label:e.label===aa?ta:e.label,color:ln(e.color),isHidden:e.isHidden};t(a)}else if(e){const i=Qt()(null==e?void 0:e.key.timestamp),l=Je(n.layers),s={key:{type:"range",timestamp:e.key.timestamp,endTimestamp:sn(i.toISOString(),a,l)},id:e.id,label:e.label===ta?aa:e.label,color:nn(e.color),isHidden:e.isHidden};t(s)}},compressed:!0}))},un=({value:e,label:t,prependLabel:a,onChange:n,dataTestSubj:i="lnsXY_annotation_date_picker"})=>Object(y.jsx)(f.EuiFormRow,{display:"rowCompressed",fullWidth:!0,label:t,className:"lnsRowCompressedMargin"},a?Object(y.jsx)(f.EuiFormControlLayout,{fullWidth:!0,className:"lnsConfigPanelNoPadding",prepend:Object(y.jsx)(f.EuiFormLabel,{className:"lnsConfigPanelDate__label"},a)},Object(y.jsx)(f.EuiDatePicker,{fullWidth:!0,showTimeSelect:!0,selected:e,onChange:n,dateFormat:"MMM D, YYYY @ HH:mm:ss.SSS","data-test-subj":i})):Object(y.jsx)(f.EuiDatePicker,{fullWidth:!0,showTimeSelect:!0,selected:e,onChange:n,dateFormat:"MMM D, YYYY @ HH:mm:ss.SSS","data-test-subj":i})),cn=({value:e,onChange:t})=>Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.xyChart.annotation.name",{defaultMessage:"Hide annotation"}),display:"columnCompressedSwitch",fullWidth:!0},Object(y.jsx)(f.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.xyChart.annotation.name",{defaultMessage:"Hide annotation"}),showLabel:!1,"data-test-subj":"lns-annotations-hide-annotation",checked:e,onChange:t}));function dn(e,t,a){const n=[...e.layers];return n[a]=t,{...e,layers:n}}const pn=Object(f.htmlIdGenerator)()();function mn(e){const{state:t,layerId:a}=e,n=t.layers.findIndex((e=>e.layerId===a)),i=t.layers[n];return at(i)?Object(y.jsx)(rn,e):et(i)?Object(y.jsx)(Ka,e):Object(y.jsx)(gn,e)}function gn(e){var t;const{state:a,setState:n,layerId:r,accessor:o}=e,c=a.layers.findIndex((e=>e.layerId===r)),d=a.layers[c],{inputValue:p,handleInputChange:m}=Object(j.p)({value:e.state,onChange:e.setState}),g=null==d||null===(t=d.yConfig)||void 0===t?void 0:t.find((e=>e.forAccessor===o)),b=(null==g?void 0:g.axisMode)||"auto",h=Object(l.useCallback)((e=>{if(null==e)return;const t=[...d.yConfig||[]],a=t.findIndex((e=>e.forAccessor===o));-1!==a?t[a]={...t[a],...e}:t.push({forAccessor:o,...e}),m(dn(p,{...d,yConfig:t},c))}),[o,c,p,d,m]),x=((e,t)=>{var a,n,i,l;return at(e)?(null==e||null===(i=e.annotations)||void 0===i||null===(l=i.find((e=>e.id===t)))||void 0===l?void 0:l.color)||null:Qe(e)&&e.splitAccessor?null:(null==e||null===(a=e.yConfig)||void 0===a||null===(n=a.find((e=>e.forAccessor===t)))||void 0===n?void 0:n.color)||null})(d,o),v=Object(l.useMemo)((()=>{var t,n;const i=ha(null!==(t=e.frame.datasourceLayers[d.layerId])&&void 0!==t?t:d.accessors,d),l=ga(Je(a.layers),{tables:null!==(n=e.frame.activeData)&&void 0!==n?n:{}},e.formatFactory);return ba({...d,accessors:i.filter((e=>d.accessors.includes(e)))},o,l,e.frame,e.paletteService).color}),[e.frame,e.paletteService,a.layers,o,e.formatFactory,d]),O=d;if("breakdown"===e.groupId)return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(E,{value:d.collapseFn||"",onChange:e=>{m(dn(p,{...d,collapseFn:e},c))}}),Object(y.jsx)(j.f,{palettes:e.paletteService,activePalette:null==O?void 0:O.palette,setPalette:e=>{n(dn(p,{...O,palette:e},c))}}));const k=xt(a.layers);return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(Na,i()({},e,{overwriteColor:x,defaultColor:v,disabled:Boolean(!O.collapseFn&&O.splitAccessor),setConfig:h})),Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.axisSide.label",{defaultMessage:"Axis side"})},Object(y.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.axisSide.label",{defaultMessage:"Axis side"}),"data-test-subj":"lnsXY_axisSide_groups",name:"axisSide",buttonSize:"compressed",options:[{id:`${pn}left`,label:k?u.i18n.translate("xpack.lens.xyChart.axisSide.bottom",{defaultMessage:"Bottom"}):u.i18n.translate("xpack.lens.xyChart.axisSide.left",{defaultMessage:"Left"}),"data-test-subj":"lnsXY_axisSide_groups_left"},{id:`${pn}auto`,label:u.i18n.translate("xpack.lens.xyChart.axisSide.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsXY_axisSide_groups_auto"},{id:`${pn}right`,label:k?u.i18n.translate("xpack.lens.xyChart.axisSide.top",{defaultMessage:"Top"}):u.i18n.translate("xpack.lens.xyChart.axisSide.right",{defaultMessage:"Right"}),"data-test-subj":"lnsXY_axisSide_groups_right"}],idSelected:`${pn}${b}`,onChange:e=>{const t=e.replace(pn,"");h({axisMode:t})}})))}var fn=a(70);function bn(e){const t=e.state.layers.find((t=>t.layerId===e.layerId));return t?et(t)?Object(y.jsx)(hn,null):at(t)?Object(y.jsx)(xn,null):Object(y.jsx)(yn,e):null}function hn(){return Object(y.jsx)(j.g,{icon:ra,label:u.i18n.translate("xpack.lens.xyChart.layerReferenceLineLabel",{defaultMessage:"Reference lines"})})}function xn(){return Object(y.jsx)(j.g,{icon:Jt,label:u.i18n.translate("xpack.lens.xyChart.layerAnnotationsLabel",{defaultMessage:"Annotations"})})}function yn(e){const[t,a]=Object(l.useState)(!1),{state:n,layerId:i}=e,r=n.layers.filter(Qe).find((e=>e.layerId===i)),o=n.layers.findIndex((e=>e===r)),c=$e.visualizationTypes.find((({id:e})=>e===r.seriesType)),d=xt(n.layers);return Object(y.jsx)(f.EuiPopover,{panelClassName:"lnsChangeIndexPatternPopover",button:Object(y.jsx)(vn,{onClick:()=>a(!t),currentVisType:c}),isOpen:t,closePopover:()=>a(!1),display:"block",panelPaddingSize:"s",ownFocus:!0},Object(y.jsx)(f.EuiPopoverTitle,null,u.i18n.translate("xpack.lens.layerPanel.layerVisualizationType",{defaultMessage:"Layer visualization type"})),Object(y.jsx)("div",null,Object(y.jsx)(f.EuiSelectable,{singleSelection:"always",options:$e.visualizationTypes.filter((e=>ht(e.id)===d)).map((e=>({value:e.id,key:e.id,checked:e.id===c.id?"on":void 0,prepend:Object(y.jsx)(f.EuiIcon,{type:e.icon}),label:e.fullLabel||e.label,"data-test-subj":`lnsXY_seriesType-${e.id}`}))),onChange:t=>{const i=t.find((({checked:e})=>"on"===e));if(!i)return;const l=i.value;Object(fn.e)("xy_change_layer_display"),e.setState(wa(n,{...r,seriesType:l},o)),a(!1)}},(e=>Object(y.jsx)(s.a.Fragment,null,e)))))}const vn=function({currentVisType:e,onClick:t}){return Object(y.jsx)(d.ToolbarButton,{"data-test-subj":"lns_layer_settings",title:e.fullLabel||e.label,onClick:t,fullWidth:!0,size:"s"},Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiIcon,{type:e.icon}),Object(y.jsx)(f.EuiText,{size:"s",className:"lnsLayerPanelChartSwitch_title"},e.fullLabel||e.label)))},jn=Object(y.jsx)("p",null,u.i18n.translate("xpack.lens.configure.invalidConfigTooltip",{defaultMessage:"Invalid configuration."}),Object(y.jsx)("br",null),u.i18n.translate("xpack.lens.configure.invalidConfigTooltipClick",{defaultMessage:"Click for more details."})),On=({id:e,label:t,isInvalid:a,hideTooltip:n,invalidMessage:i=jn})=>a?Object(y.jsx)(f.EuiToolTip,{content:n?null:i,anchorClassName:"eui-displayBlock"},Object(y.jsx)(f.EuiText,{size:"s",color:"danger",id:e,className:"lnsLayerPanel__triggerText","data-test-subj":"lns-dimensionTrigger"},Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiIcon,{size:"s",type:"alert"})),Object(y.jsx)(f.EuiFlexItem,{grow:!0},t)))):Object(y.jsx)(f.EuiText,{size:"s",id:e,className:"lnsLayerPanel__triggerText","data-test-subj":"lns-dimensionTrigger"},Object(y.jsx)(f.EuiFlexItem,{grow:!0},Object(y.jsx)("span",null,Object(y.jsx)("span",{className:"lnsLayerPanel__triggerTextLabel"},t)))),kn=({paletteService:e,fieldFormats:t,useLegacyTimeAxis:a,kibanaTheme:n,eventAnnotationService:l})=>({id:"lnsXY",visualizationTypes:$e.visualizationTypes,getVisualizationTypeId(e){const t=it(e);return"mixed"===t?t:t.id},getLayerIds:e=>pt(e).map((e=>e.layerId)),getRemoveOperation(e,t){const a=pt(e,D.o.DATA).map((e=>e.layerId));return a.includes(t)&&1===a.length?"clear":"remove"},removeLayer:(e,t)=>({...e,layers:e.layers.filter((e=>e.layerId!==t))}),appendLayer(e,t,a){var n,i;const l=null===(n=Je(e.layers))||void 0===n||null===(i=n[0])||void 0===i?void 0:i.seriesType;return{...e,layers:[...e.layers,dt({seriesType:l||e.preferredSeriesType,layerId:t,layerType:a})]}},clearLayer:(e,t)=>({...e,layers:e.layers.map((a=>a.layerId!==t?a:dt({seriesType:e.preferredSeriesType,layerId:t})))}),getDescription:lt,switchVisualizationType:(e,t)=>({...t,preferredSeriesType:e,layers:t.layers.map((t=>({...t,seriesType:e})))}),getSuggestions:Ot,triggers:[_.VIS_EVENT_TO_TRIGGER.filter,_.VIS_EVENT_TO_TRIGGER.brush],initialize:(e,t)=>t||{title:"Empty XY chart",legend:{isVisible:!0,position:pe.Position.Right},valueLabels:"hide",preferredSeriesType:rt,layers:[{layerId:e(),accessors:[],position:pe.Position.Top,seriesType:rt,showGridlines:!1,layerType:D.o.DATA}]},getLayerType(e,t){var a;return null==t||null===(a=t.layers.find((({layerId:t})=>t===e)))||void 0===a?void 0:a.layerType},getSupportedLayers:(e,t)=>[ot,ia(e,t),ca(e,t)],getConfiguration({state:a,frame:n,layerId:i}){var l,s;const r=a.layers.find((e=>e.layerId===i));if(!r)return{groups:[]};if(at(r))return(({state:e,frame:t,layer:a})=>{const n=Je(e.layers),i=Boolean(n.length&&n.every((e=>e.xAccessor&&Ze("interval","date",(null==t?void 0:t.datasourceLayers)||{})(e)))),l=Ke("x",{isHorizontal:xt(e.layers)}),s={buttonAriaLabel:u.i18n.translate("xpack.lens.indexPattern.addColumnAriaLabelClick",{defaultMessage:"Add an annotation to {groupLabel}",values:{groupLabel:l}}),buttonLabel:u.i18n.translate("xpack.lens.configure.emptyConfigClick",{defaultMessage:"Add an annotation"})};return{groups:[{groupId:"xAnnotations",groupLabel:l,accessors:la(a),dataTestSubj:"lnsXY_xAnnotationsPanel",invalid:!i,invalidMessage:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabelDisabledHelp",{defaultMessage:"Annotations require a time based chart to work. Add a date histogram."}),required:!1,requiresPreviousColumnOnDuplicate:!0,supportsMoreColumns:!0,supportFieldFormat:!1,enableDimensionEditor:!0,filterOperations:()=>!1,labels:s}]}})({state:a,frame:n,layer:r});const o=ha(n.datasourceLayers[r.layerId],r);if(et(r))return pa({state:a,frame:n,layer:r,sortedAccessors:o});const c=In({state:a,frame:n,layer:r,fieldFormats:t,paletteService:e,accessors:o});if(et(r))return pa({state:a,frame:n,layer:r,sortedAccessors:o});const d=r,p=Je(a.layers),m=xt(a.layers),{left:g,right:f}=Dt([r],n.activeData),b=Boolean(d.accessors.length<2||g.length&&g.length<2||f.length&&f.length<2)&&p.filter((e=>{if(Qe(e)&&e.seriesType===d.seriesType&&Boolean(e.xAccessor)===Boolean(d.xAccessor)&&Boolean(e.splitAccessor)===Boolean(d.splitAccessor)){const{left:t,right:a}=Dt([e],n.activeData);return e.accessors.length&&(Boolean(t.length)===Boolean(g.length)||Boolean(a.length)===Boolean(f.length))}return!1})).length<2;return{groups:[{groupId:"x",groupLabel:Ke("x",{isHorizontal:m}),accessors:d.xAccessor?[{columnId:d.xAccessor}]:[],filterOperations:bt,supportsMoreColumns:!d.xAccessor,dataTestSubj:"lnsXY_xDimensionPanel"},{groupId:"y",groupLabel:Ke("y",{isHorizontal:m}),accessors:c,filterOperations:ft,supportsMoreColumns:!0,required:!0,dataTestSubj:"lnsXY_yDimensionPanel",enableDimensionEditor:!0},{groupId:"breakdown",groupLabel:u.i18n.translate("xpack.lens.xyChart.splitSeries",{defaultMessage:"Break down by"}),accessors:d.splitAccessor?[{columnId:d.splitAccessor,triggerIcon:d.collapseFn?"aggregate":"colorBy",palette:d.collapseFn?void 0:e.get((null===(l=d.palette)||void 0===l?void 0:l.name)||"default").getCategoricalColors(10,null===(s=d.palette)||void 0===s?void 0:s.params)}]:[],filterOperations:bt,supportsMoreColumns:!d.splitAccessor,dataTestSubj:"lnsXY_splitDimensionPanel",required:d.seriesType.includes("percentage")&&b,enableDimensionEditor:!0}]}},getMainPalette:e=>{var t;if(e&&0!==e.layers.length)return null===(t=(e.layers||[]).find((e=>Qe(e))))||void 0===t?void 0:t.palette},setDimension(e){const{prevState:t,layerId:a,columnId:n,groupId:i}=e,l=t.layers.find((e=>e.layerId===a));if(!l)return t;if(et(l))return(({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i})=>{var l,s;const r=e.layers.find((e=>e.layerId===t));if(!r||!et(r))return e;const o={...r};o.accessors=[...o.accessors.filter((e=>e!==a)),a];const u=null===(l=o.yConfig)||void 0===l?void 0:l.some((({forAccessor:e})=>e===a)),c=!!i&&(null===(s=o.yConfig)||void 0===s?void 0:s.find((({forAccessor:e})=>e===i)));if(!u){const e="xReferenceLine"===n?"bottom":"yReferenceLineRight"===n?"right":"left";o.yConfig=[...o.yConfig||[],{...c,forAccessor:a,axisMode:e}]}return{...e,layers:e.layers.map((e=>e.layerId===t?o:e))}})(e);if(at(l))return(({prevState:e,layerId:t,columnId:a,previousColumn:n,frame:i})=>{const l=e.layers.find((e=>e.layerId===t));if(!l||!at(l))return e;const s=l.annotations,r=null==s?void 0:s.find((({id:e})=>e===a)),o=n?null==s?void 0:s.find((({id:e})=>e===n)):void 0;let u=[...s];if(r){if(r&&o){u=s.filter((e=>e.id!==o.id));const e=u.findIndex((e=>e.id===r.id)),t=s.indexOf(o),a=s.indexOf(r);u.splice(t<a?e+1:e,0,o)}}else u.push({label:ta,key:{type:"point_in_time",timestamp:na(Je(e.layers),i)},icon:"triangle",...o,id:a});return{...e,layers:e.layers.map((e=>e.layerId===t?{...l,annotations:u}:e))}})(e);const s=Object.assign({},l);return"x"===i&&(s.xAccessor=n),"y"===i&&(s.accessors=[...s.accessors.filter((e=>e!==n)),n]),"breakdown"===i&&(s.splitAccessor=n),{...t,layers:t.layers.map((e=>e.layerId===a?s:e))}},updateLayersConfigurationFromContext({prevState:e,layerId:t,context:a}){const{chartType:n,axisPosition:i,palette:l,metrics:s}=a,r=null==e?void 0:e.layers.find((e=>e.layerId===t));if(!r||!Qe(r))return e;const o=s.some((e=>"static_value"===e.agg)),u=i,c=s.map(((e,t)=>{var a;return{color:e.color,forAccessor:null!==(a=e.accessor)&&void 0!==a?a:r.accessors[t],...u&&{axisMode:u},...o&&{fill:"area"===n?"below":"none"}}})),d={...r,...n&&{seriesType:n},...l&&{palette:l},yConfig:c,layerType:o?D.o.REFERENCELINE:D.o.DATA},p=e.layers.map((e=>e.layerId===t?d:e));return{...e,layers:p}},getVisualizationSuggestionFromContext({suggestions:e,context:t}){var a,n;const i=[];let l={};const s=t.configuration.fill?Number(t.configuration.fill):void 0;for(let a=0;a<e.length;a++){const n=e[a],s=n.visualizationState.layers,r=t.layers.find((e=>e.layerId===Object.keys(n.datasourceState.layers)[0]));if(this.updateLayersConfigurationFromContext&&r){const e=this.updateLayersConfigurationFromContext({prevState:n.visualizationState,layerId:s[0].layerId,context:r});i.push(...e.layers),l={...l,...n.datasourceState.layers}}}let r=e[0];return r={...r,datasourceState:{...r.datasourceState,layers:{...r.datasourceState.layers,...l}},visualizationState:{...r.visualizationState,fillOpacity:s,yRightExtent:null===(a=t.configuration.extents)||void 0===a?void 0:a.yRightExtent,yLeftExtent:null===(n=t.configuration.extents)||void 0===n?void 0:n.yLeftExtent,legend:t.configuration.legend,gridlinesVisibilitySettings:t.configuration.gridLinesVisibility,valuesInLegend:!0,layers:i}},r},removeDimension({prevState:e,layerId:t,columnId:a,frame:n}){const i=e.layers.find((e=>e.layerId===t));if(!i)return e;if(at(i)){const n={...i};n.annotations=n.annotations.filter((({id:e})=>e!==a));const l=e.layers.map((e=>e.layerId===t?n:e));return{...e,layers:l}}const l={...i};var s;Qe(l)&&(l.xAccessor===a?delete l.xAccessor:l.splitAccessor===a&&(delete l.splitAccessor,delete l.palette)),l.accessors.includes(a)&&(l.accessors=l.accessors.filter((e=>e!==a))),"yConfig"in l&&(l.yConfig=null===(s=l.yConfig)||void 0===s?void 0:s.filter((({forAccessor:e})=>e!==a)));let r=e.layers.map((e=>e.layerId===t?l:e));const o=oa(Je(e.layers),n.datasourceLayers,n.activeData);return Object.keys(o).every((e=>!o[e]))&&(r=r.filter((e=>Qe(e)||"accessors"in e&&e.accessors.length))),{...e,layers:r}},renderLayerHeader(e,t){Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:n.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(bn,t))),e)},renderToolbar(e,t){Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:n.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(Ea,i()({},t,{useLegacyTimeAxis:a})))),e)},renderDimensionEditor(a,i){const l={...i,formatFactory:t.deserialize,paletteService:e},s=i.state.layers.find((e=>e.layerId===i.layerId)),o=et(s)?Object(y.jsx)(Ka,l):at(s)?Object(y.jsx)(rn,l):Object(y.jsx)(mn,l);Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:n.theme$},Object(y.jsx)(c.I18nProvider,null,o)),a)},toExpression:(t,a,n,i={})=>xa(t,a,e,n,i,l),toPreviewExpression:(t,a,n={})=>function(e,t,a,n,i){return xa({...e,layers:e.layers.map((e=>((e,t)=>Qe(e)?t[We.layerTypes.DATA](e):et(e)?t[We.layerTypes.REFERENCELINE](e):t[We.layerTypes.ANNOTATIONS](e))(e,ya))),legend:{...e.legend,isVisible:!1},valueLabels:"hide"},t,a,{},n,i)}(t,a,e,n,l),getErrorMessages(e,t){const a=({accessors:e})=>null==e||0===e.length,n=Je(e.layers),i=({splitAccessor:e,seriesType:t})=>t.includes("percentage")&&null==e,l=[];if(e&&e.layers.length>1){const e=[["Y",a],["Break down",i]],t=n.filter((({accessors:e,xAccessor:t,splitAccessor:a,layerType:n})=>e.length>0||null!=t||null!=a));for(const[a,n]of e){const e=mt(a,t,n);e.valid||l.push(e.payload)}}if(t&&e){l.push(...function(e,t){const a=Je(e.layers),n=[],i=a.some(Ze("interval","date",t)),l=a.some(Ze("interval","number",t)),s=a.some(Ze("ordinal",void 0,t));return e.layers.length>1&&i&&l&&n.push({shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:Ke("x",{isHorizontal:xt(e.layers)})}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXLong",{defaultMessage:"Data type mismatch for the {axis}. Cannot mix date and number interval types.",values:{axis:Ke("x",{isHorizontal:xt(e.layers)})}})}),e.layers.length>1&&(i||l)&&s&&n.push({shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:Ke("x",{isHorizontal:xt(e.layers)})}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXOrdinalLong",{defaultMessage:"Data type mismatch for the {axis}, use a different function.",values:{axis:Ke("x",{isHorizontal:xt(e.layers)})}})}),n}(e,t));for(const a of Je(e.layers)){const n=t[a.layerId];if(n)for(const t of a.accessors){const a=n.getOperationForColumnId(t);a&&"number"!==a.dataType&&l.push({shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureYShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:Ke("y",{isHorizontal:xt(e.layers)})}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureYLong",{defaultMessage:"The dimension {label} provided for the {axis} has the wrong data type. Expected number but have {dataType}",values:{label:a.label,dataType:a.dataType,axis:Ke("y",{isHorizontal:xt(e.layers)})}})})}}}return l.length?l:void 0},getWarningMessages(e,t){if(0===(null==e?void 0:e.layers.length)||!t.activeData)return;const a=[...Je(e.layers),...tt(e.layers)].filter((({accessors:e})=>e.length>0)),n=[];for(const e of a){var i;const{layerId:a,accessors:l}=e,s=(null===(i=t.activeData)||void 0===i?void 0:i[a])&&t.activeData[a].rows;if(!s)break;const r=vt(e,t.datasourceLayers[a]);for(const e of l)s.some((t=>Array.isArray(t[e])))&&n.push(r[e])}return n.map((e=>Object(y.jsx)(c.FormattedMessage,{key:e,id:"xpack.lens.xyVisualization.arrayValues",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(y.jsx)("strong",null,e)}})))},getUniqueLabels:e=>sa(e.layers),renderDimensionTrigger:({columnId:e,label:t,hideTooltip:a,invalid:n,invalidMessage:i})=>t?Object(y.jsx)(On,{id:e,hideTooltip:a,isInvalid:n,invalidMessage:i,label:t||ta}):null}),In=({accessors:e,frame:t,fieldFormats:a,paletteService:n,state:i,layer:l})=>{let s=e.map((e=>({columnId:e})));return t.activeData&&(s=function(e,t,a,n){if(et(a))return(e=>e.accessors.map((t=>{var a;const n=null===(a=e.yConfig)||void 0===a?void 0:a.find((e=>e.forAccessor===t));return da(t,null==n?void 0:n.color)})))(a);if(at(a))return la(a);const i=!a.collapseFn&&a.splitAccessor;return a.accessors.map((l=>{var s;if(i)return fa(l);const r=null===(s=a.yConfig)||void 0===s?void 0:s.find((e=>e.forAccessor===l));return null!=r&&r.color?{columnId:l,triggerIcon:"color",color:r.color}:ba(a,l,e,t,n)}))}(ga(Je(i.layers),{tables:t.activeData},a.deserialize),t,{...l,accessors:e.filter((e=>l.accessors.includes(e)))},n)),s};class xy_visualization_XyVisualization{setup(e,{editorFrame:t}){t.registerVisualization((async()=>{const{getXyVisualization:t}=await Promise.resolve().then(a.bind(null,463)),[,{charts:n,fieldFormats:i,eventAnnotation:l}]=await e.getStartServices();return t({paletteService:await n.palettes.getPalettes(),eventAnnotationService:await l.getService(),fieldFormats:i,useLegacyTimeAxis:e.uiSettings.get(q.LEGACY_TIME_AXIS),kibanaTheme:e.theme})}))}}var Tn=a(47);const Mn="temperature",Fn=u.i18n.translate("xpack.lens.heatmap.groupLabel",{defaultMessage:"Heatmap"}),wn="heatmap",Cn={heatmap:{shapeType:wn,icon:Tn.HeatmapIcon,label:u.i18n.translate("xpack.lens.heatmap.heatmapLabel",{defaultMessage:"Heat map"}),groupLabel:Fn}},_n="cell",Sn="heatmap",En="heatmap_legend",Pn="heatmap_grid",An=({table:e,state:t,keptLayerIds:a})=>{var n,i,l,s,r,o,c,d,p,m,g,f,b,h,x;if((null==t?void 0:t.shape)===wn&&(t.xAccessor||t.yAccessor||t.valueAccessor)&&"extended"!==e.changeType||e.columns.some((e=>e.operation.isStaticValue))||e.columns.some((e=>!e.operation.isBucketed&&"number"!==e.operation.dataType)))return[];if(t&&"unchanged"===e.changeType||a.length>1||a.length&&e.layerId!==a[0])return[];let y=0;const[v,j]=Object(Se.partition)(e.columns,(e=>e.operation.isBucketed));if(0===v.length&&0===j.length)return[];if(v.length>=3)return[];if(j.length>1)return[];const O=1===v.length&&0===j.length,k=0===v.length&&1===j.length,I=1===j.length&&v.length>0&&v.every((e=>"date"===e.operation.dataType)),T="reduced"===e.changeType||"reorder"===e.changeType||O||I||k,M={shape:wn,layerId:e.layerId,layerType:D.o.DATA,legend:{isVisible:null===(n=null==t||null===(i=t.legend)||void 0===i?void 0:i.isVisible)||void 0===n||n,position:null!==(l=null==t||null===(s=t.legend)||void 0===s?void 0:s.position)&&void 0!==l?l:pe.Position.Right,type:En},gridConfig:{type:Pn,isCellLabelVisible:!1,isYAxisLabelVisible:null===(r=null==t||null===(o=t.gridConfig)||void 0===o?void 0:o.isYAxisLabelVisible)||void 0===r||r,isXAxisLabelVisible:null===(c=null==t||null===(d=t.gridConfig)||void 0===d?void 0:d.isXAxisLabelVisible)||void 0===c||c,isYAxisTitleVisible:null!==(p=null==t||null===(m=t.gridConfig)||void 0===m?void 0:m.isYAxisTitleVisible)&&void 0!==p&&p,isXAxisTitleVisible:null!==(g=null==t||null===(f=t.gridConfig)||void 0===f?void 0:f.isXAxisTitleVisible)&&void 0!==g&&g}},F=j.find((e=>"number"===e.operation.dataType));F&&(y+=.3,M.valueAccessor=F.columnId);const[w,C]=Object(Se.partition)(v,(e=>"interval"===e.operation.scale));return M.xAccessor=(null===(b=w[0])||void 0===b?void 0:b.columnId)||(null===(h=C[0])||void 0===h?void 0:h.columnId),M.yAccessor=null===(x=v.find((e=>e.columnId!==M.xAccessor)))||void 0===x?void 0:x.columnId,v.some((e=>"date"===e.operation.dataType))||(M.xAccessor&&(y+=.3),M.yAccessor&&(y+=.3)),[{state:M,title:u.i18n.translate("xpack.lens.heatmap.heatmapLabel",{defaultMessage:"Heat map"}),hide:T,previewIcon:"empty",score:Number(y.toFixed(1))}]};a(235);const Ln=[{id:"heatmap_legend_show",value:"show",label:u.i18n.translate("xpack.lens.heatmapChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"heatmap_legend_hide",value:"hide",label:u.i18n.translate("xpack.lens.heatmapChart.legendVisibility.hide",{defaultMessage:"Hide"})}],Dn=Object(l.memo)((e=>{var t;const{state:a,setState:n,frame:i}=e,s=a.legend.isVisible?"show":"hide",r=ke(a,i.datasourceLayers).truncateText,o=null==a?void 0:a.legend.legendSize,[c]=Object(l.useState)((()=>o===_.LegendSize.AUTO));return Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(y.jsx)(j.h,{title:u.i18n.translate("xpack.lens.shared.curveLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"left",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(y.jsx)(j.j,{valueLabels:null!=a&&a.gridConfig.isCellLabelVisible?"show":"hide",onValueLabelChange:e=>{n({...a,gridConfig:{...a.gridConfig,isCellLabelVisible:"show"===e}})}})),Object(y.jsx)(j.c,{groupPosition:"right",legendOptions:Ln,mode:s,onDisplayChange:e=>{const t=Ln.find((({id:t})=>t===e)).value;"show"===t?n({...a,legend:{...a.legend,isVisible:!0}}):"hide"===t&&n({...a,legend:{...a.legend,isVisible:!1}})},position:null==a?void 0:a.legend.position,onPositionChange:e=>{n({...a,legend:{...a.legend,position:e}})},maxLines:null==a?void 0:a.legend.maxLines,onMaxLinesChange:e=>{n({...a,legend:{...a.legend,maxLines:e}})},shouldTruncate:null!==(t=null==a?void 0:a.legend.shouldTruncate)&&void 0!==t?t:r,onTruncateLegendChange:()=>{var e;const t=null!==(e=a.legend.shouldTruncate)&&void 0!==e?e:r;n({...a,legend:{...a.legend,shouldTruncate:!t}})},legendSize:o,onLegendSizeChange:e=>{n({...a,legend:{...a.legend,legendSize:e}})},showAutoLegendSizeOption:c}))),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(y.jsx)(j.i,{tooltipContent:u.i18n.translate("xpack.lens.heatmap.verticalAxisDisabledHelpText",{defaultMessage:"This setting only applies when vertical axis is enabled."}),condition:!Boolean(null==a?void 0:a.yAccessor)},Object(y.jsx)(j.h,{title:u.i18n.translate("xpack.lens.heatmap.verticalAxisLabel",{defaultMessage:"Vertical axis"}),type:Et,groupPosition:"left",isDisabled:!Boolean(null==a?void 0:a.yAccessor),buttonDataTestSubj:"lnsHeatmapVerticalAxisButton",panelClassName:"lnsVisToolbarAxis__popover"},Object(y.jsx)(j.a,{axis:"yLeft",axisTitle:null==a?void 0:a.gridConfig.yTitle,updateTitleState:({title:e,visible:t})=>{n({...a,gridConfig:{...a.gridConfig,yTitle:e,isYAxisTitleVisible:t}})},isAxisTitleVisible:null==a?void 0:a.gridConfig.isYAxisTitleVisible}))),Object(y.jsx)(j.i,{tooltipContent:u.i18n.translate("xpack.lens.heatmap.horizontalAxisDisabledHelpText",{defaultMessage:"This setting only applies when horizontal axis is enabled."}),condition:!Boolean(null==a?void 0:a.xAccessor)},Object(y.jsx)(j.h,{title:u.i18n.translate("xpack.lens.heatmap.horizontalAxisLabel",{defaultMessage:"Horizontal axis"}),type:St,groupPosition:"center",isDisabled:!Boolean(null==a?void 0:a.xAccessor),buttonDataTestSubj:"lnsHeatmapHorizontalAxisButton"},Object(y.jsx)(j.a,{axis:"x",axisTitle:null==a?void 0:a.gridConfig.xTitle,updateTitleState:({title:e,visible:t})=>n({...a,gridConfig:{...a.gridConfig,xTitle:e,isXAxisTitleVisible:t}}),isAxisTitleVisible:null==a?void 0:a.gridConfig.isXAxisTitleVisible}))))))}));function Nn(e,t,a,n){if(null==t||null==a)return{displayStops:[],activePalette:n};const i=null!=n?n:{type:"palette",name:Mn,accessor:a},l=Object(j.n)([a],t)[a];return{displayStops:Object(j.l)(e,i,l),currentMinMax:l,activePalette:i}}function zn(e){var t;const{state:a,setState:n,frame:i,accessor:r}=e,[o,c]=Object(l.useState)(!1);if((null==a?void 0:a.valueAccessor)!==r)return null;const d=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],{displayStops:m,activePalette:g,currentMinMax:b}=Nn(e.paletteService,d,r,null!=a&&a.palette&&a.palette.accessor===r?a.palette:void 0);return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteHeatmapGradient.label",{defaultMessage:"Color"})},Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(f.EuiColorPaletteDisplay,{"data-test-subj":"lnsHeatmap_dynamicColoring_palette",palette:m.map((({color:e})=>e)),type:p.i,onClick:()=>{c(!o)}})),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiButtonEmpty,{"data-test-subj":"lnsHeatmap_dynamicColoring_trigger","aria-label":u.i18n.translate("xpack.lens.paletteHeatmapGradient.customizeLong",{defaultMessage:"Edit palette"}),iconType:"controlsHorizontal",onClick:()=>{c(!o)},size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteHeatmapGradient.customize",{defaultMessage:"Edit"})),Object(y.jsx)(j.e,{siblingRef:e.panelRef,isOpen:o,handleClose:()=>c(!o)},g&&Object(y.jsx)(p.b,{palettes:e.paletteService,activePalette:g,dataBounds:b,setPalette:e=>{e.params&&!e.params.stops&&(e.params.stops=m),e.accessor=r,n({...a,palette:e})}}))))))}a(240);const Bn=u.i18n.translate("xpack.lens.heatmapVisualization.heatmapGroupLabel",{defaultMessage:"Magnitude"});function Vn(e){const t=u.i18n.translate("xpack.lens.heatmap.verticalAxisLabel",{defaultMessage:"Vertical axis"}),a=u.i18n.translate("xpack.lens.heatmap.horizontalAxisLabel",{defaultMessage:"Horizontal axis"});return"x"===e?a:t}const Rn=e=>e.isBucketed&&"ordinal"===e.scale,Hn=e=>Rn(e)||"interval"===e.scale,Gn=e=>!Rn(e)&&("ordinal"===e.scale||"ratio"===e.scale)&&(e=>"number"===e.dataType&&!e.isStaticValue)(e);function qn(e){return{...e,colors:((null==e?void 0:e.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null==e?void 0:e.name)?((null==e?void 0:e.stops)||[]).map((({stop:e})=>e)):[],reverse:!1}}const $n=({paletteService:e,theme:t})=>({id:"lnsHeatmap",visualizationTypes:[{id:"heatmap",icon:Tn.HeatmapIcon,label:u.i18n.translate("xpack.lens.heatmapVisualization.heatmapLabel",{defaultMessage:"Heat map"}),groupLabel:Bn,showExperimentalBadge:!1,sortPriority:1}],getVisualizationTypeId:e=>e.shape,getLayerIds:e=>[e.layerId],clearLayer(e){const t={...e};return delete t.valueAccessor,delete t.xAccessor,delete t.yAccessor,t},switchVisualizationType:(e,t)=>({...t,shape:e}),getDescription:e=>Cn.heatmap,initialize:(e,t,a)=>t||{layerId:e(),layerType:D.o.DATA,title:"Empty Heatmap chart",shape:wn,legend:{isVisible:!0,position:pe.Position.Right,maxLines:1,type:En},gridConfig:{type:Pn,isCellLabelVisible:!1,isYAxisLabelVisible:!0,isXAxisLabelVisible:!0,isYAxisTitleVisible:!0,isXAxisTitleVisible:!0}},getSuggestions:An,triggers:[_.VIS_EVENT_TO_TRIGGER.filter,_.VIS_EVENT_TO_TRIGGER.brush],getConfiguration({state:t,frame:a,layerId:n}){var i,l;if(!a.datasourceLayers[n].getTableSpec().map((({columnId:e})=>e)))return{groups:[]};const{displayStops:s,activePalette:r}=Nn(e,null===(i=a.activeData)||void 0===i?void 0:i[t.layerId],t.valueAccessor,null!=t&&t.palette&&t.palette.accessor===t.valueAccessor?t.palette:void 0);return{groups:[{layerId:t.layerId,groupId:"x",groupLabel:Vn("x"),accessors:t.xAccessor?[{columnId:t.xAccessor}]:[],filterOperations:Hn,supportsMoreColumns:!t.xAccessor,required:!0,dataTestSubj:"lnsHeatmap_xDimensionPanel"},{layerId:t.layerId,groupId:"y",groupLabel:Vn("y"),accessors:t.yAccessor?[{columnId:t.yAccessor}]:[],filterOperations:Hn,supportsMoreColumns:!t.yAccessor,required:!1,dataTestSubj:"lnsHeatmap_yDimensionPanel"},{layerId:t.layerId,groupId:_n,groupLabel:u.i18n.translate("xpack.lens.heatmap.cellValueLabel",{defaultMessage:"Cell value"}),accessors:t.valueAccessor?[s.length&&(a.activeData||"number"!==(null==r||null===(l=r.params)||void 0===l?void 0:l.rangeType))?{columnId:t.valueAccessor,triggerIcon:"colorBy",palette:s.map((({color:e})=>e))}:{columnId:t.valueAccessor,triggerIcon:"none"}]:[],filterOperations:Gn,supportsMoreColumns:!t.valueAccessor,enableDimensionEditor:!0,required:!0,dataTestSubj:"lnsHeatmap_cellPanel"}]}},setDimension({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i}){const l={};return"x"===n&&(l.xAccessor=a),"y"===n&&(l.yAccessor=a),n===_n&&(l.valueAccessor=a),{...e,...l}},removeDimension({prevState:e,layerId:t,columnId:a}){const n={...e};return e.valueAccessor===a&&delete n.valueAccessor,e.xAccessor===a&&delete n.xAccessor,e.yAccessor===a&&delete n.yAccessor,n},renderDimensionEditor(a,n){Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(zn,i()({},n,{paletteService:e})))),a)},renderToolbar(e,a){Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(Dn,a))),e)},getSupportedLayers:()=>[{type:D.o.DATA,label:u.i18n.translate("xpack.lens.heatmap.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression(t,a,n,i={}){var l,s,r,o,u,c,d,m,g,f;const b=a[t.layerId],h=i[t.layerId];return b.getTableSpec().map((({columnId:e})=>e))&&t.valueAccessor?{type:"expression",chain:[...null!==(l=null==h?void 0:h.chain)&&void 0!==l?l:[],{type:"function",function:Sn,arguments:{xAccessor:[null!==(s=t.xAccessor)&&void 0!==s?s:""],yAccessor:[null!==(r=t.yAccessor)&&void 0!==r?r:""],valueAccessor:[null!==(o=t.valueAccessor)&&void 0!==o?o:""],lastRangeIsRightOpen:[null===(u=t.palette)||void 0===u||null===(c=u.params)||void 0===c||!c.continuity||["above","all"].includes(t.palette.params.continuity)],palette:null!==(d=t.palette)&&void 0!==d&&d.params?[e.get(p.a).toExpression(qn((null===(m=t.palette)||void 0===m?void 0:m.params)||{}))]:[e.get(Mn).toExpression()],legend:[{type:"expression",chain:[{type:"function",function:En,arguments:{isVisible:[t.legend.isVisible],position:[t.legend.position],legendSize:t.legend.legendSize?[t.legend.legendSize]:[]}}]}],gridConfig:[{type:"expression",chain:[{type:"function",function:Pn,arguments:{strokeWidth:t.gridConfig.strokeWidth?[t.gridConfig.strokeWidth]:[],strokeColor:t.gridConfig.strokeColor?[t.gridConfig.strokeColor]:[],isCellLabelVisible:[t.gridConfig.isCellLabelVisible],isYAxisLabelVisible:[t.gridConfig.isYAxisLabelVisible],isYAxisTitleVisible:[null!==(g=t.gridConfig.isYAxisTitleVisible)&&void 0!==g&&g],yTitle:t.gridConfig.yTitle?[t.gridConfig.yTitle]:[],isXAxisLabelVisible:t.gridConfig.isXAxisLabelVisible?[t.gridConfig.isXAxisLabelVisible]:[],isXAxisTitleVisible:[null!==(f=t.gridConfig.isXAxisTitleVisible)&&void 0!==f&&f],xTitle:t.gridConfig.xTitle?[t.gridConfig.xTitle]:[]}}]}]}}]}:null},toPreviewExpression(t,a,n={}){var i,l,s,r,o,u,c,d;const m=a[t.layerId],g=n[t.layerId];return m.getTableSpec().map((({columnId:e})=>e))?{type:"expression",chain:[...null!==(i=null==g?void 0:g.chain)&&void 0!==i?i:[],{type:"function",function:Sn,arguments:{xAccessor:[null!==(l=t.xAccessor)&&void 0!==l?l:""],yAccessor:[null!==(s=t.yAccessor)&&void 0!==s?s:""],valueAccessor:[null!==(r=t.valueAccessor)&&void 0!==r?r:""],legend:[{type:"expression",chain:[{type:"function",function:En,arguments:{isVisible:[!1],position:[]}}]}],palette:null!==(o=t.palette)&&void 0!==o&&o.params?[e.get(p.a).toExpression(qn((null===(u=t.palette)||void 0===u?void 0:u.params)||{}))]:[e.get(Mn).toExpression()],gridConfig:[{type:"expression",chain:[{type:"function",function:Pn,arguments:{strokeWidth:[1],isCellLabelVisible:[!1],isYAxisLabelVisible:[!1],isYAxisTitleVisible:[t.gridConfig.isYAxisTitleVisible],yTitle:[null!==(c=t.gridConfig.yTitle)&&void 0!==c?c:""],isXAxisLabelVisible:[!1],isXAxisTitleVisible:[t.gridConfig.isXAxisTitleVisible],xTitle:[null!==(d=t.gridConfig.xTitle)&&void 0!==d?d:""]}}]}]}}]}:null},getErrorMessages(e){if(!e.yAccessor&&!e.xAccessor&&!e.valueAccessor)return;const t=[];return e.xAccessor||t.push({shortMessage:u.i18n.translate("xpack.lens.heatmapVisualization.missingXAccessorShortMessage",{defaultMessage:"Missing Horizontal axis."}),longMessage:u.i18n.translate("xpack.lens.heatmapVisualization.missingXAccessorLongMessage",{defaultMessage:"Configuration for the horizontal axis is missing."})}),t.length?t:void 0},getWarningMessages(e,t){if(null==e||!e.layerId||!t.activeData||!e.valueAccessor)return;const a=t.activeData[e.layerId]&&t.activeData[e.layerId].rows;if(!a)return;const n=a.some((t=>Array.isArray(t[e.valueAccessor]))),i=t.datasourceLayers[e.layerId].getOperationForColumnId(e.valueAccessor);return n?[Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.heatmapVisualization.arrayValuesWarningMessage",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(y.jsx)("strong",null,null==i?void 0:i.label)}})]:void 0}});class HeatmapVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getHeatmapVisualization:t}=await Promise.resolve().then(a.bind(null,463));return t({paletteService:await n.palettes.getPalettes(),theme:e.theme})}))}}var Wn=a(44),Un=a(48);const Yn=({table:e,state:t,keptLayerIds:a,subVisualizationId:n})=>{const i=Boolean(t&&(t.minAccessor||t.maxAccessor||t.goalAccessor||t.metricAccessor)),l=t&&[t.minAccessor,t.maxAccessor,t.goalAccessor,t.metricAccessor].filter(Boolean).length;if(((e,t)=>e.length>1||e.length&&t.layerId!==e[0])(a,e)||(e=>{var t,a;return"number"!==(null===(t=e.columns)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.operation.dataType)||e.columns.some((e=>e.operation.isBucketed))})(e)||!i&&e.columns.length>1||i&&(l!==e.columns.length||"initial"===e.changeType))return[];const s=(null==t?void 0:t.shape)===Wn.GaugeShapes.VERTICAL_BULLET?Wn.GaugeShapes.VERTICAL_BULLET:Wn.GaugeShapes.HORIZONTAL_BULLET,r={state:{...t,shape:s,layerId:e.layerId,layerType:D.o.DATA,ticksPosition:Wn.GaugeTicksPositions.AUTO,labelMajorMode:Wn.GaugeLabelMajorModes.AUTO},title:u.i18n.translate("xpack.lens.gauge.gaugeLabel",{defaultMessage:"Gauge"}),previewIcon:"empty",score:.5,hide:!i||void 0===(null==t?void 0:t.metricAccessor)};return i?[{...r,state:{...r.state,...t,shape:(null==t?void 0:t.shape)===Wn.GaugeShapes.VERTICAL_BULLET?Wn.GaugeShapes.HORIZONTAL_BULLET:Wn.GaugeShapes.VERTICAL_BULLET}}]:[{...r,state:{...r.state,metricAccessor:e.columns[0].columnId}},{...r,state:{...r.state,metricAccessor:e.columns[0].columnId,shape:(null==t?void 0:t.shape)===Wn.GaugeShapes.VERTICAL_BULLET?Wn.GaugeShapes.HORIZONTAL_BULLET:Wn.GaugeShapes.VERTICAL_BULLET}}]},Xn="metric",Kn="goal";a(245);const Zn=Object(l.memo)((e=>{var t,a,n;const{state:i,setState:s,frame:r}=e,o=i.layerId&&(null===(t=r.activeData)||void 0===t||null===(a=t[i.layerId])||void 0===a||null===(n=a.columns.find((e=>e.id===i.metricAccessor)))||void 0===n?void 0:n.name),[c,d]=Object(l.useState)((()=>i.labelMinor?"custom":"none")),{inputValue:p,handleInputChange:m}=Object(j.p)({onChange:s,value:i});return Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(y.jsx)(j.h,{handleClose:()=>{d(p.labelMinor?"custom":"none")},title:u.i18n.translate("xpack.lens.gauge.appearanceLabel",{defaultMessage:"Appearance"}),type:"visualOptions",buttonDataTestSubj:"lnsVisualOptionsButton",panelClassName:"lnsGaugeToolbar__popover"},Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.gauge.labelMajor.header",{defaultMessage:"Title"}),fullWidth:!0},Object(y.jsx)(j.k,{header:u.i18n.translate("xpack.lens.label.gauge.labelMajor.header",{defaultMessage:"Title"}),dataTestSubj:"lnsToolbarGaugeLabelMajor",label:p.labelMajor||"",mode:p.labelMajorMode,placeholder:o||"",hasAutoOption:!0,handleChange:e=>{m({...p,labelMajor:e.label,labelMajorMode:e.mode})}})),Object(y.jsx)(f.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.gauge.labelMinor.header",{defaultMessage:"Subtitle"})},Object(y.jsx)(j.k,{header:u.i18n.translate("xpack.lens.label.gauge.labelMinor.header",{defaultMessage:"Subtitle"}),dataTestSubj:"lnsToolbarGaugeLabelMinor",label:p.labelMinor||"",mode:c,handleChange:e=>{m({...p,labelMinor:e.label}),d(e.mode)}}))))))}));a(250);const Qn={...j.m,rangeMin:0,rangeMax:100,name:"gray",steps:3,maxSteps:5},Jn=e=>{const{minAccessor:t,maxAccessor:a,goalAccessor:n,metricAccessor:i}=null!=e?e:{};if(i||a||n||i)return{min:t,max:a,goal:n,metric:i}};function ei(e){var t;const{state:a,setState:n,frame:i,accessor:r}=e,[o,c]=Object(l.useState)(!1);if((null==a?void 0:a.metricAccessor)!==r)return null;const d=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],[m]=(null==d?void 0:d.rows)||[];if(null==r||null==m||!Object(k.f)(d,r))return null;const g=Jn(a),b="palette"===(null==a?void 0:a.colorMode),h={min:Object(Un.getMinValue)(m,g),max:Object(Un.getMaxValue)(m,g)},x=(null==a?void 0:a.palette)||{type:"palette",name:Qn.name,params:{...Qn,continuity:"all",colorStops:void 0,stops:void 0,rangeMin:h.min,rangeMax:3*h.max/4}},v=Object(j.l)(e.paletteService,x,h),O=()=>c(!o);return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.gauge.dynamicColoring.label",{defaultMessage:"Band colors"}),className:"lnsDynamicColoringRow"},Object(y.jsx)(f.EuiSwitch,{"data-test-subj":"lnsDynamicColoringGaugeSwitch",compressed:!0,label:"",showLabel:!1,checked:b,onChange:e=>{const{checked:t}=e.target,i=t?{palette:{...x,params:{...x.params,stops:v}},ticksPosition:Wn.GaugeTicksPositions.BANDS,colorMode:Wn.GaugeColorModes.PALETTE}:{ticksPosition:Wn.GaugeTicksPositions.AUTO,colorMode:Wn.GaugeColorModes.NONE};n({...a,...i})}})),b&&Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteMetricGradient.label",{defaultMessage:"Color"})},Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(f.EuiColorPaletteDisplay,{"data-test-subj":"lnsGauge_dynamicColoring_palette",palette:v.map((({color:e})=>e)),type:p.i,onClick:O})),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiButtonEmpty,{"data-test-subj":"lnsGauge_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:O,size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(y.jsx)(j.e,{siblingRef:e.panelRef,isOpen:o,handleClose:O},Object(y.jsx)(p.b,{palettes:e.paletteService,activePalette:x,dataBounds:h,setPalette:e=>{e.name!==p.a&&e.params&&e.params.rangeMin!==h.min&&(e.params.rangeMin=h.min),n({...a,palette:e})}}))))),Object(y.jsx)(f.EuiFormRow,{display:"columnCompressedSwitch",fullWidth:!0,label:Object(y.jsx)(j.i,{position:"top",tooltipContent:u.i18n.translate("xpack.lens.shared.ticksPositionOptionsTooltip",{defaultMessage:"Places ticks on each band border instead of distributing them evenly"}),condition:!0,delay:"regular"},Object(y.jsx)("span",null,u.i18n.translate("xpack.lens.shared.ticksPositionOptions",{defaultMessage:"Ticks on bands"}),Object(y.jsx)(f.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"})))},Object(y.jsx)(f.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.shared.ticksPositionOptions",{defaultMessage:"Ticks on bands"}),"data-test-subj":"lens-toolbar-gauge-ticks-position-switch",showLabel:!1,checked:a.ticksPosition===Wn.GaugeTicksPositions.BANDS,onChange:()=>{n({...a,ticksPosition:a.ticksPosition===Wn.GaugeTicksPositions.BANDS?Wn.GaugeTicksPositions.AUTO:Wn.GaugeTicksPositions.BANDS})}}))))}const ti=u.i18n.translate("xpack.lens.metric.groupLabel",{defaultMessage:"Goal and single value"}),ai=e=>!e.isBucketed&&"number"===e.dataType,ni=e=>ai(e)&&!e.isStaticValue,ii={horizontalBullet:{icon:Un.HorizontalBulletIcon,label:u.i18n.translate("xpack.lens.gaugeHorizontal.gaugeLabel",{defaultMessage:"Gauge horizontal"}),groupLabel:ti},verticalBullet:{icon:Un.VerticalBulletIcon,label:u.i18n.translate("xpack.lens.gaugeVertical.gaugeLabel",{defaultMessage:"Gauge vertical"}),groupLabel:ti}},li=(e,t)=>{if(!e||!t)return;const a=null==t?void 0:t.minAccessor,n=null==t?void 0:t.maxAccessor,i=a?Object(Un.getValueFromAccessor)(a,e):void 0,l=n?Object(Un.getValueFromAccessor)(n,e):void 0;if(null!=l&&null!=i&&void 0!==i){if(l<i)return{invalid:!0,invalidMessage:u.i18n.translate("xpack.lens.guageVisualization.chartCannotRenderMinGreaterMax",{defaultMessage:"Minimum value may not be greater than maximum value"})};if(l===i)return{invalid:!0,invalidMessage:u.i18n.translate("xpack.lens.guageVisualization.chartCannotRenderEqual",{defaultMessage:"Minimum and maximum values may not be equal"})}}},si=(e,t,a,n,i={})=>{var l,s,r,o,u;const c=a[t.layerId],d=i[t.layerId];return c.getTableSpec().map((({columnId:e})=>e))&&t.metricAccessor?{type:"expression",chain:[...null!==(l=null==d?void 0:d.chain)&&void 0!==l?l:[],{type:"function",function:Wn.EXPRESSION_GAUGE_NAME,arguments:{metric:t.metricAccessor?[t.metricAccessor]:[],min:t.minAccessor?[t.minAccessor]:[],max:t.maxAccessor?[t.maxAccessor]:[],goal:t.goalAccessor?[t.goalAccessor]:[],shape:[null!==(s=t.shape)&&void 0!==s?s:Wn.GaugeShapes.HORIZONTAL_BULLET],colorMode:[null!==(r=null==t?void 0:t.colorMode)&&void 0!==r?r:"none"],palette:null!==(o=t.palette)&&void 0!==o&&o.params?[e.get(p.a).toExpression((m=(null===(u=t.palette)||void 0===u?void 0:u.params)||{},{...m,colors:((null==m?void 0:m.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null==m?void 0:m.name)?((null==m?void 0:m.stops)||[]).map((({stop:e})=>e)):[],reverse:!1}))]:[],ticksPosition:t.ticksPosition?[t.ticksPosition]:["auto"],labelMinor:t.labelMinor?[t.labelMinor]:[],labelMajor:t.labelMajor?[t.labelMajor]:[],labelMajorMode:t.labelMajorMode?[t.labelMajorMode]:["auto"]}}]}:null;var m},ri=({paletteService:e})=>({id:"lnsGauge",visualizationTypes:[{...ii.horizontalBullet,id:Wn.GaugeShapes.HORIZONTAL_BULLET,showExperimentalBadge:!0},{...ii.verticalBullet,id:Wn.GaugeShapes.VERTICAL_BULLET,showExperimentalBadge:!0}],getVisualizationTypeId:e=>e.shape,getLayerIds:e=>[e.layerId],clearLayer(e){const t={...e};return delete t.metricAccessor,delete t.minAccessor,delete t.maxAccessor,delete t.goalAccessor,delete t.palette,delete t.colorMode,t},getDescription:e=>e.shape===Wn.GaugeShapes.HORIZONTAL_BULLET?ii.horizontalBullet:ii.verticalBullet,switchVisualizationType:(e,t)=>({...t,shape:e===Wn.GaugeShapes.HORIZONTAL_BULLET?Wn.GaugeShapes.HORIZONTAL_BULLET:Wn.GaugeShapes.VERTICAL_BULLET}),initialize:(e,t,a)=>t||{layerId:e(),layerType:D.o.DATA,shape:Wn.GaugeShapes.HORIZONTAL_BULLET,palette:a,ticksPosition:"auto",labelMajorMode:"auto"},getSuggestions:Yn,getConfiguration({state:t,frame:a}){var n,i,l,s,r;const o=Boolean("none"!==t.colorMode&&(null===(n=t.palette)||void 0===n||null===(i=n.params)||void 0===i?void 0:i.stops)),c=null!=t&&t.layerId?null==a||null===(l=a.activeData)||void 0===l||null===(s=l[null==t?void 0:t.layerId])||void 0===s||null===(r=s.rows)||void 0===r?void 0:r[0]:void 0,{metricAccessor:d}=null!=t?t:{},p=Jn(t);let m;if(null!=c&&null!=d&&null!=(null==t?void 0:t.palette)&&o){const a={min:Object(Un.getMinValue)(c,p),max:Object(Un.getMaxValue)(c,p)};m=Object(j.l)(e,null==t?void 0:t.palette,a).map((({color:e})=>e))}const g=li(c,t)||{};return{groups:[{supportFieldFormat:!0,layerId:t.layerId,groupId:Xn,groupLabel:u.i18n.translate("xpack.lens.gauge.metricLabel",{defaultMessage:"Metric"}),accessors:d?[m?{columnId:d,triggerIcon:"colorBy",palette:m}:{columnId:d,triggerIcon:"none"}]:[],filterOperations:ni,supportsMoreColumns:!d,required:!0,dataTestSubj:"lnsGauge_metricDimensionPanel",enableDimensionEditor:!0},{supportStaticValue:!0,supportFieldFormat:!1,layerId:t.layerId,groupId:"min",groupLabel:u.i18n.translate("xpack.lens.gauge.minValueLabel",{defaultMessage:"Minimum value"}),accessors:t.minAccessor?[{columnId:t.minAccessor}]:[],filterOperations:ai,supportsMoreColumns:!t.minAccessor,dataTestSubj:"lnsGauge_minDimensionPanel",prioritizedOperation:"min",suggestedValue:()=>t.metricAccessor?Object(Un.getMinValue)(c,p):void 0,...g},{supportStaticValue:!0,supportFieldFormat:!1,layerId:t.layerId,groupId:"max",groupLabel:u.i18n.translate("xpack.lens.gauge.maxValueLabel",{defaultMessage:"Maximum value"}),accessors:t.maxAccessor?[{columnId:t.maxAccessor}]:[],filterOperations:ai,supportsMoreColumns:!t.maxAccessor,dataTestSubj:"lnsGauge_maxDimensionPanel",prioritizedOperation:"max",suggestedValue:()=>t.metricAccessor?Object(Un.getMaxValue)(c,p):void 0,...g},{supportStaticValue:!0,supportFieldFormat:!1,layerId:t.layerId,groupId:Kn,groupLabel:u.i18n.translate("xpack.lens.gauge.goalValueLabel",{defaultMessage:"Goal value"}),accessors:t.goalAccessor?[{columnId:t.goalAccessor}]:[],filterOperations:ai,supportsMoreColumns:!t.goalAccessor,required:!1,dataTestSubj:"lnsGauge_goalDimensionPanel"}]}},setDimension({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i}){const l={};return"min"===n&&(l.minAccessor=a),"max"===n&&(l.maxAccessor=a),n===Kn&&(l.goalAccessor=a),n===Xn&&(l.metricAccessor=a),{...e,...l}},removeDimension({prevState:e,layerId:t,columnId:a}){const n={...e};return e.goalAccessor===a&&delete n.goalAccessor,e.minAccessor===a&&delete n.minAccessor,e.maxAccessor===a&&delete n.maxAccessor,e.metricAccessor===a&&(delete n.metricAccessor,delete n.palette,delete n.colorMode,n.ticksPosition="auto"),n},renderDimensionEditor(t,a){Object(r.render)(Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(ei,i()({},a,{paletteService:e}))),t)},renderToolbar(e,t){Object(r.render)(Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(Zn,t)),e)},getSupportedLayers(e,t){var a,n,i;const l=null!=e&&e.layerId?null==t||null===(a=t.activeData)||void 0===a||null===(n=a[null==e?void 0:e.layerId])||void 0===n||null===(i=n.rows)||void 0===i?void 0:i[0]:void 0,s=Jn(e),r=Object(Un.getMinValue)(l,s),o=Object(Un.getMaxValue)(l,s),c=Object(Un.getGoalValue)(l,s);return[{type:D.o.DATA,label:u.i18n.translate("xpack.lens.gauge.addLayer",{defaultMessage:"Visualization"}),initialDimensions:e?[{groupId:"min",columnId:Object(ea.a)(),staticValue:r},{groupId:"max",columnId:Object(ea.a)(),staticValue:o},{groupId:"goal",columnId:Object(ea.a)(),staticValue:c}]:void 0}]},getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression:(t,a,n,i={})=>si(e,t,a,0,i),toPreviewExpression:(t,a,n={})=>si(e,t,a,0,n),getErrorMessages(e){},getWarningMessages(e,t){var a,n,i;const{maxAccessor:l,minAccessor:s,goalAccessor:r,metricAccessor:o}=e;if(!(l||s||r||o))return;if(!o)return[];const u=null==t||null===(a=t.activeData)||void 0===a||null===(n=a[e.layerId])||void 0===n||null===(i=n.rows)||void 0===i?void 0:i[0];if(!u||li(u,e))return[];const d=u[o],p=l&&u[l],m=s&&u[s],g=r&&u[r],f=[];return"number"==typeof m&&(m>d&&f.push([Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.minValueGreaterMetricShortMessage",defaultMessage:"Minimum value is greater than metric value."})]),m>g&&f.push([Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.minimumValueGreaterGoalShortMessage",defaultMessage:"Minimum value is greater than goal value."})])),"number"==typeof p&&(d>p&&f.push([Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.metricValueGreaterMaximumShortMessage",defaultMessage:"Metric value is greater than maximum value."})]),"number"==typeof g&&g>p&&f.push([Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.goalValueGreaterMaximumShortMessage",defaultMessage:"Goal value is greater than maximum value."})])),f}});class gauge_GaugeVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getGaugeVisualization:e}=await Promise.resolve().then(a.bind(null,463));return e({paletteService:(e=>{const t=e=>e?new tn.a(e).hex()+"80":"000000",a=e=>({...e,getCategoricalColor:(a,n,i)=>t(e.getCategoricalColor(a,n,i)),getCategoricalColors:(a,n)=>e.getCategoricalColors(a,n).map(t)});return{...e,get:t=>a(e.get(t)),getAll:()=>e.getAll().map((e=>a(e)))}})(await n.palettes.getPalettes())})}))}}var oi=a(53),ui=a(86),ci=a.n(ui),di=a(138),pi=a(82),mi=a(37);const gi=/[^0-9A-Za-z._@\[\]/]/;function fi(e){const{namedArgument:t,variable:a,function:n}=Object(Se.groupBy)(e,(e=>Object(Se.isObject)(e)?e.type:"variable"));return{namedArguments:t||[],variables:a||[],functions:n||[]}}function bi(e){return Object(Se.isObject)(e)?"function"!==e.type?e.value:e.name:e}function hi(e,t,a){if(a&&e.filterable){const e="kql"in t?"kql":"lucene";t[e]?a.query&&(t[e]=`(${a.query}) AND (${t[e]})`):t["kuery"===a.language?"kql":a.language]=a.query}return t}function xi(e,t=[]){const a=(e.operationParams||[]).reduce(((e,{name:t,type:a})=>(e[t]=a,e)),{});return t.reduce(((t,{name:n,value:i})=>(a[n]&&(t[n]=i),!e.filterable||"kql"!==n&&"lucene"!==n||(t[n]=i),e.shiftable&&"shift"===n&&(t[n]=i),t)),{})}function yi(e){return"number"===e?u.i18n.translate("xpack.lens.formula.number",{defaultMessage:"number"}):"string"===e?u.i18n.translate("xpack.lens.formula.string",{defaultMessage:"string"}):""}const vi={add:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:yi("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.addFunction.markdown",{defaultMessage:"\nAdds up two numbers.\nAlso works with + symbol\n\nExample: Calculate the sum of two fields\n\n`sum(price) + sum(tax)`\n\nExample: Offset count by a static value\n\n`add(count(), 5)`\n    "})},subtract:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:yi("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.subtractFunction.markdown",{defaultMessage:"\nSubtracts the first number from the second number.\nAlso works with `-` symbol\n\nExample: Calculate the range of a field\n`subtract(max(bytes), min(bytes))`\n    "})},multiply:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:yi("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.multiplyFunction.markdown",{defaultMessage:"\nMultiplies two numbers.\nAlso works with `*` symbol.\n\nExample: Calculate price after current tax rate\n`sum(bytes) * last_value(tax_rate)`\n\nExample: Calculate price after constant tax rate\n`multiply(sum(price), 1.2)`\n    "})},divide:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:yi("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.divideFunction.markdown",{defaultMessage:"\nDivides the first number by the second number.\nAlso works with `/` symbol\n\nExample: Calculate profit margin\n`sum(profit) / sum(revenue)`\n\nExample: `divide(sum(bytes), 2)`\n    "})},abs:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.absFunction.markdown",{defaultMessage:"\nCalculates absolute value. A negative value is multiplied by -1, a positive value stays the same.\n\nExample: Calculate average distance to sea level `abs(average(altitude))`\n    "})},cbrt:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.cbrtFunction.markdown",{defaultMessage:"\nCube root of value.\n\nExample: Calculate side length from volume\n`cbrt(last_value(volume))`\n    "})},ceil:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.ceilFunction.markdown",{defaultMessage:"\nCeiling of value, rounds up.\n\nExample: Round up price to the next dollar\n`ceil(sum(price))`\n    "})},clamp:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:yi("number")},{name:u.i18n.translate("xpack.lens.formula.min",{defaultMessage:"min"}),type:yi("number")},{name:u.i18n.translate("xpack.lens.formula.max",{defaultMessage:"max"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.clampFunction.markdown",{defaultMessage:"\nLimits the value from a minimum to maximum.\n\nExample: Make sure to catch outliers\n```\nclamp(\n  average(bytes),\n  percentile(bytes, percentile=5),\n  percentile(bytes, percentile=95)\n)\n```\n"})},cube:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.cubeFunction.markdown",{defaultMessage:"\nCalculates the cube of a number.\n\nExample: Calculate volume from side length\n`cube(last_value(length))`\n    "})},exp:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.expFunction.markdown",{defaultMessage:"\nRaises *e* to the nth power.\n\nExample: Calculate the natural exponential function\n\n`exp(last_value(duration))`\n    "})},fix:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.fixFunction.markdown",{defaultMessage:"\nFor positive values, takes the floor. For negative values, takes the ceiling.\n\nExample: Rounding towards zero\n`fix(sum(profit))`\n    "})},floor:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.floorFunction.markdown",{defaultMessage:"\nRound down to nearest integer value\n\nExample: Round down a price\n`floor(sum(price))`\n    "})},log:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:yi("number")},{name:u.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),optional:!0,defaultValue:"e",type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.logFunction.markdown",{defaultMessage:"\nLogarithm with optional base. The natural base *e* is used as default.\n\nExample: Calculate number of bits required to store values\n```\nlog(sum(bytes))\nlog(sum(bytes), 2)\n```\n    "})},mod:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:yi("number")},{name:u.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.modFunction.markdown",{defaultMessage:"\nRemainder after dividing the function by a number\n\nExample: Calculate last three digits of a value\n`mod(sum(price), 1000)`\n    "})},pow:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:yi("number")},{name:u.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.powFunction.markdown",{defaultMessage:"\nRaises the value to a certain power. The second argument is required\n\nExample: Calculate volume based on side length\n`pow(last_value(length), 3)`\n    "})},round:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:yi("number")},{name:u.i18n.translate("xpack.lens.formula.decimals",{defaultMessage:"decimals"}),optional:!0,defaultValue:0,type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.roundFunction.markdown",{defaultMessage:"\nRounds to a specific number of decimal places, default of 0\n\nExamples: Round to the cent\n```\nround(sum(bytes))\nround(sum(bytes), 2)\n```\n    "})},sqrt:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.sqrtFunction.markdown",{defaultMessage:"\nSquare root of a positive value only\n\nExample: Calculate side length based on area\n`sqrt(last_value(area))`\n    "})},square:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:yi("number")}],help:u.i18n.translate("xpack.lens.formula.squareFunction.markdown",{defaultMessage:"\nRaise the value to the 2nd power\n\nExample: Calculate area based on side length\n`square(last_value(length))`\n    "})}};function ji(e){return Object(Se.isObject)(e)&&"function"===e.type&&vi[e.name]}function Oi(e){return"string"==typeof e?[{type:"variable",value:e,text:e,location:{min:0,max:0}}]:null==e||"number"==typeof e||"namedArgument"===e.type?[]:"variable"===e.type?[e]:e.args.flatMap(Oi)}function ki(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>!e.hidden)))}const Ii=(e,t)=>{const[,...a]=e.split("="),n=(a||[""]).join(""),i=n.trim();if(i.length&&("'"!==i[0]||!/'\s*([^']+?)\s*'/.test(n))&&"''"!==i)return u.i18n.translate("xpack.lens.indexPattern.formulaOperationQueryError",{defaultMessage:"Single quotes are required for {language}='' at {rawQuery}",values:{language:t,rawQuery:e}})};function Ti({messageId:e,values:t,locations:a}){let n;const i=t;switch(e){case"wrongFirstArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationWrongFirstArgument",{defaultMessage:"The first argument for {operation} should be a {type} name. Found {argument}",values:{operation:i.operation,type:i.type,argument:i.argument}});break;case"shouldNotHaveField":n=u.i18n.translate("xpack.lens.indexPattern.formulaFieldNotRequired",{defaultMessage:"The operation {operation} does not accept any field as argument",values:{operation:i.operation}});break;case"cannotAcceptParameter":n=u.i18n.translate("xpack.lens.indexPattern.formulaParameterNotRequired",{defaultMessage:"The operation {operation} does not accept any parameter",values:{operation:i.operation}});break;case"missingParameter":n=u.i18n.translate("xpack.lens.indexPattern.formulaExpressionNotHandled",{defaultMessage:"The operation {operation} in the Formula is missing the following parameters: {params}",values:{operation:i.operation,params:i.params}});break;case"wrongTypeParameter":n=u.i18n.translate("xpack.lens.indexPattern.formulaExpressionWrongType",{defaultMessage:"The parameters for the operation {operation} in the Formula are of the wrong type: {params}",values:{operation:i.operation,params:i.params}});break;case"duplicateArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationDuplicateParams",{defaultMessage:"The parameters for the operation {operation} have been declared multiple times: {params}",values:{operation:i.operation,params:i.params}});break;case"missingField":n=u.i18n.translate("xpack.lens.indexPattern.formulaFieldNotFound",{defaultMessage:"{variablesLength, plural, one {Field} other {Fields}} {variablesList} not found",values:{variablesLength:i.variablesLength,variablesList:i.variablesList}});break;case"missingOperation":n=u.i18n.translate("xpack.lens.indexPattern.operationsNotFound",{defaultMessage:"{operationLength, plural, one {Operation} other {Operations}} {operationsList} not found",values:{operationLength:i.operationLength,operationsList:i.operationsList}});break;case"fieldWithNoOperation":n=u.i18n.translate("xpack.lens.indexPattern.fieldNoOperation",{defaultMessage:"The field {field} cannot be used without operation",values:{field:i.field}});break;case"failedParsing":n=u.i18n.translate("xpack.lens.indexPattern.formulaExpressionParseError",{defaultMessage:"The Formula {expression} cannot be parsed",values:{expression:i.expression}});break;case"tooManyArguments":n=u.i18n.translate("xpack.lens.indexPattern.formulaWithTooManyArguments",{defaultMessage:"The operation {operation} has too many arguments",values:{operation:i.operation}});break;case"missingMathArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaMathMissingArgument",{defaultMessage:"The operation {operation} in the Formula is missing {count} arguments: {params}",values:{operation:i.operation,count:i.count,params:i.params}});break;case"tooManyQueries":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationDoubleQueryError",{defaultMessage:"Use only one of kql= or lucene=, not both"});break;case"tooManyFirstArguments":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationTooManyFirstArguments",{defaultMessage:"The operation {operation} in the Formula requires a {supported, plural, one {single} other {supported}} {type}, found: {text}",values:{operation:i.operation,text:i.text,type:i.type,supported:i.supported||1}});break;case"wrongArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationwrongArgument",{defaultMessage:"The operation {operation} in the Formula does not support {type} parameters, found: {text}",values:{operation:i.operation,text:i.text,type:i.type}});break;case"wrongReturnedType":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationWrongReturnedType",{defaultMessage:"The return value type of the operation {text} is not supported in Formula.",values:{text:i.text}});break;case"filtersTypeConflict":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationFiltersTypeConflicts",{defaultMessage:'The Formula filter of type "{outerType}" is not compatible with the inner filter of type "{innerType}" from the {operation} operation.',values:{operation:i.operation,outerType:i.outerType,innerType:i.innerType}});break;default:n="no Error found"}return{message:n,locations:a}}function Mi(e,t){let a;try{a=Object(di.parse)(e)}catch(a){const n=((e,t)=>{const a=e.split("\n").join(""),n=a.split(",").filter((e=>/(kql|lucene)/.test(e))),i=Object.keys(t).some((e=>a.includes(e)));if(0===n.length||!i)return;const l=n.flatMap((e=>e.split("count").filter((e=>/(kql|lucene)/.test(e))))),[s,r]=Object(Se.partition)(l,(e=>/kql/.test(e))),o=[];for(const e of s){const t=Ii(e,"kql");t&&o.push(t)}for(const e of r){const t=Ii(e,"lucene");t&&o.push(t)}return o.length?o:void 0})(e,t);return n?{root:null,error:{message:n[0],locations:[]}}:{root:null,error:Ti({messageId:"failedParsing",values:{expression:e},locations:[]})}}return{root:a,error:null}}function Fi(e,t,a,n,i){return[...wi(e,t,a,n),...Si(e,t,a,n,i)]}function wi(e,t,a,n){const i=[],l=function(e,t){const a=(n=e,function e(t){return Object(Se.isObject)(t)&&"function"===t.type?[t,...t.args.flatMap(e)].filter(Boolean):[]}(n)).filter((e=>!ji(e)&&!t[e.name]));var n;return{names:Array.from(new Set(a.map((({name:e})=>e)))),locations:a.map((({location:e})=>e)).filter((e=>e))}}(e,n);l.names.length&&i.push(Ti({messageId:"missingOperation",values:{operationLength:l.names.length,operationsList:l.names.join(", ")},locations:l.locations}));const s=Oi(e).filter((({value:e})=>!a.getFieldByName(e)&&!t.columns[e]));s.length&&i.push(Ti({messageId:"missingField",values:{variablesLength:s.length,variablesList:s.map((({value:e})=>e)).join(", ")},locations:s.map((({location:e})=>e))}));const r=function(e,t){const a=[];return Object(Se.isObject)(e)&&"variable"===e.type&&!t.has(e.value)&&a.push(Ti({messageId:"fieldWithNoOperation",values:{field:e.value},locations:[e.location]})),a}(e,new Set(s.map((({value:e})=>e))));return[...i,...r]}function Ci(e,t,a,n){const i=[],{conflicts:l,innerType:s,outerType:r}=function(e,t=[],a){const n=xi(e,t);if(!e.filterable||!a||!n.kql&&!n.lucene)return{conflicts:!1};const i="kuery"===a.language?"kql":a.language;return{conflicts:!(i in n),innerType:n.lucene?"lucene":"kql",outerType:i}}(t,a,n);return l&&s&&r&&i.push(Ti({messageId:"filtersTypeConflict",values:{operation:e.name,innerType:s,outerType:r},locations:e.location?[e.location]:[]})),i}function _i(e,t,a,n){const i=[],l=function(e,t=[]){return Ai(e,t).filter((({isMissing:e,isRequired:t})=>e&&t))}(t,a);l.length&&i.push(Ti({messageId:"missingParameter",values:{operation:e.name,params:l.map((({name:e})=>e)).join(", ")},locations:e.location?[e.location]:[]}));const s=function(e,t=[]){return Ai(e,t).filter((({isCorrectType:e,isMissing:t})=>!e&&!t))}(t,a);s.length&&i.push(Ti({messageId:"wrongTypeParameter",values:{operation:e.name,params:s.map((({name:e})=>e)).join(", ")},locations:e.location?[e.location]:[]}));const r=function(e=[]){const t=Object.create(null);for(const{name:a}of e){const e=t[a]||0;t[a]=e+1}const a=Object.keys(t);return e.length>a.length?a.filter((e=>t[e]>1)):[]}(a);r.length&&i.push(Ti({messageId:"duplicateArgument",values:{operation:e.name,params:r.join(", ")},locations:e.location?[e.location]:[]}));const o=function(e,t){const a=[];return(null!=e?e:[]).forEach((e=>{if("kql"===e.name||"lucene"===e.name){const n=(({value:e,name:t,text:a},n)=>{const i=Ii(a,t);if(i)return i;try{return void("kql"===t?Object(pi.g)(Object(pi.d)(e),n):Object(pi.f)(e))}catch(e){return e.message}})(e,t);n&&a.push({message:n,locations:[e.location]})}"shift"===e.name&&"invalid"===Object(mi.parseTimeShift)(e.value)&&a.push({message:u.i18n.translate("xpack.lens.indexPattern.invalidTimeShift",{defaultMessage:"Invalid time shift. Enter positive integer amount followed by one of the units s, m, h, d, w, M, y. For example 3h for 3 hours"}),locations:[e.location]})})),a}(a,n);o.length&&i.push(...o);const c=function(e){return e?e.filter((e=>"kql"===e.name||"lucene"===e.name)).length>1:void 0}(a);return c&&i.push(Ti({messageId:"tooManyQueries",values:{},locations:e.location?[e.location]:[]})),i}function Si(e,t,a,n,i){const l=Oi(e).filter((({value:e})=>!a.getFieldByName(e)&&!t.columns[e])),s=new Set(l.map((({value:e})=>e))),r=null==i?void 0:i.filter;return function e(t){if(!Object(Se.isObject)(t)||"function"!==t.type)return[];const i=n[t.name],l=[],{namedArguments:o,functions:c,variables:d}=fi(t.args),[p]=(null==t?void 0:t.args)||[];if(i){if("field"===i.input){if(Li(t)){if(Ni(p,"variable")){const e=Bi(t,d,{isFieldOperation:!0,firstArg:p,returnedType:Pi(i,a,p)});e.length&&l.push(...e)}else ji(p)?l.push(Ti({messageId:"wrongFirstArgument",values:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),argument:"math operation"},locations:t.location?[t.location]:[]})):l.push(Ti({messageId:"wrongFirstArgument",values:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),argument:bi(p)||u.i18n.translate("xpack.lens.indexPattern.formulaNoFieldForOperation",{defaultMessage:"no field"})},locations:t.location?[t.location]:[]}));const e=Vi(t,c,0,{isFieldOperation:!0,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),firstArgValidation:!1});e.length&&l.push(...e)}else(null!=c&&c.length||null!=d&&d.length)&&l.push(Ti({messageId:"shouldNotHaveField",values:{operation:t.name},locations:t.location?[t.location]:[]}));if(!Ei(i)&&o.length)l.push(Ti({messageId:"cannotAcceptParameter",values:{operation:t.name},locations:t.location?[t.location]:[]}));else{const e=_i(t,i,o,a),n=Ci(t,i,o,r);l.push(...e,...n)}return l}if("fullReference"===i.input){const e=Boolean(!Ni(p,"function")||ji(p)&&zi(p,s).length);e&&l.push(Ti({messageId:"wrongFirstArgument",values:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaOperationValue",{defaultMessage:"operation"}),argument:bi(p)||u.i18n.translate("xpack.lens.indexPattern.formulaNoOperation",{defaultMessage:"no operation"})},locations:t.location?[t.location]:[]}));const n=Vi(t,c,i.requiredReferences?i.requiredReferences.length:1,{isFieldOperation:!1,firstArgValidation:e,type:u.i18n.translate("xpack.lens.indexPattern.formulaMetricValue",{defaultMessage:"metric"})});if(n.length&&l.push(...n),!Ei(i)&&o.length)l.push(Ti({messageId:"cannotAcceptParameter",values:{operation:t.name},locations:t.location?[t.location]:[]}));else{const e=Bi(t,d,{isFieldOperation:!1,firstArg:p,returnedType:void 0}),n=_i(t,i,o,a),s=Ci(t,i,o,r);l.push(...e,...n,...s)}}return l.concat(e(c[0]))}return l.push(...zi(t,s)),null!=c&&c.length?l.concat(c.flatMap((t=>e(t)))):l}(e)}function Ei(e){return Boolean((e.operationParams||[]).length)||e.filterable}function Pi(e,t,a){var n;const i=Oi(a);if(1!==i.length)return;const l=t.getFieldByName(bi(i[0]));return l?null===(n=e.getPossibleOperationForField(l))||void 0===n?void 0:n.scale:void 0}function Ai(e,t=[]){var a;const n=xi(e,t),i=[...null!==(a=e.operationParams)&&void 0!==a?a:[]];return e.filterable&&i.push({name:"kql",type:"string",required:!1},{name:"lucene",type:"string",required:!1}),i.map((({name:e,type:t,required:a})=>({name:e,isMissing:!(e in n),isCorrectType:typeof n[e]===t,isRequired:a})))}function Li(e){return Di(e.name)}function Di(e){return!["count"].includes(e)}function Ni(e,t){return Object(Se.isObject)(e)&&e.type===t}function zi(e,t){const a=function(e){return function e(t){return Object(Se.isObject)(t)&&"function"===t.type&&ji(t)?[t,...t.args.flatMap(e)].filter(Boolean):[]}(e)}(e),n=[];return a.forEach((e=>{const{positionalArguments:a}=vi[e.name];if(!e.args.length)return n.push(Ti({messageId:"wrongFirstArgument",values:{operation:e.name,type:"operation",argument:"()"},locations:e.location?[e.location]:[]}));e.args.length>a.length&&n.push(Ti({messageId:"tooManyArguments",values:{operation:e.name},locations:e.location?[e.location]:[]})),a.some(((a,n)=>{const i=e.args[n];if(null!=i&&"number"!=typeof i)return"variable"===i.type&&!t.has(i.value)}))&&n.push(Ti({messageId:"shouldNotHaveField",values:{operation:e.name},locations:e.location?[e.location]:[]}));const i=a.filter((({optional:e})=>!e));if(i.length>1&&e.args.length<i.length){const t=a.filter((({name:t,optional:a},n)=>!a&&null==e.args[n]));n.push(Ti({messageId:"missingMathArgument",values:{operation:e.name,count:i.length-e.args.length,params:t.map((({name:e})=>e)).join(", ")},locations:e.location?[e.location]:[]}))}})),n}function Bi(e,t,{isFieldOperation:a,firstArg:n,returnedType:i}){const l=t.filter((e=>Ni(e,"variable")&&!ji(e))),s=[];var r;return a&&(l.length>1||1===l.length&&l[0]!==n)&&s.push(Ti({messageId:"tooManyFirstArguments",values:{operation:e.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),supported:1,text:l.map((({text:e})=>e)).join(", ")},locations:e.location?[e.location]:[]})),a&&1===l.length&&l[0]===n&&"ordinal"===i&&s.push(Ti({messageId:"wrongReturnedType",values:{text:null!==(r=e.text)&&void 0!==r?r:`${e.name}(${bi(n)})`},locations:e.location?[e.location]:[]})),!a&&l.length&&s.push(Ti({messageId:"wrongArgument",values:{operation:e.name,text:l.map((({text:e})=>e)).join(", "),type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"})},locations:e.location?[e.location]:[]})),s}function Vi(e,t,a=0,{isFieldOperation:n,firstArgValidation:i,type:l}){const s=[],[r,o]=Object(Se.partition)(t,(e=>!ji(e)));return r.length>a&&(n?s.push(Ti({messageId:"wrongArgument",values:{operation:e.name,text:r.map((({text:e})=>e)).join(", "),type:u.i18n.translate("xpack.lens.indexPattern.formulaMetricValue",{defaultMessage:"metric"})},locations:e.location?[e.location]:[]})):s.push(Ti({messageId:"tooManyFirstArguments",values:{operation:e.name,type:l,supported:a,text:r.map((({text:e})=>e)).join(", ")},locations:e.location?[e.location]:[]}))),n&&(!i&&o.length||o.length>1)&&s.push(Ti({messageId:"wrongArgument",values:{operation:e.name,type:l,text:o.map((({text:e})=>e)).join(", ")},locations:e.location?[e.location]:[]})),s}var Ri=a(297),Hi=a.n(Ri),Gi=a(45);function qi({indexPattern:e,operationDefinitionMap:t,isFullscreen:a}){const[n,i]=Object(l.useState)(),r=Object(l.useRef)({});Object(l.useEffect)((()=>{n&&r.current[n]&&r.current[n].scrollIntoView()}),[n]);const o=[];o.push({label:u.i18n.translate("xpack.lens.formulaDocumentationHeading",{defaultMessage:"How it works"}),items:[]}),o.push({label:u.i18n.translate("xpack.lens.formulaFrequentlyUsedHeading",{defaultMessage:"Common formulas"}),description:u.i18n.translate("xpack.lens.formulaCommonFormulaDocumentation",{defaultMessage:'The most common formulas are dividing two values to produce a percent. To display accurately, set "value format" to "percent".'}),items:[{label:u.i18n.translate("xpack.lens.formulaDocumentation.filterRatio",{defaultMessage:"Filter ratio"}),description:Object(y.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.filterRatioDescription.markdown",{defaultMessage:"### Filter ratio:\n\nUse `kql=''` to filter one set of documents and compare it to other documents within the same grouping.\nFor example, to see how the error rate changes over time:\n\n```\ncount(kql='response.status_code > 400') / count()\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})},{label:u.i18n.translate("xpack.lens.formulaDocumentation.weekOverWeek",{defaultMessage:"Week over week"}),description:Object(y.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.weekOverWeekDescription.markdown",{defaultMessage:"### Week over week:\n\nUse `shift='1w'` to get the value of each grouping from\nthe previous week. Time shift should not be used with the *Top values* function.\n\n```\npercentile(system.network.in.bytes, percentile=99) /\npercentile(system.network.in.bytes, percentile=99, shift='1w')\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})},{label:u.i18n.translate("xpack.lens.formulaDocumentation.percentOfTotal",{defaultMessage:"Percent of total"}),description:Object(y.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.percentOfTotalDescription.markdown",{defaultMessage:"### Percent of total\n\nFormulas can calculate `overall_sum` for all the groupings,\nwhich lets you convert each grouping into a percent of total:\n\n```\nsum(products.base_price) / overall_sum(sum(products.base_price))\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})}]}),o.push({label:u.i18n.translate("xpack.lens.formulaDocumentation.elasticsearchSection",{defaultMessage:"Elasticsearch"}),description:u.i18n.translate("xpack.lens.formulaDocumentation.elasticsearchSectionDescription",{defaultMessage:"These functions will be executed on the raw documents for each row of the resulting table, aggregating all documents matching the break down dimensions into a single value."}),items:[]});const c=sl(e);o[2].items.push(...c.filter((e=>{var a;return e in t&&"elasticsearch"===(null===(a=t[e].documentation)||void 0===a?void 0:a.section)})).sort().map((e=>{var a,n;return{label:e,description:Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)("h3",null,e,"(",null===(a=t[e].documentation)||void 0===a?void 0:a.signature,")"),null!==(n=t[e].documentation)&&void 0!==n&&n.description?Object(y.jsx)(d.Markdown,{markdown:t[e].documentation.description}):null)}}))),o.push({label:u.i18n.translate("xpack.lens.formulaDocumentation.columnCalculationSection",{defaultMessage:"Column calculations"}),description:u.i18n.translate("xpack.lens.formulaDocumentation.columnCalculationSectionDescription",{defaultMessage:"These functions are executed for each row, but are provided with the whole column as context. This is also known as a window function."}),items:[]}),o[3].items.push(...c.filter((e=>{var a;return e in t&&"calculation"===(null===(a=t[e].documentation)||void 0===a?void 0:a.section)})).sort().map((e=>{var a,i;return{label:e,description:Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)("h3",null,e,"(",null===(a=t[e].documentation)||void 0===a?void 0:a.signature,")"),null!==(i=t[e].documentation)&&void 0!==i&&i.description?Object(y.jsx)(d.Markdown,{markdown:t[e].documentation.description}):null),checked:n===`${e}: ${t[e].displayName}`?"on":void 0}}))),o.push({label:u.i18n.translate("xpack.lens.formulaDocumentation.mathSection",{defaultMessage:"Math"}),description:u.i18n.translate("xpack.lens.formulaDocumentation.mathSectionDescription",{defaultMessage:"These functions will be executed for reach row of the resulting table using single values from the same row calculated using other functions."}),items:[]});const p=Object(l.useMemo)((()=>sl(e).filter((e=>e in vi)).sort().map((e=>{const[t,a]=vi[e].help.split("```");return{label:e,description:t.replace(/\n/g,"\n\n"),examples:a?`\`\`\`${a}\`\`\``:""}}))),[e]);o[4].items.push(...p.map((({label:e,description:a,examples:n})=>({label:e,description:Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)("h3",null,Wi(e,t)),Object(y.jsx)(d.Markdown,{markdown:`${a}${n}`}))}))));const[m,g]=Object(l.useState)(""),b=m.trim().toLocaleLowerCase(),h=o.map((e=>{const t=e.items.filter((e=>!b||e.label.toLocaleLowerCase().includes(b)));return{...e,items:t}})).filter((e=>e.items.length>0||!b||e.label.toLocaleLowerCase().includes(b)));return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiPopoverTitle,{className:"lnsFormula__docsHeader",paddingSize:"m"},u.i18n.translate("xpack.lens.formulaDocumentation.header",{defaultMessage:"Formula reference"})),Object(y.jsx)(f.EuiFlexGroup,{className:"lnsFormula__docsContent",gutterSize:"none",responsive:!1,alignItems:"stretch"},Object(y.jsx)(f.EuiFlexItem,{className:"lnsFormula__docsSidebar",grow:1},Object(y.jsx)(f.EuiFlexGroup,{className:"lnsFormula__docsSidebarInner",direction:"column",gutterSize:"none",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{className:"lnsFormula__docsSearch",grow:!1},Object(y.jsx)(f.EuiFieldSearch,{value:m,onChange:e=>{g(e.target.value)},placeholder:u.i18n.translate("xpack.lens.formulaSearchPlaceholder",{defaultMessage:"Search functions"})})),Object(y.jsx)(f.EuiFlexItem,{className:"lnsFormula__docsNav"},h.map(((e,t)=>Object(y.jsx)("nav",{className:"lnsFormula__docsNavGroup",key:e.label},Object(y.jsx)(f.EuiTitle,{size:"xxs"},Object(y.jsx)("h6",null,Object(y.jsx)(f.EuiLink,{className:"lnsFormula__docsNavGroupLink",color:"text",onClick:()=>{i(e.label)}},Object(y.jsx)(f.EuiHighlight,{search:m},e.label)))),e.items.length?Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiSpacer,{size:"s"}),Object(y.jsx)(f.EuiListGroup,{gutterSize:"none"},e.items.map((e=>Object(y.jsx)(f.EuiListGroupItem,{key:e.label,label:Object(y.jsx)(f.EuiHighlight,{search:m},e.label),size:"s",onClick:()=>{i(e.label)}}))))):null)))))),Object(y.jsx)(f.EuiFlexItem,{className:"lnsFormula__docsText",grow:2},Object(y.jsx)(f.EuiText,{size:"s"},Object(y.jsx)("section",{className:"lnsFormula__docsTextIntro",ref:e=>{e&&(r.current[o[0].label]=e)}},Object(y.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.markdown",{defaultMessage:"## How it works\n\nLens formulas let you do math using a combination of Elasticsearch aggregations and\nmath functions. There are three main types of functions:\n\n* Elasticsearch metrics, like `sum(bytes)`\n* Time series functions use Elasticsearch metrics as input, like `cumulative_sum()`\n* Math functions like `round()`\n\nAn example formula that uses all of these:\n\n```\nround(100 * moving_average(\n  average(cpu.load.pct),\n  window=10,\n  kql='datacenter.name: east*'\n))\n```\n\nElasticsearch functions take a field name, which can be in quotes. `sum(bytes)` is the same\nas `sum('bytes')`.\n\nSome functions take named arguments, like `moving_average(count(), window=5)`.\n\nElasticsearch metrics can be filtered using KQL or Lucene syntax. To add a filter, use the named\nparameter `kql='field: value'` or `lucene=''`. Always use single quotes when writing KQL or Lucene\nqueries. If your search has a single quote in it, use a backslash to escape, like: `kql='Women's''\n\nMath functions can take positional arguments, like pow(count(), 3) is the same as count() * count() * count()\n\nUse the symbols +, -, /, and * to perform basic math.\n                  ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})),o.slice(1).map(((e,t)=>Object(y.jsx)("section",{className:"lnsFormula__docsTextGroup",key:e.label,ref:t=>{t&&(r.current[e.label]=t)}},Object(y.jsx)("h2",null,e.label),Object(y.jsx)("p",null,e.description),o[t+1].items.map((e=>Object(y.jsx)("article",{className:"lnsFormula__docsTextItem",key:e.label,ref:t=>{t&&(r.current[e.label]=t)}},e.description))))))))))}const $i=s.a.memo(qi);function Wi(e,t,a){if(vi[e])return`${e}(${vi[e].positionalArguments.map((({name:e,optional:t,type:a})=>`[${e}]${t?"?":""}: ${a}`)).join(", ")})`;if(t[e]){var n;const a=t[e];let i="";return a.filterable&&(i+=Di(e)||"operationParams"in a?",":"",i+=u.i18n.translate("xpack.lens.formula.kqlExtraArguments",{defaultMessage:"[kql]?: string, [lucene]?: string"})),a.filterable&&a.shiftable&&(i+=", "),a.shiftable&&(i+=u.i18n.translate("xpack.lens.formula.shiftExtraArguments",{defaultMessage:"[shift]?: string"})),`${e}(${null===(n=a.documentation)||void 0===n?void 0:n.signature}${i})`}return""}function Ui(e){return e.map((({name:e,type:t,defaultValue:a=5})=>`${e}=${"string"===t?`"${a}"`:a}`)).join(", ")}const Yi=[{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.hour",{defaultMessage:"1 hour ago (1h)"}),value:"1h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.3hours",{defaultMessage:"3 hours ago (3h)"}),value:"3h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.6hours",{defaultMessage:"6 hours ago (6h)"}),value:"6h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.12hours",{defaultMessage:"12 hours ago (12h)"}),value:"12h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.day",{defaultMessage:"1 day ago (1d)"}),value:"1d"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.week",{defaultMessage:"1 week ago (1w)"}),value:"1w"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.month",{defaultMessage:"1 month ago (1M)"}),value:"1M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.3months",{defaultMessage:"3 months ago (3M)"}),value:"3M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.6months",{defaultMessage:"6 months ago (6M)"}),value:"6M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.year",{defaultMessage:"1 year ago (1y)"}),value:"1y"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.previous",{defaultMessage:"Previous time range"}),value:"previous"}],Xi=Yi.reduce(((e,{value:t},a)=>({...e,[t]:a})),{});function Ki(e,t,a,n){const i=e.columnOrder.find((t=>"date_histogram"===e.columns[t].operationType));if(!i&&!t.timeFieldName)return{canShift:!1,hasDateHistogram:!1};if(i&&a&&a[n]&&a[n]){const e=a[n].columns.find((e=>e.id===i));if(e){var l;const t=(null===(l=Ja.search.aggs.getDateHistogramMetaDataByDatatableColumn(e))||void 0===l?void 0:l.interval)||"";return{interval:Ja.search.aggs.parseInterval(t),expression:t,canShift:!0,hasDateHistogram:!0}}}return{canShift:!0,hasDateHistogram:Boolean(i)}}function Zi({interval:e,hasDateHistogram:t,canShift:a}){return{canShift:a,isValueTooSmall:t=>e&&t&&"object"==typeof t&&t.asMilliseconds()<e.asMilliseconds(),isValueNotMultiple:t=>e&&t&&"object"==typeof t&&!Number.isInteger(t.asMilliseconds()/e.asMilliseconds()),isInvalid:e=>Boolean("invalid"===e||t&&e&&"previous"===e)}}function Qi(e,t){const a=e.columns[t];if(a.timeShift&&"previous"===Object(mi.parseTimeShift)(a.timeShift))return Object.values(e.columns).some((e=>"date_histogram"===e.operationType))?[u.i18n.translate("xpack.lens.indexPattern.dateHistogramTimeShift",{defaultMessage:'In a single layer, you are unable to combine previous time range shift with date histograms. Either use an explicit time shift duration in "{column}" or replace the date histogram.',values:{column:a.label}})]:void 0}function Ji(e,{activeData:t}){if(!e)return;const a=[];return Object.entries(e.layers).forEach((([n,i])=>{const l=e.indexPatterns[i.indexPatternId];if(!l)return;const s=Ki(i,l,t,n);if(!s.interval)return;const r=s.expression,o=s.interval.asMilliseconds();let u=[];const d={};Object.entries(i.columns).forEach((([e,t])=>{if(t.isBucketed)return;let a=0;if(t.timeShift){const e=Object(mi.parseTimeShift)(t.timeShift);if("previous"===e||"invalid"===e)return;a=e.asMilliseconds()}u.push(a),d[a]||(d[a]=[]),d[a].push(e)})),u=Object(Se.uniq)(u),u.length<2||u.forEach((e=>{0!==e&&(e<o?d[e].forEach((e=>{a.push(Object(y.jsx)(c.FormattedMessage,{key:`small-${e}`,id:"xpack.lens.indexPattern.timeShiftSmallWarning",defaultMessage:"{label} uses a time shift of {columnTimeShift} which is smaller than the date histogram interval of {interval}. To prevent mismatched data, use a multiple of {interval} as time shift.",values:{label:Object(y.jsx)("strong",null,i.columns[e].label),interval:Object(y.jsx)("strong",null,r),columnTimeShift:Object(y.jsx)("strong",null,i.columns[e].timeShift)}}))})):Number.isInteger(e/o)||d[e].forEach((e=>{a.push(Object(y.jsx)(c.FormattedMessage,{key:`multiple-${e}`,id:"xpack.lens.indexPattern.timeShiftMultipleWarning",defaultMessage:"{label} uses a time shift of {columnTimeShift} which is not a multiple of the date histogram interval of {interval}. To prevent mismatched data, use a multiple of {interval} as time shift.",values:{label:Object(y.jsx)("strong",null,i.columns[e].label),interval:Object(y.jsx)("strong",null,r),columnTimeShift:Object(y.jsx)("strong",null,i.columns[e].timeShift)}}))})))}))})),a}let el;!function(e){e.FIELD="field",e.NAMED_ARGUMENT="named_argument",e.FUNCTIONS="functions",e.KQL="kql",e.SHIFTS="shifts"}(el||(el={}));const tl="LENS_MATH_MARKER";function al(e,t,a){if("number"!=typeof e&&(!e.location||(n=t)>=(i=e.location).min&&n<i.max)){var n,i;if("function"===e.type){const[a]=e.args.map((a=>al(a,t,e))).filter((e=>e));return a||(e.location?{ast:e}:void 0)}return{ast:e,parent:a}}}function nl(e,t){const a=e.split(/\n/);let n=t,i=1;for(const e of a){if(e.length>=n)return new Gi.monaco.Position(i,n+1);n-=e.length+1,i++}throw new Error("Algorithm failure")}function il(e,t){return e.split(/\n/).slice(0,t.lineNumber).reduce(((e,a,n)=>e+(n===t.lineNumber-1?t.column-1:a.length+1)),0)}async function ll({expression:e,zeroIndexedOffset:t,context:a,indexPattern:n,operationDefinitionMap:i,dataViews:l,unifiedSearch:s,dateHistogramInterval:r}){const o=e.substr(0,t)+tl+e.substr(t);try{const e=al(Object(di.parse)(o),t),u=null==e?void 0:e.ast,c=(null==e?void 0:e.parent)&&"number"!=typeof u&&u&&"type"in u&&"namedArgument"===u.type;if(null!=e&&e.parent&&("="===a.triggerCharacter||c))return await async function({ast:e,unifiedSearch:t,dataViews:a,indexPattern:n,dateHistogramInterval:i}){if("shift"===e.name)return{list:Yi.filter((({value:e})=>{if(void 0===i)return!0;const t=Object(mi.parseTimeShift)(e);return"previous"!==t&&("invalid"===t||Number.isInteger(t.asMilliseconds()/i))})).map((({value:e})=>e)),type:el.SHIFTS};if("kql"!==e.name&&"lucene"!==e.name)return{list:[],type:el.KQL};if(!t.autocomplete.hasQuerySuggestions("kql"===e.name?"kuery":"lucene"))return{list:[],type:el.KQL};const l=e.value.split(tl)[0],s=e.value.indexOf(tl)+1,r=await t.autocomplete.getQuerySuggestions({language:"kql"===e.name?"kuery":"lucene",query:l,selectionStart:s,selectionEnd:s,indexPatterns:[await a.get(n.id)],boolFilter:[]});return{list:null!=r?r:[],type:el.KQL}}({ast:u,unifiedSearch:s,dataViews:l,indexPattern:n,dateHistogramInterval:r});if(null!=e&&e.parent)return function(e,t,a,n,i){const{name:l}=e,s=i[l];if(!s&&!vi[l])return{list:[],type:el.FIELD};const r=vi[l];if(r)return r.positionalArguments[t]?{list:Object(Se.uniq)(sl(n,i)).map((e=>({type:"math",label:e}))),type:el.FUNCTIONS}:{list:[],type:el.FIELD};if(t>0||!Di(s.type)){const{namedArguments:t}=fi(e.args),a=[];return s.filterable&&(t.find((e=>"kql"===e.name||"lucene"===e.name))||(a.push("kql"),a.push("lucene"))),s.shiftable&&(t.find((e=>"shift"===e.name))||a.push("shift")),"operationParams"in s&&a.push(...s.operationParams.filter((e=>!t.find((t=>t.name===e.name)))).map((e=>e.name))),{list:a,type:el.NAMED_ARGUMENT}}if("field"===s.input&&0===t){const t=cu(n,i).find((({operationMetaData:e})=>"number"===e.dataType&&!e.isBucketed));if(t){const n=t.operations.filter((e=>e.operationType===s.type)).map((e=>"field"in e?e.field:void 0)).filter((e=>e)),i=e.args[0],l="string"!=typeof i&&i.location;let r;if(l){const e=nl(a,l.min),t=nl(a,l.max-tl.length);r=Gi.monaco.Range.fromPositions(e,t)}return{list:n,type:el.FIELD,range:r}}return{list:[],type:el.FIELD}}if("fullReference"===s.input){const e=cu(n,i),t=[];return e.forEach((e=>{s.requiredReferences.some((t=>t.validateMetadata(e.operationMetaData)))&&t.push(...e.operations.filter((e=>s.requiredReferences.some((t=>t.input.includes(e.type))))).map((e=>e.operationType)))})),{list:Object(Se.uniq)(t).map((e=>({label:e,type:"operation"}))),type:el.FUNCTIONS}}return{list:[],type:el.FIELD}}(e.parent,e.parent.args.findIndex((e=>e===u)),o,n,i);if("object"==typeof u&&Boolean("variable"===u.type||"function"===u.type))return function(e,t,a){return{list:Object(Se.uniq)(sl(t,a).filter((t=>Object(Se.startsWith)(t,e)))).map((e=>({label:e,type:"operation"}))),type:el.FUNCTIONS}}(("function"===u.type?u.name:u.value).split(tl)[0],n,i)}catch(e){}return{list:[],type:el.FIELD}}function sl(e,t){const a=cu(e,t),n=[];return a.forEach((e=>{"number"!==e.operationMetaData.dataType||e.operationMetaData.isBucketed||n.push(...e.operations.filter((e=>"managedReference"!==e.type)).map((e=>e.operationType)))})),[...Object(Se.uniq)(n),...Object.keys(vi)]}const rl={title:"Trigger Suggestion Dialog",id:"editor.action.triggerSuggest"};function ol(e,t){if(vi[e])return[{label:Wi(e,t),documentation:{value:vi[e].help.replace(/\n/g,"\n\n")},parameters:vi[e].positionalArguments.map((e=>({label:e.name,documentation:e.optional?u.i18n.translate("xpack.lens.formula.optionalArgument",{defaultMessage:"Optional. Default value is {defaultValue}",values:{defaultValue:e.defaultValue}}):""})))}];if(t[e]){const a=t[e],n=Di(e)?{label:"field"===a.input?"field":"fullReference"===a.input?"function":""}:null,i=Wi(e,t),l=function(e,t){const{description:a,examples:n}=function(e,t){var a,n;const i=t[e],l=null!==(a=null===(n=i.documentation)||void 0===n?void 0:n.description)&&void 0!==a?a:"",s=[];if(!/Example/.test(l)){if(!Di(e))return s.push(`${e}()`),{description:l,examples:s};if("field"===i.input){var r;const t=(null===(r=i.operationParams)||void 0===r?void 0:r.filter((({required:e})=>e)))||[];if(0===t.length&&s.push(`${e}(bytes)`),t.length){const a=Ui(t);s.push(`${e}(bytes, ${a})`)}if(i.operationParams&&t.length!==i.operationParams.length){const t=Ui(i.operationParams);s.push(`${e}(bytes, ${t})`)}}if("fullReference"===i.input){var o;const t=(null===(o=i.operationParams)||void 0===o?void 0:o.filter((({required:e})=>e)))||[];if(0===t.length&&s.push(`${e}(sum(bytes))`),t.length){const a=Ui(t);s.push(`${e}(sum(bytes), ${a})`)}if(i.operationParams&&t.length!==i.operationParams.length){const t=Ui(i.operationParams);s.push(`${e}(sum(bytes), ${t})`)}}}return{description:l,examples:s}}(e,t);return{value:`${a}${n.length?`\n\n**${u.i18n.translate("xpack.lens.formulaExampleMarkdown",{defaultMessage:"Examples"})}**\n\n  ${n.map((e=>`\`${e}\``)).join("\n\n")}`:""}`}}(e,t);return"operationParams"in a&&a.operationParams?[{label:i,parameters:[...n?[n]:[],...a.operationParams.map((e=>({label:`${e.name}=${e.type}`,documentation:e.required?u.i18n.translate("xpack.lens.formula.requiredArgument",{defaultMessage:"Required"}):""})))],documentation:l}]:[{label:i,parameters:n?[n]:[],documentation:l}]}return[]}function ul(e,t){const a=e.substr(0,t)+tl+e.substr(t);try{return al(Object(di.parse)(a),t)}catch(e){return}}const cl="lens_math";Gi.monaco.languages.register({id:cl});Gi.monaco.languages.setMonarchTokensProvider(cl,{defaultToken:"invalid",tokenPostfix:"",ignoreCase:!0,brackets:[{open:"(",close:")",token:"delimiter.parenthesis"}],escapes:/\\(?:[\\"'])/,tokenizer:{root:[[/\s+/,"whitespace"],[/-?(\d*\.)?\d+([eE][+\-]?\d+)?/,"number"],[/[a-zA-Z0-9][a-zA-Z0-9_\-\.]*/,"keyword"],[/[,=:]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_dq"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/'/,"string","@string_sq"],[/\+|\-|\*|\//,"keyword.operator"],[/[\(]/,"delimiter"],[/[\)]/,"delimiter"]],string_dq:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_sq:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]]}}),Gi.monaco.languages.setLanguageConfiguration(cl,{wordPattern:/[^()'"\s]+/g,brackets:[["(",")"]],autoClosingPairs:[{open:"(",close:")"},{open:"'",close:"'"},{open:'"',close:'"'}],surroundingPairs:[{open:"(",close:")"},{open:"'",close:"'"},{open:'"',close:'"'}]}),a(292);const dl={type:"math",displayName:"Math",hidden:!0,getDefaultLabel:(e,t)=>"Math",input:"managedReference",getDisabledStatus(e){},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),toExpression:(e,t)=>{const a=e.columns[t];return[{type:"function",function:"mathColumn",arguments:{id:[t],name:[a.label],expression:[pl(a.params.tinymathAst)],onError:["null"]}}]},buildColumn:()=>({label:"Math",dataType:"number",operationType:"math",isBucketed:!1,scale:"ratio",params:{tinymathAst:""},references:[]}),isTransferable:(e,t)=>!0,createCopy:e=>({...e})};function pl(e){return"number"==typeof e?e:"string"==typeof e?`"${e}"`:"variable"===e.type?e.value:"namedArgument"===e.type?"kql"===e.name||"lucene"===e.name?`${e.name}='${e.value}'`:`${e.name}=${e.value}`:`${e.name}(${e.args.map(pl).join(",")})`}const ml={displayName:u.i18n.translate("xpack.lens.indexPattern.records",{defaultMessage:"Records"}),name:D.d,type:"document",aggregatable:!0,searchable:!0};function gl(e,t){return`${e}X${t}`}function fl(e,t,a,n){const i={...a,columns:{...a.columns,[e]:{...t}}},{columns:l,meta:s}=Object.entries(i.columns).reduce(((t,[a,l])=>{if(a.startsWith(e)){if(a===e&&function(e){return"params"in e&&"formula"in e.params}(l)){const e=function(e,t,a,{indexPattern:n,operations:i=au}){const{columns:l,meta:s}={columns:{},meta:{locations:{}}},r=t.params.formula||"",{extracted:o,isValid:c}=function(e,t,a,n,i,l){const{root:s,error:r}=Mi(e,i);if(r||null==s)return{extracted:[],isValid:!1};if(Fi(s,t,n,i,t.columns[a]).length)return{extracted:[],isValid:!1};const o=function(e,t,a,n,i,l){const s=[],r=n.columns[e].filter,o=function a(o){if("number"==typeof o||"function"!==o.type)return o;const u=t[o.name];if(!u){const e=o.args.map(a).filter((e=>null!=e));return{...o,args:e}}const{namedArguments:c,variables:d,functions:p}=fi(o.args);if("field"===u.input){const[t]=d.filter((e=>Object(Se.isObject)(e))),a=Li(o)?i.getFieldByName(t.value):ml,p={...hi(u,xi(u,c||[]),r),usedInMath:!0},m=u.buildColumn({layer:n,indexPattern:i,field:a},p),g=gl(e,s.length);return m.customLabel=!0,m.label=l,s.push({column:m,location:o.location}),g}if("fullReference"===u.input){const[t]=p,d=a(t),m="string"!=typeof d;if(m){const e=d?Oi(d):[],t=dl.buildColumn({layer:n,indexPattern:i});t.references=e.map((({value:e})=>e)),t.params.tinymathAst=d,s.push({column:t}),t.customLabel=!0,t.label=l}const g=hi(u,xi(u,c||[]),r),f=u.buildColumn({layer:n,indexPattern:i,referenceIds:[m?gl(e,s.length-1):d]},g),b=gl(e,s.length);return f.customLabel=!0,f.label=l,s.push({column:f,location:o.location}),b}}(a);if(void 0===o)return[];if("string"!=typeof o){const e=Oi(o),t=dl.buildColumn({layer:n,indexPattern:i});t.references=e.map((({value:e})=>e)),t.params.tinymathAst=o,t.customLabel=!0,t.label=l,s.push({column:t})}return s}(a,i,s,t,n,u.i18n.translate("xpack.lens.indexPattern.formulaPartLabel",{defaultMessage:"Part of {label}",values:{label:l||e}}));return{extracted:o,isValid:!0}}(r,a,e,n,ki(i),t.customLabel?t.label:void 0);return o.forEach((({column:t,location:a},n)=>{const i=gl(e,n);l[i]=t,a&&(s.locations[i]=a)})),l[e]={...t,label:t.customLabel?t.label:null!=r?r:u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"}),references:c?[gl(e,o.length-1)]:[],params:{...t.params,formula:r,isFormulaBroken:!c}},{columns:l,meta:s}}(a,l,i,n);t.columns={...t.columns,...e.columns},t.meta={...t.meta,...e.meta}}}else t.columns[a]={...l};return t}),{columns:{},meta:{locations:{}}});return{layer:{...i,columns:l,columnOrder:ks({...i,columns:l})},meta:s}}function bl(e,t,a){const n=null==e?void 0:e[t];return!(!n||0===n.rows.length)&&n.rows.some((e=>null!=e[a]))}const hl=s.a.memo(xl);function xl({layer:e,updateLayer:t,currentColumn:a,columnId:n,indexPattern:r,operationDefinitionMap:o,unifiedSearch:c,dataViews:p,toggleFullscreen:m,isFullscreen:g,setIsCloseable:b,dateHistogramInterval:h,hasData:v}){var O;const[k,I]=Object(l.useState)(a.params.formula),[T,M]=Object(l.useState)([]),[F,w]=Object(l.useState)(g),[C,_]=Object(l.useState)(!1),[S,E]=Object(l.useState)(!0),P=s.a.useRef(),A=s.a.useRef(),L=s.a.useRef([]),D=s.a.useRef(),N=Object(l.useMemo)((()=>ki(o)),[o]),z="interval"in h?null===(O=h.interval)||void 0===O?void 0:O.asMilliseconds():void 0,B=Object(l.useRef)(z);if(B.current=z,null==A||!A.current){const e=A.current=document.createElement("div");e.setAttribute("data-test-subj","lnsFormulaWidget"),e.classList.add("lnsFormulaOverflow","monaco-editor"),document.body.appendChild(e)}Object(l.useEffect)((()=>{const e=P,t=L,a=D;return()=>{var n,i,l,s,r;null===(n=e.current)||void 0===n||n.dispose(),null===(i=A.current)||void 0===i||null===(l=i.parentNode)||void 0===l||l.removeChild(A.current),null===(s=a.current)||void 0===s||s.dispose(),null===(r=t.current)||void 0===r||r.forEach((e=>e.dispose()))}}),[]),Hi()((()=>{b(!0),k!==a.params.formula&&t((e=>fl(n,{...a,params:{...a.params,formula:k||""}},e,{indexPattern:r,operations:o}).layer))})),Object(j.o)((()=>{if(!P.current)return;if(!k)return M([]),Gi.monaco.editor.setModelMarkers(P.current,"LENS",[]),void(a.params.formula&&t(fl(n,{...a,params:{...a.params,formula:k||""}},e,{indexPattern:r,operations:o}).layer));let i=[];const{root:l,error:s}=Mi(k,N);if(s)i=[s];else if(l){const t=Fi(l,e,r,N,a);t.length&&(i=t)}if(i.length){const l=a.params.isFormulaBroken,s=!a.params.isFormulaBroken&&!v;(l||s)&&a.params.formula!==k&&t(fl(n,{...a,params:{...a.params,formula:k||""}},e,{indexPattern:r,operations:o}).layer);const u=i.flatMap((e=>{if(e.locations.length)return e.locations.map((t=>{const a=nl(k,t.min),n=nl(k,t.max);return{message:e.message,startColumn:a.column+1,startLineNumber:a.lineNumber,endColumn:n.column+1,endLineNumber:n.lineNumber,severity:"warning"===e.severity?Gi.monaco.MarkerSeverity.Warning:Gi.monaco.MarkerSeverity.Error}}));{const t=nl(k,0),a=nl(k,k.length-1);return[{message:e.message,startColumn:t.column+1,startLineNumber:t.lineNumber,endColumn:a.column+1,endLineNumber:a.lineNumber,severity:"warning"===e.severity?Gi.monaco.MarkerSeverity.Warning:Gi.monaco.MarkerSeverity.Error}]}}));Gi.monaco.editor.setModelMarkers(P.current,"LENS",u),M(u.map((({severity:e,message:t})=>({severity:e,message:t}))))}else{Gi.monaco.editor.setModelMarkers(P.current,"LENS",[]);const{layer:i,meta:{locations:l}}=fl(n,{...a,params:{...a.params,formula:k||""}},e,{indexPattern:r,operations:o});t(i);const s=Ls(n,i.columns).flatMap((([e,t])=>{const a=[];if(l[e]){const n=N[t.operationType];if(n.getErrorMessage){const t=n.getErrorMessage(i,e,r,N);if(t){const n=nl(k,l[e].min),i=nl(k,l[e].max);a.push({message:t.join(", "),startColumn:n.column+1,startLineNumber:n.lineNumber,endColumn:i.column+1,endLineNumber:i.lineNumber,severity:Gi.monaco.MarkerSeverity.Warning})}}if(n.shiftable&&t.timeShift){const n=nl(k,l[e].min),i=nl(k,l[e].max);a.push(...function(e,t){const{isValueTooSmall:a,isValueNotMultiple:n}=Zi(e),i=[],l=t.timeShift&&Object(mi.parseTimeShift)(t.timeShift),s=l&&a(l),r=l&&n(l);return s?i.push(u.i18n.translate("xpack.lens.indexPattern.timeShift.tooSmallHelp",{defaultMessage:"Time shift should to be larger than the date histogram interval. Either increase time shift or specify smaller interval in date histogram"})):r&&i.push(u.i18n.translate("xpack.lens.indexPattern.timeShift.noMultipleHelp",{defaultMessage:"Time shift should be a multiple of the date histogram interval. Either adjust time shift or date histogram interval"})),i}(h,t).map((e=>({message:e,startColumn:n.column+1,startLineNumber:n.lineNumber,endColumn:i.column+1,endLineNumber:i.lineNumber,severity:Gi.monaco.MarkerSeverity.Warning}))))}}return a})).filter((e=>e));M(s.map((({severity:e,message:t})=>({severity:e,message:t})))),Gi.monaco.editor.setModelMarkers(P.current,"LENS",s)}}),{skipFirstRender:!1},256,[k,a.filter]);const V=T.filter((e=>e.severity===Gi.monaco.MarkerSeverity.Error)).length,R=T.filter((e=>e.severity===Gi.monaco.MarkerSeverity.Warning)).length,H=Object(l.useCallback)((async(e,t,a)=>{const n=e.getValue();let i={list:[],type:el.FIELD};const l=il(n,t);return"("===a.triggerCharacter?("()"===n.slice(l-1,l+1)&&(t=t.delta(0,-1)),e.getWordAtPosition(t.delta(0,-3))&&(i=await ll({expression:n,zeroIndexedOffset:l,context:a,indexPattern:r,operationDefinitionMap:N,unifiedSearch:c,dataViews:p,dateHistogramInterval:B.current}))):i=await ll({expression:n,zeroIndexedOffset:l,context:a,indexPattern:r,operationDefinitionMap:N,unifiedSearch:c,dataViews:p,dateHistogramInterval:B.current}),{suggestions:i.list.map((e=>function(e,t,a,n,i){var l;let s,r,o,u=Gi.monaco.languages.CompletionItemKind.Method,c="string"==typeof e?e:"label"in e?e.label:e.text,d="",p="";const m=c;switch(t){case el.SHIFTS:p=String(Xi[c]).padStart(4,"0");break;case el.FIELD:u=Gi.monaco.languages.CompletionItemKind.Value,gi.test(c)&&(s=`'${c.replaceAll("'","\\'")}'`);break;case el.FUNCTIONS:if(s=`${c}($0)`,r=Gi.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,"string"!=typeof e){if("text"in e)break;c=Wi(e.label,a),vi[e.label]?(d="TinyMath",u=Gi.monaco.languages.CompletionItemKind.Method):(u=Gi.monaco.languages.CompletionItemKind.Constant,d="Elasticsearch",p=`0${c}`,o=rl)}break;case el.NAMED_ARGUMENT:u=Gi.monaco.languages.CompletionItemKind.Keyword,"kql"!==c&&"lucene"!==c&&"shift"!==c||(o=rl,s=`${c}='$0'`,r=Gi.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,p=`zzz${c}`),c=`${c}=`,d="";break;case el.KQL:":"===n?s=`${n} ${c}`:o=rl,c.includes("'")&&(s=(s||c).replaceAll("'","\\'"))}return{detail:d,kind:u,label:c,insertText:null!==(l=s)&&void 0!==l?l:c,insertTextRules:r,command:o,additionalTextEdits:[],range:i,sortText:p,filterText:m}}(e,i.type,N,a.triggerCharacter,i.range)))}}),[r,N,c,p,B]),G=Object(l.useCallback)((async(e,t,a,n)=>{const i=e.getValue(),l=e.getFullModelRange(),s=e.getValueLengthInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:l.endLineNumber,endColumn:l.endColumn});return function(e,t,a){const n=e.substr(0,t)+tl+e.substr(t);try{const e=al(Object(di.parse)(n),t);let i=[],l=0;if(null!=e&&e.parent){const t=e.parent.name;l=e.parent.args.findIndex((t=>t===e.ast)),i=ol(t,a)}else"object"==typeof(null==e?void 0:e.ast)&&"function"===e.ast.type&&(i=ol(e.ast.name,a));if(i.length)return{value:{signatures:i.map((({documentation:e,...t})=>({...t,documentation:{value:e.value.split("\n\n")[0]}}))),activeParameter:l,activeSignature:0},dispose:()=>{}}}catch(e){}return{value:{signatures:[],activeParameter:0,activeSignature:0},dispose:()=>{}}}(e.getValue(),i.length-s,N)}),[N]),q=Object(l.useCallback)((async(e,t,a)=>{const n=e.getValue(),i=e.getFullModelRange(),l=e.getValueLengthInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:i.endLineNumber,endColumn:i.endColumn});return function(e,t,a){try{const n=al(Object(di.parse)(e),t);if(!n||"number"==typeof n.ast||!("name"in n.ast))return{contents:[]};const i=ol(n.ast.name,a);if(i.length){const{label:e}=i[0];return{contents:[{value:e}]}}}catch(e){}return{contents:[]}}(e.getValue(),n.length-l,N)}),[N]),$=Object(l.useCallback)(((e,t)=>{if(!(e.isFlush||e.isRedoing||e.isUndoing)&&1===e.changes.length){const a=e.changes[0].text;if("="!==a&&"'"!==a)return;const n=e.changes[0].range;if(n){const e=t.getValue(),i=il(e,new Gi.monaco.Position(n.startLineNumber,n.startColumn));let l=ul(e,i+1);if(!l&&"'"===a){const t=e;l=ul(t.substring(0,i)+"\\'"+t.substring(i+1),i+2)}const s=/'LENS_MATH_MARKER/;if(!l||"number"==typeof l.ast||"namedArgument"!==l.ast.type||"kql"!==l.ast.name&&"lucene"!==l.ast.name&&"shift"!==l.ast.name||"LENS_MATH_MARKER"!==l.ast.value&&!s.test(l.ast.value))return;let r=null;const o=2;"="===a&&(r={range:{...n,startColumn:n.startColumn+1,endColumn:n.startColumn+1},text:"''"}),"'"===a&&"shift"!==l.ast.name&&(r={range:{...n,startColumn:n.startColumn,endColumn:n.startColumn+1},text:"\\'"}),r&&setTimeout((()=>{t.executeEdits("LENS",[r],[new Gi.monaco.Selection(n.startLineNumber,n.startColumn+o,n.startLineNumber,n.startColumn+o)]),t.setPosition({column:n.startColumn+o,lineNumber:n.startLineNumber}),t.trigger("lens","editor.action.triggerSuggest",{})}),0)}}}),[]),W={languageId:cl,value:null!=k?k:"",onChange:I,options:{automaticLayout:!1,fontSize:14,folding:!1,lineNumbers:"off",scrollBeyondLastLine:!1,minimap:{enabled:!1},wordWrap:S?"on":"off",wordBasedSuggestions:!1,autoIndent:"brackets",wrappingIndent:"none",dimension:{width:320,height:200},fixedOverflowWidgets:!0,matchBrackets:"always",lineDecorationsWidth:16}};return Object(l.useEffect)((()=>{const{dispose:e}=Gi.monaco.languages.registerCompletionItemProvider(cl,{triggerCharacters:[".","(","="," ",":","'"],provideCompletionItems:H}),{dispose:t}=Gi.monaco.languages.registerSignatureHelpProvider(cl,{signatureHelpTriggerCharacters:["(","="],provideSignatureHelp:G}),{dispose:a}=Gi.monaco.languages.registerHoverProvider(cl,{provideHover:q});return()=>{e(),t(),a()}}),[H,G,q]),Object(y.jsx)("div",{className:x()({lnsIndexPatternDimensionEditor:!0,"lnsIndexPatternDimensionEditor-isFullscreen":g})},Object(y.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--shaded"},Object(y.jsx)("div",{className:"lnsFormula"},Object(y.jsx)("div",{className:"lnsFormula__editor"},Object(y.jsx)("div",{className:"lnsFormula__editorHeader"},Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"m",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{className:"lnsFormula__editorHeaderGroup"},Object(y.jsx)(f.EuiToolTip,{content:S?u.i18n.translate("xpack.lens.formula.disableWordWrapLabel",{defaultMessage:"Disable word wrap"}):u.i18n.translate("xpack.lens.formulaEnableWordWrapLabel",{defaultMessage:"Enable word wrap"}),position:"top"},Object(y.jsx)(f.EuiButtonIcon,{iconType:S?"wordWrap":"wordWrapDisabled",display:S?void 0:"fill",color:"text","aria-label":S?u.i18n.translate("xpack.lens.formula.disableWordWrapLabel",{defaultMessage:"Disable word wrap"}):u.i18n.translate("xpack.lens.formulaEnableWordWrapLabel",{defaultMessage:"Enable word wrap"}),isSelected:!S,onClick:()=>{var e;null===(e=D.current)||void 0===e||e.updateOptions({wordWrap:S?"off":"on"}),E(!S)}}))),Object(y.jsx)(f.EuiFlexItem,{className:"lnsFormula__editorHeaderGroup",grow:!1},Object(y.jsx)(f.EuiButtonEmpty,{onClick:()=>{m(),w(!g),Object(fn.e)("toggle_formula_fullscreen")},iconType:g?"fullScreenExit":"fullScreen",size:"xs",color:"text",flush:"right","data-test-subj":"lnsFormula-fullscreen"},g?u.i18n.translate("xpack.lens.formula.fullScreenExitLabel",{defaultMessage:"Collapse"}):u.i18n.translate("xpack.lens.formula.fullScreenEnterLabel",{defaultMessage:"Expand"}))))),Object(y.jsx)("div",{className:"lnsFormula__editorContent"},Object(y.jsx)(d.CodeEditor,i()({},W,{options:{...W.options,overflowWidgetsDomNode:A.current},editorDidMount:e=>{D.current=e;const t=e.getModel();t&&(P.current=t),L.current.push(e.onDidFocusEditorWidget((()=>{setTimeout((()=>{b(!1)}))}))),L.current.push(e.onDidBlurEditorWidget((()=>{setTimeout((()=>{b(!0)}))}))),L.current.push(e.onDidChangeModelContent((t=>{$(t,e)})))}})),k?null:Object(y.jsx)("div",{className:"lnsFormula__editorPlaceholder"},Object(y.jsx)(f.EuiText,{color:"subdued",size:"s"},u.i18n.translate("xpack.lens.formulaPlaceholderText",{defaultMessage:"Type a formula by combining functions with math, like:"})),Object(y.jsx)(f.EuiSpacer,{size:"s"}),Object(y.jsx)("pre",null,"count() + 1"))),Object(y.jsx)("div",{className:"lnsFormula__editorFooter"},Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"m",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{className:"lnsFormula__editorFooterGroup"},g?Object(y.jsx)(f.EuiToolTip,{content:F?u.i18n.translate("xpack.lens.formula.editorHelpInlineHideToolTip",{defaultMessage:"Hide function reference"}):u.i18n.translate("xpack.lens.formula.editorHelpInlineShowToolTip",{defaultMessage:"Show function reference"}),delay:"long",position:"top"},Object(y.jsx)(f.EuiLink,{"aria-label":u.i18n.translate("xpack.lens.formula.editorHelpInlineHideLabel",{defaultMessage:"Hide function reference"}),className:"lnsFormula__editorHelp lnsFormula__editorHelp--inline",color:"text",onClick:()=>w(!F)},Object(y.jsx)(f.EuiIcon,{type:"documentation"}),Object(y.jsx)(f.EuiIcon,{type:F?"arrowDown":"arrowUp"}))):Object(y.jsx)(j.i,{tooltipContent:u.i18n.translate("xpack.lens.formula.editorHelpOverlayToolTip",{defaultMessage:"Function reference"}),condition:!F,position:"top",delay:"regular"},Object(y.jsx)(f.EuiPopover,{panelClassName:"lnsFormula__docs lnsFormula__docs--overlay",panelPaddingSize:"none",anchorPosition:"leftCenter",isOpen:F,closePopover:()=>w(!1),ownFocus:!1,button:Object(y.jsx)(f.EuiButtonIcon,{className:"lnsFormula__editorHelp lnsFormula__editorHelp--overlay",onClick:()=>{F||Object(fn.e)("open_formula_popover"),w(!F)},iconType:"documentation",color:"text","aria-label":u.i18n.translate("xpack.lens.formula.editorHelpInlineShowToolTip",{defaultMessage:"Show function reference"})})},Object(y.jsx)($i,{isFullscreen:g,indexPattern:r,operationDefinitionMap:N})))),V||R?Object(y.jsx)(f.EuiFlexItem,{className:"lnsFormula__editorFooterGroup",grow:!1},Object(y.jsx)(f.EuiPopover,{ownFocus:!1,isOpen:C,closePopover:()=>_(!1),button:Object(y.jsx)(f.EuiButtonEmpty,{color:V?"danger":"warning",className:"lnsFormula__editorError",iconType:"alert",size:"xs",flush:"right",onClick:()=>{_(!C)}},V?u.i18n.translate("xpack.lens.formulaErrorCount",{defaultMessage:"{count} {count, plural, one {error} other {errors}}",values:{count:V}}):null,R?u.i18n.translate("xpack.lens.formulaWarningCount",{defaultMessage:"{count} {count, plural, one {warning} other {warnings}}",values:{count:R}}):null)},T.map((({message:e,severity:t},a)=>Object(y.jsx)("div",{key:a,className:"lnsFormula__warningText"},Object(y.jsx)(f.EuiText,{size:"s",color:t===Gi.monaco.MarkerSeverity.Warning?"warning":"danger"},e)))))):null))),g&&F?Object(y.jsx)("div",{className:"lnsFormula__docs lnsFormula__docs--inline"},Object(y.jsx)($i,{isFullscreen:g,indexPattern:r,operationDefinitionMap:N})):null)))}function yl(e){return"histogram"===e||"document"===e?"number":e}function vl(e){return"sourceField"in e}function jl(e){return"object"==typeof e&&null!==e&&["id","field","indexPatternId"].every((t=>t in e))}function Ol(e,t){var a,n;if(!t)return;const{operationType:i}=e,l=i?au[i]:void 0,s=vl(e)&&l?null!==(a=null==l||null===(n=l.getCurrentFields)||void 0===n?void 0:n.call(l,e))&&void 0!==a?a:[e.sourceField]:[],r=s.map((e=>t.getFieldByName(e))),o=r.filter(Boolean),c=Boolean(r.length>o.length||!("field"===(null==l?void 0:l.input)&&o.every((e=>null!=l.getPossibleOperationForField(e))))),d=Boolean(o.length&&!(null!=l&&l.isTransferable(e,t,au)));if(c){const a=r.map(((e,t)=>e?null:s[t])).filter(Boolean);if(a.length)return[u.i18n.translate("xpack.lens.indexPattern.fieldsNotFound",{defaultMessage:"{count, plural, one {Field} other {Fields}} {missingFields} {count, plural, one {was} other {were}} not found",values:{count:a.length,missingFields:a.join(", ")}})];if(d){var p,m;const a=null!==(p=null==l||null===(m=l.getNonTransferableFields)||void 0===m?void 0:m.call(l,e,t))&&void 0!==p?p:s;return[u.i18n.translate("xpack.lens.indexPattern.fieldsWrongType",{defaultMessage:"{count, plural, one {Field} other {Fields}} {invalidFields} {count, plural, one {is} other {are}} of the wrong type",values:{count:a.length,invalidFields:a.join(", ")}})]}}}function kl(e){const t=e.filter(Boolean).flat();return t.length?t:void 0}function Il(e,t){const a=t.getFieldByName(e);return a?a.displayName:u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"})}function Tl(e,t,a,n){const i=Number(e);return""!==e&&null!=e&&!Number.isNaN(i)&&Number.isFinite(i)&&(!t||Number.isInteger(i))&&(void 0===a||i<=a)&&(void 0===n||i>=n)}function Ml(e,t){return t.operationType===e}function Fl(e){return Boolean("params"in e&&e.params&&"format"in e.params)}function wl(e){return"number"===(null==e?void 0:e.dataType)&&Fl(e)&&e.params?{format:e.params.format}:void 0}function Cl(e,t){let a=null==e?void 0:e.filter;var n;if(t)if("kql"in t)a={query:null!==(n=t.kql)&&void 0!==n?n:"",language:"kuery"};else if("lucene"in t){var i;a={query:null!==(i=t.lucene)&&void 0!==i?i:"",language:"lucene"}}return a}function _l({sourceField:e,operationType:t}){return e&&"count"!==t?gi.test(e)?`'${e.replaceAll("'","\\'")}'`:e:""}const Sl=u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"}),El={type:"formula",displayName:Sl,getDefaultLabel:(e,t)=>{var a;return null!==(a=e.params.formula)&&void 0!==a?a:Sl},input:"managedReference",hidden:!0,filterable:{helpMessage:u.i18n.translate("xpack.lens.indexPattern.formulaFilterableHelpText",{defaultMessage:"The provided filter will be applied to the entire formula."})},getDisabledStatus(e){},getErrorMessage(e,t,a,n){const i=e.columns[t];if(!i.params.formula||!n)return;const l=ki(n),{root:s,error:r}=Mi(i.params.formula,l);if(r||null==s)return null!=r&&r.message?[r.message]:[];const o=Fi(s,e,a,l,i);if(o.length)return o.map((({message:e})=>e));const c=Ls(t,e.columns).flatMap((([t,n])=>{const i=l[n.operationType];if(null!=i&&i.getErrorMessage){const n=i.getErrorMessage(e,t,a,l);return n?{message:n.join(", ")}:[]}return[]})).filter((e=>e)),d=e.columnOrder.some((t=>e.columns[t].isBucketed)),p=e.columnOrder.some((t=>{const a=e.columns[t];return!a.isBucketed&&!a.isStaticValue&&"math"!==a.operationType&&"formula"!==a.operationType}));return d&&!p&&c.push({message:u.i18n.translate("xpack.lens.indexPattern.noRealMetricError",{defaultMessage:"A layer with only static values will not show results, use at least one dynamic metric"})}),c.length?c.map((({message:e})=>e)):void 0},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),toExpression:(e,t)=>{var a;const n=e.columns[t],i=n.params,l=n.label!==Sl,s=null!=i&&i.isFormulaBroken?Sl:l?n.label:null!==(a=null==i?void 0:i.formula)&&void 0!==a?a:Sl;return[{type:"function",function:n.references.length?"mathColumn":"mapColumn",arguments:{id:[t],name:[s||Sl],expression:[n.references.length?`"${n.references[0]}"`:""]}}]},buildColumn({previousColumn:e,layer:t,indexPattern:a},n,i){let l="";e&&(l=function(e,t,a,n){if(Ml("static_value",e)&&e.params&&"value"in e.params)return String(e.params.value);if("references"in e){const n=t.columns[e.references[0]];if(n&&"sourceField"in n&&"number"===n.dataType){const t=_l(n);a+=`${e.operationType}(${n.operationType}(${t})`}}else{if(!e||!("sourceField"in e)||"number"!==e.dataType)return"";a+=`${e.operationType}(${_l(e)}`}const i=function(e,t){if(!t)return[];const a=t[e.operationType];return"operationParams"in a&&(n=e,Boolean("params"in n&&n.params))?(a.operationParams||[]).flatMap((({name:t,required:a})=>{const n=e.params[t];return Object(Se.isObject)(n)?Object.keys(n).map((e=>({name:`${t}-${e}`,value:n[e],required:a}))):{name:t,value:n,required:a}})):[];var n}(e,n);return i.length&&(a+=", "+i.map((({name:e,value:t})=>`${e}=${t}`)).join(", ")),e.filter&&("count"!==e.operationType&&(a+=", "),a+=("kuery"===e.filter.language?"kql=":"lucene=")+`'${e.filter.query.replace(/'/g,"\\'")}'`),e.timeShift&&(("count"!==e.operationType||e.filter)&&(a+=", "),a+=`shift='${e.timeShift}'`),a&&(a+=")"),a}(e,t,l,i));let s={};var r;return e&&Fl(e)&&(s={format:null===(r=e.params)||void 0===r?void 0:r.format}),{label:l||Sl,dataType:"number",operationType:"formula",isBucketed:!1,scale:"ratio",params:l?{formula:l,isFormulaBroken:!1,...s}:{...s},references:[],filter:"formula"===(null==e?void 0:e.operationType)?Cl(e,{}):void 0,timeScale:null==e?void 0:e.timeScale}},isTransferable:()=>!0,createCopy:(e,t,a,n,i)=>fl(a,e.columns[t],e,{indexPattern:n,operations:i}).layer,timeScalingMode:"optional",paramEditor:({activeData:e,...t})=>{const a=Ki(t.layer,t.indexPattern,e,t.layerId);return Object(y.jsx)(hl,i()({},t,{dateHistogramInterval:a,hasData:bl(e,t.layerId,t.columnId)}))}};a(298),a(303);const Pl=({value:e,onChange:t,placeholder:a,inputRef:n,onSubmit:i,dataTestSubj:s,compressed:r})=>{const{inputValue:o,handleInputChange:c}=Object(j.p)({value:e,onChange:t}),d=Object(l.useRef)(!1);return Object(y.jsx)(f.EuiFieldText,{"data-test-subj":s||"lens-labelInput",value:o,onChange:e=>c(e.target.value),fullWidth:!0,placeholder:a||"",inputRef:e=>{n&&e&&(n.current=e)},onKeyDown:()=>{d.current=!0},onKeyUp:({key:e})=>{d.current&&f.keys.ENTER===e&&i&&i(),d.current=!1},prepend:u.i18n.translate("xpack.lens.labelInput.label",{defaultMessage:"Label"}),compressed:r})},Al=({label:e,onClick:t,"data-test-subj":a,isDisabled:n})=>Object(y.jsx)(f.EuiButtonEmpty,{"data-test-subj":null!=a?a:"lns-newBucket-add",size:"xs",iconType:"plusInCircle",onClick:t,isDisabled:n},e),Ll=({isInvalid:e,invalidMessage:t,onRemoveClick:a,removeTitle:n,children:i,dataTestSubj:l,isNotRemovable:s})=>Object(y.jsx)(f.EuiPanel,{paddingSize:"none","data-test-subj":l,hasShadow:!1,hasBorder:!0},Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{grow:!1}),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiIcon,{size:"s",color:e?"danger":"subdued",type:e?"alert":"grab",title:e?t:u.i18n.translate("xpack.lens.customBucketContainer.dragToReorder",{defaultMessage:"Drag to reorder"})})),Object(y.jsx)(f.EuiFlexItem,{grow:!0},i),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiButtonIcon,{iconSize:"s",iconType:"cross",color:"danger","data-test-subj":"lns-customBucketContainer-remove",onClick:a,"aria-label":n,title:n,disabled:s})))),Dl=({id:e,idx:t,children:a,...n})=>Object(y.jsx)(f.EuiDraggable,{style:{marginBottom:4},spacing:"none",index:t,draggableId:e,disableInteractiveElementBlocking:!0},(e=>Object(y.jsx)(Ll,n,a))),Nl=({items:e,onDragStart:t,onDragEnd:a,droppableId:n,children:i})=>Object(y.jsx)(f.EuiDragDropContext,{onDragEnd:({source:t,destination:n})=>{if(t&&n){const i=Object(f.euiDragDropReorder)(e,t.index,n.index);a(i)}},onDragStart:t},Object(y.jsx)(f.EuiDroppable,{droppableId:n,spacing:"none"},i));var zl=a(49);const Bl=({value:e,onChange:t,indexPatternTitle:a,isInvalid:n,onSubmit:i,disableAutoFocus:l,"data-test-subj":s})=>{const{inputValue:r,handleInputChange:o}=Object(j.p)({value:e,onChange:t});return Object(y.jsx)(zl.QueryStringInput,{dataTestSubj:null!=s?s:"indexPattern-filters-queryStringInput",size:"s",disableAutoFocus:l,isInvalid:n,bubbleSubmitEvent:!1,indexPatterns:[a],query:r,onChange:e=>{Object(Se.isEqual)(e,r)||o(e)},onSubmit:()=>{r.query&&i()},placeholder:"kuery"===r.language?u.i18n.translate("xpack.lens.indexPattern.filters.queryPlaceholderKql",{defaultMessage:"{example}",values:{example:'method : "GET" or status : "404"'}}):u.i18n.translate("xpack.lens.indexPattern.filters.queryPlaceholderLucene",{defaultMessage:"{example}",values:{example:"method:GET OR status:404"}}),languageSwitcherPopoverAnchorPosition:"rightDown"})},Vl=({filter:e,setFilter:t,indexPattern:a,button:n,isOpen:i,triggerClose:l})=>{const r=s.a.useRef(),o=s.a.useRef(null);let u;return Object(y.jsx)(f.EuiPopover,{ref:o,panelRef:e=>{const t=e=>{var a;"Escape"===e.key&&(e.stopPropagation(),u.removeEventListener("keydown",t),null===(a=o.current)||void 0===a||a.closePopover())};e&&(u=e,u.addEventListener("keydown",t))},"data-test-subj":"indexPattern-filters-existingFilterContainer",anchorClassName:"eui-fullWidth",panelClassName:"lnsIndexPatternDimensionEditor__filtersEditor",isOpen:i,ownFocus:!0,closePopover:()=>l(),button:n},Object(y.jsx)(Bl,{isInvalid:!Ul(e.input,a),value:e.input,indexPatternTitle:a.title,disableAutoFocus:!0,onChange:a=>t({...e,input:a}),onSubmit:()=>{r.current&&r.current.focus()}}),Object(y.jsx)(f.EuiSpacer,{size:"s"}),Object(y.jsx)(Pl,{value:e.label||"",onChange:a=>t({...e,label:a}),placeholder:(c=e.input.query,""===c?ql:"object"===c?JSON.stringify(c):String(c)),inputRef:r,onSubmit:()=>l(),dataTestSubj:"indexPattern-filters-label"}));var c},Rl=Object(f.htmlIdGenerator)(),Hl="filters",Gl=u.i18n.translate("xpack.lens.indexPattern.filters",{defaultMessage:"Filters"}),ql=u.i18n.translate("xpack.lens.indexPattern.filters.label.placeholder",{defaultMessage:"All records"}),$l={input:{query:"",language:"kuery"},label:""},Wl=(e,t)=>{let a,n=!0;try{"kuery"===e.language?Object(pi.g)(Object(pi.d)(e.query),t):Object(pi.f)(e.query)}catch(e){n=!1,a=e.message}return{isValid:n,error:a}},Ul=(e,t)=>Wl(e,t).isValid,Yl={type:Hl,displayName:Gl,priority:3,input:"none",isTransferable:()=>!0,getDefaultLabel:()=>Gl,buildColumn({previousColumn:e}){let t={filters:[$l]};var a,n,i;return"terms"===(null==e?void 0:e.operationType)&&"sourceField"in e&&(t={filters:[{label:"",input:{query:`${e.sourceField} : *`,language:"kuery"}},...null!==(a=null===(n=e.params)||void 0===n||null===(i=n.secondaryFields)||void 0===i?void 0:i.map((e=>({label:"",input:{query:`${e} : *`,language:"kuery"}}))))&&void 0!==a?a:[]]}),{label:Gl,dataType:"string",operationType:Hl,scale:"ordinal",isBucketed:!0,params:t}},getPossibleOperation:()=>({dataType:"string",isBucketed:!0,scale:"ordinal"}),toEsAggsFn:(e,t,a)=>{var n;const i=null===(n=e.params.filters)||void 0===n?void 0:n.filter((e=>Ul(e.input,a)));return Object(me.buildExpressionFunction)("aggFilters",{id:t,enabled:!0,schema:"segment",filters:((null==i?void 0:i.length)>0?i:[$l]).map(mi.queryFilterToAst)}).toAst()},paramEditor:({layer:e,columnId:t,currentColumn:a,indexPattern:n,updateLayer:i,data:l})=>{const s=a.params.filters;return Object(y.jsx)(f.EuiFormRow,null,Object(y.jsx)(Xl,{filters:s,setFilters:a=>i(vs({layer:e,columnId:t,paramName:Hl,value:a})),indexPattern:n,defaultQuery:$l}))}},Xl=({filters:e,setFilters:t,indexPattern:a,defaultQuery:n})=>{const[i,r]=Object(l.useState)(""),[o,c]=Object(l.useState)((()=>e.map((e=>({...e,id:Rl()}))))),d=e=>{t(e.map((e=>Object(Se.omit)(e,"id")))),c(e)},p=e=>{let t=e;i===e&&(t=""),r(t)};return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(Nl,{onDragEnd:d,onDragStart:()=>{},droppableId:"FILTERS_DROPPABLE_AREA",items:o},null==o?void 0:o.map(((e,t)=>{const n=!Ul(e.input,a);return Object(y.jsx)(Dl,{id:e.id,key:e.id,idx:t,isInvalid:n,invalidMessage:u.i18n.translate("xpack.lens.indexPattern.filters.isInvalid",{defaultMessage:"This query is invalid"}),onRemoveClick:()=>{return t=e.id,d(o.filter((e=>e.id!==t)));var t},removeTitle:u.i18n.translate("xpack.lens.indexPattern.filters.removeFilter",{defaultMessage:"Remove a filter"}),isNotRemovable:1===o.length},Object(y.jsx)(Vl,{"data-test-subj":"indexPattern-filters-existingFilterContainer",isOpen:e.id===i,triggerClose:()=>p(""),indexPattern:a,filter:e,setFilter:e=>{var t,a,n;t=e.id,a=e.input,n=e.label,d(o.map((e=>e.id===t?{...e,input:a,label:n}:e)))},button:Object(y.jsx)(f.EuiLink,{className:"lnsFiltersOperation__popoverButton","data-test-subj":"indexPattern-filters-existingFilterTrigger",onClick:()=>p(e.id),color:n?"danger":"text",title:u.i18n.translate("xpack.lens.indexPattern.filters.clickToEdit",{defaultMessage:"Click to edit"})},e.label||e.input.query||ql)}))}))),Object(y.jsx)(Al,{onClick:()=>{(()=>{const e=Rl();d([...o,{...n,id:e}]),r(e)})()},label:u.i18n.translate("xpack.lens.indexPattern.filters.addaFilter",{defaultMessage:"Add a filter"})}))},Kl=new Set(["string","boolean","number","ip"]),Zl="  ";function Ql(e,t,a){var n;const i=e.columns[t],l=[i.sourceField,...null!==(n=i.params.secondaryFields)&&void 0!==n?n:[]],s=l.filter((e=>{var t;return null===(t=a.getFieldByName(e))||void 0===t?void 0:t.scripted}));if(!(l.length<2)&&s.length)return u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleTermsAndScriptedFields",{defaultMessage:"Scripted fields are not supported when using multiple fields, found {fields}",values:{fields:s.join(", ")}})}function Jl(e,t){const a=t.split(Zl);return e.map(((e,t)=>`${e}: ${"*"!==a[t]?`"${a[t]}"`:a[t]}`)).join(" AND ")}function es(e,t){return 1===e.length?t:t.split(Zl).map(((t,a)=>null==t?u.i18n.translate("xpack.lens.indexPattern.filterBy.emptyFilterQuery",{defaultMessage:"(empty)"}):`${e[a]}: ${t}`)).join(Zl)}function ts(e){return"object"==typeof e&&null!=e&&"keys"in e&&Array.isArray(e.keys)}function as(e,t,a){if(Object(Se.uniq)(Object.values(e.columns).filter((e=>au[e.operationType].shiftable)).map((e=>e.timeShift||""))).length>1)return{message:u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleShifts",{defaultMessage:"In a single layer, you are unable to combine metrics with different time shifts and dynamic top values. Use the same time shift value for all metrics, or use filters instead of top values."}),fixAction:{label:u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleShiftsFixActionLabel",{defaultMessage:"Use filters"}),newState:async(n,i,l)=>{var s,r,o,c,d;const p=e.columns[t],m=[p.sourceField,...null!==(s=null===(r=p.params)||void 0===r?void 0:r.secondaryFields)&&void 0!==s?s:[]],g=(null===(o=i.activeData)||void 0===o||null===(c=o[l].columns.find((({id:e})=>e===t)))||void 0===c?void 0:c.meta.field)===m[0];let f=Object(Se.uniq)((null===(d=i.activeData)||void 0===d?void 0:d[l].rows.map((e=>e[t])).filter((e=>m.length>1?ts(e)&&"__other__"!==e.keys[0]:"string"==typeof e&&"__other__"!==e)).map((e=>ts(e)?e.keys.join(Zl):e)))||[]);var b;g&&0!==f.length||1!==m.length||(f=(null===(b=(await n.http.post(`/api/lens/index_stats/${a.id}/field`,{body:JSON.stringify({fieldName:m[0],dslQuery:Object(pi.c)(a,i.query,i.filters,Object(Ja.getEsQueryConfig)(n.uiSettings)),fromDate:i.dateRange.fromDate,toDate:i.dateRange.toDate,size:p.params.size})})).topValues)||void 0===b?void 0:b.buckets.map((({key:e})=>String(e))))||[]);return m.length>1&&0===f.length&&(f=[Array(m.length).fill("*").join(Zl)]),{...e,columns:{...e.columns,[t]:{label:u.i18n.translate("xpack.lens.indexPattern.pinnedTopValuesLabel",{defaultMessage:"Filters of {field}",values:{field:m.length>1?m.join(Zl):m[0]}}),customLabel:!0,isBucketed:e.columns[t].isBucketed,dataType:"string",operationType:"filters",params:{filters:f.length>0?f.map((e=>({input:{query:1===m.length?`${m[0]}: "${e}"`:Jl(m,e),language:"kuery"},label:es(m,e)}))):[{input:{query:"*",language:"kuery"},label:ql}]}}}}}}}}function ns(e,t){const a=e.columns[t];return a&&!a.isBucketed&&function(e){return"last_value"!==e.operationType||["number","date"].includes(e.dataType)&&!e.params.showArrayValues}(a)&&!("references"in a)&&!Fs(e,t)}function is(e,t){if("string"==typeof e){const a=null==t?void 0:t.getFieldByName(e);return a&&a.scripted}return e.scripted}function ls(e,t,a){const n=[];var i,l;t&&"sourceField"in t&&(t.sourceField&&n.push(t.sourceField),Ml("terms",t)&&n.push(...null!==(i=null===(l=t.params)||void 0===l?void 0:l.secondaryFields)&&void 0!==i?i:[])),a&&n.push("string"==typeof a?a:a.name||a.displayName);const s=n.map((t=>e.getFieldByName(t))),r=[],o=[],u=Boolean(t&&1===s.length);return n.forEach(((e,t)=>{const a=s[t];(!(a&&Kl.has(a.type)&&a.aggregatable)||a.aggregationRestrictions&&!a.aggregationRestrictions.terms||!u&&is(a)?o:r).push(e)})),{allFields:s,validFields:r,invalidFields:o}}function ss({layer:e,targetId:t,sourceColumn:a,shouldDeleteSource:n,indexPattern:i,sourceColumnId:l}){let s=rs(e,a,l,t,i);return n&&(s=Os({layer:s,columnId:l,indexPattern:i})),s}function rs(e,t,a,n,i){let l={...e.columns};if("references"in t){if(l[n])return e;const s=au[t.operationType];if("createCopy"in s)return s.createCopy(e,a,n,i,au);null==t||t.references.forEach(((s,r)=>{const o=Object(ea.a)(),u={...l[s]},c="references"in u?rs(e,u,a,o,i).columns:{[o]:u},d=l[n];let p=[o];d&&"references"in d&&(p=d.references,p[r]=o),l={...l,...c,[n]:{...t,references:p}}}))}else l={...l,[n]:t};return{...e,columns:l,columnOrder:ks({...e,columns:l})}}function os(e){return e.layer.columns[e.columnId]?ds(e):cs(e)}function us(e,t,a){const n={...e};return t.filterable&&(n.filter=a.filter),t.shiftable&&(n.timeShift=a.timeShift),"disabled"!==t.timeScalingMode&&(n.timeScale=a.timeScale),n}function cs({op:e,layer:t,columnId:a,field:n,indexPattern:i,visualizationGroups:l,targetGroup:s,shouldResetLabel:r,incompleteParams:o,incompleteFieldName:u,incompleteFieldOperation:c,columnParams:d,initialParams:p}){var m,g;const f=au[e];if(!f)throw new Error("No suitable operation found for given parameters");if(t.columns[a])throw new Error("Can't insert a column with an ID that is already in use");const b={indexPattern:i,previousColumn:{...o,...p,...t.columns[a]}};if("none"===f.input||"managedReference"===f.input){if(n)throw new Error(`Can't create operation ${e} with the provided field ${n.name}`);f.input;const r=f.getPossibleOperation();return Es((Boolean(null==r?void 0:r.isBucketed)?fs:hs)(t,d?f.buildColumn({...b,layer:t},d):f.buildColumn({...b,layer:t}),a,l,s),i)}if("fullReference"===f.input){if(n)throw new Error("Reference-based operations can't take a field as input when creating");let r={...t};const o=f.requiredReferences.map((t=>{const a=Object.values(au).filter((({type:e})=>Ss({validation:t,operationType:e,indexPattern:i})));if(!a.length)throw new Error(`Can't create reference, ${e} has a validation function which doesn't allow any operations`);const n=Object(ea.a)();if(c&&u){var o;const e=i.fields.filter((e=>e.name===u));r=cs({layer:r,columnId:n,op:c,indexPattern:i,field:null!==(o=e[0])&&void 0!==o?o:ml,visualizationGroups:l,columnParams:d,targetGroup:s})}if(1===a.length){const e=a[0];let t="field"===e.input?i.fields.filter(e.getPossibleOperationForField):[];u&&(t=t.filter((e=>e.name===u))),r="none"===e.input?cs({layer:r,columnId:n,op:e.type,indexPattern:i,visualizationGroups:l,targetGroup:s}):1===t.length?cs({layer:r,columnId:n,op:e.type,indexPattern:i,field:t[0],visualizationGroups:l,targetGroup:s}):{...r,incompleteColumns:{...r.incompleteColumns,[n]:{operationType:e.type}}}}return n})),p=f.getPossibleOperation(i);if(!p)throw new Error(`Can't create operation ${e} because it's incompatible with the data view`);const m=Boolean(p.isBucketed)?fs:hs,g=d?f.buildColumn({...b,layer:r,referenceIds:o},d):f.buildColumn({...b,layer:r,referenceIds:o});return Es(m(r,g,a,l,s),i)}const h=null===(m=(null!==(g=t.incompleteColumns)&&void 0!==g?g:{})[a])||void 0===m?void 0:m.sourceField,x=h?i.getFieldByName(h):void 0;if(!n&&x){const e=f.getPossibleOperationForField(x);if(!e)throw new Error(`Tried to create an invalid operation ${f.type} using previously selected field ${x.name}`);return Es(Boolean(e.isBucketed)?fs(t,f.buildColumn({...b,layer:t,field:x}),a,l,s):hs(t,f.buildColumn({...b,layer:t,field:x}),a),i)}var y;if(!n)return{...t,incompleteColumns:{...null!==(y=t.incompleteColumns)&&void 0!==y?y:{},[a]:{operationType:e}}};const v=f.getPossibleOperationForField(n);var j;if(!v)return{...t,incompleteColumns:{...null!==(j=t.incompleteColumns)&&void 0!==j?j:{},[a]:{operationType:e,sourceField:n.name}}};const O=f.buildColumn({...b,layer:t,field:n},d);return Es((Boolean(v.isBucketed)?fs:hs)(t,O,a,l,s),i)}function ds({layer:e,columnId:t,indexPattern:a,op:n,field:i,visualizationGroups:l,initialParams:s,shouldResetLabel:r,shouldCombineField:o}){const u=e.columns[t];if(!u)throw new Error("Can't replace column because there is no prior column");const c=n!==u.operationType,d=au[n],p=au[u.operationType];if(!d)throw new Error("No suitable operation found for given parameters");const m={columns:e.columns,indexPattern:a,previousColumn:u};if(c){let s={...e};if(s=Ps(s,t),"managedReference"===p.input&&d.input!==p.input){s=ps(p,u,s,a);const o=cs({layer:s,columnId:t,indexPattern:a,op:n,field:i,visualizationGroups:l,incompleteParams:u});return!r&&u.customLabel&&o.columns[t]&&u.label!==p.getDefaultLabel(u,a,s.columns)&&(o.columns[t].customLabel=!0,o.columns[t].label=u.label),o.incompleteColumns&&o.incompleteColumns[t]?{...e,incompleteColumns:o.incompleteColumns}:o}if("fullReference"===d.input)return function({layer:e,columnId:t,previousColumn:a,op:n,indexPattern:i,visualizationGroups:l}){const s=au[n];if("fullReference"!==s.input)throw new Error("Requirements for transitioning are not met");let r=!1,o=!1;const u="references"in a?[...a.references]:[],c=s.requiredReferences.map((t=>{const n=Object(ea.a)();if(u.length){const a=e.columns[u[0]];if(As({validation:t,column:a}))return u.shift()}if(!r&&As({validation:t,column:a})){r=!0;const t={...e,columns:{...e.columns,[n]:{...a,filter:s.filterable?void 0:a.filter,timeShift:s.shiftable?void 0:a.timeShift}}};return e={...e,columnOrder:ks(t),columns:js(t,n)},n}if(t.input.includes("none")){const a=tu.filter((e=>{if("none"===e.input)return Ss({validation:t,operationType:e.type,indexPattern:i})}));if(1===a.length)return e=cs({layer:e,columnId:n,op:a[0].type,indexPattern:i,visualizationGroups:l}),n}if(!o&&"sourceField"in a&&t.input.includes("field")){const s=tu.filter((e=>"field"===e.input&&Ss({validation:t,operationType:e.type,indexPattern:i}))).sort(lu),r=s.filter((e=>{const n=i.getFieldByName(a.sourceField);if(n)return Ss({validation:t,operationType:e.type,field:n,indexPattern:i})}));if(r.length>0)return o=!0,e=cs({layer:e,columnId:n,op:r[0].type,indexPattern:i,field:i.getFieldByName(a.sourceField),visualizationGroups:l}),n;if(1===s.length)return o=!0,e={...e,incompleteColumns:{...e.incompleteColumns,[n]:{operationType:s[0].type}}},n}if(u.length){const a=e.columns[u[0]];if(a&&"sourceField"in a&&t.input.includes("field")){const s=i.getFieldByName(a.sourceField);if(s){const a=tu.filter((e=>"field"===e.input&&Ss({validation:t,operationType:e.type,field:s,indexPattern:i}))).sort(lu);if(a.length>0)return e=cs({layer:e,columnId:n,op:a[0].type,indexPattern:i,field:s,visualizationGroups:l}),n}}}return n}));return u.length&&u.forEach((t=>{e=Os({layer:e,columnId:t,indexPattern:i})})),e={...e,columns:{...e.columns,[t]:s.buildColumn({indexPattern:i,layer:e,referenceIds:c,previousColumn:a})}},Es({...e,columnOrder:ks(e),columns:js(e,t)},i)}({layer:s,columnId:t,previousColumn:u,op:n,indexPattern:a,visualizationGroups:l});if("fullReference"===p.input&&1===u.references.length){const l=u.references[0],r=e.columns[l];if(r){const e=au[r.operationType];if(e.type===n){s=Os({layer:s,columnId:l,indexPattern:a});const n=us(gs({...r},u),e,u);return s={...s,columns:{...s.columns,[t]:n}},Es({...s,columnOrder:ks(s),columns:js(s,t)},a)}if(!i&&"sourceField"in r&&"field"===e.input&&"field"===d.input){const e=a.getFieldByName(r.sourceField);e&&d.getPossibleOperationForField(e)&&(i=e)}}}if("managedReference"===d.input){const e=d.buildColumn({...m,layer:s},"params"in u?u.params:void 0,au);"fullReference"===p.input&&u.references.forEach((e=>{s=Os({layer:s,columnId:e,indexPattern:a})}));const n={...s,columns:{...s.columns,[t]:e}};let i;try{i=e.params.formula?fl(t,e,n,{indexPattern:a}).layer:n}catch(e){i=n}const l=i.columns[t];return!r&&l.operationType!==u.operationType&&u.customLabel&&(l.customLabel=!0,l.label=u.label),Es({...s,columnOrder:ks(i),columns:js(i,t)},a)}if("none"===d.input){let e=d.buildColumn({...m,layer:s});e=gs(e,u),s=ps(p,u,s,a);const n={...s,columns:{...s.columns,[t]:e}};return Es({...s,columnOrder:ks(n),columns:js(n,t)},a)}if(!i){var g;let a={operationType:n};if("fullReference"===p.input){const t=u.references[0],n=e.columns[t];n&&(a=us(a,au[n.operationType],u))}return{...s,incompleteColumns:{...null!==(g=s.incompleteColumns)&&void 0!==g?g:{},[t]:a}}}var f;if(!d.getPossibleOperationForField(i))return{...s,incompleteColumns:{...null!==(f=s.incompleteColumns)&&void 0!==f?f:{},[t]:{operationType:n}}};s=ps(p,u,s,a);let o=d.buildColumn({...m,layer:s,field:i});r||(o=gs(o,u));const c={...s,columns:{...s.columns,[t]:o}};return Es({...s,columnOrder:ks(c),columns:js(c,t)},a)}if("field"===d.input&&i&&"sourceField"in u&&(u.sourceField!==i.name||null!=d&&d.getParamsForMultipleFields)){let a=d.onFieldChange(u,i,o?null==s?void 0:s.params:void 0);r||(a=gs(a,u));const n=Ps({...e,columns:{...e.columns,[t]:a}},t);return{...n,columnOrder:ks(n),columns:js(n,t)}}throw new Error("nothing changed")}function ps(e,t,a,n){let i=a;if("managedReference"===e.input){const[e]=Object.entries(a.columns).find((([e,a])=>a===t))||[];null!=e&&(i=Os({layer:a,columnId:e,indexPattern:n}))}return"fullReference"===e.input&&t.references.forEach((e=>{i=Os({layer:a,columnId:e,indexPattern:n})})),i}function ms({layer:e,columnId:t,op:a,field:n,indexPattern:i,filterOperations:l,visualizationGroups:s}){const r=e.columns[t];if(!r)return!0;if(r.operationType===a)return!0;try{var o,u,c;const r=ds({layer:e,columnId:t,op:a,field:n,indexPattern:i,visualizationGroups:s}),d=au[a],p=r.columns[t];return Boolean(p)&&!(null!==(o=r.incompleteColumns)&&void 0!==o&&o[t])&&l(p)&&!(null!==(u=d.getErrorMessage)&&void 0!==u&&null!==(c=u.call(d,r,t,i))&&void 0!==c&&c.length)}catch(e){return!1}}function gs(e,t){const a={...e},n=e.operationType!==t.operationType,i=("sourceField"in e&&e.sourceField)!==("sourceField"in t&&t.sourceField);return!t.customLabel||n&&i||(a.customLabel=!0,a.label=t.label),a}function fs(e,t,a,n,i){const[l,s]=Object(Se.partition)(e.columnOrder,(t=>e.columns[t].isBucketed)),r=e.columnOrder.findIndex((t=>"date_histogram"===e.columns[t].operationType));let o=[];o=r>-1&&"terms"===t.operationType?[...l.slice(0,r),a,...l.slice(r,l.length),...s]:[...l,a,...s],o=bs(n,i,o,a);const u={...Ps(e,a),columns:{...e.columns,[a]:t},columnOrder:o};return{...u,columns:js(u,a),columnOrder:ks(u)}}function bs(e,t,a,n){var i;if(t&&(null===(i=e.find((e=>e.groupId===t)))||void 0===i?void 0:i.hideGrouping)){const i=[...e];i.sort(((e,t)=>void 0===typeof e.nestingOrder?-1:void 0===typeof t.nestingOrder?1:e.nestingOrder-t.nestingOrder));const l={};return a.forEach((e=>{const s=i.findIndex((a=>e===n&&a.groupId===t||a.accessors.some((t=>t.columnId===e))));l[e]=-1!==s?s:a.length})),[...a].sort(((e,t)=>l[e]-l[t]))}return a}function hs(e,t,a){const n={...Ps(e,a),columns:{...e.columns,[a]:t}};return{...n,columnOrder:ks(n),columns:js(n,a)}}function xs(e){return tu.sort(lu).filter((t=>{if("field"!==t.input)return;const a=t.getPossibleOperationForField(e);return a&&!a.isBucketed&&"number"===a.dataType}))}function ys({layer:e,columnId:t,customLabel:a}){const n=e.columns[t];return{...e,columns:{...e.columns,[t]:{...n,label:a||n.label,customLabel:Boolean(a)}}}}function vs({layer:e,columnId:t,paramName:a,value:n}){const i=e.columns[t];return{...e,columns:{...e.columns,[t]:{...i,params:{..."params"in i?i.params:{},[a]:n}}}}}function js(e,t){const a={...e.columns};return Object.keys(a).forEach((n=>{if(n!==t){const i=a[n],l=au[i.operationType];a[n]=l.onOtherColumnChanged?l.onOtherColumnChanged({...e,columns:a},n,t):i}})),a}function Os({layer:e,columnId:t,indexPattern:a}){const n=e.columns[t];if(!n){const a={...e.incompleteColumns||{}};return delete a[t],{...e,columnOrder:e.columnOrder.filter((e=>e!==t)),incompleteColumns:a}}const i="references"in n?n.references:[],l={...e.columns};delete l[t];let s={...e,columns:js({...e,columns:l},t)};i.forEach((e=>{s=Os({layer:s,columnId:e,indexPattern:a})}));const r={...s.incompleteColumns||{}};return delete r[t],Es({...s,columnOrder:ks(s),incompleteColumns:r},a)}function ks(e){const t=Object.entries(e.columns);t.sort((([t],[a])=>{const n=e.columnOrder.indexOf(t),i=e.columnOrder.indexOf(a);return n>-1&&i>-1?n-i:n>-1?-1:1}));const[a,n]=Object(Se.partition)(t,(([,e])=>e.isBucketed));return a.map((([e])=>e)).concat(n.map((([e])=>e)))}function Is(e){const[t,a]=Object(Se.partition)(e.columnOrder,(t=>e.columns[t]&&!("references"in e.columns[t])));return[...Object(Se.partition)(t,(t=>{var a;return null===(a=e.columns[t])||void 0===a?void 0:a.isBucketed})),a]}function Ts(e,t,a){return au[e.operationType].isTransferable(e,t,au)&&(!("references"in e)||e.references.every((e=>Ts(a.columns[e],t,a))))}function Ms(e,t){const a=Object(Se.pickBy)(e.columns,(a=>Ts(a,t,e))),n=Object(Se.mapValues)(a,(e=>{const a=au[e.operationType];return a.transfer?a.transfer(e,t):e})),i=e.columnOrder.filter((e=>n[e]));return{...e,indexPatternId:t.id,columns:n,columnOrder:i}}function Fs(e,t){return Object.values(e.columns).flatMap((e=>"references"in e?e.references:[])).includes(t)}const ws=ci()((e=>{const t={};for(const[a,n]of Object.entries(e.columns))if("references"in n)for(const e of n.references)t[e]=a;return t}));function Cs(e,t){const a=[];return function t(n){const i=e.columns[n];if(i&&"references"in i){const n=i.references.filter((t=>Boolean(e.columns[t])));a.push(...n),n.forEach(t)}}(t),a}function _s(e){return e.columnOrder.some((t=>{const a=e.columns[t];if(a)return Ml("terms",a)&&a.params.size>5}))}function Ss({operationType:e,validation:t,field:a,indexPattern:n}){const i=au[e];let l=!0;if(a&&"field"===i.input){const e=i.getPossibleOperationForField(a);l=Boolean(e)&&t.validateMetadata(e)}else if("none"===i.input){const e=i.getPossibleOperation();l=Boolean(e)&&t.validateMetadata(e)}else if("fullReference"===i.input){const e=i.getPossibleOperation(n);l=Boolean(e)&&t.validateMetadata(e)}return t.input.includes(i.input)&&(!t.specificOperations||t.specificOperations.includes(e))&&l}function Es(e,t){const a={...e.columns};return e.columnOrder.forEach((e=>{const n=a[e];n.customLabel||(a[e]={...n,label:au[n.operationType].getDefaultLabel(n,t,a)})})),{...e,columns:a}}function Ps(e,t){var a;const n={...null!==(a=e.incompleteColumns)&&void 0!==a?a:{}};return delete n[t],{...e,incompleteColumns:n}}function As({column:e,validation:t}){if(!e)return!1;const a=e.operationType,n=au[a];return t.input.includes(n.input)&&function({column:e,validation:t}){return!t.specificOperations||"managedReference"===au[e.operationType].input||t.specificOperations.includes(e.operationType)}({column:e,validation:t})&&t.validateMetadata(e)}function Ls(e,t){const a={};Object.entries(t).forEach((([e,t])=>{a[e]="references"in t?[...t.references]:[]}));const n=a[e],i=[];for(;n.length>0;){const e=n.shift();i.push([e,t[e]]),n.push(...a[e])}return i.filter((([,e])=>e))}function Ds(e,t,a,n,i){let l={indexPatternId:a.id,columns:{},columnOrder:[]};if(Object(Se.isArray)(t)){var s;const n=t.shift(),i=n&&null!==(s=a.getFieldByName(n.fieldName))&&void 0!==s?s:ml,g=null==n?void 0:n.agg;if("formula"===g){var r,o,u,c;const e=au.formula,t={indexPatternId:a.id,columns:{},columnOrder:[]};let i=e.buildColumn({indexPattern:a,layer:t}),s=null!=n&&null!==(r=n.params)&&void 0!==r&&r.kql?{query:null==n||null===(o=n.params)||void 0===o?void 0:o.kql,language:"kuery"}:void 0;var d,p;null!=n&&null!==(u=n.params)&&void 0!==u&&u.lucene&&(s=null!=n&&null!==(d=n.params)&&void 0!==d&&d.lucene?{query:null==n||null===(p=n.params)||void 0===p?void 0:p.lucene,language:"lucene"}:void 0),i={...i,...s&&{filter:s},params:{...i.params,...null==n?void 0:n.params}},l=null!=n&&null!==(c=n.params)&&void 0!==c&&c.formula?fl(Object(ea.a)(),i,t,{indexPattern:a}).layer:t}else{var m;const s=Object(ea.a)();l=cs({op:g,layer:e?{indexPatternId:a.id,columns:{},columnOrder:[]}:Ds(1===t.length,t,a),columnId:s,field:null!=n&&n.isFullReference?void 0:null!=i?i:ml,columnParams:null!==(m=null==n?void 0:n.params)&&void 0!==m?m:void 0,incompleteFieldName:null!=n&&n.isFullReference?null==i?void 0:i.name:void 0,incompleteFieldOperation:null!=n&&n.isFullReference?null==n?void 0:n.pipelineAggType:void 0,indexPattern:a,visualizationGroups:[]}),n&&(n.accessor=s)}}let g=0;for(const[e,t]of Object.entries(l.columns))n&&(l=vs({layer:l,columnId:e,paramName:"format",value:{id:n,params:{decimals:0}}})),(i&&"percentile"===t.operationType||i&&g===Object.keys(l.columns).length-1)&&(l=ys({layer:l,columnId:e,customLabel:i})),g++;return l}const Ns=({value:e,onChange:t,minValue:a=1,maxValue:n=1e3,label:i=u.i18n.translate("xpack.lens.indexPattern.terms.size",{defaultMessage:"Number of values"}),disabled:s})=>{const[r,o]=Object(l.useState)(String(e));Object(j.o)((()=>{if(""===r)return;const e=Number(r);t(Math.min(n,Math.max(e,a)))}),{skipFirstRender:!0},256,[r]);const c=""===r,d=!c&&Number(r)>n,p=!c&&Number(r)<a;return Object(y.jsx)(f.EuiFormRow,{label:i,display:"rowCompressed",fullWidth:!0,isInvalid:d||p,error:d?[u.i18n.translate("xpack.lens.indexPattern.terms.sizeLimitMax",{defaultMessage:"Value is higher than the maximum {max}, the maximum value is used instead.",values:{max:n}})]:p?[u.i18n.translate("xpack.lens.indexPattern.terms.sizeLimitMin",{defaultMessage:"Value is lower than the minimum {min}, the minimum value is used instead.",values:{min:a}})]:null},Object(y.jsx)(f.EuiFieldNumber,{min:a,max:n,step:1,value:r,compressed:!0,isInvalid:d||p,disabled:s,onChange:({currentTarget:e})=>o(e.value),"aria-label":i,onBlur:()=>{if(""===r)return o(String(e));const t=Number(r);o(String(Math.min(n,Math.max(t,a))))}}))};a(308);var zs=a(147),Bs=a.n(zs),Vs=a(69),Rs=a.n(Vs),Hs=["type","label","size","scripted","className"],Gs={iconType:"questionInCircle",color:"gray"},qs={boolean:{iconType:"tokenBoolean"},conflict:{iconType:"alert",color:"euiColorVis9",shape:"square"},date:{iconType:"tokenDate"},date_range:{iconType:"tokenDate"},geo_point:{iconType:"tokenGeo"},geo_shape:{iconType:"tokenGeo"},ip:{iconType:"tokenIP"},ip_range:{iconType:"tokenIP"},match_only_text:{iconType:"tokenString"},murmur3:{iconType:"tokenSearchType"},number:{iconType:"tokenNumber"},number_range:{iconType:"tokenNumber"},histogram:{iconType:"tokenHistogram"},_source:{iconType:"editorCodeBlock",color:"gray"},string:{iconType:"tokenString"},text:{iconType:"tokenString"},keyword:{iconType:"tokenKeyword"},nested:{iconType:"tokenNested"},version:{iconType:"tokenTag"}};function $s(e){var t=e.type,a=e.label,n=e.size,l=void 0===n?"s":n,s=e.scripted,r=e.className,o=Rs()(e,Hs),u=qs[t]||Gs;return Object(y.jsx)(f.EuiToken,i()({},u,{className:x()("kbnFieldIcon",r),"aria-label":a||t,title:a||t,size:l,fill:s?"dark":void 0},o))}a(313);var Ws=["size","isActive","fieldIcon","fieldName","fieldInfoIcon","fieldAction","className","isDraggable","onClick","dataTestSubj","buttonProps"],Us={s:"kbnFieldButton--small",m:null};function Ys(e){var t=e.size,a=void 0===t?"m":t,n=e.isActive,l=void 0!==n&&n,r=e.fieldIcon,o=e.fieldName,u=e.fieldInfoIcon,c=e.fieldAction,d=e.className,p=e.isDraggable,m=void 0!==p&&p,g=e.onClick,f=e.dataTestSubj,b=e.buttonProps,h=Rs()(e,Ws),v=x()("kbnFieldButton",a?Us[a]:null,{"kbnFieldButton-isActive":l},{"kbnFieldButton--isDraggable":m},d),j=x()("kbn-resetFocusState","kbnFieldButton__button"),O=Object(y.jsx)(s.a.Fragment,null,r&&Object(y.jsx)("span",{className:"kbnFieldButton__fieldIcon"},r),o&&Object(y.jsx)("span",{className:"kbnFieldButton__name"},o),u&&Object(y.jsx)("div",{className:"kbnFieldButton__infoIcon"},u));return Object(y.jsx)("div",i()({className:v},h),g?Object(y.jsx)("button",i()({onClick:function(e){"click"===e.type&&e.currentTarget.focus(),g()},"data-test-subj":f,className:j},b),O):Object(y.jsx)("div",{className:j,"data-test-subj":f},O),c&&Object(y.jsx)("div",{className:"kbnFieldButton__fieldAction"},c))}function Xs({type:e,...t}){return Object(y.jsx)($s,i()({className:"lnsFieldListPanel__fieldIcon",type:yl(e)},t))}function Ks(e,t,a){return e[t]&&e[t][a]}function Zs(e){const t=Object(Se.keyBy)(e,"name");return e=>t[e]}Object.keys(Us);const Qs=()=>document.createElement("canvas").getContext("2d"),Js=Qs(),er=(e,t)=>{const a=null!=Js?Js:Qs();return a.font=t,a.measureText(e).width},tr=s.a.memo((function({label:e,width:t,search:a,font:n}){const i=Object(l.useMemo)((()=>er(e,n)),[e,n]);if(i<t)return Object(y.jsx)(f.EuiHighlight,{search:a},e);const s=e.indexOf(a),r=Math.round(t*e.length/i);let o,u="".length;a&&-1!==s?0===s?o=(e,t)=>`${e.substr(0,t)}`:r>e.length-s?o=(e,t)=>`${e.substr(e.length-t)}`:(o=(e,t)=>`${e.substr(s,t)}`,u=2*"".length):o=(e,t)=>`${e.substr(0,8)}${e.substr(e.length-(t-8))}`;const c=((e,t,a,n,i)=>{let l=i(a,n);for(;er(l,t)>e;)l=i(a,n-=1);return l})(t,n,e,r,o);return a.length<c.length-u?Object(y.jsx)(f.EuiHighlight,{search:a},c):Object(y.jsx)(f.EuiMark,null,c)}));function ar({currentIndexPattern:e,incompleteOperation:t,selectedOperationType:a,selectedField:n,operationByField:r,onChoose:o,onDeleteColumn:c,existingFields:d,fieldIsInvalid:p,markAllFieldsCompatible:m,"data-test-subj":g,...b}){var h,v;const j=Object(l.useMemo)((()=>{const n=Object.keys(r).sort(),i=null!=t?t:a;function l(e){return!i||r[e].has(i)}const[s,o]=Object(Se.partition)(n,(t=>{var a;return"document"===(null===(a=e.getFieldByName(t))||void 0===a?void 0:a.type)})),c=t=>{var a;return"document"===(null===(a=e.getFieldByName(t))||void 0===a?void 0:a.type)||Ks(d,e.title,t)};function p(t){return t.filter((t=>{var a;return null===(a=e.getFieldByName(t))||void 0===a?void 0:a.displayName})).map((t=>{var a,n;const s=m||l(t)?1:0,o=c(t);return{label:null===(a=e.getFieldByName(t))||void 0===a?void 0:a.displayName,value:{type:"field",field:t,dataType:null===(n=e.getFieldByName(t))||void 0===n?void 0:n.type,operationType:i&&l(t)?i:r[t].values().next().value},exists:o,compatible:s,className:x()({"lnFieldSelect__option--incompatible":!s,"lnFieldSelect__option--nonExistant":!o}),"data-test-subj":`lns-fieldOption${s?"":"Incompatible"}-${t}`}})).sort(((e,t)=>t.compatible-e.compatible))}const[g,f]=Object(Se.partition)(o,(t=>{var a;return null===(a=e.getFieldByName(t))||void 0===a?void 0:a.meta})),[b,h]=Object(Se.partition)(f,c),y=(e,t)=>e.length>0&&{label:t,options:p(e)},v=y(b,u.i18n.translate("xpack.lens.indexPattern.availableFieldsLabel",{defaultMessage:"Available fields"})),j=y(h,u.i18n.translate("xpack.lens.indexPattern.emptyFieldsLabel",{defaultMessage:"Empty fields"})),O=y(g,u.i18n.translate("xpack.lens.indexPattern.metaFieldsLabel",{defaultMessage:"Meta fields"}));return[...p(s),v,j,O].filter(Boolean)}),[t,a,e,r,d,m]),O=Object(l.useRef)(null),[k,I]=s.a.useState({width:215,font:"14px Inter"}),T=(e,t=!1)=>{if(O.current){var a;const e={...k,width:(null===(a=O.current)||void 0===a?void 0:a.clientWidth)-90};t&&(e.font=window.getComputedStyle(O.current).font),I(e)}};return Bs()((()=>{O.current&&T(0,!0),window.addEventListener("resize",T)})),Object(y.jsx)("div",{ref:O},Object(y.jsx)(f.EuiComboBox,i()({fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":null!=g?g:"indexPattern-dimension-field",placeholder:u.i18n.translate("xpack.lens.indexPattern.fieldPlaceholder",{defaultMessage:"Field"}),options:j,isInvalid:Boolean(t||p),selectedOptions:a&&n?[{label:p?n:null!==(h=null===(v=e.getFieldByName(n))||void 0===v?void 0:v.displayName)&&void 0!==h?h:n,value:{type:"field",field:n}}]:[],singleSelection:{asPlainText:!0},onChange:e=>{if(0===e.length)return void(null==c||c());const t=e[0].value;t.field!==n&&(Object(fn.e)("indexpattern_dimension_field_changed"),o(t))},renderOption:(e,t)=>Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{grow:null},Object(y.jsx)(Xs,{type:e.value.dataType,fill:"none"})),Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(tr,i()({},k,{label:e.label,search:t}))))},b)))}const nr=Object(f.htmlIdGenerator)();function ir(e){return null!=e.value}function lr({column:e,onChange:t,indexPattern:a,existingFields:n,operationSupportMatrix:i,invalidFields:r}){const o=Object(l.useCallback)((e=>t(e.filter(ir).map((({value:e})=>e)))),[t]),{wrappedValues:c,rawValuesLookup:d}=Object(l.useMemo)((()=>{var t;const a=e?[e.sourceField,...(null===(t=e.params)||void 0===t?void 0:t.secondaryFields)||[]]:[];return{wrappedValues:a.map((e=>({id:nr(),value:e}))),rawValuesLookup:new Set(a)}}),[e]),{inputValue:p,handleInputChange:m}=Object(j.p)({onChange:o,value:c}),g=Object(l.useCallback)(((e,t=0)=>{const n=[...p];a.getFieldByName(e.field)&&(n[t]={id:nr(),value:e.field},m(n))}),[p,a,m]);if(1===p.length){const[{value:t}]=p;return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(ar,{fieldIsInvalid:Boolean(null==r?void 0:r[0]),currentIndexPattern:a,existingFields:n,operationByField:i.operationByField,selectedOperationType:null==e?void 0:e.operationType,selectedField:t,onChoose:g}),Object(y.jsx)(Al,{"data-test-subj":"indexPattern-terms-add-field",onClick:()=>{m([...p,{id:nr(),value:void 0,isNew:!0}])},label:u.i18n.translate("xpack.lens.indexPattern.terms.addField",{defaultMessage:"Add field"}),isDisabled:"rare"===e.params.orderBy.type}))}const b=2===p.length&&p.some((({isNew:e})=>e)),h=p.filter((({isNew:e})=>!e));return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(Nl,{onDragEnd:e=>{m(e)},onDragStart:()=>{},droppableId:"TOP_TERMS_DROPPABLE_AREA",items:p},p.map((({id:t,value:l,isNew:s},o)=>{var c;const x=Object.keys(i.operationByField).filter((e=>{if(e===l)return!0;const t=a.getFieldByName(e);return!d.has(e)&&t&&!t.scripted&&Kl.has(t.type)})).reduce(((e,t)=>(e[t]=i.operationByField[t],e)),{}),v=Boolean(l&&((null===(c=a.getFieldByName(l))||void 0===c?void 0:c.scripted)&&h.length>1||(null==r?void 0:r.includes(l))));return Object(y.jsx)(f.EuiDraggable,{style:{marginBottom:4},spacing:"none",index:o,draggableId:l||"newField",key:t,disableInteractiveElementBlocking:!0},(t=>Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{grow:!1}),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiIcon,{size:"s",color:"subdued",type:"grab",title:u.i18n.translate("xpack.lens.indexPattern.terms.dragToReorder",{defaultMessage:"Drag to reorder"}),"data-test-subj":`indexPattern-terms-dragToReorder-${o}`})),Object(y.jsx)(f.EuiFlexItem,{grow:!0,style:{minWidth:0}},Object(y.jsx)(ar,{fieldIsInvalid:v,currentIndexPattern:a,existingFields:n,operationByField:x,selectedOperationType:e.operationType,selectedField:l,autoFocus:s,onChoose:e=>{g(e,o)},isInvalid:v,"data-test-subj":`indexPattern-dimension-field-${o}`})),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(j.i,{tooltipContent:u.i18n.translate("xpack.lens.indexPattern.terms.deleteButtonDisabled",{defaultMessage:"This function requires a minimum of one field defined"}),condition:b},Object(y.jsx)(f.EuiButtonIcon,{iconType:"trash",color:"danger","aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.deleteButtonAriaLabel",{defaultMessage:"Delete"}),title:u.i18n.translate("xpack.lens.indexPattern.terms.deleteButtonLabel",{defaultMessage:"Delete"}),onClick:()=>{m(p.filter(((e,t)=>t!==o)))},"data-test-subj":`indexPattern-terms-removeField-${o}`,isDisabled:b&&!s}))))))}))),Object(y.jsx)(Al,{onClick:()=>{m([...p,{id:nr(),value:void 0,isNew:!0}])},"data-test-subj":"indexPattern-terms-add-field",label:u.i18n.translate("xpack.lens.indexPattern.terms.addaFilter",{defaultMessage:"Add field"}),isDisabled:p.length>3}))}function sr(e,t){return e?u.i18n.translate("xpack.lens.indexPattern.terms.scriptedFieldErrorShort",{defaultMessage:"Scripted fields are not supported when using multiple fields"}):t.length?u.i18n.translate("xpack.lens.indexPattern.terms.invalidFieldsErrorShort",{defaultMessage:"Invalid {invalidFieldsCount, plural, one {field} other {fields}}: {invalidFields}. Check your data view or pick another field.",values:{invalidFieldsCount:t.length,invalidFields:t.map((e=>`"${e}"`)).join(", ")}}):void 0}function rr({layer:e,selectedColumn:t,columnId:a,indexPattern:n,existingFields:i,operationSupportMatrix:l,updateLayer:s,onDeleteColumn:r,incompleteField:o,incompleteOperation:c,incompleteParams:d,currentFieldIsInvalid:p,helpMessage:m,groupId:g,dimensionGroups:b,operationDefinitionMap:h}){const x=t&&h[t.operationType],v=("fullReference"!==(null==x?void 0:x.input)&&"managedReference"!==(null==x?void 0:x.input)||c&&"field"===h[c].input)&&or(t,Boolean(c),null==x?void 0:x.input,p);return Object(y.jsx)(f.EuiFormRow,{"data-test-subj":"indexPattern-field-selection-row",label:u.i18n.translate("xpack.lens.indexPattern.chooseField",{defaultMessage:"Field"}),fullWidth:!0,isInvalid:Boolean(c||p),error:v,labelAppend:!v&&m},Object(y.jsx)(ar,{fieldIsInvalid:p,currentIndexPattern:n,existingFields:i,operationByField:l.operationByField,selectedOperationType:t?t.operationType:c,selectedField:null!=o?o:null==t?void 0:t.sourceField,incompleteOperation:c,onDeleteColumn:r,onChoose:t=>s(os({layer:e,columnId:a,indexPattern:n,op:t.operationType,field:n.getFieldByName(t.field),visualizationGroups:b,targetGroup:g,incompleteParams:d}))}))}function or(e,t,a,n){return e&&t?"field"===a?u.i18n.translate("xpack.lens.indexPattern.invalidOperationLabel",{defaultMessage:"This field does not work with the selected function."}):u.i18n.translate("xpack.lens.indexPattern.chooseFieldLabel",{defaultMessage:"To use this function, select a field."}):n?u.i18n.translate("xpack.lens.indexPattern.invalidFieldLabel",{defaultMessage:"Invalid field. Check your data view or pick another field."}):void 0}function ur(e){var t;return!(null!=e&&null!==(t=e.esTypes)&&void 0!==t&&t.some((e=>["double","float","half_float","scaled_float"].includes(e))))}const cr=u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"});function dr(e,t=0,a=!1,n=0){return a?u.i18n.translate("xpack.lens.indexPattern.rareTermsOf",{defaultMessage:"Rare values of {name}",values:{name:null!=e?e:cr}}):t?u.i18n.translate("xpack.lens.indexPattern.multipleTermsOf",{defaultMessage:"Top values of {name} + {count} {count, plural, one {other} other {others}}",values:{name:null!=e?e:cr,count:t}}):u.i18n.translate("xpack.lens.indexPattern.termsOf",{defaultMessage:"Top {numberOfTermsLabel}{termsCount, plural, one {value} other {values}} of {name}",values:{name:null!=e?e:cr,termsCount:n,numberOfTermsLabel:n>1?`${n} `:""}})}function pr(e){var t;return{id:null!==(t=e.secondaryFields)&&void 0!==t&&t.length?"multi_terms":"terms"}}const mr=Object(f.htmlIdGenerator)()(),gr={type:"terms",displayName:u.i18n.translate("xpack.lens.indexPattern.terms",{defaultMessage:"Top values"}),priority:3,input:"field",getCurrentFields:e=>{var t,a;return[e.sourceField,...null!==(t=null==e||null===(a=e.params)||void 0===a?void 0:a.secondaryFields)&&void 0!==t?t:[]]},getParamsForMultipleFields:({targetColumn:e,sourceColumn:t,field:a,indexPattern:n})=>{const i=new Set(ls(n,e).validFields),l=ls(n,t,a).validFields;for(const e of l)i.add(e);i.delete(e.sourceField);const s=[...i];return{secondaryFields:s,parentFormat:pr({...e.params,secondaryFields:s})}},canAddNewField:({targetColumn:e,sourceColumn:t,field:a,indexPattern:n})=>{var i,l,s;if("rare"===e.params.orderBy.type)return!1;const r=new Set(ls(n,e).validFields),{validFields:o}=ls(n,t,a),u=o.filter((e=>!r.has(e))).length;return!!u&&u+(null!==(i=null===(l=e.params)||void 0===l||null===(s=l.secondaryFields)||void 0===s?void 0:s.length)&&void 0!==i?i:0)<=3},getDefaultVisualSettings:e=>{var t,a;return{truncateText:Boolean(!(null!==(t=e.params)&&void 0!==t&&null!==(a=t.secondaryFields)&&void 0!==a&&a.length))}},getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(Kl.has(a)&&t&&(!e||e.terms))return{dataType:a,isBucketed:!0,scale:"ordinal"}},getErrorMessage:(e,t,a)=>{const n=[...Ol(e.columns[t],a)||[],as(e,t,a)||"",Ql(e,t,a)||""].filter(Boolean);return n.length?n:void 0},getNonTransferableFields:(e,t)=>ls(t,e).invalidFields,isTransferable:(e,t)=>{const{allFields:a,invalidFields:n}=ls(t,e);return Boolean(a.length&&0===n.length&&(!e.params.otherBucket||!t.hasRestrictions))},buildColumn({layer:e,field:t,indexPattern:a}){const n=Object.entries(e.columns).filter((([t])=>ns(e,t))).map((([e])=>e))[0],i=Object.values(e.columns).filter((e=>e&&e.isBucketed)).length;return{label:dr(t.displayName),dataType:t.type,operationType:"terms",scale:"ordinal",sourceField:t.name,isBucketed:!0,params:{size:0===i?5:3,orderBy:n?{type:"column",columnId:n}:{type:"alphabetical",fallback:!0},orderDirection:n?"desc":"asc",otherBucket:!a.hasRestrictions,missingBucket:!1,parentFormat:{id:"terms"}}}},toEsAggsFn:(e,t,a,n,i,l)=>{var s,r,o;if("rare"===(null===(s=e.params)||void 0===s?void 0:s.orderBy.type))return Object(me.buildExpressionFunction)("aggRareTerms",{id:t,enabled:!0,schema:"segment",field:e.sourceField,max_doc_count:e.params.orderBy.maxDocCount}).toAst();const c=e.params.accuracyMode?Math.max(1e3,1.5*e.params.size+10):void 0;return null!==(r=e.params)&&void 0!==r&&null!==(o=r.secondaryFields)&&void 0!==o&&o.length?Object(me.buildExpressionFunction)("aggMultiTerms",{id:t,enabled:!0,schema:"segment",fields:[e.sourceField,...e.params.secondaryFields],orderBy:"alphabetical"===e.params.orderBy.type?"_key":String(l.indexOf(e.params.orderBy.columnId)),order:e.params.orderDirection,size:e.params.size,shardSize:c,otherBucket:Boolean(e.params.otherBucket),otherBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.otherLabel",{defaultMessage:"Other"})}).toAst():Object(me.buildExpressionFunction)("aggTerms",{id:t,enabled:!0,schema:"segment",field:e.sourceField,orderBy:"alphabetical"===e.params.orderBy.type?"_key":String(l.indexOf(e.params.orderBy.columnId)),order:e.params.orderDirection,size:e.params.size,shardSize:c,otherBucket:Boolean(e.params.otherBucket),otherBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.otherLabel",{defaultMessage:"Other"}),missingBucket:e.params.otherBucket&&e.params.missingBucket,missingBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.missingLabel",{defaultMessage:"(missing value)"})}).toAst()},getDefaultLabel:(e,t)=>{var a,n;return dr(null===(a=t.getFieldByName(e.sourceField))||void 0===a?void 0:a.displayName,null===(n=e.params.secondaryFields)||void 0===n?void 0:n.length,"rare"===e.params.orderBy.type,e.params.size)},onFieldChange:(e,t,a)=>{var n;const i={...e.params,secondaryFields:void 0,...a};return"format"in i&&"number"!==t.type&&delete i.format,i.parentFormat=pr(i),ur(t)||"rare"!==i.orderBy.type||(i.orderBy={type:"alphabetical"}),{...e,dataType:t.type,label:e.customLabel?e.label:dr(t.displayName,null===(n=i.secondaryFields)||void 0===n?void 0:n.length,"rare"===i.orderBy.type,i.size),sourceField:t.name,params:i}},onOtherColumnChanged:(e,t,a)=>{const n=e.columns,i=n[t];if(("column"===i.params.orderBy.type||"alphabetical"===i.params.orderBy.type&&i.params.orderBy.fallback)&&(!("column"===i.params.orderBy.type?n[i.params.orderBy.columnId]:void 0)||"column"===i.params.orderBy.type&&!ns(e,i.params.orderBy.columnId))){const t=Object.entries(e.columns).filter((([t])=>ns(e,t))).map((([e])=>e))[0];return{...i,params:{...i.params,orderBy:t?{type:"column",columnId:t}:{type:"alphabetical",fallback:!0},orderDirection:t?"desc":"asc"}}}return i},renderFieldInput:function(e){var t,a,n,i;const{layer:s,selectedColumn:r,columnId:o,indexPattern:c,existingFields:d,operationSupportMatrix:p,updateLayer:m,dimensionGroups:g,groupId:b,incompleteParams:h}=e,x=Object(l.useCallback)((e=>{const t=s.columns[o],[a,...n]=e,i=Object(Se.uniq)(e.map((e=>{var t;return null===(t=c.getFieldByName(e))||void 0===t?void 0:t.type}))),l=(1===i.length?i[0]:"string")||t.dataType,r={...t.params};"format"in r&&"number"!==l&&delete r.format;const u=c.getFieldByName(a);if(ur(u)||"rare"!==r.orderBy.type||(r.orderBy={type:"alphabetical"}),1===e.length){const e=p.operationByField[a];if(!(null==e?void 0:e.has("terms"))){const t=null==e?void 0:e.values().next().value;return m(os({layer:s,columnId:o,indexPattern:c,op:t,field:u,visualizationGroups:g,targetGroup:b,incompleteParams:h}))}}m({...s,columns:{...s.columns,[o]:{...t,dataType:l,sourceField:a,label:t.customLabel?t.label:dr(null==u?void 0:u.displayName,e.length-1,"rare"===r.orderBy.type,r.size),params:{...r,secondaryFields:n,parentFormat:pr({...r,secondaryFields:n})}}}})}),[o,g,b,h,c,s,p.operationByField,m]),v=s.columns[o],j=or(r,Boolean(e.incompleteOperation),"field",e.currentFieldIsInvalid);if(!v||!r||e.incompleteOperation||j&&(null===(t=r.params)||void 0===t||null===(a=t.secondaryFields)||void 0===a||!a.length))return Object(y.jsx)(rr,e);const O=Boolean(Ql(s,o,c)),{invalidFields:k}=ls(c,r);return Object(y.jsx)(f.EuiFormRow,{"data-test-subj":"indexPattern-field-selection-row",label:u.i18n.translate("xpack.lens.indexPattern.terms.chooseFields",{defaultMessage:"{count, plural, zero {Field} other {Fields}}",values:{count:(null===(n=r.params)||void 0===n||null===(i=n.secondaryFields)||void 0===i?void 0:i.length)||0}}),fullWidth:!0,isInvalid:Boolean(O||k.length),error:sr(O,k)},Object(y.jsx)(lr,{column:r,indexPattern:c,existingFields:d,operationSupportMatrix:p,onChange:x,invalidFields:k}))},paramEditor:function({layer:e,updateLayer:t,currentColumn:a,columnId:n,indexPattern:i}){var l,r;const o=i.hasRestrictions;function c(e){return"column"!==e.type?e.type:`${e.type}$$$${e.columnId}`}const d=Object.entries(e.columns).filter((([t])=>ns(e,t))).map((([e,t])=>({value:c({type:"column",columnId:e}),text:t.label})));d.push({value:c({type:"alphabetical"}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderAlphabetical",{defaultMessage:"Alphabetical"})}),null!==(l=a.params.secondaryFields)&&void 0!==l&&l.length||!ur(i.getFieldByName(a.sourceField))||d.push({value:c({type:"rare",maxDocCount:1}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderRare",{defaultMessage:"Rarity"})});const p=a.params.secondaryFields?a.params.secondaryFields.length:0;return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(Ns,{value:a.params.size,disabled:"rare"===a.params.orderBy.type,onChange:l=>{var s;t({...e,columns:{...e.columns,[n]:{...a,label:a.customLabel?a.label:dr(null===(s=i.getFieldByName(a.sourceField))||void 0===s?void 0:s.displayName,p,"rare"===a.params.orderBy.type,l),params:{...a.params,size:l}}}})}}),"rare"===a.params.orderBy.type&&Object(y.jsx)(Ns,{value:a.params.orderBy.maxDocCount,label:u.i18n.translate("xpack.lens.indexPattern.terms.maxDocCount",{defaultMessage:"Max doc count per term"}),maxValue:100,onChange:i=>{t(vs({layer:e,columnId:n,paramName:"orderBy",value:{...a.params.orderBy,maxDocCount:i}}))}}),Object(y.jsx)(f.EuiFormRow,{label:Object(y.jsx)(s.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.terms.orderBy",{defaultMessage:"Rank by"})," ",Object(y.jsx)(f.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.indexPattern.terms.orderByHelp",{defaultMessage:"Specifies the dimension the top values are ranked by."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),display:"rowCompressed",fullWidth:!0},Object(y.jsx)(f.EuiSelect,{compressed:!0,"data-test-subj":"indexPattern-terms-orderBy",options:d,value:c(a.params.orderBy),onChange:a=>{const l="alphabetical"===(s=a.target.value)?{type:"alphabetical",fallback:!1}:"rare"===s?{type:"rare",maxDocCount:1}:{type:"column",columnId:s.split("$$$")[1]};var s;const r=Es(vs({layer:e,columnId:n,paramName:"orderBy",value:l}),i);t(vs({layer:r,columnId:n,paramName:"orderDirection",value:"alphabetical"===l.type?"asc":"desc"}))},"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.orderBy",{defaultMessage:"Rank by"})})),Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),display:"rowCompressed",fullWidth:!0},Object(y.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),"data-test-subj":"indexPattern-terms-orderDirection-groups",name:"orderDirection",buttonSize:"compressed","aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),isDisabled:"rare"===a.params.orderBy.type,options:[{id:`${mr}asc`,"data-test-subj":"indexPattern-terms-orderDirection-groups-asc",value:"asc",label:u.i18n.translate("xpack.lens.indexPattern.terms.orderAscending",{defaultMessage:"Ascending"})},{id:`${mr}desc`,"data-test-subj":"indexPattern-terms-orderDirection-groups-desc",value:"desc",label:u.i18n.translate("xpack.lens.indexPattern.terms.orderDescending",{defaultMessage:"Descending"})}],idSelected:`${mr}${a.params.orderDirection}`,onChange:a=>{const i=a.replace(mr,"");t(vs({layer:e,columnId:n,paramName:"orderDirection",value:i}))}})),!o&&Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiSpacer,{size:"s"}),Object(y.jsx)(f.EuiAccordion,{id:"lnsTermsAdvanced",buttonContent:u.i18n.translate("xpack.lens.indexPattern.terms.advancedSettings",{defaultMessage:"Advanced"}),"data-test-subj":"indexPattern-terms-advanced"},Object(y.jsx)(f.EuiSpacer,{size:"m"}),Object(y.jsx)(f.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.terms.otherBucketDescription",{defaultMessage:'Group other values as "Other"'}),compressed:!0,"data-test-subj":"indexPattern-terms-other-bucket",checked:Boolean(a.params.otherBucket),disabled:"rare"===a.params.orderBy.type,onChange:a=>t(vs({layer:e,columnId:n,paramName:"otherBucket",value:a.target.checked}))}),Object(y.jsx)(f.EuiSpacer,{size:"m"}),Object(y.jsx)(f.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.terms.missingBucketDescription",{defaultMessage:"Include documents without this field"}),compressed:!0,disabled:!a.params.otherBucket||"string"!==(null===(r=i.getFieldByName(a.sourceField))||void 0===r?void 0:r.type)||"rare"===a.params.orderBy.type,"data-test-subj":"indexPattern-terms-missing-bucket",checked:Boolean(a.params.missingBucket),onChange:a=>t(vs({layer:e,columnId:n,paramName:"missingBucket",value:a.target.checked}))}),Object(y.jsx)(f.EuiSpacer,{size:"m"}),Object(y.jsx)(f.EuiSwitch,{label:Object(y.jsx)(s.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.terms.accuracyModeDescription",{defaultMessage:"Enable accuracy mode"})," ",Object(y.jsx)(f.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.indexPattern.terms.accuracyModeHelp",{defaultMessage:"Improves results for high-cardinality data, but increases the load on the Elasticsearch cluster."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),compressed:!0,disabled:"rare"===a.params.orderBy.type,"data-test-subj":"indexPattern-accuracy-mode",checked:Boolean(a.params.accuracyMode&&"rare"!==a.params.orderBy.type),onChange:a=>t(vs({layer:e,columnId:n,paramName:"accuracyMode",value:a.target.checked}))}))))}};var fr,br,hr=a(1),xr=a.n(hr),yr=a(108),vr=a.n(yr),jr=a(109),Or=a.n(jr);!function(e){e._ID="_id",e._INDEX="_index",e._SOURCE="_source",e._TYPE="_type",e.STRING="string",e.TEXT="text",e.MATCH_ONLY_TEXT="match_only_text",e.KEYWORD="keyword",e.VERSION="version",e.BOOLEAN="boolean",e.OBJECT="object",e.DATE="date",e.DATE_NANOS="date_nanos",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.FLOAT="float",e.HALF_FLOAT="half_float",e.SCALED_FLOAT="scaled_float",e.DOUBLE="double",e.INTEGER="integer",e.LONG="long",e.SHORT="short",e.UNSIGNED_LONG="unsigned_long",e.FLOAT_RANGE="float_range",e.DOUBLE_RANGE="double_range",e.INTEGER_RANGE="integer_range",e.LONG_RANGE="long_range",e.NESTED="nested",e.BYTE="byte",e.IP="ip",e.IP_RANGE="ip_range",e.ATTACHMENT="attachment",e.TOKEN_COUNT="token_count",e.MURMUR3="murmur3",e.HISTOGRAM="histogram"}(fr||(fr={})),function(e){e._SOURCE="_source",e.ATTACHMENT="attachment",e.BOOLEAN="boolean",e.DATE="date",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.IP="ip",e.IP_RANGE="ip_range",e.MURMUR3="murmur3",e.NUMBER="number",e.NUMBER_RANGE="number_range",e.STRING="string",e.UNKNOWN="unknown",e.CONFLICT="conflict",e.OBJECT="object",e.NESTED="nested",e.HISTOGRAM="histogram",e.MISSING="missing"}(br||(br={}));var kr=vr()((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Or()(this,e),xr()(this,"name",void 0),xr()(this,"sortable",void 0),xr()(this,"filterable",void 0),xr()(this,"esTypes",void 0),this.name=t.name||br.UNKNOWN,this.sortable=t.sortable||!1,this.filterable=t.filterable||!1,this.esTypes=Object.freeze((t.esTypes||[]).slice())})),Ir=(new kr({name:br.UNKNOWN}),new kr({name:br.STRING,sortable:!0,filterable:!0,esTypes:[fr.STRING,fr.TEXT,fr.MATCH_ONLY_TEXT,fr.KEYWORD,fr.VERSION,fr._TYPE,fr._ID]}),new kr({name:br.NUMBER,sortable:!0,filterable:!0,esTypes:[fr.FLOAT,fr.HALF_FLOAT,fr.SCALED_FLOAT,fr.DOUBLE,fr.INTEGER,fr.LONG,fr.UNSIGNED_LONG,fr.SHORT,fr.BYTE,fr.TOKEN_COUNT]}),new kr({name:br.NUMBER_RANGE,sortable:!0,filterable:!0,esTypes:[fr.FLOAT_RANGE,fr.DOUBLE_RANGE,fr.INTEGER_RANGE,fr.LONG_RANGE]}),new kr({name:br.DATE,sortable:!0,filterable:!0,esTypes:[fr.DATE,fr.DATE_NANOS]}),new kr({name:br.DATE_RANGE,sortable:!0,filterable:!0,esTypes:[fr.DATE_RANGE]}),new kr({name:br.IP,sortable:!0,filterable:!0,esTypes:[fr.IP]}),new kr({name:br.IP_RANGE,sortable:!0,filterable:!0,esTypes:[fr.IP_RANGE]}),new kr({name:br.BOOLEAN,sortable:!0,filterable:!0,esTypes:[fr.BOOLEAN]}),new kr({name:br.OBJECT,esTypes:[fr.OBJECT]}),new kr({name:br.NESTED,esTypes:[fr.NESTED]}),new kr({name:br.GEO_POINT,esTypes:[fr.GEO_POINT]}),new kr({name:br.GEO_SHAPE,esTypes:[fr.GEO_SHAPE]}),new kr({name:br.ATTACHMENT,esTypes:[fr.ATTACHMENT]}),new kr({name:br.MURMUR3,esTypes:[fr.MURMUR3]}),new kr({name:br._SOURCE,esTypes:[fr._SOURCE]}),new kr({name:br.HISTOGRAM,filterable:!0,esTypes:[fr.HISTOGRAM]}),new kr({name:br.CONFLICT}),a(54));const Tr={s:u.i18n.translate("xpack.lens.fieldFormats.suffix.s",{defaultMessage:"/s"}),m:u.i18n.translate("xpack.lens.fieldFormats.suffix.m",{defaultMessage:"/m"}),h:u.i18n.translate("xpack.lens.fieldFormats.suffix.h",{defaultMessage:"/h"}),d:u.i18n.translate("xpack.lens.fieldFormats.suffix.d",{defaultMessage:"/d"})},Mr={s:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.s",{defaultMessage:"per second"}),m:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.m",{defaultMessage:"per minute"}),h:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.h",{defaultMessage:"per hour"}),d:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.d",{defaultMessage:"per day"})},Fr="suffix";function wr(e){var t;return t=class SuffixFormatter extends Ir.FieldFormat{constructor(...t){super(...t),xr()(this,"allowsNumericalAggregations",!0),xr()(this,"textConvert",(t=>{const a=this.param("unit"),n=a?Tr[a]:this.param("suffixString"),i=this.param("id"),l=this.param("params"),s=e()({id:i,params:l}).convert(t);return""===s?"":n?`${s}${n}`:s}))}getParamDefaults(){return{unit:void 0,nestedParams:{}}}},xr()(t,"id",Fr),xr()(t,"hidden",!0),xr()(t,"title",u.i18n.translate("xpack.lens.fieldFormats.suffix.title",{defaultMessage:"Suffix"})),xr()(t,"fieldType",br.NUMBER),t}function Cr(e,t){return(t||e?" ":"")+(e?Mr[e]:"")+(t&&e?" ":"")+(t?`-${t}`:"")}function _r(e,t,a,n,i){let l=e;if(t||n){const a=Cr(t,n),i=e.lastIndexOf(a);-1!==i&&(l=e.substring(0,i))}return a||i?`${l}${Cr(a,i)}`:l}function Sr(e,t,a){const n=e.columns,i=n[t];return i.timeScale?Object.values(n).some((e=>"date_histogram"===(null==e?void 0:e.operationType)))||i.customLabel?i:{...i,timeScale:void 0,label:_r(i.label,i.timeScale,void 0,i.timeShift,i.timeShift)}:i}const Er=new Set(["string","boolean","number","number_range","ip","ip_range","date","date_range","murmur3"]),Pr="ratio",Ar="unique_count";function Lr(e,t){return _r(u.i18n.translate("xpack.lens.indexPattern.cardinalityOf",{defaultMessage:"Unique count of {name}",values:{name:e}}),void 0,void 0,void 0,t)}const Dr={type:Ar,displayName:u.i18n.translate("xpack.lens.indexPattern.cardinality",{defaultMessage:"Unique count"}),input:"field",getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(Er.has(a)&&t&&(!e||e.cardinality))return{dataType:"number",isBucketed:!1,scale:Pr}},getErrorMessage:(e,t,a)=>kl([Ol(e.columns[t],a),Qi(e,t)]),isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&Er.has(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.cardinality))},filterable:!0,shiftable:!0,getDefaultLabel:(e,t)=>Lr(Il(e.sourceField,t),e.timeShift),buildColumn({field:e,previousColumn:t},a){var n;return{label:Lr(e.displayName,null==t?void 0:t.timeShift),dataType:"number",operationType:Ar,scale:Pr,sourceField:e.name,isBucketed:!1,filter:Cl(t,a),timeShift:(null==a?void 0:a.shift)||(null==t?void 0:t.timeShift),params:{...wl(t),emptyAsNull:t&&Ml("unique_count",t)?null===(n=t.params)||void 0===n?void 0:n.emptyAsNull:!(null!=a&&a.usedInMath)}}},getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,updateLayer:n})=>{var i;return[{dataTestSubj:"hide-zero-values",optionElement:Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"}),labelProps:{style:{fontWeight:G.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(vs({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})),title:"",showInPopover:!0,inlineElement:null,onClick:()=>{}}]},toEsAggsFn:(e,t)=>{var a;return Object(me.buildExpressionFunction)("aggCardinality",{id:t,enabled:!0,schema:"metric",field:e.sourceField,timeShift:e.filter?void 0:e.timeShift,emptyAsNull:null===(a=e.params)||void 0===a?void 0:a.emptyAsNull}).toAst()},onFieldChange:(e,t)=>({...e,label:Lr(t.displayName,e.timeShift),sourceField:t.name}),documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.cardinality.signature",{defaultMessage:"field: string"}),description:u.i18n.translate("xpack.lens.indexPattern.cardinality.documentation.markdown",{defaultMessage:"\nCalculates the number of unique values of a specified field. Works for number, string, date and boolean values.\n\nExample: Calculate the number of different products:\n`unique_count(product.name)`\n\nExample: Calculate the number of different products from the \"clothes\" group:\n`unique_count(product.name, kql='product.group=clothes')`\n      "})}};function Nr(e,t,a){return _r(u.i18n.translate("xpack.lens.indexPattern.percentileOf",{defaultMessage:"{percentile, selectordinal, one {#st} two {#nd} few {#rd} other {#th}} percentile of {name}",values:{name:e,percentile:t}}),void 0,void 0,void 0,a)}const zr=["number","histogram"],Br={type:"percentile",displayName:u.i18n.translate("xpack.lens.indexPattern.percentile",{defaultMessage:"Percentile"}),input:"field",operationParams:[{name:"percentile",type:"number",required:!1,defaultValue:95}],filterable:!0,shiftable:!0,getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(zr.includes(a)&&t&&!e)return{dataType:"number",isBucketed:!1,scale:"ratio"}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&zr.includes(a.type)&&a.aggregatable&&!a.aggregationRestrictions)},getDefaultLabel:(e,t,a)=>Nr(Il(e.sourceField,t),e.params.percentile,e.timeShift),buildColumn:({field:e,previousColumn:t,indexPattern:a},n)=>{var i;const l=t&&Ml("percentile",t)&&t.params.percentile,s=null!==(i=null==n?void 0:n.percentile)&&void 0!==i?i:l||95;return{label:Nr(Il(e.name,a),s,null==t?void 0:t.timeShift),dataType:"number",operationType:"percentile",sourceField:e.name,isBucketed:!1,scale:"ratio",filter:Cl(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),params:{percentile:s,...wl(t)}}},onFieldChange:(e,t)=>({...e,label:Nr(t.displayName,e.params.percentile,e.timeShift),sourceField:t.name}),toEsAggsFn:(e,t,a)=>Object(me.buildExpressionFunction)("aggSinglePercentile",{id:t,enabled:!0,schema:"metric",field:e.sourceField,percentile:e.params.percentile,timeShift:e.filter?void 0:e.timeShift}).toAst(),getErrorMessage:(e,t,a)=>kl([Ol(e.columns[t],a),Qi(e,t)]),paramEditor:function({layer:e,updateLayer:t,currentColumn:a,columnId:n,indexPattern:i}){const s=Object(l.useCallback)((l=>{var s;Tl(l,!0,99,1)&&Number(l)!==a.params.percentile&&t({...e,columns:{...e.columns,[n]:{...a,label:a.customLabel?a.label:Nr((null===(s=i.getFieldByName(a.sourceField))||void 0===s?void 0:s.displayName)||a.sourceField,Number(l),a.timeShift),params:{...a.params,percentile:Number(l)}}}})}),[t,e,n,a,i]),{inputValue:r,handleInputChange:o}=Object(j.p)({onChange:s,value:String(a.params.percentile)}),c=Tl(r,!0,99,1),d=Object(l.useCallback)((e=>o(String(e.currentTarget.value))),[o]);return Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.percentile.percentileValue",{defaultMessage:"Percentile"}),"data-test-subj":"lns-indexPattern-percentile-form",display:"rowCompressed",fullWidth:!0,isInvalid:!c,error:!c&&u.i18n.translate("xpack.lens.indexPattern.percentile.errorMessage",{defaultMessage:"Percentile has to be an integer between 1 and 99"})},Object(y.jsx)(f.EuiRange,{"data-test-subj":"lns-indexPattern-percentile-input",compressed:!0,value:null!=r?r:"",min:1,max:99,step:1,onChange:d,showInput:!0,"aria-label":u.i18n.translate("xpack.lens.indexPattern.percentile.percentileValue",{defaultMessage:"Percentile"})}))},documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.percentile.signature",{defaultMessage:"field: string, [percentile]: number"}),description:u.i18n.translate("xpack.lens.indexPattern.percentile.documentation.markdown",{defaultMessage:"\nReturns the specified percentile of the values of a field. This is the value n percent of the values occuring in documents are smaller.\n\nExample: Get the number of bytes larger than 95 % of values:\n`percentile(bytes, percentile=95)`\n      "})}},Vr={min:"aggMin",max:"aggMax",average:"aggAvg",sum:"aggSum",median:"aggMedian"},Rr=["number","histogram"];function Hr({type:e,displayName:t,description:a,ofName:n,priority:i,optionalTimeScaling:l,supportsDate:r,hideZeroOption:o}){const c=(e,t)=>_r(n(e),void 0,l?null==t?void 0:t.timeScale:void 0,void 0,null==t?void 0:t.timeShift);return{type:e,priority:i,displayName:t,description:a,input:"field",timeScalingMode:l?"optional":void 0,getPossibleOperationForField:({aggregationRestrictions:t,aggregatable:a,type:n})=>{if((Rr.includes(n)||r&&"date"===n)&&a&&(!t||t[e]))return{dataType:"date"===n?"date":"number",isBucketed:!1,scale:"ratio"}},isTransferable:(t,a)=>{const n=a.getFieldByName(t.sourceField);return Boolean(n&&Rr.includes(n.type)&&n.aggregatable&&(!n.aggregationRestrictions||n.aggregationRestrictions[e]))},onOtherColumnChanged:(e,t,a)=>l?Sr(e,t):e.columns[t],getDefaultLabel:(e,t,a)=>c(Il(e.sourceField,t),e),buildColumn:({field:t,previousColumn:a},n)=>{var i;return{label:c(t.displayName,a),dataType:r&&"date"===t.type?"date":"number",operationType:e,sourceField:t.name,isBucketed:!1,scale:"ratio",timeScale:l?null==a?void 0:a.timeScale:void 0,filter:Cl(a,n),timeShift:(null==n?void 0:n.shift)||(null==a?void 0:a.timeShift),params:{...wl(a),emptyAsNull:o&&a&&Ml(e,a)?null===(i=a.params)||void 0===i?void 0:i.emptyAsNull:!(null!=n&&n.usedInMath)}}},onFieldChange:(e,t)=>({...e,label:c(t.displayName,e),dataType:t.type,sourceField:t.name}),getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,updateLayer:n})=>{var i;return o?[{dataTestSubj:"hide-zero-values",optionElement:Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"}),labelProps:{style:{fontWeight:G.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(vs({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})),title:"",showInPopover:!0,inlineElement:null,onClick:()=>{}}]:[]},toEsAggsFn:(t,a,n)=>{var i;return Object(me.buildExpressionFunction)(Vr[e],{id:a,enabled:!0,schema:"metric",field:t.sourceField,timeShift:t.filter?void 0:t.timeShift,emptyAsNull:o?null===(i=t.params)||void 0===i?void 0:i.emptyAsNull:void 0}).toAst()},getErrorMessage:(e,t,a)=>kl([Ol(e.columns[t],a),Qi(e,t)]),filterable:!0,documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.metric.signature",{defaultMessage:"field: string"}),description:u.i18n.translate("xpack.lens.indexPattern.metric.documentation.markdown",{defaultMessage:"\nReturns the {metric} of a field. This function only works for number fields.\n\nExample: Get the {metric} of price:\n`{metric}(price)`\n\nExample: Get the {metric} of price for orders from the UK:\n`{metric}(price, kql='location:UK')`\n      ",values:{metric:e}})},shiftable:!0}}const Gr=Hr({type:"min",displayName:u.i18n.translate("xpack.lens.indexPattern.min",{defaultMessage:"Minimum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.minOf",{defaultMessage:"Minimum of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.min.description",{defaultMessage:"A single-value metrics aggregation that returns the minimum value among the numeric values extracted from the aggregated documents."}),supportsDate:!0}),qr=Hr({type:"max",displayName:u.i18n.translate("xpack.lens.indexPattern.max",{defaultMessage:"Maximum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.maxOf",{defaultMessage:"Maximum of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.max.description",{defaultMessage:"A single-value metrics aggregation that returns the maximum value among the numeric values extracted from the aggregated documents."}),supportsDate:!0}),$r=Hr({type:"average",priority:2,displayName:u.i18n.translate("xpack.lens.indexPattern.avg",{defaultMessage:"Average"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.avgOf",{defaultMessage:"Average of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.avg.description",{defaultMessage:"A single-value metric aggregation that computes the average of numeric values that are extracted from the aggregated documents"})}),Wr=Hr({type:"sum",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.sum",{defaultMessage:"Sum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.sumOf",{defaultMessage:"Sum of {name}",values:{name:e}}),optionalTimeScaling:!0,description:u.i18n.translate("xpack.lens.indexPattern.sum.description",{defaultMessage:"A single-value metrics aggregation that sums up numeric values that are extracted from the aggregated documents."}),hideZeroOption:!0}),Ur=Hr({type:"median",priority:3,displayName:u.i18n.translate("xpack.lens.indexPattern.median",{defaultMessage:"Median"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.medianOf",{defaultMessage:"Median of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.median.description",{defaultMessage:"A single-value metrics aggregation that computes the median value that are extracted from the aggregated documents."})}),{isValidInterval:Yr}=Ja.search.aggs,Xr="auto",Kr=new Set(["w","M","q","y"]);function Zr(e,t){if(Object.values(e.columns).some((e=>e.timeShift&&""!==e.timeShift)))return e.columnOrder.filter((t=>"date_histogram"===e.columns[t].operationType)).length<2?void 0:u.i18n.translate("xpack.lens.indexPattern.multipleDateHistogramsError",{defaultMessage:'"{dimensionLabel}" is not the only date histogram. When using time shifts, make sure to only use one date histogram.',values:{dimensionLabel:e.columns[t].label}})}const Qr={type:"date_histogram",displayName:u.i18n.translate("xpack.lens.indexPattern.dateHistogram",{defaultMessage:"Date histogram"}),input:"field",priority:5,operationParams:[{name:"interval",type:"string",required:!1}],getErrorMessage:(e,t,a)=>[...Ol(e.columns[t],a)||[],Zr(e,t)||""].filter(Boolean),getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(("date"===a||"date_range"===a)&&t&&(!e||e.date_histogram))return{dataType:"date",isBucketed:!0,scale:"interval"}},getDefaultLabel:(e,t)=>Il(e.sourceField,t),buildColumn({field:e},t){var a;return{label:e.displayName,dataType:"date",operationType:"date_histogram",sourceField:e.name,isBucketed:!0,scale:"interval",params:{interval:null!==(a=null==t?void 0:t.interval)&&void 0!==a?a:Xr,includeEmptyRows:!0,dropPartials:Boolean(null==t?void 0:t.dropPartials)}}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&"date"===a.type&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.date_histogram))},onFieldChange:(e,t)=>({...e,label:t.displayName,sourceField:t.name}),toEsAggsFn:(e,t,a)=>{var n,i,l,s,r,o,u;const c=a.getFieldByName(e.sourceField);let d,p=null!==(n=null===(i=e.params)||void 0===i?void 0:i.interval)&&void 0!==n?n:Xr;const m=Boolean((null===(l=e.params)||void 0===l?void 0:l.dropPartials)&&(a.timeFieldName===(null==c?void 0:c.name)||!(null!==(s=e.params)&&void 0!==s&&s.ignoreTimeRange)));return c&&c.aggregationRestrictions&&c.aggregationRestrictions.date_histogram&&(p=eo(c.aggregationRestrictions),d=c.aggregationRestrictions.date_histogram.time_zone),Object(me.buildExpressionFunction)("aggDateHistogram",{id:t,enabled:!0,schema:"segment",field:e.sourceField,time_zone:d,useNormalizedEsInterval:!(null!=c&&null!==(r=c.aggregationRestrictions)&&void 0!==r&&r.date_histogram),interval:p,drop_partials:m,min_doc_count:null!==(o=e.params)&&void 0!==o&&o.includeEmptyRows?0:1,extended_bounds:Object(mi.extendedBoundsToAst)({}),extendToTimeRange:null===(u=e.params)||void 0===u?void 0:u.includeEmptyRows}).toAst()},paramEditor:function({layer:e,columnId:t,currentColumn:a,updateLayer:n,dateRange:i,data:r,indexPattern:o}){const d=a&&o.getFieldByName(a.sourceField),p=d.aggregationRestrictions&&d.aggregationRestrictions.date_histogram,[m,g]=Object(l.useState)(a.params.interval),b=m===Xr?Xr:Jr(m),h=!a.params.ignoreTimeRange&&m===Xr||b!==Xr&&""!==m&&Yr(`${""===b.value?"1":b.value}${b.unit}`,eo(d.aggregationRestrictions)),x=Object(l.useCallback)((e=>{const a=e.target.checked;n((e=>vs({layer:e,columnId:t,paramName:"dropPartials",value:a})))}),[t,n]),v=Object(l.useCallback)((e=>{const a=e!==Xr&&Kr.has(e.unit),i=e===Xr?Xr:`${a?"1":e.value}${e.unit||"d"}`;n((e=>vs({layer:e,columnId:t,paramName:"interval",value:i})))}),[t,n]),O=(mi.intervalOptions||[]).filter((e=>e.val!==Xr)).map((e=>({label:e.display,key:e.val})),[]);O.unshift({label:u.i18n.translate("xpack.lens.indexPattern.autoIntervalLabel",{defaultMessage:"Auto ({interval})",values:{interval:r.search.aggs.calculateAutoTimeExpression({from:i.fromDate,to:i.toDate})||"1h"}}),key:Xr});const k=O.find((e=>e.key===m)),I=k?[k]:[{label:m,key:m}];Object(l.useEffect)((()=>{h&&m!==a.params.interval&&v(Jr(m))}),[m,h,a.params.interval,v]);const T=o.timeFieldName===(null==d?void 0:d.name)||!a.params.ignoreTimeRange;return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(y.jsx)(j.i,{tooltipContent:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.dropPartialBucketsHelp",{defaultMessage:"Drop partial buckets is disabled as these can be computed only for a time field bound to global time picker in the top right."}),condition:!T},Object(y.jsx)(f.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.dropPartialBuckets",{defaultMessage:"Drop partial buckets"}),checked:Boolean(a.params.dropPartials),onChange:x,compressed:!0,disabled:!T}))),Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.minimumInterval",{defaultMessage:"Minimum interval"}),fullWidth:!0,display:"rowCompressed",helpText:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.selectOptionHelpText",{defaultMessage:"Select an option or create a custom value. Examples: 30s, 20m, 24h, 2d, 1w, 1M"}),isInvalid:!h,error:!h&&u.i18n.translate("xpack.lens.indexPattern.dateHistogram.invalidInterval",{defaultMessage:"Please pick a valid interval. It's not possible to use multiple weeks, months or years as interval."})},p?Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.dateHistogram.restrictedInterval",defaultMessage:"Interval fixed to {intervalValue} due to aggregation restrictions.",values:{intervalValue:eo(d.aggregationRestrictions)}}):Object(y.jsx)(f.EuiComboBox,{compressed:!0,fullWidth:!0,"data-test-subj":"lensDateHistogramInterval",isInvalid:!h,onChange:i=>{const l=i.length?i[0].key:"";g(l),l===Xr&&a.params.ignoreTimeRange&&n(vs({layer:e,columnId:t,paramName:"ignoreTimeRange",value:!1}))},onCreateOption:e=>g(e.trim()),options:O,selectedOptions:I,singleSelection:{asPlainText:!0},placeholder:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.selectIntervalPlaceholder",{defaultMessage:"Select an interval"})})),Object(y.jsx)(f.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(y.jsx)(f.EuiSwitch,{label:Object(y.jsx)(s.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.bindToGlobalTimePicker",{defaultMessage:"Bind to global time picker"})," ",Object(y.jsx)(f.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.globalTimePickerHelp",{defaultMessage:"Filter the selected field by the global time picker in the top right. This setting can't be turned off for the default time field of the current data view."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),disabled:o.timeFieldName===(null==d?void 0:d.name),checked:T,onChange:()=>{let l=vs({layer:e,columnId:t,paramName:"ignoreTimeRange",value:!a.params.ignoreTimeRange});if(!a.params.ignoreTimeRange&&a.params.interval===Xr){const e=r.search.aggs.calculateAutoTimeExpression({from:i.fromDate,to:i.toDate})||"1h";l=vs({layer:l,columnId:t,paramName:"interval",value:e}),g(e)}n(l)},compressed:!0})),Object(y.jsx)(f.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(y.jsx)(f.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.includeEmptyRows",{defaultMessage:"Include empty rows"}),checked:Boolean(a.params.includeEmptyRows),"data-test-subj":"indexPattern-include-empty-rows",onChange:()=>{n(vs({layer:e,columnId:t,paramName:"includeEmptyRows",value:!a.params.includeEmptyRows}))},compressed:!0})))},helpComponentTitle:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.titleHelp",{defaultMessage:"How auto date histogram works"}),helpComponent(){const e=u.i18n.translate("xpack.lens.indexPattern.dateHistogram.moreThanYear",{defaultMessage:"More than a year"}),t=u.i18n.translate("xpack.lens.indexPattern.dateHistogram.upTo",{defaultMessage:"Up to"});return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoBasicExplanation",{defaultMessage:"The auto date histogram splits a data field into buckets by interval."})),Object(y.jsx)("p",null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.dateHistogram.autoLongerExplanation",defaultMessage:"To choose the interval, Lens divides the specified time range by the {targetBarSetting} setting. Lens calculates the best interval for your data. For example 30m, 1h, and 12. The maximum number of bars is set by the {maxBarSetting} value.",values:{maxBarSetting:Object(y.jsx)(f.EuiCode,null,Ja.UI_SETTINGS.HISTOGRAM_MAX_BARS),targetBarSetting:Object(y.jsx)(f.EuiCode,null,Ja.UI_SETTINGS.HISTOGRAM_BAR_TARGET)}})),Object(y.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoAdvancedExplanation",{defaultMessage:"The interval follows this logic:"})),Object(y.jsx)(f.EuiBasicTable,{items:Ja.search.aggs.boundsDescendingRaw.map((({bound:a,boundLabel:n,intervalLabel:i})=>({bound:"number"==typeof a?e:`${t} ${n}`,interval:i}))),columns:[{field:"bound",name:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoBoundHeader",{defaultMessage:"Target interval measured"})},{field:"interval",name:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoIntervalHeader",{defaultMessage:"Interval used"})}]}))}};function Jr(e){const t=e||"",a=t.match(/[\d]+/)||[],n=t.match(/[\D]+/)||[],i=parseInt(a[0]||"",10);return{value:isNaN(i)?"":i,unit:n[0]||"h"}}function eo(e){if(e&&e.date_histogram)return e.date_histogram.calendar_interval||e.date_histogram.fixed_interval}const to=e=>(t,a,n)=>_r(e(t),void 0,a,void 0,n);function ao(e,t){if(e===D.o.REFERENCELINE)return[u.i18n.translate("xpack.lens.indexPattern.calculations.layerDataType",{defaultMessage:"{name} is disabled for this type of layer.",values:{name:t}})]}function no(e,t){if(!e.columnOrder.filter((t=>e.columns[t].isBucketed)).some((t=>"date_histogram"===e.columns[t].operationType)))return[u.i18n.translate("xpack.lens.indexPattern.calculations.dateHistogramErrorMessage",{defaultMessage:"{name} requires a date histogram to work. Add a date histogram or select a different function.",values:{name:t}})]}const io=ci()((e=>{const t=new Set;return Object.entries(e.columns).forEach((([a,n])=>{"references"in n&&"managedReference"===au[n.operationType].input&&(t.add(a),Ls(a,e.columns).map((([e])=>{t.add(e)})))})),t}));function lo(e,t,a){var n,i;const l=null!==(n=no(e,a))&&void 0!==n?n:[],s=null!==(i=function(e,t){const a=e.columns[t],n=[];return a.references.forEach(((i,l)=>{if(e.columns[i]){const s=e.columns[i],r=au[a.operationType];if("fullReference"!==r.input)throw new Error("inconsistent state - column is not a reference operation");As({validation:r.requiredReferences[l],column:s})||io(e).has(t)||n.push(u.i18n.translate("xpack.lens.indexPattern.invalidReferenceConfiguration",{defaultMessage:'Dimension "{dimensionLabel}" is configured incorrectly',values:{dimensionLabel:a.label}}))}else n.push(u.i18n.translate("xpack.lens.indexPattern.missingReferenceError",{defaultMessage:'"{dimensionLabel}" is not fully configured',values:{dimensionLabel:a.label}}))})),n.length?n:void 0}(e,t))&&void 0!==i?i:[];if(l.length||s.length)return[...l,...s]}function so(e){return e.fields.some((e=>"date"===e.type))}function ro(e,t,a,n={}){const i=e.columns[t],l=e.columnOrder.filter((t=>e.columns[t].isBucketed)),s=l.findIndex((t=>"date_histogram"===e.columns[t].operationType));return l.splice(s,1),[{type:"function",function:a,arguments:{by:l,inputColumnId:[i.references[0]],outputColumnId:[t],outputColumnName:[i.label],...n}}]}const oo=to((e=>u.i18n.translate("xpack.lens.indexPattern.CounterRateOf",{defaultMessage:"Counter rate of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),uo={type:"counter_rate",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"}),input:"fullReference",selectionStyle:"field",requiredReferences:[{input:["field","managedReference"],specificOperations:["max"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:e=>{if(so(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;const i=a[e.references[0]];return oo(i&&"sourceField"in i?null===(n=t.getFieldByName(i.sourceField))||void 0===n?void 0:n.displayName:void 0,e.timeScale,e.timeShift)},toExpression:(e,t)=>ro(e,t,"lens_counter_rate"),buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>{var l;const s=a.columns[e[0]],r=i,o=(null==t?void 0:t.timeScale)||(null==r?void 0:r.timeScale)||"s";return{label:oo(s&&"sourceField"in s?null===(l=n.getFieldByName(s.sourceField))||void 0===l?void 0:l.displayName:void 0,o,null==t?void 0:t.timeShift),dataType:"number",operationType:"counter_rate",isBucketed:!1,scale:"ratio",references:e,timeScale:o,timeShift:(null==i?void 0:i.shift)||(null==t?void 0:t.timeShift),filter:Cl(t,i),params:wl(t)}},isTransferable:(e,t)=>so(t),getErrorMessage:(e,t)=>kl([lo(e,t,u.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"})),Qi(e,t)]),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"});if(a){const e=ao(a,i);if(e)return e.join(", ")}return null===(n=no(t,i))||void 0===n?void 0:n.join(", ")},timeScalingMode:"mandatory",filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.counterRate.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("xpack.lens.indexPattern.counterRate.documentation.markdown",{defaultMessage:"\nCalculates the rate of an ever increasing counter. This function will only yield helpful results on counter metric fields which contain a measurement of some kind monotonically growing over time.\nIf the value does get smaller, it will interpret this as a counter reset. To get most precise results, `counter_rate` should be calculated on the `max` of a field.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\nIt uses the current interval when used in Formula.\n\nExample: Visualize the rate of bytes received over time by a memcached server:\n`counter_rate(max(memcached.stats.read.bytes))`\n      "})},shiftable:!0},co=to((e=>u.i18n.translate("xpack.lens.indexPattern.cumulativeSumOf",{defaultMessage:"Cumulative sum of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),po={type:"cumulative_sum",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"}),input:"fullReference",selectionStyle:"field",requiredReferences:[{input:["field","managedReference"],specificOperations:["count","sum"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:e=>{if(so(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;const i=a[e.references[0]];return co(i&&"sourceField"in i?null===(n=t.getFieldByName(i.sourceField))||void 0===n?void 0:n.displayName:void 0,void 0,e.timeShift)},toExpression:(e,t)=>ro(e,t,"cumulative_sum"),buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>{var l;const s=a.columns[e[0]];return{label:co(s&&"sourceField"in s?null===(l=n.getFieldByName(s.sourceField))||void 0===l?void 0:l.displayName:void 0,void 0,null==t?void 0:t.timeShift),dataType:"number",operationType:"cumulative_sum",isBucketed:!1,scale:"ratio",timeShift:(null==i?void 0:i.shift)||(null==t?void 0:t.timeShift),filter:Cl(t,i),references:e,params:wl(t)}},isTransferable:()=>!0,getErrorMessage:(e,t)=>kl([lo(e,t,u.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"})),Qi(e,t)]),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"});if(a){const e=ao(a,i);if(e)return e.join(", ")}return null===(n=no(t,i))||void 0===n?void 0:n.join(", ")},filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.cumulative_sum.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("xpack.lens.indexPattern.cumulativeSum.documentation.markdown",{defaultMessage:"\nCalculates the cumulative sum of a metric over time, adding all previous values of a series to each value. To use this function, you need to configure a date histogram dimension as well.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nExample: Visualize the received bytes accumulated over time:\n`cumulative_sum(sum(bytes))`\n      "})},shiftable:!0},mo="differences",go=to((e=>u.i18n.translate("xpack.lens.indexPattern.derivativeOf",{defaultMessage:"Differences of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),fo={type:mo,priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"}),input:"fullReference",selectionStyle:"full",requiredReferences:[{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:e=>{if(so(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;return go(null===(n=a[e.references[0]])||void 0===n?void 0:n.label,e.timeScale,e.timeShift)},toExpression:(e,t)=>ro(e,t,"derivative"),buildColumn:({referenceIds:e,previousColumn:t,layer:a},n)=>{var i;const l=a.columns[e[0]],s=null!==(i=null==n?void 0:n.timeScale)&&void 0!==i?i:null==t?void 0:t.timeScale;return{label:go(null==l?void 0:l.label,null==t?void 0:t.timeScale,null==t?void 0:t.timeShift),dataType:"number",operationType:mo,isBucketed:!1,scale:"ratio",references:e,timeScale:s,filter:Cl(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),params:wl(t)}},isTransferable:(e,t)=>so(t),onOtherColumnChanged:Sr,getErrorMessage:(e,t)=>kl([lo(e,t,u.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"})),Qi(e,t)]),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"});if(a){const e=ao(a,i);if(e)return e.join(", ")}return null===(n=no(t,i))||void 0===n?void 0:n.join(", ")},timeScalingMode:"optional",filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.differences.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("xpack.lens.indexPattern.differences.documentation.markdown",{defaultMessage:"\nCalculates the difference to the last value of a metric over time. To use this function, you need to configure a date histogram dimension as well.\nDifferences requires the data to be sequential. If your data is empty when using differences, try increasing the date histogram interval.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nExample: Visualize the change in bytes received over time:\n`differences(sum(bytes))`\n      "})},shiftable:!0},bo=to((e=>u.i18n.translate("xpack.lens.indexPattern.movingAverageOf",{defaultMessage:"Moving average of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),ho={type:"moving_average",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"}),input:"fullReference",selectionStyle:"full",requiredReferences:[{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],operationParams:[{name:"window",type:"number",required:!1,defaultValue:5}],getPossibleOperation:e=>{if(so(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;return bo(null===(n=a[e.references[0]])||void 0===n?void 0:n.label,e.timeScale,e.timeShift)},toExpression:(e,t)=>ro(e,t,"moving_average",{window:[e.columns[t].params.window]}),buildColumn:({referenceIds:e,previousColumn:t,layer:a},n)=>{var i;const l=a.columns[e[0]],s=null!==(i=null==n?void 0:n.window)&&void 0!==i?i:5;return{label:bo(null==l?void 0:l.label,null==t?void 0:t.timeScale,null==t?void 0:t.timeShift),dataType:"number",operationType:"moving_average",isBucketed:!1,scale:"ratio",references:e,timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),filter:Cl(t,n),timeScale:null==t?void 0:t.timeScale,params:{window:s,...wl(t)}}},paramEditor:function({layer:e,updateLayer:t,currentColumn:a,columnId:n}){const[i,s]=Object(l.useState)(String(a.params.window));return Object(j.o)((()=>{if(!Tl(i,!0,void 0,1))return;const a=parseInt(i,10);t(vs({layer:e,columnId:n,paramName:"window",value:a}))}),{skipFirstRender:!0},256,[i]),Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.movingAverage.window",{defaultMessage:"Window size"}),display:"rowCompressed",fullWidth:!0,isInvalid:!Tl(i)},Object(y.jsx)(f.EuiFieldNumber,{compressed:!0,value:i,onChange:e=>s(e.target.value),min:1,step:1,isInvalid:!Tl(i)}))},isTransferable:(e,t)=>so(t),onOtherColumnChanged:Sr,getErrorMessage:(e,t)=>kl([lo(e,t,u.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"})),Qi(e,t)]),helpComponent:()=>Object(y.jsx)(xo,null),helpComponentTitle:u.i18n.translate("xpack.lens.indexPattern.movingAverage.titleHelp",{defaultMessage:"How moving average works"}),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"});if(a){const e=ao(a,i);if(e)return e.join(", ")}return null===(n=no(t,i))||void 0===n?void 0:n.join(", ")},timeScalingMode:"optional",filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.moving_average.signature",{defaultMessage:"metric: number, [window]: number"}),description:u.i18n.translate("xpack.lens.indexPattern.movingAverage.documentation.markdown",{defaultMessage:"\nCalculates the moving average of a metric over time, averaging the last n-th values to calculate the current value. To use this function, you need to configure a date histogram dimension as well.\nThe default window value is {defaultValue}.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nTakes a named parameter `window` which specifies how many last values to include in the average calculation for the current value.\n\nExample: Smooth a line of measurements:\n`moving_average(sum(bytes), window=5)`\n      ",values:{defaultValue:5}})},shiftable:!0},xo=()=>Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)("p",null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.basicExplanation",defaultMessage:"Moving average slides a window across the data and displays the average value. Moving average is supported only by date histograms."})),Object(y.jsx)("p",null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.longerExplanation",defaultMessage:"To calculate the moving average, Lens uses the mean of the window and applies a skip policy for gaps.  For missing values, the bucket is skipped, and the calculation is performed on the next value."})),Object(y.jsx)("p",null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.tableExplanation",defaultMessage:"For example, given the data [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], you can calculate a simple moving average with a window size of 5:"})),Object(y.jsx)("ul",null,Object(y.jsx)("li",null,"(1 + 2 + 3 + 4 + 5) / 5 = 3"),Object(y.jsx)("li",null,"(2 + 3 + 4 + 5 + 6) / 5 = 4"),Object(y.jsx)("li",null,"..."),Object(y.jsx)("li",null,"(5 + 6 + 7 + 8 + 9) / 5 = 7")),Object(y.jsx)("p",null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.windowLimitations",defaultMessage:"The window does not include the current value."})),Object(y.jsx)("p",null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.windowInitialPartial",defaultMessage:"The window is partial until it reaches the requested number of items.  For example, with a window size of 5:"})),Object(y.jsx)("ul",null,Object(y.jsx)("li",null,"(1 + 2) / 2 = 1.5"),Object(y.jsx)("li",null,"(1 + 2 + 3) / 3 = 2"),Object(y.jsx)("li",null,"(1 + 2 + 3 + 4) / 4 = 2.5"),Object(y.jsx)("li",null,"(1 + 2 + 3 + 4 + 5) / 5 = 3")),Object(y.jsx)("p",null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.limitations",defaultMessage:"The first moving average value starts at the second item."})));function yo({type:e,displayName:t,ofName:a,description:n,metric:i}){return{type:e,priority:1,displayName:t,input:"fullReference",selectionStyle:"hidden",requiredReferences:[{input:["field","managedReference","fullReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),getDefaultLabel:(e,t,n)=>{var i;const l=n[e.references[0]];return a(l&&"sourceField"in l?null===(i=t.getFieldByName(l.sourceField))||void 0===i?void 0:i.displayName:void 0)},toExpression:(e,t)=>function(e,t,a,n={}){const i=e.columns[t],l=e.columnOrder.filter((t=>e.columns[t].isBucketed)),s=l.filter((t=>"date_histogram"!==e.columns[t].operationType&&"range"!==e.columns[t].operationType));return[{type:"function",function:a,arguments:{by:s.length===l.length?[]:s,inputColumnId:[i.references[0]],outputColumnId:[t],outputColumnName:[i.label],...n}}]}(e,t,"overall_metric",{metric:[i]}),buildColumn:({referenceIds:e,previousColumn:t,layer:n,indexPattern:l},s)=>{var r;const o=n.columns[e[0]];return{label:a(o&&"sourceField"in o?null===(r=l.getFieldByName(o.sourceField))||void 0===r?void 0:r.displayName:void 0),dataType:"number",operationType:`overall_${i}`,isBucketed:!1,scale:"ratio",references:e,params:wl(t)}},isTransferable:()=>!0,filterable:!1,shiftable:!1,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.overall_metric",{defaultMessage:"metric: number"}),description:n}}}const vo=yo({type:"overall_sum",displayName:u.i18n.translate("xpack.lens.indexPattern.overallSum",{defaultMessage:"Overall sum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallSumOf",{defaultMessage:"Overall sum of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"sum",description:u.i18n.translate("xpack.lens.indexPattern.overall_sum.documentation.markdown",{defaultMessage:"\nCalculates the sum of a metric of all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_sum` is calculating the sum over all dimensions no matter the used function.\n\nExample: Percentage of total\n`sum(bytes) / overall_sum(sum(bytes))`\n      "})}),jo=yo({type:"overall_min",displayName:u.i18n.translate("xpack.lens.indexPattern.overallMin",{defaultMessage:"Overall min"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallMinOf",{defaultMessage:"Overall min of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"min",description:u.i18n.translate("xpack.lens.indexPattern.overall_min.documentation.markdown",{defaultMessage:"\nCalculates the minimum of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_min` is calculating the minimum over all dimensions no matter the used function\n\nExample: Percentage of range\n`(sum(bytes) - overall_min(sum(bytes)) / (overall_max(sum(bytes)) - overall_min(sum(bytes)))`\n      "})}),Oo=yo({type:"overall_max",displayName:u.i18n.translate("xpack.lens.indexPattern.overallMax",{defaultMessage:"Overall max"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallMaxOf",{defaultMessage:"Overall max of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"max",description:u.i18n.translate("xpack.lens.indexPattern.overall_max.documentation.markdown",{defaultMessage:"\nCalculates the maximum of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_max` is calculating the maximum over all dimensions no matter the used function\n\nExample: Percentage of range\n`(sum(bytes) - overall_min(sum(bytes))) / (overall_max(sum(bytes)) - overall_min(sum(bytes)))`\n      "})}),ko=yo({type:"overall_average",displayName:u.i18n.translate("xpack.lens.indexPattern.overallMax",{defaultMessage:"Overall max"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallAverageOf",{defaultMessage:"Overall average of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"average",description:u.i18n.translate("xpack.lens.indexPattern.overall_average.documentation.markdown",{defaultMessage:"\nCalculates the average of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_average` is calculating the average over all dimensions no matter the used function\n\nExample: Divergence from the mean:\n`sum(bytes) - overall_average(sum(bytes))`\n      "})}),Io={type:"normalize_by_unit",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.timeScale",{defaultMessage:"Normalize by unit"}),input:"fullReference",selectionStyle:"hidden",requiredReferences:[{input:["field","managedReference","fullReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],operationParams:[{name:"unit",type:"string",required:!0}],getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),getDefaultLabel:(e,t,a)=>"normalize_by_unit",toExpression:(e,t)=>{const a=e.columns[t];return[{type:"function",function:"lens_time_scale",arguments:{dateColumnId:[e.columnOrder.filter((t=>e.columns[t].isBucketed)).find((t=>"date_histogram"===e.columns[t].operationType))],inputColumnId:[a.references[0]],outputColumnId:[t],outputColumnName:[a.label],targetUnit:[a.params.unit]}}]},buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>({label:"Normalize by unit",dataType:"number",operationType:"normalize_by_unit",isBucketed:!1,scale:"ratio",references:e,params:{...wl(t),unit:null==i?void 0:i.unit}}),isTransferable:()=>!0,getErrorMessage:(e,t)=>kl([lo(e,t,u.i18n.translate("xpack.lens.indexPattern.timeScale",{defaultMessage:"Normalize by unit"})),Qi(e,t),e.columns[t].params.unit?[]:[u.i18n.translate("xpack.lens.indexPattern.timeScale.missingUnit",{defaultMessage:"No unit specified for normalize by unit."})],-1===["s","m","h","d"].indexOf(e.columns[t].params.unit||"s")?[u.i18n.translate("xpack.lens.indexPattern.timeScale.wrongUnit",{defaultMessage:"Unknown unit specified, use s,m,h or d."})]:[]]),filterable:!1,shiftable:!1,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.time_scale",{defaultMessage:"metric: number, unit: s|m|h|d|w|M|y"}),description:u.i18n.translate("xpack.lens.indexPattern.time_scale.documentation.markdown",{defaultMessage:"\n\nThis advanced function is useful for normalizing counts and sums to a specific time interval. It allows for integration with metrics that are stored already normalized to a specific time interval.\n\nThis function can only be used if there's a date histogram function used in the current chart.\n\nExample: A ratio comparing an already normalized metric to another metric that needs to be normalized.\n`normalize_by_unit(counter_rate(max(system.diskio.write.bytes)), unit='s') / last_value(apache.status.bytes_per_second)`\n      "})}},To=u.i18n.translate("xpack.lens.indexPattern.countOf",{defaultMessage:"Count of records"}),Mo={type:"count",priority:2,displayName:u.i18n.translate("xpack.lens.indexPattern.count",{defaultMessage:"Count"}),input:"field",getErrorMessage:(e,t,a)=>kl([Ol(e.columns[t],a),Qi(e,t)]),onFieldChange:(e,t)=>({...e,label:_r(t.displayName,void 0,e.timeScale,void 0,e.timeShift),sourceField:t.name}),getPossibleOperationForField:e=>{if("document"===e.type)return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:e=>_r(To,void 0,e.timeScale,void 0,e.timeShift),buildColumn({field:e,previousColumn:t},a){var n;return{label:_r(To,void 0,null==t?void 0:t.timeScale,void 0,null==t?void 0:t.timeShift),dataType:"number",operationType:"count",isBucketed:!1,scale:"ratio",sourceField:e.name,timeScale:null==t?void 0:t.timeScale,filter:Cl(t,a),timeShift:(null==a?void 0:a.shift)||(null==t?void 0:t.timeShift),params:{...wl(t),emptyAsNull:t&&Ml("count",t)?null===(n=t.params)||void 0===n?void 0:n.emptyAsNull:!(null!=a&&a.usedInMath)}}},getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,updateLayer:n})=>{var i;return[{dataTestSubj:"hide-zero-values",optionElement:Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"}),labelProps:{style:{fontWeight:G.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(vs({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})),title:"",showInPopover:!0,inlineElement:null,onClick:()=>{}}]},onOtherColumnChanged:(e,t,a)=>Sr(e,t),toEsAggsFn:(e,t)=>{var a;return Object(me.buildExpressionFunction)("aggCount",{id:t,enabled:!0,schema:"metric",timeShift:e.filter?void 0:e.timeShift,emptyAsNull:null===(a=e.params)||void 0===a?void 0:a.emptyAsNull}).toAst()},isTransferable:()=>!0,timeScalingMode:"optional",filterable:!0,documentation:{section:"elasticsearch",signature:"",description:u.i18n.translate("xpack.lens.indexPattern.count.documentation.markdown",{defaultMessage:"\nCalculates the number of documents.\n\nExample: Calculate the number of documents:\n`count()`\n\nExample: Calculate the number of documents matching a certain filter:\n`count(kql='price > 500')`\n      "})},shiftable:!0},Fo=u.i18n.translate("xpack.lens.indexPattern.staticValueLabelDefault",{defaultMessage:"Static value"});function wo(e){return function(e){return null==e||""===e}(e)?Fo:u.i18n.translate("xpack.lens.indexPattern.staticValueLabelWithValue",{defaultMessage:"Static value: {value}",values:{value:e}})}const Co={type:"static_value",displayName:Fo,getDefaultLabel:e=>wo(e.params.value),input:"managedReference",hidden:!0,getDisabledStatus(e){},getErrorMessage(e,t){const a=e.columns[t];return null==a.params.value||Tl(a.params.value)?void 0:[u.i18n.translate("xpack.lens.indexPattern.staticValueError",{defaultMessage:"The static value of {value} is not a valid number",values:{value:a.params.value}})]},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio",isStaticValue:!0}),toExpression:(e,t)=>{var a;const n=e.columns[t],i=n.params,l=n.label!==Fo,s=Tl(i.value)?l?n.label:null!==(a=null==i?void 0:i.value)&&void 0!==a?a:Fo:Fo;return[{type:"function",function:Tl(i.value)?"mathColumn":"mapColumn",arguments:{id:[t],name:[s||Fo],expression:[String(Tl(i.value)?i.value:100)]}}]},buildColumn({previousColumn:e,layer:t,indexPattern:a},n,i){var l,s;const r={value:e&&(s=e,Boolean("params"in s&&s.params&&"value"in s.params))&&Tl(e.params.value)?e.params.value:void 0,...wl(e),...n};return{label:wo(r.value),dataType:"number",operationType:"static_value",isStaticValue:!0,isBucketed:!1,scale:"ratio",params:{...r,value:String(null!==(l=r.value)&&void 0!==l?l:100)},references:[]}},isTransferable:e=>!0,createCopy(e,t,a,n,i){const l=e.columns[t];return{...e,columns:{...e.columns,[a]:{...l}}}},paramEditor:function({updateLayer:e,currentColumn:t,columnId:a,activeData:n,layerId:i,paramEditorCustomProps:s}){var r,o,u,c;const d=Object(l.useCallback)((n=>{t.params.value!==n&&e((e=>{const t=e.columns[a];return{...e,columns:{...e.columns,[a]:{...t,label:null!=t&&t.customLabel?t.label:wo(n),params:{...t.params,value:n}}}}}))}),[a,e,null==t||null===(r=t.params)||void 0===r?void 0:r.value]),p=1===(null==n||null===(o=n[i])||void 0===o||null===(u=o.rows)||void 0===u?void 0:u.length)&&n[i].rows[0][a],m="static_value"!==(null==t?void 0:t.operationType)&&null!=p?p:String(100),{inputValue:g,handleInputChange:b}=Object(j.p)({value:(null==t||null===(c=t.params)||void 0===c?void 0:c.value)||m,onChange:d},{allowFalsyValue:!0}),h=Object(l.useCallback)((e=>{const t=e.currentTarget.value;b(Tl(t)?t:void 0)}),[b]);return Object(y.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--padded lnsIndexPatternDimensionEditor__section--shaded"},Object(y.jsx)(f.EuiFormLabel,null,(null==s?void 0:s.label)||Fo),Object(y.jsx)(f.EuiSpacer,{size:"s"}),Object(y.jsx)(f.EuiFieldNumber,{"data-test-subj":"lns-indexPattern-static_value-input",compressed:!0,value:null!=g?g:"",onChange:h,step:"any"}))}};function _o(e,t){return _r(u.i18n.translate("xpack.lens.indexPattern.lastValueOf",{defaultMessage:"Last value of {name}",values:{name:e}}),void 0,void 0,void 0,t)}const So=new Set(["string","boolean","number","ip","date","ip_range","number_range","date_range"]);function Eo(e,t){if(!t)return;const a=t.getFieldByName(e);return a?"date"!==a.type?u.i18n.translate("xpack.lens.indexPattern.lastValue.invalidTypeSortField",{defaultMessage:"Field {invalidField} is not a date field and cannot be used for sorting",values:{invalidField:e}}):void 0:u.i18n.translate("xpack.lens.indexPattern.lastValue.sortFieldNotFound",{defaultMessage:"Field {invalidField} was not found",values:{invalidField:e}})}function Po(e){return e.timeFieldName&&e.fields.find((t=>t.name===e.timeFieldName&&"date"===t.type))}function Ao(e){const t=e.fields.filter((e=>"date"===e.type));return Po(e)&&t.sort((({name:t},{name:a})=>t===e.timeFieldName?-1:a===e.timeFieldName?1:0)),t}function Lo(e){return{query:`${e}: *`,language:"kuery"}}const Do={type:"last_value",displayName:u.i18n.translate("xpack.lens.indexPattern.lastValue",{defaultMessage:"Last value"}),getDefaultLabel:(e,t)=>_o(Il(e.sourceField,t),e.timeShift),input:"field",onFieldChange:(e,t)=>{const a={...e.params};return a.showArrayValues=is(t)||e.params.showArrayValues,"format"in a&&"number"!==t.type&&delete a.format,{...e,dataType:t.type,label:_o(t.displayName,e.timeShift),sourceField:t.name,params:a,scale:"string"===t.type?"ordinal":"ratio",filter:e.filter&&Object(Se.isEqual)(e.filter,Lo(e.sourceField))?Lo(t.name):e.filter}},getPossibleOperationForField:({aggregationRestrictions:e,type:t})=>{if(So.has(t)&&!e)return{dataType:t,isBucketed:!1,scale:"string"===t?"ordinal":"ratio"}},getDisabledStatus(e){if(!e||!Ao(e).length)return u.i18n.translate("xpack.lens.indexPattern.lastValue.disabled",{defaultMessage:"This function requires the presence of a date field in your data view"})},getErrorMessage(e,t,a){const n=e.columns[t];let i=[];const l=Ol(n,a),s=Eo(n.params.sortField,a);return l&&(i=[...l]),s&&(i=[s]),i.push(...Qi(e,t)||[]),i.length?i:void 0},buildColumn({field:e,previousColumn:t,indexPattern:a},n){var i;const l=n,s=Po(a)?a.timeFieldName:null===(i=a.fields.find((e=>"date"===e.type)))||void 0===i?void 0:i.name;if(!s)throw new Error(u.i18n.translate("xpack.lens.functions.lastValue.missingSortField",{defaultMessage:"This data view does not contain any date fields"}));const r=is(e)||(null==l?void 0:l.showArrayValues);return{label:_o(e.displayName,null==t?void 0:t.timeShift),dataType:e.type,operationType:"last_value",isBucketed:!1,scale:"string"===e.type?"ordinal":"ratio",sourceField:e.name,filter:Cl(t,n)||Lo(e.name),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),params:{showArrayValues:r,sortField:(null==l?void 0:l.sortField)||s,...wl(t)}}},filterable:!0,shiftable:!0,toEsAggsFn:(e,t,a)=>{const n={id:t,enabled:!0,schema:"metric",field:e.sourceField,size:1,sortOrder:"desc",sortField:e.params.sortField,timeShift:e.filter?void 0:e.timeShift};return(e.params.showArrayValues?Object(me.buildExpressionFunction)("aggTopHit",{...n,aggregate:"concat"}):Object(me.buildExpressionFunction)("aggTopMetrics",n)).toAst()},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField),n=t.getFieldByName(e.params.sortField);return Boolean(a&&a.type===e.dataType&&!a.aggregationRestrictions&&"date"===(null==n?void 0:n.type)&&So.has(a.type))},paramEditor:({layer:e,updateLayer:t,columnId:a,currentColumn:n,indexPattern:i})=>{var l,r;const o=Ao(i),c=!!Eo(n.params.sortField,i),d=Object.keys(e.columns).some((t=>"terms"===e.columns[t].operationType));return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.lastValue.sortField",{defaultMessage:"Sort by date field"}),display:"rowCompressed",fullWidth:!0,error:u.i18n.translate("xpack.lens.indexPattern.sortField.invalid",{defaultMessage:"Invalid field. Check your data view or pick another field."}),isInvalid:c},Object(y.jsx)(f.EuiComboBox,{placeholder:u.i18n.translate("xpack.lens.indexPattern.lastValue.sortFieldPlaceholder",{defaultMessage:"Sort field"}),compressed:!0,isClearable:!1,"data-test-subj":"lns-indexPattern-lastValue-sortField",isInvalid:c,singleSelection:{asPlainText:!0},"aria-label":u.i18n.translate("xpack.lens.indexPattern.lastValue.sortField",{defaultMessage:"Sort by date field"}),options:null==o?void 0:o.map((e=>({value:e.name,label:e.displayName}))),onChange:n=>{0!==n.length&&t(vs({layer:e,columnId:a,paramName:"sortField",value:n[0].value}))},selectedOptions:null!==(l=n.params)&&void 0!==l&&l.sortField?[{label:(null===(r=i.getFieldByName(n.params.sortField))||void 0===r?void 0:r.displayName)||n.params.sortField,value:n.params.sortField}]:[]})),Object(y.jsx)(f.EuiFormRow,{error:u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValuesWithTopValuesWarning",{defaultMessage:"When you show array values, you are unable to use this field to rank Top values."}),isInvalid:n.params.showArrayValues&&d,display:"rowCompressed",fullWidth:!0,"data-test-subj":"lns-indexPattern-lastValue-showArrayValues"},Object(y.jsx)(f.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValuesExplanation",{defaultMessage:"Displays all values associated with this field in each last document."}),position:"left"},Object(y.jsx)(f.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValues",{defaultMessage:"Show array values"}),compressed:!0,checked:Boolean(n.params.showArrayValues),disabled:is(n.sourceField,i),onChange:()=>(n=>{let i=vs({layer:e,columnId:a,paramName:"showArrayValues",value:n});i={...i,columns:js(i,a)},t(i)})(!n.params.showArrayValues)}))))},documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.lastValue.signature",{defaultMessage:"field: string"}),description:u.i18n.translate("xpack.lens.indexPattern.lastValue.documentation.markdown",{defaultMessage:"\nReturns the value of a field from the last document, ordered by the default time field of the data view.\n\nThis function is usefull the retrieve the latest state of an entity.\n\nExample: Get the current status of server A:\n`last_value(server.status, kql='server.name=\"A\"')`\n      "})}};a(318);const No="auto",zo="range",Bo="histogram",Vo=Object(f.htmlIdGenerator)(),Ro=(e,t)=>e.label||t.convert({gte:Tl(e.from)?e.from:-1/0,lt:Tl(e.to)?e.to:1/0}),Ho=({range:e,setRange:t,button:a,triggerClose:n,isOpen:i})=>{const[r,o]=Object(l.useState)(e),c=s.a.useRef(),d=s.a.useRef(),p=(a,n=!1)=>{n&&o(e),t(a)},{from:m,to:g,label:b}=r,h=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanOrEqualAppend",{defaultMessage:""}),x=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanOrEqualTooltip",{defaultMessage:"Less than or equal to"}),v=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanPrepend",{defaultMessage:"<"}),j=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanTooltip",{defaultMessage:"Less than"});return Object(y.jsx)(f.EuiPopover,{display:"block",ownFocus:!0,isOpen:i,closePopover:()=>n(),button:a,"data-test-subj":"indexPattern-ranges-popover"},Object(y.jsx)(f.EuiFormRow,null,Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"s",responsive:!1,alignItems:"center"},Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(f.EuiFieldNumber,{className:"lnsRangesOperation__popoverNumberField",value:Tl(m)?Number(m):"",onChange:({target:e})=>{const t={...r,from:""!==e.value?Number(e.value):-1/0};o(t),p(t)},append:Object(y.jsx)(f.EuiToolTip,{content:x},Object(y.jsx)(f.EuiText,{size:"s"},h)),onKeyDown:({key:e})=>{f.keys.ENTER===e&&d.current&&d.current.focus()},compressed:!0,placeholder:"",isInvalid:!Qo(r),step:1})),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiIcon,{type:"sortRight",color:"subdued"})),Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(f.EuiFieldNumber,{className:"lnsRangesOperation__popoverNumberField",value:Tl(g)?Number(g):"",inputRef:e=>{d&&e&&(d.current=e)},onChange:({target:e})=>{const t={...r,to:""!==e.value?Number(e.value):1/0};o(t),p(t)},prepend:Object(y.jsx)(f.EuiToolTip,{content:j},Object(y.jsx)(f.EuiText,{size:"s"},v)),compressed:!0,placeholder:"+",isInvalid:!Qo(r),onKeyDown:({key:e})=>{f.keys.ENTER===e&&c.current&&c.current.focus()},step:1})))),Object(y.jsx)(f.EuiFormRow,null,Object(y.jsx)(Pl,{inputRef:c,value:b||"",onChange:e=>{const t={...r,label:e};o(t),p(t)},placeholder:u.i18n.translate("xpack.lens.indexPattern.ranges.customRangeLabelPlaceholder",{defaultMessage:"Custom label"}),onSubmit:()=>{n()},compressed:!0,dataTestSubj:"indexPattern-ranges-label"})))},Go=({ranges:e,setRanges:t,onToggleEditor:a,formatter:n})=>{const[i,r]=Object(l.useState)(""),[o,c]=Object(l.useState)((()=>e.map((e=>({...e,id:Vo()})))));Object(j.o)((()=>{t(o.map((({id:e,...t})=>({...t}))))}),{skipFirstRender:!0},256,[o]);const d=e=>{let t=e;i===e&&(t=""),r(t)};return Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.ranges.customRanges",{defaultMessage:"Ranges"}),labelAppend:Object(y.jsx)(f.EuiText,{size:"xs"},Object(y.jsx)(f.EuiLink,{color:"danger",onClick:a},Object(y.jsx)(f.EuiIcon,{size:"s",type:"cross",color:"danger"})," ",u.i18n.translate("xpack.lens.indexPattern.ranges.customRangesRemoval",{defaultMessage:"Remove custom ranges"})))},Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(Nl,{onDragEnd:c,onDragStart:()=>{},droppableId:"RANGES_DROPPABLE_AREA",items:o},o.map(((e,t)=>Object(y.jsx)(Dl,{key:e.id,idx:t,id:e.id,isInvalid:!Qo(e),invalidMessage:u.i18n.translate("xpack.lens.indexPattern.range.isInvalid",{defaultMessage:"This range is invalid"}),onRemoveClick:()=>{const e=o.filter(((e,a)=>a!==t));c(e)},removeTitle:u.i18n.translate("xpack.lens.indexPattern.ranges.deleteRange",{defaultMessage:"Delete range"}),isNotRemovable:1===o.length},Object(y.jsx)(Ho,{range:e,isOpen:e.id===i,triggerClose:()=>d(""),setRange:e=>{const a=[...o];e.id===a[t].id?a[t]=e:a.push(e),c(a)},button:Object(y.jsx)(f.EuiLink,{color:"text",onClick:()=>d(e.id),className:"lnsRangesOperation__popoverButton","data-test-subj":"indexPattern-ranges-popover-trigger"},Object(y.jsx)(f.EuiText,{size:"s",textAlign:"left",color:Qo(e)?"default":"danger"},Ro(e,n)))}))))),Object(y.jsx)(Al,{onClick:()=>{(()=>{const e=Vo();c([...o,{id:e,from:o[o.length-1].to,to:1/0,label:""}]),r(e)})()},label:u.i18n.translate("xpack.lens.indexPattern.ranges.addRange",{defaultMessage:"Add range"})})))};a(323);const qo=({children:e,onClick:t})=>Object(y.jsx)(f.EuiText,{size:"xs"},Object(y.jsx)(f.EuiLink,{onClick:t},Object(y.jsx)(f.EuiIcon,{className:"lnsHelpPopover__buttonIcon",size:"s",type:"help"}),e)),$o=({anchorPosition:e,button:t,children:a,closePopover:n,isOpen:i,title:s})=>(Object(l.useEffect)((()=>{i&&Object(fn.e)("open_help_popover")}),[i]),Object(y.jsx)(f.EuiPopover,{anchorPosition:e,button:t,className:"lnsHelpPopover",closePopover:n,isOpen:i,ownFocus:!0,panelClassName:"lnsHelpPopover__panel",panelPaddingSize:"none"},s&&Object(y.jsx)(f.EuiPopoverTitle,{paddingSize:"m"},s),Object(y.jsx)(f.EuiText,{className:"lnsHelpPopover__content",size:"s"},a))),Wo=({anchorPosition:e,button:t,children:a,closePopover:n,isOpen:i,title:s})=>(Object(l.useEffect)((()=>{i&&Object(fn.e)("open_help_popover")}),[i]),Object(y.jsx)(f.EuiWrappingPopover,{anchorPosition:e,button:t,className:"lnsHelpPopover",closePopover:n,isOpen:i,ownFocus:!0,panelClassName:"lnsHelpPopover__panel",panelPaddingSize:"none"},s&&Object(y.jsx)(f.EuiPopoverTitle,{paddingSize:"m"},s),Object(y.jsx)(f.EuiText,{className:"lnsHelpPopover__content",size:"s"},a))),Uo=()=>{const[e,t]=Object(l.useState)(!1);return Object(y.jsx)($o,{anchorPosition:"upCenter",button:Object(y.jsx)(qo,{onClick:()=>{t(!e)}},u.i18n.translate("xpack.lens.indexPattern.ranges.granularityHelpText",{defaultMessage:"How it works"})),closePopover:()=>t(!1),isOpen:e,title:u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverTitle",{defaultMessage:"How granularity interval works"})},Object(y.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverBasicExplanation",{defaultMessage:"Interval granularity divides the field into evenly spaced intervals based on the minimum and maximum values for the field."})),Object(y.jsx)("p",null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.ranges.granularityPopoverExplanation",defaultMessage:'The size of the interval is a "nice" value. When the granularity of the slider changes, the interval stays the same when the nice interval is the same. The minimum granularity is 1, and the maximum value is {setting}. To change the maximum granularity, go to Advanced settings.',values:{setting:Object(y.jsx)(f.EuiCode,null,Ja.UI_SETTINGS.HISTOGRAM_MAX_BARS)}})),Object(y.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverAdvancedExplanation",{defaultMessage:"Intervals are incremented by 10, 5 or 2. For example, an interval can be 100 or 0.2 ."})))},Yo=({maxBars:e,step:t,maxHistogramBars:a,onToggleEditor:n,onMaxBarsChange:i,includeEmptyRows:r,onChangeIncludeEmptyRows:o})=>{const[c,d]=Object(l.useState)(String(e));Object(j.o)((()=>{i(Number(c))}),{skipFirstRender:!0},256,[c]);const p=u.i18n.translate("xpack.lens.indexPattern.ranges.granularity",{defaultMessage:"Intervals granularity"}),m=u.i18n.translate("xpack.lens.indexPattern.ranges.decreaseButtonLabel",{defaultMessage:"Decrease granularity"}),g=u.i18n.translate("xpack.lens.indexPattern.ranges.increaseButtonLabel",{defaultMessage:"Increase granularity"});return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{label:p,"data-test-subj":"indexPattern-ranges-section-label",labelType:"legend",fullWidth:!0,display:"rowCompressed",labelAppend:Object(y.jsx)(Uo,null)},Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiToolTip,{content:m,delay:"long"},Object(y.jsx)(f.EuiButtonIcon,{iconType:"minusInCircle",color:"text","data-test-subj":"lns-indexPattern-range-maxBars-minus",onClick:()=>d(""+Math.max(Number(c)-t,1)),"aria-label":m}))),Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(f.EuiRange,{compressed:!0,fullWidth:!0,"aria-label":p,"data-test-subj":"lns-indexPattern-range-maxBars-field",min:1,max:a,step:t,value:c,onChange:({currentTarget:e})=>d(e.value)})),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiToolTip,{content:g,delay:"long"},Object(y.jsx)(f.EuiButtonIcon,{iconType:"plusInCircle",color:"text","data-test-subj":"lns-indexPattern-range-maxBars-plus",onClick:()=>d(""+Math.min(Number(c)+t,a)),"aria-label":g}))))),Object(y.jsx)(f.EuiButtonEmpty,{size:"xs",iconType:"controlsHorizontal",onClick:()=>n()},u.i18n.translate("xpack.lens.indexPattern.ranges.customIntervalsToggle",{defaultMessage:"Create custom ranges"})),Object(y.jsx)(f.EuiSpacer,{size:"s"}),Object(y.jsx)(f.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(y.jsx)(f.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.ranges.includeEmptyRows",{defaultMessage:"Include empty rows"}),checked:Boolean(r),onChange:()=>{o(!r)},compressed:!0})))},Xo=({setParam:e,params:t,maxHistogramBars:a,maxBars:n,granularityStep:i,onChangeMode:s,rangeFormatter:r})=>{const[o,u]=Object(l.useState)(t.type===zo);return o?Object(y.jsx)(Go,{ranges:t.ranges,setRanges:t=>{e("ranges",t)},onToggleEditor:()=>{s(Bo),u(!1)},formatter:r}):Object(y.jsx)(Yo,{includeEmptyRows:t.includeEmptyRows,maxBars:n,step:i,maxHistogramBars:a,onMaxBarsChange:t=>{e("maxBars",t)},onChangeIncludeEmptyRows:t=>{e("includeEmptyRows",t)},onToggleEditor:()=>{s(zo),u(!0)}})};var Ko=a(110);const Zo=e=>Tl(e.from)&&Tl(e.to),Qo=e=>!Zo(e)||(e=>e.from<=e.to)(e);function Jo(e,t){if(t&&e.fieldFormatMap&&e.fieldFormatMap[t.name])return e.fieldFormatMap[t.name]}const eu=[Yl,gr,Qr,Gr,qr,$r,Dr,Wr,Ur,Br,Do,Mo,{type:"range",displayName:u.i18n.translate("xpack.lens.indexPattern.intervals",{defaultMessage:"Intervals"}),priority:4,input:"field",getErrorMessage:(e,t,a)=>Ol(e.columns[t],a),getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if("number"===a&&t&&(!e||e.range))return{dataType:"number",isBucketed:!0,scale:"interval"}},getDefaultLabel:(e,t)=>{var a,n;return null!==(a=null===(n=t.getFieldByName(e.sourceField))||void 0===n?void 0:n.displayName)&&void 0!==a?a:u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"})},buildColumn:({field:e})=>({label:e.displayName,dataType:"number",operationType:"range",sourceField:e.name,isBucketed:!0,scale:"interval",params:{includeEmptyRows:!0,type:Bo,ranges:[{from:0,to:1e3,label:""}],maxBars:No,format:void 0,parentFormat:void 0}}),isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&"number"===a.type&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.range))},onFieldChange:(e,t)=>({...e,label:t.name,sourceField:t.name}),toEsAggsFn:(e,t,a,n,i)=>{const{sourceField:l,params:s}=e;if(s.type===zo)return Object(me.buildExpressionFunction)("aggRange",{id:t,enabled:!0,schema:"segment",field:l,ranges:s.ranges.filter(Qo).map((e=>{if(Zo(e))return e;const t={label:e.label};return Tl(e.from)&&(t.from=Number(e.from)),Tl(e.to)&&(t.to=Number(e.to)),t})).map(mi.numericalRangeToAst)}).toAst();const r=(i.get(Ja.UI_SETTINGS.HISTOGRAM_MAX_BARS)-1)/2;return Object(me.buildExpressionFunction)("aggHistogram",{id:t,enabled:!0,schema:"segment",field:l,maxBars:s.maxBars===No?r:s.maxBars,interval:"auto",has_extended_bounds:!1,min_doc_count:Boolean(s.includeEmptyRows),autoExtendBounds:Boolean(s.includeEmptyRows),extended_bounds:Object(mi.extendedBoundsToAst)({})}).toAst()},paramEditor:({layer:e,columnId:t,currentColumn:a,updateLayer:n,indexPattern:i,uiSettings:l,data:s})=>{var r,o;const u=i.getFieldByName(a.sourceField),c=a.params.format,d=c&&Ko.a[c.id]&&Ko.a[c.id].decimalsToPattern((null===(r=c.params)||void 0===r?void 0:r.decimals)||0),p=s.fieldFormats.deserialize({...a.params.parentFormat||{id:"range"},params:{...null===(o=a.params.parentFormat)||void 0===o?void 0:o.params,...c?{id:c.id,params:{pattern:d}}:Jo(i,u)}}),m=l.get(Ja.UI_SETTINGS.HISTOGRAM_MAX_BARS),g=(m-1)/6,f=(m-1)/2;return Object(y.jsx)(Xo,{setParam:(a,i)=>{n(vs({layer:e,columnId:t,paramName:a,value:i}))},maxBars:a.params.maxBars===No?f:a.params.maxBars,granularityStep:g,params:a.params,onChangeMode:i=>{const l=i===zo?"ordinal":"interval",s=i===zo?"string":"number",r=i===zo?{id:"range",params:{template:"arrow_right",replaceInfinity:!0}}:void 0;n({...e,columns:{...e.columns,[t]:{...a,scale:l,dataType:s,params:{type:i,ranges:[{from:0,to:1e3,label:""}],maxBars:f,format:a.params.format,parentFormat:r}}}})},maxHistogramBars:l.get(Ja.UI_SETTINGS.HISTOGRAM_MAX_BARS),rangeFormatter:p})}},po,uo,fo,ho,dl,El,vo,jo,Oo,ko,Co,Io],tu=eu,au=eu.reduce(((e,t)=>({...e,[t.type]:t})),{}),nu={avg:"average",cardinality:"unique_count"};function iu(){const e={};return tu.forEach((({type:t,displayName:a})=>{e[t]={type:t,displayName:a}})),e}function lu(e,t){return(t.priority||Number.NEGATIVE_INFINITY)-(e.priority||Number.NEGATIVE_INFINITY)}function su(e){var t,a,n;return vl(e)?null!==(t=null===(a=au[e.operationType])||void 0===a||null===(n=a.getCurrentFields)||void 0===n?void 0:n.call(a,e))&&void 0!==t?t:[e.sourceField]:[]}function ru(e){var t;return null===(t=au[e])||void 0===t?void 0:t.getParamsForMultipleFields}function ou(e,t,a,n){var i,l;return Boolean(null===(i=au[t.operationType])||void 0===i||null===(l=i.canAddNewField)||void 0===l?void 0:l.call(i,{targetColumn:t,sourceColumn:a,field:n,indexPattern:e}))}function uu(e,t){return tu.filter((a=>{if("field"!==a.input)return!1;const n=a.getPossibleOperationForField(e);return t?n&&t(n):n})).sort(lu).map((({type:e})=>e))}const cu=Object(Se.memoize)((function(e,t){const a={},n=(e,t)=>{if(!t)return;const n=JSON.stringify(t);a[n]?a[n].operations.push(e):a[n]={operationMetaData:t,operations:[e]}};return(t?Object.values(t):tu).sort(lu).forEach((t=>{if("field"===t.input)e.fields.forEach((e=>{n({type:"field",operationType:t.type,field:e.name},t.getPossibleOperationForField(e))}));else if("none"===t.input)n({type:"none",operationType:t.type},t.getPossibleOperation());else if("fullReference"===t.input){const a=t.getPossibleOperation(e);a&&n({type:"fullReference",operationType:t.type},a)}else if("managedReference"===t.input){const e=t.getPossibleOperation();e&&n({type:"managedReference",operationType:t.type},e)}})),Object.values(a)}));var du=a(111);function pu(e){const t=e.fields.filter((e=>!(Object(oi.isNestedField)(e)||!e.aggregatable&&!e.scripted))).map((t=>{const a={name:t.name,displayName:t.displayName,type:t.type,aggregatable:t.aggregatable,searchable:t.searchable,meta:e.metaFields.includes(t.name),esTypes:t.esTypes,scripted:t.scripted,runtime:Boolean(t.runtimeField)};return a.scripted?{...a,lang:t.lang,script:t.script}:a})).concat(ml),{typeMeta:a,title:n,timeFieldName:i,fieldFormatMap:l}=e;if(null!=a&&a.aggs){const e=Object.keys(a.aggs);t.forEach(((n,i)=>{const l={};e.forEach((e=>{const t=a.aggs&&a.aggs[e]&&a.aggs[e][n.name];t&&(l[function(e){return e in nu?nu[e]:e}(e)]=t)})),Object.keys(l).length&&(t[i]={...n,aggregationRestrictions:l})}))}return{id:e.id,title:n,timeFieldName:i,fieldFormatMap:l&&Object.fromEntries(Object.entries(l).map((([e,t])=>[e,"toJSON"in t?t.toJSON():t]))),fields:t,getFieldByName:Zs(t),hasRestrictions:!(null==a||!a.aggs)}}async function mu({indexPatternsService:e,patterns:t,notUsedPatterns:a,cache:n}){const i=t.filter((e=>!n[e]));if(0===i.length)return n;cu.cache.clear&&cu.cache.clear();let l=(await Promise.allSettled(i.map((t=>e.get(t))))).filter((e=>"fulfilled"===e.status)).map((e=>e.value));for(let t=0;a&&t<(null==a?void 0:a.length)&&!l.length;t++){const n=await e.get(a[t]).catch((e=>{}));n&&(l=[n])}return l.reduce(((e,t)=>({[t.id]:pu(t),...e})),{...n})}const gu=(e,t)=>{Object(du.b)(e,"indexPatternId",t)};function fu(e){return`indexpattern-datasource-layer-${e}`}function bu(e,t){const a={};return Object.entries(e.layers).forEach((([e,n])=>{a[e]={...n,indexPatternId:t.find((({name:t})=>t===fu(e))).id}})),{layers:a}}function hu(e){return e.reduce(((e,t)=>(e[t]=!0,e)),{})}function xu(e){const t=Object.values(e);return 1===t.length&&0===t[0].columnOrder.length}function yu({state:e,layerId:t,newLayer:a}){return{...e,layers:{...e.layers,[t]:{...e.layers[t],...a}}}}function vu(e,t,a){var n;const i=e.columns[t];if(!i||!a)return;const l=i.operationType&&au[i.operationType],s="references"in i&&Boolean(function(e,t,a){var n;return null===(n=t.references)||void 0===n?void 0:n.map((t=>{var n,i;const l=null===(n=e.columns[t])||void 0===n?void 0:n.operationType,s=au[l];return null==s||null===(i=s.getErrorMessage)||void 0===i?void 0:i.call(s,e,t,a,au)}))}(e,i,a).filter(Boolean).length),r=l&&(null===(n=l.getErrorMessage)||void 0===n?void 0:n.call(l,e,t,a,au)),o=!!i.filter&&!Ul(i.filter,a);return r&&r.length>0||s||o}function ju(e,{activeData:t},a,n){const i=[];return e&&t&&Object.entries(t).reduce(((e,[t,{columns:a}])=>[...e,...a.map((e=>({layerId:t,column:e})))]),[]).forEach((({layerId:t,column:l})=>{const r=e.layers[t],o=null==r?void 0:r.columns[l.id];if(r&&o&&Object(mi.checkColumnForPrecisionError)(l)){const m=e.indexPatterns[r.indexPatternId],g=Ml("terms",o),b=g&&"column"===o.params.orderBy.type&&"asc"===o.params.orderDirection&&Ml("count",r.columns[o.params.orderBy.columnId]),h=g&&!ur(m.getFieldByName(o.sourceField)),x=g&&(o.params.secondaryFields||[]).length>0;g&&(!b||h||x)?i.push(o.params.accuracyMode?(d=l.name,p=a.links.aggs.terms_doc_count_error,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.accuracyEnabled",defaultMessage:"{name} might be an approximation. For more precise results, try increasing the number of {topValues} or using {filters} instead. {learnMoreLink}",values:{name:Object(y.jsx)(f.EuiTextColor,{color:"accent"},d),topValues:Object(y.jsx)(f.EuiTextColor,{color:"subdued"},Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.topValues",defaultMessage:"top values"})),filters:Object(y.jsx)(f.EuiTextColor,{color:"subdued"},Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.filters",defaultMessage:"filters"})),learnMoreLink:Object(y.jsx)(f.EuiLink,{href:p,color:"text",target:"_blank",external:!0},Object(y.jsx)(c.FormattedMessage,{defaultMessage:"Learn more.",id:"xpack.lens.indexPattern.precisionErrorWarning.link"}))}})):((e,a,i)=>Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.accuracyDisabled",defaultMessage:"{name} might be an approximation. You can enable accuracy mode for more precise results, but note that it increases the load on the Elasticsearch cluster. {learnMoreLink}",values:{name:Object(y.jsx)(f.EuiTextColor,{color:"accent"},e),learnMoreLink:Object(y.jsx)(f.EuiLink,{href:a,color:"text",target:"_blank",external:!0},Object(y.jsx)(c.FormattedMessage,{defaultMessage:"Learn more.",id:"xpack.lens.indexPattern.precisionErrorWarning.link"}))}}),Object(y.jsx)(f.EuiSpacer,{size:"s"}),Object(y.jsx)(f.EuiButton,{"data-test-subj":"lnsPrecisionWarningEnableAccuracy",onClick:()=>{n((e=>yu({state:e,layerId:t,newLayer:Es(vs({layer:r,columnId:l.id,paramName:"accuracyMode",value:!0}),m)})))}},u.i18n.translate("xpack.lens.indexPattern.enableAccuracyMode",{defaultMessage:"Enable accuracy mode"}))))(l.name,a.links.aggs.terms_doc_count_error)):i.push(Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.ascendingCountPrecisionErrorWarning",defaultMessage:"{name} for this visualization may be approximate due to how the data is indexed. Try sorting by rarity instead of ascending count of records. To learn more about this limit, {link}.",values:{name:Object(y.jsx)(f.EuiTextColor,{color:"accent"},l.name),link:Object(y.jsx)(f.EuiLink,{href:a.links.aggs.rare_terms,color:"text",target:"_blank",external:!0},Object(y.jsx)(c.FormattedMessage,{defaultMessage:"visit the documentation",id:"xpack.lens.indexPattern.ascendingCountPrecisionErrorWarning.link"}))}}),Object(y.jsx)(f.EuiSpacer,{size:"s"}),Object(y.jsx)(f.EuiButton,{onClick:()=>{n((e=>yu({state:e,layerId:t,newLayer:Es(vs({layer:r,columnId:l.id,paramName:"orderBy",value:{type:"rare",maxDocCount:1}}),m)})))}},u.i18n.translate("xpack.lens.indexPattern.switchToRare",{defaultMessage:"Rank by rarity"}))))}var d,p})),i}function Ou(e){return null==e?void 0:e.map((({input:e})=>e)).filter((({query:e})=>(null==e?void 0:e.trim())&&"*"!==e))}function ku(e){return e.params.ranges.map((({from:t,to:a})=>{let n="";return null!=t&&isFinite(t)&&(n+=`${e.sourceField} >= ${t}`),null!=a&&isFinite(a)&&(n.length&&(n+=" AND "),n+=`${e.sourceField} <= ${a}`),{query:n,language:"kuery"}})).filter((({query:e})=>null==e?void 0:e.trim()))}function Iu(e,t){return[{language:"kuery",query:`${e.sourceField} >= "${t.from}" AND ${e.sourceField} <= "${t.to}"`}]}function Tu(e,t,a){const n=[e.sourceField].concat(e.params.secondaryFields||[]).filter(Boolean),i=a.rows.map((({[t]:a})=>{if(null!=a)return"string"!=typeof a&&Array.isArray(a.keys)?a.keys.map(((e,t)=>`${n[t]}: "${""===e?Object(Se.escape)(e):e}"`)).join(" AND "):`${e.sourceField}: "${""===a?Object(Se.escape)(a):a}"`})).filter(Boolean);return[...new Set(i)].map((e=>({language:"kuery",query:e})))}function Mu(e,t,a){return[e[a],...t.map((({[a]:e})=>e))].filter((e=>null==e?void 0:e.length))}function Fu(e,t,a){const n=e.filter((e=>e!==a)),i=n.indexOf(t);return n.splice(i+1,0,a),n}function wu(e,t){var a;return vl(e)?(null===(a=t(e.sourceField))||void 0===a?void 0:a.displayName)||e.sourceField:""}function Cu({columnId:e,layer:t,setColumns:a,getFieldByName:n}){const i=t.columns[e],l=Object.entries(t.columns).filter((([t,a])=>t!==e&&a.isBucketed)).map((([e,t])=>({value:e,text:t.label,fieldName:wu(t,n),operationType:t.operationType})));if(!i||!i.isBucketed||!l.length)return null;const s=t.columnOrder[t.columnOrder.indexOf(e)-1];if(1===l.length){const[n]=l,i=u.i18n.translate("xpack.lens.indexPattern.useAsTopLevelAgg",{defaultMessage:"Group by this field first"});return Object(y.jsx)(f.EuiFormRow,{label:i,display:"columnCompressedSwitch"},Object(y.jsx)(f.EuiSwitch,{compressed:!0,label:i,showLabel:!1,"data-test-subj":"indexPattern-nesting-switch",name:"nestingSwitch",checked:!s,onChange:()=>{a(s?Fu(t.columnOrder,e,n.value):Fu(t.columnOrder,n.value,e))}}))}return Object(y.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.groupByDropdown",{defaultMessage:"Group by"}),display:"columnCompressed",fullWidth:!0},Object(y.jsx)(f.EuiSelect,{compressed:!0,"data-test-subj":"indexPattern-nesting-select",options:[{value:"",text:u.i18n.translate("xpack.lens.xyChart.nestUnderRoot",{defaultMessage:"Entire data set"})},...l.map((({value:e,text:t})=>({value:e,text:t})))],value:s,onChange:n=>a(Fu(t.columnOrder,n.target.value,e))}))}a(112);const _u={number:{title:u.i18n.translate("xpack.lens.indexPattern.numberFormatLabel",{defaultMessage:"Number"})},percent:{title:u.i18n.translate("xpack.lens.indexPattern.percentFormatLabel",{defaultMessage:"Percent"})},bytes:{title:u.i18n.translate("xpack.lens.indexPattern.bytesFormatLabel",{defaultMessage:"Bytes (1024)"})}},Su={value:"",label:u.i18n.translate("xpack.lens.indexPattern.defaultFormatLabel",{defaultMessage:"Default"})},Eu={asPlainText:!0},Pu=u.i18n.translate("xpack.lens.indexPattern.columnFormatLabel",{defaultMessage:"Value format"}),Au=u.i18n.translate("xpack.lens.indexPattern.decimalPlacesLabel",{defaultMessage:"Decimals"}),Lu=u.i18n.translate("xpack.lens.indexPattern.suffixLabel",{defaultMessage:"Suffix"});function Du(e){var t,a,n,i,r;const{selectedColumn:o,onChange:u}=e,c=Fl(o)?null===(t=o.params)||void 0===t?void 0:t.format:void 0,[d,p]=Object(l.useState)(null!==(a=null==c||null===(n=c.params)||void 0===n?void 0:n.decimals)&&void 0!==a?a:2),m=Object(l.useCallback)((e=>{c&&u({id:c.id,params:{...c.params,suffix:e}})}),[c,u]),{handleInputChange:g,inputValue:b}=Object(j.p)({onChange:m,value:null!==(i=null==c||null===(r=c.params)||void 0===r?void 0:r.suffix)&&void 0!==i?i:""},{allowFalsyValue:!0}),h=null!=c&&c.id?_u[c.id]:void 0,x=Object(l.useMemo)((()=>[Su,...Object.entries(_u).map((([e,t])=>{var a;return{value:e,label:null!==(a=t.title)&&void 0!==a?a:e}}))]),[]),v=Object(l.useCallback)((e=>{0!==e.length&&(e[0].value?u({id:e[0].value,params:{decimals:d}}):u())}),[u,d]),O=Object(l.useMemo)((()=>{var e;return c?[{value:c.id,label:null!==(e=null==h?void 0:h.title)&&void 0!==e?e:c.id}]:[Su]}),[c,null==h?void 0:h.title]);return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{label:Pu,display:"columnCompressed",fullWidth:!0},Object(y.jsx)("div",null,Object(y.jsx)(f.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-dimension-format","aria-label":Pu,singleSelection:Eu,options:x,selectedOptions:O,onChange:v}),c?Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiSpacer,{size:"xs"}),Object(y.jsx)(f.EuiRange,{showInput:"inputWithPopover",value:d,min:0,max:15,onChange:e=>{const t=Number(e.currentTarget.value);p(t);const a=Math.min(15,Math.max(0,t));u({id:c.id,params:{...c.params,decimals:a}})},"data-test-subj":"indexPattern-dimension-formatDecimals",compressed:!0,fullWidth:!0,prepend:Au,"aria-label":Au}),Object(y.jsx)(f.EuiSpacer,{size:"xs"}),Object(y.jsx)(f.EuiFieldText,{value:b,onChange:e=>{g(e.currentTarget.value)},"data-test-subj":"indexPattern-dimension-formatSuffix",compressed:!0,fullWidth:!0,prepend:Lu,"aria-label":Lu})):null)))}const Nu=iu();function zu(e){var t;const{layer:a,layerId:n,activeData:r,columnId:o,updateLayer:c,currentIndexPattern:d,existingFields:p,validation:m,selectionStyle:g,dateRange:b,labelAppend:h,dimensionGroups:x,isFullscreen:v,toggleFullscreen:j,setIsCloseable:O,paramEditorCustomProps:k,...I}=e,T=a.columns[o],M=T&&au[T.operationType],F=null==M?void 0:M.paramEditor,w=a.incompleteColumns?a.incompleteColumns[o]:void 0,C=null==w?void 0:w.operationType,_=null!==(t=null==w?void 0:w.sourceField)&&void 0!==t?t:null,S=Object(l.useMemo)((()=>{const e=new Set,t=new Set,a={},n={};return Object.values(au).filter((({hidden:e})=>!e)).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).forEach((i=>{if("field"===i.input){const t=d.fields.filter((e=>Ss({operationType:i.type,validation:m,field:e,indexPattern:d})));t.length&&(e.add(i.type),n[i.type]=new Set(t.map((({name:e})=>e))),t.forEach((e=>{var t;a[e.name]||(a[e.name]=new Set),null===(t=a[e.name])||void 0===t||t.add(i.type)})))}else Ss({operationType:i.type,validation:m,indexPattern:d})&&(e.add(i.type),t.add(i.type))})),{operationTypes:e,operationWithoutField:t,operationByField:a,fieldByOperation:n}}),[d,m]),E=Array.from(S.operationTypes).map((e=>{var t;const a=au[e];return{label:Nu[e].displayName,value:e,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${e}${!T||T&&vl(T)&&"field"===a.input&&(null===(t=S.fieldByOperation[e])||void 0===t?void 0:t.has(T.sourceField))||T&&!vl(T)&&"field"!==a.input?"":" incompatible"}`}}));if("hidden"===g)return null;const P=C?[E.find((({value:e})=>e===C))]:T?[E.find((({value:e})=>e===T.operationType))]:[],A=!T&&!Boolean(C),L=Boolean(C)||"field"===g&&!T,D=!d.getFieldByName(null!=_?_:null==T?void 0:T.sourceField),N=Boolean(P.length&&null==P[0]);if(N){const e=C||T.operationType,t={label:Nu[e].displayName,value:e,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${e} incompatible`};E.push(t),P[0]=t}return Object(y.jsx)("div",{id:o},Object(y.jsx)("div",null,"field"!==g?Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFormRow,{"data-test-subj":"indexPattern-subFunction-selection-row",label:u.i18n.translate("xpack.lens.indexPattern.chooseSubFunction",{defaultMessage:"Choose a sub-function"}),fullWidth:!0,isInvalid:A||N},Object(y.jsx)(f.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-reference-function",placeholder:u.i18n.translate("xpack.lens.indexPattern.referenceFunctionPlaceholder",{defaultMessage:"Sub-function"}),options:E,isInvalid:A||N,selectedOptions:P,singleSelection:{asPlainText:!0},onChange:e=>{0!==e.length?(Object(fn.e)("indexpattern_dimension_field_changed"),function(e){if((null==T?void 0:T.operationType)===e)return;const t=S.fieldByOperation[e];if(T&&"sourceField"in T&&null!=t&&t.has(T.sourceField))c(os({layer:a,columnId:o,op:e,indexPattern:d,field:d.getFieldByName(T.sourceField),visualizationGroups:x}));else{const n=1===(null==t?void 0:t.size)?d.getFieldByName(t.values().next().value):void 0;c(os({layer:a,columnId:o,op:e,indexPattern:d,field:n,visualizationGroups:x}))}Object(fn.e)(`indexpattern_dimension_operation_${e}`)}(e[0].value)):c(Os({layer:a,columnId:o,indexPattern:d}))}})),Object(y.jsx)(f.EuiSpacer,{size:"s"})):null,T&&"field"!==M.input?null:Object(y.jsx)(f.EuiFormRow,{"data-test-subj":"indexPattern-reference-field-selection-row",label:u.i18n.translate("xpack.lens.indexPattern.chooseField",{defaultMessage:"Field"}),fullWidth:!0,isInvalid:L||D,labelAppend:h},Object(y.jsx)(ar,{fieldIsInvalid:L||D,currentIndexPattern:d,existingFields:p,operationByField:S.operationByField,selectedOperationType:T?T.operationType:C,selectedField:null!=_?_:null==T?void 0:T.sourceField,incompleteOperation:C,markAllFieldsCompatible:"field"===g,onDeleteColumn:()=>{c(Os({layer:a,columnId:o,indexPattern:d}))},onChoose:e=>{c(os({layer:a,columnId:o,indexPattern:d,op:e.operationType,field:d.getFieldByName(e.field),visualizationGroups:x}))}})),T&&!w&&F&&Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(F,i()({updateLayer:c,currentColumn:T,layer:a,layerId:n,activeData:r,columnId:o,indexPattern:d,dateRange:b,operationDefinitionMap:au,isFullscreen:v,toggleFullscreen:j,setIsCloseable:O,paramEditorCustomProps:k},I)))))}function Bu(e,t,a){const n=t.columns[e],i=n.customLabel?n.label:_r(n.label,n.timeScale,a,n.timeShift,n.timeShift);return{...t,columns:{...t.columns,[e]:{...t.columns[e],label:i,timeScale:a}}}}function Vu({selectedColumn:e,columnId:t,layer:a,updateLayer:n}){const i=a.columnOrder.some((e=>"date_histogram"===a.columns[e].operationType)),l=au[e.operationType];return l.timeScalingMode&&"disabled"!==l.timeScalingMode&&i&&e.timeScale?Object(y.jsx)(f.EuiFormRow,{display:"rowCompressed",fullWidth:!0,label:Object(y.jsx)(f.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.timeScale.tooltip",{defaultMessage:"Normalize values to be always shown as rate per specified time unit, regardless of the underlying date interval."})},Object(y.jsx)("span",null,u.i18n.translate("xpack.lens.indexPattern.timeScale.label",{defaultMessage:"Normalize by unit"})," ",Object(y.jsx)(f.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"})))},Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(f.EuiSelect,{compressed:!0,options:Object.entries(Mr).map((([e,t])=>({value:e,text:t}))),"data-test-subj":"indexPattern-time-scaling-unit",value:e.timeScale,onChange:e=>{n(Bu(t,a,e.target.value))}})),"optional"===l.timeScalingMode&&Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiButtonIcon,{"data-test-subj":"indexPattern-time-scaling-remove",color:"danger","aria-label":u.i18n.translate("xpack.lens.timeScale.removeLabel",{defaultMessage:"Remove normalizing by time unit"}),onClick:()=>{n(Bu(t,a,void 0))},iconType:"cross"})))):null}const Ru=u.i18n.translate("xpack.lens.indexPattern.filterBy.label",{defaultMessage:"Filter by"}),Hu={query:"",language:"kuery"};function Gu(e,t,a){return{...t,columns:{...t.columns,[e]:{...t.columns[e],filter:a}}}}function qu({selectedColumn:e,columnId:t,layer:a,updateLayer:n,indexPattern:i,isInitiallyOpen:r,helpMessage:o}){const c=e.filter,d=Object(l.useCallback)((e=>{const{isValid:l}=Wl(e,i);l&&!Object(Se.isEqual)(c,e)&&n(Gu(t,a,e))}),[t,i,c,a,n]),{inputValue:p,handleInputChange:m}=Object(j.p)({value:null!=c?c:Hu,onChange:d}),[g,b]=Object(l.useState)(r),h=Object(l.useCallback)((()=>{b(!1),c&&m(c)}),[c,m]);if(!au[e.operationType].filterable||!c)return null;const{isValid:x}=Wl(c,i),{isValid:v,error:O}=Wl(p,i),k=o?Object(y.jsx)(s.a.Fragment,null,Ru," ",Object(y.jsx)(f.EuiIconTip,{color:"subdued",content:o,iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})):Ru;return Object(y.jsx)(f.EuiFormRow,{display:"rowCompressed",label:k,fullWidth:!0,isInvalid:!x},Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(f.EuiPopover,{isOpen:g,closePopover:h,anchorClassName:"eui-fullWidth",panelClassName:"lnsIndexPatternDimensionEditor__filtersEditor",button:Object(y.jsx)(f.EuiPanel,{paddingSize:"none",hasShadow:!1,hasBorder:!0},Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{grow:!1}),Object(y.jsx)(f.EuiFlexItem,{grow:!0},Object(y.jsx)(f.EuiLink,{className:"lnsFiltersOperation__popoverButton","data-test-subj":"indexPattern-filters-existingFilterTrigger",onClick:()=>{b(!g)},color:x?"text":"danger",title:u.i18n.translate("xpack.lens.indexPattern.filterBy.clickToEdit",{defaultMessage:"Click to edit"})},c.query||u.i18n.translate("xpack.lens.indexPattern.filterBy.emptyFilterQuery",{defaultMessage:"(empty)"}))),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiButtonIcon,{"data-test-subj":"indexPattern-filter-by-remove",color:"danger","aria-label":u.i18n.translate("xpack.lens.filterBy.removeLabel",{defaultMessage:"Remove filter"}),onClick:()=>{n(Gu(t,a,void 0))},iconType:"cross"}))))},Object(y.jsx)(f.EuiFormRow,{label:Ru,isInvalid:!v,error:O,fullWidth:!0,"data-test-subj":"indexPattern-filter-by-input"},Object(y.jsx)(Bl,{indexPatternTitle:i.title,value:p,onChange:m,isInvalid:!v,onSubmit:()=>{}}))))))}function $u(e){const[t,a]=Object(l.useState)(!1),n=e.options.filter((e=>e.showInPopover)),i=e.options.filter((e=>e.inlineElement));return Object(y.jsx)(s.a.Fragment,null,n.length>0&&Object(y.jsx)(f.EuiText,{textAlign:"right"},Object(y.jsx)(f.EuiPopover,{ownFocus:!0,button:Object(y.jsx)(f.EuiButtonEmpty,{size:"xs",iconType:"arrowDown",iconSide:"right","data-test-subj":"indexPattern-advanced-popover",onClick:()=>{a(!t)}},u.i18n.translate("xpack.lens.indexPattern.advancedSettings",{defaultMessage:"Add advanced options"})),isOpen:t,closePopover:()=>{a(!1)}},n.map((({dataTestSubj:e,onClick:t,title:i,optionElement:l},r)=>Object(y.jsx)(s.a.Fragment,{key:e},l||Object(y.jsx)(f.EuiText,{size:"s"},Object(y.jsx)(f.EuiLink,{"data-test-subj":e,color:"text",onClick:()=>{a(!1),t()}},i)),n.length-1!==r&&Object(y.jsx)(f.EuiSpacer,{size:"s"})))))),i.map((e=>Object(y.jsx)(s.a.Fragment,{key:e.dataTestSubj},Object(y.jsx)(f.EuiSpacer,{size:"s"}),e.inlineElement))))}function Wu(e,t,a){const n=null==a?void 0:a.trim(),i=t.columns[e],l=i.customLabel?i.label:_r(i.label,i.timeScale,i.timeScale,i.timeShift,n);return{...t,columns:{...t.columns,[e]:{...t.columns[e],label:l,timeShift:n}}}}function Uu({selectedColumn:e,columnId:t,layer:a,updateLayer:n,indexPattern:i,isFocused:s,activeData:r,layerId:o}){const c=Object(l.useRef)(!1),[d,p]=Object(l.useState)(e.timeShift);if(Object(l.useEffect)((()=>{p(e.timeShift)}),[e.timeShift]),!au[e.operationType].shiftable||void 0===e.timeShift)return null;const m=Ki(a,i,r,o),{isValueTooSmall:g,isValueNotMultiple:b,isInvalid:h,canShift:x}=Zi(m);if(!x)return null;const v=d&&Object(mi.parseTimeShift)(d),j=Boolean(v&&h(v)),O=v&&g(v),k=v&&b(v);return Object(y.jsx)("div",{ref:e=>{if(e&&s){const t=e.querySelector('[data-test-subj="comboBoxSearchInput"]');!c.current&&t instanceof HTMLInputElement&&(c.current=!0,t.focus())}}},Object(y.jsx)(f.EuiFormRow,{display:"rowCompressed",fullWidth:!0,"data-test-subj":"indexPattern-dimension-time-shift-row",label:u.i18n.translate("xpack.lens.indexPattern.timeShift.label",{defaultMessage:"Time shift"}),helpText:u.i18n.translate("xpack.lens.indexPattern.timeShift.help",{defaultMessage:"Enter the time shift number and unit"}),error:O&&u.i18n.translate("xpack.lens.indexPattern.timeShift.tooSmallHelp",{defaultMessage:"Time shift should to be larger than the date histogram interval. Either increase time shift or specify smaller interval in date histogram"})||k&&u.i18n.translate("xpack.lens.indexPattern.timeShift.noMultipleHelp",{defaultMessage:"Time shift should be a multiple of the date histogram interval. Either adjust time shift or date histogram interval"})||j&&u.i18n.translate("xpack.lens.indexPattern.timeShift.genericInvalidHelp",{defaultMessage:"Time shift value is not valid."}),isInvalid:Boolean(j||O||k)},Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(f.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-dimension-time-shift",placeholder:u.i18n.translate("xpack.lens.indexPattern.timeShiftPlaceholder",{defaultMessage:"Type custom values (e.g. 8w)"}),options:Yi.filter((({value:e})=>{const t=Object(mi.parseTimeShift)(e);return t&&!g(t)&&!b(t)&&!("previous"===t&&m.interval)})),selectedOptions:function(){if(!d)return[];const e=Yi.filter((({value:e})=>e===d));return e.length>0?e:[{value:d,label:d}]}(),singleSelection:{asPlainText:!0},isInvalid:j,onCreateOption:e=>{const i=Object(mi.parseTimeShift)(e);h(i)?p(e):n(Wu(t,a,e))},onChange:e=>{if(0===e.length)return n(Wu(t,a,"")),void p("");const i=e[0].value,l=Object(mi.parseTimeShift)(i);h(l)?p(i):n(Wu(t,a,i))}})),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiButtonIcon,{"data-test-subj":"indexPattern-time-shift-remove",color:"danger","aria-label":u.i18n.translate("xpack.lens.timeShift.removeLabel",{defaultMessage:"Remove time shift"}),onClick:()=>{n(Wu(t,a,void 0))},iconType:"cross"})))))}const Yu="formula",Xu="static_value",Ku="quickFunctions",Zu=new Set([Yu,Xu]);function Qu(e){return!Zu.has(e)}const Ju=({currentOperationType:e,temporaryStateType:t})=>"none"===t||null!=e&&Qu(e)?null:e===Xu&&"quickFunctions"===t?Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiCallOut,{className:"lnsIndexPatternDimensionEditor__warning",size:"s",title:u.i18n.translate("xpack.lens.indexPattern.staticValueWarning",{defaultMessage:"Static value currently applied"}),iconType:"alert",color:"warning"},Object(y.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.staticValueWarningText",{defaultMessage:"To overwrite your static value, select a quick function"})))):Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiCallOut,{className:"lnsIndexPatternDimensionEditor__warning",size:"s",title:u.i18n.translate("xpack.lens.indexPattern.formulaWarning",{defaultMessage:"Formula currently applied"}),iconType:"alert",color:"warning"},"quickFunctions"!==t?Object(y.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.formulaWarningStaticValueText",{defaultMessage:"To overwrite your formula, change the value in the input field"})):Object(y.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.formulaWarningText",{defaultMessage:"To overwrite your formula, select a quick function"})))),ec=({tabs:e})=>Object(y.jsx)(f.EuiTabs,{size:"s",className:"lnsIndexPatternDimensionEditor__header","data-test-subj":"lens-dimensionTabs"},e.map((({id:e,enabled:t,state:a,onClick:n,label:i})=>t?Object(y.jsx)(f.EuiTab,{key:e,isSelected:a,"data-test-subj":`lens-dimensionTabs-${e}`,onClick:n},i):null))),tc=iu();function ac(e){var t,a,n,r,c;const{selectedColumn:d,operationSupportMatrix:p,state:m,columnId:g,setState:b,layerId:h,currentIndexPattern:x,hideGrouping:v,dateRange:O,dimensionGroups:k,toggleFullscreen:I,isFullscreen:T,supportStaticValue:M,supportFieldFormat:F=!0,layerType:w,paramEditorCustomProps:C}=e,_={data:e.data,uiSettings:e.uiSettings,savedObjectsClient:e.savedObjectsClient,http:e.http,storage:e.storage,unifiedSearch:e.unifiedSearch,dataViews:e.dataViews},{fieldByOperation:S,operationWithoutField:E}=p,P=d&&au[d.operationType],[A,L]=Object(l.useState)("none"),D=Boolean(A===Ku),N=Boolean(A===Xu),z=Object(l.useCallback)((e=>b((t=>yu({state:t,layerId:h,newLayer:e})))),[h,b]),B=(e,t={})=>{const a="function"==typeof e?e(m.layers[h]):e,n=Boolean(a.columns[g]);b((t=>{const a="function"==typeof e?e(t.layers[h]):e;return yu({state:t,layerId:h,newLayer:a})}),{isDimensionComplete:n,...t})},V=e=>{b((t=>({...t,isDimensionClosePrevented:!e})))},R=(null!==(t=m.layers[h].incompleteColumns)&&void 0!==t?t:{})[g],{operationType:H,sourceField:G=null,...q}=R||{},$=Boolean(M?P&&Qu(P.type):!P||Qu(P.type)),W=D||$,U=N||"none"===A&&M&&(!d||(null==d?void 0:d.operationType)===Xu),Y=(t=e.state.layers[e.layerId])=>{if((null==d?void 0:d.operationType)!==Xu){var a,n,i;Object(fn.e)("indexpattern_dimension_operation_static_value");const o=os({layer:t,indexPattern:x,columnId:g,op:Xu,visualizationGroups:k});var l,s,r;return null!=(null===(a=e.activeData)||void 0===a||null===(n=a[h])||void 0===n||null===(i=n.rows[0])||void 0===i?void 0:i[g])?Es(vs({layer:o,columnId:g,paramName:"value",value:null===(l=e.activeData)||void 0===l||null===(s=l[h])||void 0===s||null===(r=s.rows[0])||void 0===r?void 0:r[g]}),x):o}return t},X=function(e,t,a){return e?au.static_value.paramEditor:null!=t&&t.paramEditor?t.paramEditor:a?au.static_value.paramEditor:null}(N,P,M&&!W),K=Object(l.useMemo)((()=>Object.values(au).filter((({hidden:e})=>!e)).filter((e=>!("selectionStyle"in e)||"hidden"!==e.selectionStyle)).filter((({type:e})=>{var t;return(null===(t=S[e])||void 0===t?void 0:t.size)||E.has(e)})).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).map((e=>e.type))),[S,E]),[Z,Q]=Object(l.useState)(!1),[J,ee]=Object(l.useState)(!1),te=Object(l.useRef)(null);Object(l.useEffect)((()=>()=>{te.current&&(o.a.unmountComponentAtNode(te.current),document.body.removeChild(te.current))}),[]);const ae=K.map((t=>{const a=au[t],n=d&&vl(d)&&x.getFieldByName(d.sourceField);return{operationType:t,compatibleWithCurrentField:ms({layer:m.layers[h],columnId:g,op:t,indexPattern:x,field:n||void 0,filterOperations:e.filterOperations,visualizationGroups:k}),disabledStatus:a.getDisabledStatus&&a.getDisabledStatus(m.indexPatterns[m.currentIndexPatternId],m.layers[h],w)}})),ne=Object(l.useMemo)((()=>{return t=x,!(!(e=d)||!vl(e)||null===(a=Ol(e,t))||void 0===a||!a.length);var e,t,a}),[d,x]),ie=ae.map((({operationType:t,compatibleWithCurrentField:a,disabledStatus:n})=>{const i=Boolean(H===t||!H&&d&&d.operationType===t);let l="primary";i?l="text":a||(l="subdued");let s=tc[t].displayName;return i&&n?s=Object(y.jsx)(f.EuiToolTip,{content:n,display:"block",position:"left"},Object(y.jsx)(f.EuiText,{color:"danger",size:"s"},Object(y.jsx)("strong",null,tc[t].displayName))):n?s=Object(y.jsx)(f.EuiToolTip,{content:n,display:"block",position:"left"},Object(y.jsx)("span",null,tc[t].displayName)):i&&(s=Object(y.jsx)("strong",null,tc[t].displayName)),{id:t,label:s,color:l,isActive:i,size:"s",isDisabled:!!n,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${t}${a?"":" incompatible"}`,"aria-pressed":i,extraAction:au[t].helpComponent?{color:"primary",onClick:e=>{if(te.current)o.a.unmountComponentAtNode(te.current),document.body.removeChild(te.current),te.current=null;else{const a=document.createElement("div");te.current=a,document.body.appendChild(a);const n=au[t].helpComponent,i=Object(y.jsx)(Wo,{button:e.target,isOpen:!0,title:au[t].helpComponentTitle,closePopover:()=>{te.current&&(o.a.unmountComponentAtNode(te.current),document.body.removeChild(te.current),te.current=null)}},Object(y.jsx)(n,null));o.a.render(i,te.current)}},iconType:"documentation",iconSize:"s","aria-label":u.i18n.translate("xpack.lens.indexPattern.helpLabel",{defaultMessage:"Function help"})}:void 0,onClick(){if(["none","fullReference","managedReference"].includes(au[t].input)){if((null==d?void 0:d.operationType)===t)return void(R&&B(Ps(m.layers[h],g)));const a=os({layer:e.state.layers[e.layerId],indexPattern:x,columnId:g,op:t,visualizationGroups:k,targetGroup:e.groupId});return D&&Qu(a.columns[g].operationType)&&L("none"),B(a),void Object(fn.e)(`indexpattern_dimension_operation_${t}`)}if(!d||!a){const a=S[t]||new Set;let n;return n=1===a.size?os({layer:e.state.layers[e.layerId],indexPattern:x,columnId:g,op:t,field:x.getFieldByName(a.values().next().value),visualizationGroups:k,targetGroup:e.groupId}):os({layer:e.state.layers[e.layerId],indexPattern:x,columnId:g,op:t,field:void 0,visualizationGroups:k,targetGroup:e.groupId}),D&&Qu(n.columns[g].operationType)&&L("none"),B(n),void Object(fn.e)(`indexpattern_dimension_operation_${t}`)}if(d.operationType===t)return void(R&&B(Ps(m.layers[h],g)));D&&L("none");const n=ds({layer:e.state.layers[e.layerId],indexPattern:x,columnId:g,op:t,field:vl(d)?x.getFieldByName(d.sourceField):void 0,visualizationGroups:k});B(n)}}})),le=!ne&&!R&&d&&Qu(d.operationType)&&X,se=!R&&d&&"references"in d&&"fullReference"===(null==P?void 0:P.input),re=!d||"field"===(null==P?void 0:P.input)||H&&"field"===(null===(a=au[H])||void 0===a?void 0:a.input)||D,oe=(null==P?void 0:P.renderFieldInput)||rr,ue={layer:m.layers[h],layerId:h,activeData:e.activeData,updateLayer:e=>{D&&L("none"),B(e,{forceRender:D})},columnId:g,currentColumn:m.layers[h].columns[g],dateRange:O,indexPattern:x,operationDefinitionMap:au,toggleFullscreen:I,isFullscreen:T,setIsCloseable:V,paramEditorCustomProps:C,..._},ce=Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--padded lnsIndexPatternDimensionEditor__section--shaded"},Object(y.jsx)(f.EuiFormLabel,null,u.i18n.translate("xpack.lens.indexPattern.functionsLabel",{defaultMessage:"Functions"})),Object(y.jsx)(f.EuiSpacer,{size:"s"}),Object(y.jsx)(f.EuiListGroup,{className:ie.length>3?"lnsIndexPatternDimensionEditor__columns":"",gutterSize:"none",listItems:ie.length%2==1?[...ie,{label:""}]:ie,maxWidth:!1})),Object(y.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--padded lnsIndexPatternDimensionEditor__section--shaded"},se?Object(y.jsx)(s.a.Fragment,null,d.references.map(((t,a)=>{var n;const l=P.requiredReferences[a];return Object(y.jsx)(zu,i()({key:a,layer:m.layers[h],layerId:h,activeData:e.activeData,columnId:t,updateLayer:e=>{z("function"==typeof e?e(m.layers[h]):e)},validation:l,currentIndexPattern:x,existingFields:m.existingFields,selectionStyle:P.selectionStyle,dateRange:O,labelAppend:null==P||null===(n=P.getHelpMessage)||void 0===n?void 0:n.call(P,{data:e.data,uiSettings:e.uiSettings,currentColumn:m.layers[h].columns[g]}),dimensionGroups:k,isFullscreen:T,toggleFullscreen:I,setIsCloseable:V,paramEditorCustomProps:C},_))})),"field"!==P.selectionStyle?Object(y.jsx)(f.EuiSpacer,{size:"s"}):null):null,re?Object(y.jsx)(oe,{layer:m.layers[h],selectedColumn:d,columnId:g,indexPattern:x,existingFields:m.existingFields,operationSupportMatrix:p,updateLayer:e=>{D&&L("none"),B(e,{forceRender:D})},incompleteField:G,incompleteOperation:H,incompleteParams:q,currentFieldIsInvalid:ne,helpMessage:null==P||null===(n=P.getHelpMessage)||void 0===n?void 0:n.call(P,{data:e.data,uiSettings:e.uiSettings,currentColumn:m.layers[h].columns[g]}),dimensionGroups:k,groupId:e.groupId,operationDefinitionMap:au}):null,le&&Object(y.jsx)(X,ue))),de=X?Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(X,i()({layer:m.layers[h],layerId:h,activeData:e.activeData,updateLayer:N?e=>{if(N&&L("none"),"function"==typeof e)return b((t=>{const a=e(Y(t.layers[h]));return yu({state:t,layerId:h,newLayer:a})}),{isDimensionComplete:!0,forceRender:!0})}:B,columnId:g,currentColumn:m.layers[h].columns[g],dateRange:O,indexPattern:x,operationDefinitionMap:au,toggleFullscreen:I,isFullscreen:T,setIsCloseable:V,paramEditorCustomProps:C},_))):null,pe=W?ce:de,me=Object(l.useCallback)((e=>{z(vs({layer:m.layers[h],columnId:g,paramName:"format",value:e}))}),[g,h,m.layers,z]),ge=!T&&p.operationWithoutField.has(Yu),fe=!T&&(ge||M),be=[{id:Xu,enabled:Boolean(M),state:U,onClick:()=>{if((null==d?void 0:d.operationType)===Yu)return L(Xu);L("none"),B(Y())},label:u.i18n.translate("xpack.lens.indexPattern.staticValueLabel",{defaultMessage:"Static value"})},{id:Ku,enabled:!0,state:W,onClick:()=>{!d||Qu(d.operationType)||L(Ku)},label:u.i18n.translate("xpack.lens.indexPattern.quickFunctionsLabel",{defaultMessage:"Quick functions"})},{id:Yu,enabled:ge,state:"none"===A&&(null==d?void 0:d.operationType)===Yu,onClick:()=>{if(L("none"),(null==d?void 0:d.operationType)!==Yu){const t=os({layer:e.state.layers[e.layerId],indexPattern:x,columnId:g,op:Yu,visualizationGroups:k});B(t),Object(fn.e)("indexpattern_dimension_operation_formula")}},label:u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"})}],he=Object(l.useMemo)((()=>String(d&&au[d.operationType].getDefaultLabel(d,m.indexPatterns[m.layers[h].indexPatternId],m.layers[h].columns))),[h,d,m.indexPatterns,m.layers]),xe=!T&&!ne&&!R&&d&&"none"===A&&P&&(P.timeScalingMode||P.filterable||P.shiftable);return Object(y.jsx)("div",{id:g},fe?Object(y.jsx)(ec,{tabs:be}):null,Object(y.jsx)(Ju,{currentOperationType:null==d?void 0:d.operationType,temporaryStateType:A}),pe,xe&&Object(y.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--padded lnsIndexPatternDimensionEditor__section--shaded"},Object(y.jsx)($u,{options:[{title:u.i18n.translate("xpack.lens.indexPattern.timeScale.enableTimeScale",{defaultMessage:"Normalize by unit"}),dataTestSubj:"indexPattern-time-scaling-enable",onClick:()=>{B(Bu(g,m.layers[h],"s"))},showInPopover:Boolean(P.timeScalingMode&&"disabled"!==P.timeScalingMode&&Object.values(m.layers[h].columns).some((e=>"date_histogram"===e.operationType))&&!d.timeScale),inlineElement:P.timeScalingMode?Object(y.jsx)(Vu,{selectedColumn:d,columnId:g,layer:m.layers[h],updateLayer:B}):null},{title:u.i18n.translate("xpack.lens.indexPattern.filterBy.label",{defaultMessage:"Filter by"}),dataTestSubj:"indexPattern-filter-by-enable",onClick:()=>{Q(!0),B(Gu(g,m.layers[h],Hu))},showInPopover:Boolean(P.filterable&&!d.filter),inlineElement:P.filterable&&d.filter?Object(y.jsx)(qu,{indexPattern:x,selectedColumn:d,columnId:g,layer:m.layers[h],updateLayer:B,isInitiallyOpen:Z,helpMessage:P.filterable&&"boolean"!=typeof P.filterable?P.filterable.helpMessage:null}):null},{title:u.i18n.translate("xpack.lens.indexPattern.timeShift.label",{defaultMessage:"Time shift"}),dataTestSubj:"indexPattern-time-shift-enable",onClick:()=>{ee(!0),B(Wu(g,m.layers[h],""))},showInPopover:Boolean(P.shiftable&&void 0===d.timeShift&&(x.timeFieldName||Object.values(m.layers[h].columns).some((e=>"date_histogram"===e.operationType)))),inlineElement:P.shiftable&&void 0!==d.timeShift?Object(y.jsx)(Uu,{indexPattern:x,selectedColumn:d,columnId:g,layer:m.layers[h],updateLayer:B,isFocused:J,activeData:e.activeData,layerId:h}):null},...(null===(r=(c=au[d.operationType]).getAdvancedOptions)||void 0===r?void 0:r.call(c,ue))||[]]})),!T&&!ne&&Object(y.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--padded  lnsIndexPatternDimensionEditor__section--collapseNext"},!R&&d&&"none"===A&&Object(y.jsx)(j.d,{key:he,value:d.label,defaultValue:he,onChange:e=>{z({columns:{...m.layers[h].columns,[g]:{...d,label:e,customLabel:au[d.operationType].getDefaultLabel(d,m.indexPatterns[m.layers[h].indexPatternId],m.layers[h].columns)!==e}}})}}),!T&&!R&&!v&&"none"===A&&Object(y.jsx)(Cu,{layer:m.layers[e.layerId],columnId:e.columnId,setColumns:e=>z({columnOrder:e}),getFieldByName:x.getFieldByName}),!F||T||!d||"number"!==d.dataType&&"range"!==d.operationType?null:Object(y.jsx)(Du,{selectedColumn:d,onChange:me})))}const nc=ci()((function(e,t){const a=e.filter((e=>t(e.operationMetaData))),n={},i=new Set,l={};return a.forEach((({operations:e})=>{e.forEach((e=>{var t,a;"field"===e.type?(n[e.field]||(n[e.field]=new Set),null===(t=n[e.field])||void 0===t||t.add(e.operationType),l[e.operationType]||(l[e.operationType]=new Set),null===(a=l[e.operationType])||void 0===a||a.add(e.field)):i.add(e.operationType)}))})),{operationByField:n,operationWithoutField:i,fieldByOperation:l}})),ic=function(e){var t;const a=e.layerId,n=e.state.layers[a],i=e.state.indexPatterns[n.indexPatternId],{columnId:s,uniqueLabel:r,invalid:o,invalidMessage:u,hideTooltip:c}=e,d=Object(l.useMemo)((()=>o||vu(n,s,i)),[n,s,i,o]),p=null!==(t=n.columns[e.columnId])&&void 0!==t?t:null;if(!p)return null;const m=(g=r)?g.replace(/\./g,"."):"";var g;return Object(y.jsx)(On,{id:s,label:d?p.label:m,isInvalid:Boolean(d),hideTooltip:c,invalidMessage:u})},lc=function(e){var t;const a=e.layerId,n=e.state.indexPatterns[null===(t=e.state.layers[a])||void 0===t?void 0:t.indexPatternId];if(!n)return null;const l=(e=>{const t=e.layerId,a=e.state.indexPatterns[e.state.layers[t].indexPatternId],n=cu(a);return nc(n,e.filterOperations)})(e),s=e.state.layers[a].columns[e.columnId]||null;return Object(y.jsx)(ac,i()({},e,{layerType:e.layerType||D.o.DATA,currentIndexPattern:n,selectedColumn:s,operationSupportMatrix:l}))},sc=Object(l.memo)(ic),rc=Object(l.memo)(lc);var oc=a(102);const uc=iu();function cc(e,t,a,n){if(!e)return;const i=uu(e,t);return i.length?a&&i.includes(a.operationType)?a.operationType:n&&i.includes(n)?n:i[0]:void 0}function dc(e,t){if(e)return vl(e)&&t.getFieldByName(e.sourceField)||void 0}function pc(e){const{state:t,columnId:a,layerId:n,dragging:i,groupId:l,filterOperations:s}=e;if(i){if(jl(i))return function({state:e,columnId:t,layerId:a,dragging:n,filterOperations:i}){const l=e.layers[a].columns[t],s=e.layers[a].indexPatternId===n.indexPatternId,r=cc(n.field,i,l);if(s&&r){const t=uc[r].displayName;if(!l)return{dropTypes:["field_add"],nextLabel:t};if(vl(l)&&l.sourceField!==n.field.name||!vl(l)){const i=e.indexPatterns[e.layers[a].indexPatternId];return vl(l)&&i&&ou(i,l,void 0,n.field)?{dropTypes:["field_replace","field_combine"]}:{dropTypes:["field_replace"],nextLabel:t}}}}({...e,dragging:i});if(Object(oc.a)(i)&&i.layerId===n&&a!==i.columnId){const r=t.layers[i.layerId].columns[i.columnId],o=t.layers[n].columns[a];if(l===i.groupId)return o?{dropTypes:["reorder"]}:{dropTypes:["duplicate_compatible"]};const u=t.indexPatterns[t.layers[n].indexPatternId];return s(r)?function(e,t,a,n,i){var l;const s=a&&mc(a,n),r=n&&!s&&(null===(l=e.find((e=>e.accessors.some((e=>e.columnId===t)))))||void 0===l?void 0:l.filterOperations(n)),o=r?["swap_compatible"]:[];if(!n)return{dropTypes:["move_compatible","duplicate_compatible",...o]};if(!i||!vl(n))return{dropTypes:["replace_compatible","replace_duplicate_compatible",...o]};const u=[];return s||u.push("replace_compatible","replace_duplicate_compatible"),r&&u.push("swap_compatible"),ou(i,n,a)&&u.push("combine_compatible"),u.length?{dropTypes:u}:void 0}(e.dimensionGroups,i.columnId,r,o,u):mc(r,o)?void 0:function({state:e,columnId:t,layerId:a,dragging:n,filterOperations:i}){const l=e.layers[a].columns[t],s=e.layers[n.layerId].columns[n.columnId],r=e.indexPatterns[e.layers[a].indexPatternId];if(!r)return;const o=cc(dc(s,r),i,l);if(o){const e=dc(l,r),t=Boolean(cc(e,n.filterOperations,s)),a=[];return l?(a.push("replace_incompatible","replace_duplicate_incompatible"),t&&a.push("swap_incompatible"),ou(r,l,s)&&a.push("combine_incompatible")):a.push("move_incompatible","duplicate_incompatible"),{dropTypes:a,nextLabel:uc[o].displayName}}}({...e,dragging:i})}}}function mc(e,t){const a=t?su(t):[],n=new Set(su(e));return a.length===n.size&&a.every((e=>n.has(e)))}function gc(e){const{droppedItem:t,dropType:a}=e;return fc[a]({...e,droppedItem:t})}const fc={field_add:hc,field_replace:hc,field_combine:e=>hc(e,!0),reorder:function({columnId:e,setState:t,state:a,layerId:n,droppedItem:i}){return t(yu({state:a,layerId:n,newLayer:{columnOrder:function(e,t,a){const n=e.filter((e=>e!==a)),i=e.findIndex((e=>e===a)),l=e.findIndex((e=>e===t)),s=n.indexOf(t);return n.splice(i<l?s+1:s,0,a),n}(a.layers[n].columnOrder,e,i.columnId)}})),!0},move_compatible:e=>xc(e,!0),replace_compatible:e=>xc(e,!0),duplicate_compatible:xc,replace_duplicate_compatible:xc,move_incompatible:e=>yc(e,!0),replace_incompatible:e=>yc(e,!0),duplicate_incompatible:yc,replace_duplicate_incompatible:yc,swap_compatible:function({columnId:e,setState:t,state:a,layerId:n,droppedItem:i,dimensionGroups:l,groupId:s}){const r=a.layers[n],o=i.columnId,u=e,c={...r.columns[o]},d={...r.columns[u]},p={...r.columns};p[u]=c,p[o]=d;let m=((e,t,a)=>{const n=[...e],i=n.findIndex((e=>e===t)),l=n.findIndex((e=>e===a));return n[i]=a,n[l]=t,n})(r.columnOrder,o,u);return m=bs(l,s,m,e),t(yu({state:a,layerId:n,newLayer:{columnOrder:m,columns:p}})),!0},swap_incompatible:function({columnId:e,setState:t,state:a,layerId:n,droppedItem:i,filterOperations:l,dimensionGroups:s,groupId:r}){const o=a.layers[n],u=a.indexPatterns[o.indexPatternId],c=o.columns[i.columnId],d=o.columns[e],p=dc(c,u),m=dc(d,u),g=cc(p,l,d),f=cc(m,i.filterOperations,c);if(!g||!f)return!1;const b=os({layer:os({layer:o,columnId:e,targetGroup:r,indexPattern:u,op:g,field:p,visualizationGroups:s,shouldResetLabel:!0}),columnId:i.columnId,indexPattern:u,op:f,field:m,visualizationGroups:s,targetGroup:i.groupId,shouldResetLabel:!0});return Object(fn.e)("drop_onto_dimension"),t(yu({state:a,layerId:n,newLayer:b})),!0},combine_compatible:bc,combine_incompatible:bc};function bc({columnId:e,setState:t,state:a,layerId:n,droppedItem:i,dimensionGroups:l,groupId:s}){var r,o;const u=a.layers[n],c=i.columnId,d=e,p=a.indexPatterns[u.indexPatternId],m=u.columns[c],g=u.columns[d],f=dc(m,p),b=dc(g,p);if(!f||!b)return!1;const h={params:null!==(r=null===(o=ru(g.operationType))||void 0===o?void 0:o({targetColumn:g,sourceColumn:m,indexPattern:p}))&&void 0!==r?r:{}};return t(yu({state:a,layerId:n,newLayer:Os({layer:ds({layer:u,columnId:e,indexPattern:p,op:g.operationType,field:b,visualizationGroups:l,targetGroup:s,initialParams:h,shouldCombineField:!0}),columnId:c,indexPattern:p})})),{deleted:c}}function hc(e,t){var a,n;const{columnId:i,setState:l,state:s,layerId:r,droppedItem:o,filterOperations:u,groupId:c,dimensionGroups:d}=e,p=null===(a=d.find((e=>e.groupId===c)))||void 0===a?void 0:a.prioritizedOperation,m=s.layers[r],g=s.indexPatterns[m.indexPatternId],f=m.columns[i],b=t?f.operationType:cc(o.field,u,f,p);if(!jl(o)||!b||t&&!ou(g,f,void 0,o.field))return!1;const h=t?dc(f,g):o.field,x=t?{params:(null===(n=ru(f.operationType))||void 0===n?void 0:n({targetColumn:f,field:o.field,indexPattern:g}))||{}}:void 0,y=os({layer:m,columnId:i,indexPattern:g,op:b,field:h,visualizationGroups:d,targetGroup:c,shouldCombineField:t,initialParams:x});Object(fn.e)("drop_onto_dimension");const v=Object.values(s.layers).some((({columns:e})=>e.length));return Object(fn.e)(v?"drop_non_empty":"drop_empty"),l(yu({state:s,layerId:r,newLayer:y})),!0}function xc({columnId:e,setState:t,state:a,layerId:n,droppedItem:i,dimensionGroups:l,groupId:s},r){const o=a.layers[n],u=o.columns[i.columnId],c=a.indexPatterns[o.indexPatternId],d=ss({layer:o,targetId:e,sourceColumnId:i.columnId,sourceColumn:u,shouldDeleteSource:r,indexPattern:c});return t(yu({state:a,layerId:n,newLayer:{columnOrder:bs(l,s,ks(d),e),columns:d.columns}})),!r||{deleted:i.columnId}}function yc({columnId:e,setState:t,state:a,layerId:n,droppedItem:i,filterOperations:l,dimensionGroups:s,groupId:r},o){const u=a.layers[n],c=a.indexPatterns[u.indexPatternId],d=u.columns[i.columnId],p=u.columns[e]||null,m=dc(d,c),g=cc(m,l,p);if(!g)return!1;const f=os({layer:o?Os({layer:u,columnId:i.columnId,indexPattern:c}):u,columnId:e,indexPattern:c,op:g,field:m,visualizationGroups:s,targetGroup:r,shouldResetLabel:!0});return Object(fn.e)("drop_onto_dimension"),t(yu({state:a,layerId:n,newLayer:f})),!o||{deleted:i.columnId}}a(148);var vc=a(4),jc=a(78);function Oc(e){const[t,a]=Object(l.useState)(!1),n=Object(l.useRef)(void 0),i=Object(l.useRef)(void 0);return Object(l.useEffect)((function t(){n.current?i.current=t:(a(!0),n.current=e.load().catch((()=>{})).then((()=>{const e=i.current;n.current=void 0,i.current=void 0,e?e():a(!1)})))}),e.loadDeps),t?Object(y.jsx)(f.EuiProgress,{size:"xs",color:"accent",position:"absolute"}):null}a(343),a(348);var kc=a(55),Ic=a.n(kc),Tc=a(3);function Mc(e){const[t,a]=Object(l.useState)(void 0);return Object(l.useEffect)((()=>{!async function(){var t,n;const i=await e.uiActions.getTriggerCompatibleActions(vc.VISUALIZE_GEO_FIELD_TRIGGER,{indexPatternId:e.indexPatternId,fieldName:e.fieldName}),l={indexPatternId:e.indexPatternId,fieldName:e.fieldName,trigger:vc.visualizeGeoFieldTrigger},s=i.length?await(null===(t=(n=i[0]).getHref)||void 0===t?void 0:t.call(n,l)):void 0;a(s)}()}),[]),Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiButton,{onClick:function(t){t.preventDefault(),e.uiActions.getTrigger(vc.VISUALIZE_GEO_FIELD_TRIGGER).exec({indexPatternId:e.indexPatternId,fieldName:e.fieldName,originatingApp:Tc.APP_ID})},href:t,size:"s","data-test-subj":`lensVisualize-GeoField-${e.fieldName}`},Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.fieldItem.visualizeGeoFieldLinkText",defaultMessage:"Visualize in Maps"})))}var Fc=a(74);function wc(e){return e?e.replace(/\./g,"."):""}const Cc=function(e,t=256){const a=Object(l.memo)(e);return e=>{const[n,i]=Object(l.useState)(e),r=Object(l.useMemo)((()=>Object(Se.debounce)(i,t)),[i]);return Object(l.useEffect)((()=>()=>r.cancel()),[r]),r(e),s.a.createElement(a,n)}}((function(e){const{core:t,field:a,indexPattern:n,highlight:s,exists:r,query:o,dateRange:c,filters:d,hideDetails:p,itemIndex:m,groupIndex:g,dropOntoWorkspace:b,editField:h,removeField:x}=e,[v,j]=Object(l.useState)(!1),O=Object(l.useMemo)((()=>h?e=>{h(e),j(!1)}:void 0),[h,j]),k=Object(l.useMemo)((()=>x?e=>{x(e),j(!1)}:void 0),[x,j]),I=Object(l.useCallback)((e=>{b(e),j(!1)}),[b,j]),[T,M]=Object(l.useState)({isLoading:!1}),F=Object(l.useCallback)((()=>{j(!1)}),[j]),w=Object(l.useMemo)((()=>({field:a,indexPatternId:n.id,id:a.name,humanData:{label:a.displayName,position:m+1}})),[a,n.id,m]),C=Object(l.useMemo)((()=>[0,g,m]),[g,m]),_=Object(y.jsx)(Xs,{type:a.type}),S=Object(y.jsx)(f.EuiIconTip,{anchorClassName:"lnsFieldItem__infoIcon",content:p?u.i18n.translate("xpack.lens.indexPattern.fieldItemTooltip",{defaultMessage:"Drag and drop to visualize."}):r?u.i18n.translate("xpack.lens.indexPattern.fieldStatsButtonLabel",{defaultMessage:"Click for a field preview, or drag and drop to visualize."}):u.i18n.translate("xpack.lens.indexPattern.fieldStatsButtonEmptyLabel",{defaultMessage:"This field doesnt have any data but you can still drag and drop to visualize."}),type:"iInCircle",color:"subdued",size:"s"});return Object(y.jsx)("li",null,Object(y.jsx)(f.EuiPopover,{ownFocus:!0,className:"lnsFieldItem__popoverAnchor",display:"block","data-test-subj":"lnsFieldListPanelField",container:document.querySelector(".application")||void 0,button:Object(y.jsx)(jc.c,{draggable:!0,order:C,value:w,dataTestSubj:`lnsFieldListPanelField-${a.name}`,onDragStart:F},Object(y.jsx)(Ys,{className:`lnsFieldItem lnsFieldItem--${a.type} lnsFieldItem--${r?"exists":"missing"}`,isActive:v,onClick:function(){j(!v),v||(Object(fn.e)("indexpattern_field_info_click"),T.isLoading||"document"===a.type||a.type.includes("range")||"geo_point"===a.type||"geo_shape"===a.type||(M((e=>({...e,isLoading:!0}))),t.http.post(`/api/lens/index_stats/${n.id}/field`,{body:JSON.stringify({dslQuery:Object(pi.c)(n,o,d,Object(Ja.getEsQueryConfig)(t.uiSettings)),fromDate:c.fromDate,toDate:c.toDate,fieldName:a.name})}).then((e=>{M((t=>({...t,isLoading:!1,totalDocuments:e.totalDocuments,sampledDocuments:e.sampledDocuments,sampledValues:e.sampledValues,histogram:e.histogram,topValues:e.topValues})))})).catch((()=>{M((e=>({...e,isLoading:!1})))}))))},buttonProps:{"aria-label":u.i18n.translate("xpack.lens.indexPattern.fieldStatsButtonAriaLabel",{defaultMessage:"Preview {fieldName}: {fieldType}",values:{fieldName:a.displayName,fieldType:a.type}})},fieldIcon:_,fieldName:Object(y.jsx)(f.EuiHighlight,{search:wc(s)},wc(a.displayName)),fieldInfoIcon:S})),isOpen:v,closePopover:()=>j(!1),anchorPosition:"rightUp",panelClassName:"lnsFieldItem__fieldPanel",initialFocus:".lnsFieldItem__fieldPanel"},Object(y.jsx)(Sc,i()({},T,e,{editField:O,removeField:k,dropOntoWorkspace:I}))))}));function _c({indexPatternId:e,field:t,hasSuggestionForField:a,dropOntoWorkspace:n,editField:i,removeField:l}){const s={indexPatternId:e,id:t.name,field:t,humanData:{label:t.displayName}};return Object(y.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(f.EuiTitle,{size:"xxs"},Object(y.jsx)("h5",{className:"eui-textBreakWord lnsFieldItem__fieldPanelTitle"},t.displayName))),Object(y.jsx)(Ec,{isEnabled:a(s),dropOntoWorkspace:n,field:s}),i&&t.name!==D.d&&Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.editFieldLabel",{defaultMessage:"Edit data view field"})},Object(y.jsx)(f.EuiButtonIcon,{onClick:()=>i(t.name),iconType:"pencil","data-test-subj":"lnsFieldListPanelEdit","aria-label":u.i18n.translate("xpack.lens.indexPattern.editFieldLabel",{defaultMessage:"Edit data view field"})}))),l&&t.runtime&&Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.removeFieldLabel",{defaultMessage:"Remove data view field"})},Object(y.jsx)(f.EuiButtonIcon,{onClick:()=>l(t.name),iconType:"trash","data-test-subj":"lnsFieldListPanelRemove",color:"danger","aria-label":u.i18n.translate("xpack.lens.indexPattern.removeFieldLabel",{defaultMessage:"Remove data view field"})}))))}function Sc(e){const{histogram:t,topValues:a,indexPattern:n,field:i,dateRange:r,core:o,sampledValues:c,chartsThemeService:d,fieldFormats:p,dropOntoWorkspace:m,editField:g,removeField:b,hasSuggestionForField:h,hideDetails:x,uiActions:v}=e,j=d.useChartsTheme(),O=d.useChartsBaseTheme();let k=!!e.histogram;const I=a&&a.buckets.reduce(((e,t)=>t.count+e),0),T=c&&I?c-I:0;I&&t&&t.buckets.length&&a&&a.buckets.length&&(k=T/I>.9);const[M,F]=Object(l.useState)(k),w=Object(y.jsx)(_c,{indexPatternId:n.id,field:i,dropOntoWorkspace:m,hasSuggestionForField:h,editField:g,removeField:b});if(x)return w;let C;if(n.fieldFormatMap&&n.fieldFormatMap[i.name]){const e=p.getType(n.fieldFormatMap[i.name].id);C=e?new e(n.fieldFormatMap[i.name].params,o.uiSettings.get.bind(o.uiSettings)):{convert:e=>JSON.stringify(e)}}else C=p.getDefaultInstance(i.type,i.esTypes);const _=Ic.a.parse(r.fromDate),S=Ic.a.parse(r.toDate);let E=Object(y.jsx)(s.a.Fragment,null);if(e.isLoading)return Object(y.jsx)(f.EuiLoadingSpinner,null);if(i.type.includes("range"))return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiPopoverTitle,null,w),Object(y.jsx)(f.EuiText,{size:"s"},u.i18n.translate("xpack.lens.indexPattern.fieldStatsLimited",{defaultMessage:"Summary information is not available for range type fields."})));if("murmur3"===i.type)return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiPopoverTitle,null,w),Object(y.jsx)(f.EuiText,{size:"s"},u.i18n.translate("xpack.lens.indexPattern.fieldStatsMurmur3Limited",{defaultMessage:"Summary information is not available for murmur3 fields."})));if("geo_point"===i.type||"geo_shape"===i.type)return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiPopoverTitle,null,w),Object(y.jsx)(f.EuiText,{size:"s"},Object(Fc.getVisualizeGeoFieldMessage)(i.type)),Object(y.jsx)(f.EuiSpacer,{size:"m"}),Object(y.jsx)(Mc,{uiActions:v,indexPatternId:n.id,fieldName:i.name}));if(!(e.histogram&&0!==e.histogram.buckets.length||e.topValues&&0!==e.topValues.buckets.length)){const e=o.uiSettings.get("lens:useFieldExistenceSampling");return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiPopoverTitle,null,w),Object(y.jsx)(f.EuiText,{size:"s"},e?u.i18n.translate("xpack.lens.indexPattern.fieldStatsSamplingNoData",{defaultMessage:"Lens is unable to create visualizations with this field because it does not contain data in the first 500 documents that match your filters. To create a visualization, drag and drop a different field."}):u.i18n.translate("xpack.lens.indexPattern.fieldStatsNoData",{defaultMessage:"Lens is unable to create visualizations with this field because it does not contain data. To create a visualization, drag and drop a different field."})))}function P(t){return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiPopoverTitle,null,w),E||Object(y.jsx)(s.a.Fragment,null),Object(y.jsx)(f.EuiSpacer,{size:"s"}),t,e.totalDocuments?Object(y.jsx)(f.EuiPopoverFooter,null,Object(y.jsx)(f.EuiText,{color:"subdued",size:"xs"},e.sampledDocuments&&Object(y.jsx)(s.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.percentageOfLabel",{defaultMessage:"{percentage}% of",values:{percentage:Math.round(e.sampledDocuments/e.totalDocuments*100)}}))," ",Object(y.jsx)("strong",null,p.getDefaultInstance(Ja.KBN_FIELD_TYPES.NUMBER,[Ja.ES_FIELD_TYPES.INTEGER]).convert(e.totalDocuments))," ",u.i18n.translate("xpack.lens.indexPattern.ofDocumentsLabel",{defaultMessage:"documents"}))):Object(y.jsx)(s.a.Fragment,null))}if(t&&t.buckets.length&&a&&a.buckets.length?E=Object(y.jsx)(f.EuiButtonGroup,{className:"lnsFieldItem__buttonGroup",buttonSize:"compressed",isFullWidth:!0,legend:u.i18n.translate("xpack.lens.indexPattern.fieldStatsDisplayToggle",{defaultMessage:"Toggle either the"}),options:[{label:u.i18n.translate("xpack.lens.indexPattern.fieldTopValuesLabel",{defaultMessage:"Top values"}),id:"topValues"},{label:u.i18n.translate("xpack.lens.indexPattern.fieldDistributionLabel",{defaultMessage:"Distribution"}),id:"histogram"}],onChange:e=>{F("histogram"===e)},idSelected:M?"histogram":"topValues"}):"date"===i.type?E=Object(y.jsx)(f.EuiTitle,{size:"xxxs"},Object(y.jsx)("h6",null,u.i18n.translate("xpack.lens.indexPattern.fieldTimeDistributionLabel",{defaultMessage:"Time distribution"}))):a&&a.buckets.length&&(E=Object(y.jsx)(f.EuiTitle,{size:"xxxs"},Object(y.jsx)("h6",null,u.i18n.translate("xpack.lens.indexPattern.fieldTopValuesLabel",{defaultMessage:"Top values"})))),t&&t.buckets.length){const e=u.i18n.translate("xpack.lens.indexPattern.fieldStatsCountLabel",{defaultMessage:"Count"});if("date"===i.type)return P(Object(y.jsx)(pe.Chart,{"data-test-subj":"lnsFieldListPanel-histogram",size:{height:200,width:268}},Object(y.jsx)(pe.Settings,{tooltip:{type:pe.TooltipType.None},theme:j,baseTheme:O,xDomain:_&&S?{min:_.valueOf(),max:S.valueOf(),minInterval:Math.round((S.valueOf()-_.valueOf())/10)}:void 0}),Object(y.jsx)(pe.Axis,{id:"key",position:pe.Position.Bottom,tickFormat:_&&S?Object(pe.niceTimeFormatter)([_.valueOf(),S.valueOf()]):void 0,showOverlappingTicks:!0}),Object(y.jsx)(pe.HistogramBarSeries,{data:t.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:pe.ScaleType.Time,yScaleType:pe.ScaleType.Linear,timeZone:"local"})));if(M||!a||!a.buckets.length)return P(Object(y.jsx)(pe.Chart,{"data-test-subj":"lnsFieldListPanel-histogram",size:{height:200,width:"100%"}},Object(y.jsx)(pe.Settings,{rotation:90,tooltip:{type:pe.TooltipType.None},theme:j,baseTheme:O}),Object(y.jsx)(pe.Axis,{id:"key",position:pe.Position.Left,showOverlappingTicks:!0,tickFormat:e=>C.convert(e)}),Object(y.jsx)(pe.HistogramBarSeries,{data:t.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:pe.ScaleType.Linear,yScaleType:pe.ScaleType.Linear})))}if(e.topValues&&e.topValues.buckets.length){const t=e.topValues.buckets.some((t=>!Number.isInteger(t.count/e.sampledValues)));return P(Object(y.jsx)("div",{"data-test-subj":"lnsFieldListPanel-topValues"},e.topValues.buckets.map((a=>{const n=C.convert(a.key);return Object(y.jsx)("div",{className:"lnsFieldItem__topValue",key:a.key},Object(y.jsx)(f.EuiFlexGroup,{alignItems:"stretch",key:a.key,gutterSize:"xs",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{grow:!0,className:"eui-textTruncate"},""===n?Object(y.jsx)(f.EuiText,{size:"xs",color:"subdued"},Object(y.jsx)("em",null,u.i18n.translate("xpack.lens.indexPattern.fieldPanelEmptyStringValue",{defaultMessage:"Empty string"}))):Object(y.jsx)(f.EuiToolTip,{content:n,delay:"long"},Object(y.jsx)(f.EuiText,{size:"xs",color:"subdued",className:"eui-textTruncate"},n))),Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiText,{size:"xs",textAlign:"left",color:"accent"},(Math.round(a.count/e.sampledValues*1e3)/10).toFixed(t?1:0),"%"))),Object(y.jsx)(f.EuiProgress,{className:"lnsFieldItem__topValueProgress",value:a.count/e.sampledValues,max:1,size:"s",color:"accent"}))})),T?Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiFlexGroup,{alignItems:"stretch",gutterSize:"xs",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{grow:!0,className:"eui-textTruncate"},Object(y.jsx)(f.EuiText,{size:"xs",className:"eui-textTruncate",color:"subdued"},u.i18n.translate("xpack.lens.indexPattern.otherDocsLabel",{defaultMessage:"Other"}))),Object(y.jsx)(f.EuiFlexItem,{grow:!1,className:"eui-textTruncate"},Object(y.jsx)(f.EuiText,{size:"xs",color:"subdued"},(Math.round(T/e.sampledValues*1e3)/10).toFixed(t?1:0),"%"))),Object(y.jsx)(f.EuiProgress,{className:"lnsFieldItem__topValueProgress",value:T/e.sampledValues,max:1,size:"s",color:"subdued"})):Object(y.jsx)(s.a.Fragment,null)))}return Object(y.jsx)(s.a.Fragment,null)}const Ec=({field:e,dropOntoWorkspace:t,isEnabled:a})=>{const n=a?u.i18n.translate("xpack.lens.indexPattern.moveToWorkspace",{defaultMessage:"Add {field} to workspace",values:{field:e.field.name}}):u.i18n.translate("xpack.lens.indexPattern.moveToWorkspaceDisabled",{defaultMessage:"This field can't be added to the workspace automatically. You can still use it directly in the configuration panel."});return Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiToolTip,{content:n},Object(y.jsx)(f.EuiButtonIcon,{"aria-label":n,isDisabled:!a,iconType:"plusInCircle",onClick:()=>{t(e)}})))},Pc=u.i18n.translate("xpack.lens.indexPatterns.noDataLabel",{defaultMessage:"There are no fields."}),Ac=({existFieldsInIndex:e,defaultNoFieldsMessage:t=Pc,isAffectedByFieldFilter:a=!1,isAffectedByTimerange:n=!1,isAffectedByGlobalFilter:i=!1})=>e?Object(y.jsx)(f.EuiCallOut,{size:"s",color:"warning",title:a?u.i18n.translate("xpack.lens.indexPatterns.noFilteredFieldsLabel",{defaultMessage:"No fields match the selected filters."}):t},(n||a||i)&&Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)("strong",null,u.i18n.translate("xpack.lens.indexPatterns.noFields.tryText",{defaultMessage:"Try:"})),Object(y.jsx)("ul",null,n&&Object(y.jsx)("li",null,u.i18n.translate("xpack.lens.indexPatterns.noFields.extendTimeBullet",{defaultMessage:"Extending the time range"})),a&&Object(y.jsx)("li",null,u.i18n.translate("xpack.lens.indexPatterns.noFields.fieldTypeFilterBullet",{defaultMessage:"Using different field filters"})),i&&Object(y.jsx)("li",null,u.i18n.translate("xpack.lens.indexPatterns.noFields.globalFiltersBullet",{defaultMessage:"Changing the global filters"}))))):Object(y.jsx)(f.EuiCallOut,{size:"s",color:"warning",title:u.i18n.translate("xpack.lens.indexPatterns.noFieldsLabel",{defaultMessage:"No fields exist in this data view."})}),Lc=Object(l.memo)((function({initialIsOpen:e,onToggle:t,id:a,label:n,helpTooltip:s,hasLoaded:r,fieldsCount:o,isFiltered:c,paginatedFields:d,fieldProps:p,renderCallout:m,exists:g,hideDetails:b,showExistenceFetchError:h,showExistenceFetchTimeout:v,groupIndex:j,dropOntoWorkspace:O,hasSuggestionForField:k,editField:I,removeField:T,uiActions:M}){const F=Object(l.useCallback)(((e,t)=>Object(y.jsx)(Cc,i()({},p,{key:e.name,field:e,exists:g(e),hideDetails:b,itemIndex:t,groupIndex:j,dropOntoWorkspace:O,hasSuggestionForField:k,editField:I,removeField:T,uiActions:M}))),[p,g,b,O,k,j,I,T,M]),w=Object(l.useMemo)((()=>{const e=x()({lnsInnerIndexPatternDataPanel__titleTooltip:!!s});return Object(y.jsx)(f.EuiText,{size:"xs"},Object(y.jsx)("strong",{className:e},n),!!s&&Object(y.jsx)(f.EuiIconTip,{"aria-label":s,type:"questionInCircle",color:"subdued",size:"s",position:"right",content:s,iconProps:{className:"eui-alignTop"}}))}),[n,s]),C=Object(l.useMemo)((()=>h?Object(y.jsx)(f.EuiIconTip,{"aria-label":u.i18n.translate("xpack.lens.indexPattern.existenceErrorAriaLabel",{defaultMessage:"Existence fetch failed"}),type:"alert",color:"warning",content:u.i18n.translate("xpack.lens.indexPattern.existenceErrorLabel",{defaultMessage:"Field information can't be loaded"})}):v?Object(y.jsx)(f.EuiIconTip,{"aria-label":u.i18n.translate("xpack.lens.indexPattern.existenceTimeoutAriaLabel",{defaultMessage:"Existence fetch timed out"}),type:"clock",color:"warning",content:u.i18n.translate("xpack.lens.indexPattern.existenceTimeoutLabel",{defaultMessage:"Field information took too long"})}):r?Object(y.jsx)(f.EuiNotificationBadge,{size:"m",color:c?"accent":"subdued"},o):Object(y.jsx)(f.EuiLoadingSpinner,{size:"m"})),[h,v,r,c,o]);return Object(y.jsx)(f.EuiAccordion,{initialIsOpen:e,onToggle:t,"data-test-subj":a,id:a,buttonContent:w,extraAction:C},Object(y.jsx)(f.EuiSpacer,{size:"s"}),r&&(o?Object(y.jsx)("ul",{className:"lnsInnerIndexPatternDataPanel__fieldItems"},d&&d.map(F)):m))}));function Dc(e,t){return Object.entries(e).filter((([e])=>t[e])).reduce(((e,[,{fields:t}])=>e+t.length),0)}const Nc=s.a.memo((function({exists:e,fieldGroups:t,existenceFetchFailed:a,existenceFetchTimeout:n,fieldProps:s,hasSyncedExistingFields:r,filter:o,currentIndexPatternId:u,existFieldsInIndex:c,dropOntoWorkspace:d,hasSuggestionForField:p,editField:m,removeField:g,uiActions:b}){const[h,x]=Object(l.useState)(50),[v,j]=Object(l.useState)(void 0),[O,k]=Object(l.useState)((()=>Object.fromEntries(Object.entries(t).filter((([,{showInAccordion:e}])=>e)).map((([e,{isInitiallyOpen:t}])=>[e,t])))));Object(l.useEffect)((()=>{v&&(v.scrollTop=0,x(50))}),[o.nameFilter,o.typeFilter,u,v]);const I=Object(l.useCallback)((()=>{v&&v.scrollTop+v.clientHeight>.9*v.scrollHeight&&x(Math.max(50,Math.min(h+25,Dc(t,O))))}),[v,h,x,t,O]),T=Object(l.useMemo)((()=>{let e=h;return Object.fromEntries(Object.entries(t).filter((([,{showInAccordion:e}])=>e)).map((([t,a])=>{if(!O[t]||e<=0)return[t,[]];const n=a.fields.slice(0,e);return e-=n.length,[t,n]})))}),[h,t,O]);return Object(y.jsx)("div",{className:"lnsIndexPatternFieldList",ref:e=>{e&&!e.dataset.dynamicScroll&&(e.dataset.dynamicScroll="true",j(e))},onScroll:Object(Se.throttle)(I,100)},Object(y.jsx)("div",{className:"lnsIndexPatternFieldList__accordionContainer"},Object(y.jsx)("ul",null,Object.entries(t).filter((([,{showInAccordion:e}])=>!e)).flatMap((([,{fields:t}])=>t.map(((t,a)=>Object(y.jsx)(Cc,i()({},s,{exists:e(t),field:t,editField:m,removeField:g,hideDetails:!0,key:t.name,itemIndex:a,groupIndex:0,dropOntoWorkspace:d,hasSuggestionForField:p,uiActions:b}))))))),Object(y.jsx)(f.EuiSpacer,{size:"s"}),Object.entries(t).filter((([,{showInAccordion:e}])=>e)).map((([i,o],u)=>Object(y.jsx)(l.Fragment,{key:i},Object(y.jsx)(Lc,{dropOntoWorkspace:d,hasSuggestionForField:p,initialIsOpen:Boolean(O[i]),key:i,id:`lnsIndexPattern${i}`,label:o.title,helpTooltip:o.helpText,exists:e,editField:m,removeField:g,hideDetails:o.hideDetails,hasLoaded:!!r,fieldsCount:o.fields.length,isFiltered:o.fieldCount!==o.fields.length,paginatedFields:T[i],fieldProps:s,groupIndex:u+1,onToggle:e=>{k((t=>({...t,[i]:e})));const a=Dc(t,{...O,[i]:e});x(Math.max(50,Math.min(1.5*h,a)))},showExistenceFetchError:a,showExistenceFetchTimeout:n,renderCallout:Object(y.jsx)(Ac,{isAffectedByGlobalFilter:o.isAffectedByGlobalFilter,isAffectedByTimerange:o.isAffectedByTimeFilter,isAffectedByFieldFilter:o.fieldCount!==o.fields.length,existFieldsInIndex:!!c,defaultNoFieldsMessage:o.defaultNoFieldsMessage}),uiActions:b}),Object(y.jsx)(f.EuiSpacer,{size:"m"}))))))}));function zc(e,t){return e.displayName.localeCompare(t.displayName,void 0,{sensitivity:"base"})}const Bc=new Set(["string","number","boolean","date","ip","number_range","date_range","ip_range","histogram","document","geo_point","geo_shape","murmur3"]),Vc={document:u.i18n.translate("xpack.lens.datatypes.record",{defaultMessage:"record"}),string:u.i18n.translate("xpack.lens.datatypes.string",{defaultMessage:"string"}),number:u.i18n.translate("xpack.lens.datatypes.number",{defaultMessage:"number"}),boolean:u.i18n.translate("xpack.lens.datatypes.boolean",{defaultMessage:"boolean"}),date:u.i18n.translate("xpack.lens.datatypes.date",{defaultMessage:"date"}),ip:u.i18n.translate("xpack.lens.datatypes.ipAddress",{defaultMessage:"IP"}),histogram:u.i18n.translate("xpack.lens.datatypes.histogram",{defaultMessage:"histogram"}),geo_point:u.i18n.translate("xpack.lens.datatypes.geoPoint",{defaultMessage:"geo_point"}),geo_shape:u.i18n.translate("xpack.lens.datatypes.geoShape",{defaultMessage:"geo_shape"}),murmur3:u.i18n.translate("xpack.lens.datatypes.murmur3",{defaultMessage:"murmur3"})};function Rc({setState:e,state:t,dragDropContext:a,core:n,data:i,dataViews:r,fieldFormats:o,query:d,filters:p,dateRange:m,changeIndexPattern:g,charts:b,indexPatternFieldEditor:h,showNoDataPopover:x,dropOntoWorkspace:v,hasSuggestionForField:j,uiActions:O}){const{indexPatternRefs:k,indexPatterns:I,currentIndexPatternId:T}=t,M=Object(l.useCallback)((a=>g(a,t,e)),[t,e,g]),F=Object(l.useCallback)((t=>{e((e=>({...e,indexPatterns:{...e.indexPatterns,[t.id]:t}})))}),[e]),w=Object(Se.uniq)(Object.values(t.layers).map((e=>e.indexPatternId)).concat(T)).filter((e=>!!I[e])).sort(((e,t)=>e.localeCompare(t))).map((e=>({id:e,title:I[e].title,timeFieldName:I[e].timeFieldName,fields:I[e].fields,hasRestrictions:I[e].hasRestrictions}))),C=function(e,t,a,n){try{return Object(pi.c)(e,t,a,n)}catch(e){return{bool:{must_not:{match_all:{}}}}}}(I[T],d,p,Object(Ja.getEsQueryConfig)(n.uiSettings));return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(Oc,{load:()=>{var a;return async function({indexPatterns:e,dateRange:t,fetchJson:a,setState:n,isFirstExistenceFetch:i,currentIndexPatternTitle:l,dslQuery:s,showNoDataPopover:r}){const o=e.map((e=>{if(e.hasRestrictions)return{indexPatternTitle:e.title,existingFieldNames:e.fields.map((e=>e.name))};const n={dslQuery:s,fromDate:t.fromDate,toDate:t.toDate};return e.timeFieldName&&(n.timeFieldName=e.timeFieldName),a(`${D.b}/existing_fields/${e.id}`,{body:JSON.stringify(n)})}));try{const e=await Promise.all(o);if(i){const t=e.find((e=>e.indexPatternTitle===l));t&&0===t.existingFieldNames.length&&r()}n((t=>({...t,isFirstExistenceFetch:!1,existenceFetchFailed:!1,existenceFetchTimeout:!1,existingFields:e.reduce(((e,t)=>(e[t.indexPatternTitle]=hu(t.existingFieldNames),e)),{...t.existingFields})})),{applyImmediately:!0})}catch(t){n((a=>{var n,i;return{...a,existenceFetchFailed:408!==(null===(n=t.res)||void 0===n?void 0:n.status),existenceFetchTimeout:408===(null===(i=t.res)||void 0===i?void 0:i.status),existingFields:e.reduce(((e,t)=>(e[t.title]=hu(t.fields.map((e=>e.name))),e)),{...a.existingFields})}}),{applyImmediately:!0})}}({dateRange:m,setState:e,isFirstExistenceFetch:t.isFirstExistenceFetch,currentIndexPatternTitle:(null===(a=I[T])||void 0===a?void 0:a.title)||"",showNoDataPopover:x,indexPatterns:w,fetchJson:n.http.post,dslQuery:C})},loadDeps:[d,p,m.fromDate,m.toDate,w.map((e=>`${e.title}:${e.timeFieldName}`)).join(","),t.indexPatterns]}),0===Object.keys(I).length&&0===k.length?Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"m",className:"lnsInnerIndexPatternDataPanel",direction:"column",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{grow:null},Object(y.jsx)(f.EuiCallOut,{"data-test-subj":"indexPattern-no-indexpatterns",title:u.i18n.translate("xpack.lens.indexPattern.noDataViewsLabel",{defaultMessage:"No data views"}),color:"warning",iconType:"alert"},Object(y.jsx)("p",null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.noDataViewDescription",defaultMessage:"Please create a data view or switch to another data source"}))))):Object(y.jsx)(Wc,{currentIndexPatternId:T,indexPatternRefs:k,indexPatterns:I,query:d,dateRange:m,filters:p,dragDropContext:a,core:n,data:i,dataViews:r,fieldFormats:o,charts:b,indexPatternFieldEditor:h,onChangeIndexPattern:M,onUpdateIndexPattern:F,existingFields:t.existingFields,existenceFetchFailed:t.existenceFetchFailed,existenceFetchTimeout:t.existenceFetchTimeout,dropOntoWorkspace:v,hasSuggestionForField:j,uiActions:O}))}const Hc={specialFields:[],availableFields:[],emptyFields:[],metaFields:[]},Gc=u.i18n.translate("xpack.lens.indexPatterns.fieldFiltersLabel",{defaultMessage:"Filter by type"}),qc=Object(f.htmlIdGenerator)("datapanel")(),$c=function({currentIndexPatternId:e,indexPatternRefs:t,indexPatterns:a,existenceFetchFailed:n,existenceFetchTimeout:i,query:s,dateRange:r,filters:o,dragDropContext:c,onChangeIndexPattern:d,onUpdateIndexPattern:p,core:m,data:g,dataViews:b,fieldFormats:h,indexPatternFieldEditor:x,existingFields:v,charts:j,dropOntoWorkspace:O,hasSuggestionForField:k,uiActions:I}){var T;const[M,F]=Object(l.useState)({nameFilter:"",typeFilter:[],isTypeFilterOpen:!1,isAvailableAccordionOpen:!0,isEmptyAccordionOpen:!1,isMetaAccordionOpen:!1}),w=a[e],C=I.getTrigger(vc.VISUALIZE_GEO_FIELD_TRIGGER)?w.fields:w.fields.filter((({type:e})=>"geo_point"!==e&&"geo_shape"!==e)),_=v[w.title],S=Object(Se.uniq)(C.map((({type:e})=>e))).filter((e=>e in Vc)),E=n||i||w.hasRestrictions,P=x.userPermissions.editIndexPattern(),A=Object(l.useMemo)((()=>{const e=C.filter((e=>Bc.has(e.type))).sort(zc),t={...Hc,...Object(Se.groupBy)(e,(e=>"document"===e.type?"specialFields":e.meta?"metaFields":(e=>{const t=w.getFieldByName(e.name);return t&&Ks(v,w.title,t.name)})(e)?"availableFields":"emptyFields"))},a=m.uiSettings.get("lens:useFieldExistenceSampling"),n={SpecialFields:{fields:t.specialFields,fieldCount:1,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!1,title:"",hideDetails:!0},AvailableFields:{fields:t.availableFields,fieldCount:t.availableFields.length,isInitiallyOpen:!0,showInAccordion:!0,title:E?u.i18n.translate("xpack.lens.indexPattern.allFieldsLabel",{defaultMessage:"All fields"}):u.i18n.translate("xpack.lens.indexPattern.availableFieldsLabel",{defaultMessage:"Available fields"}),helpText:a?u.i18n.translate("xpack.lens.indexPattern.allFieldsSamplingLabelHelp",{defaultMessage:"Available fields contain the data in the first 500 documents that match your filters. To view all fields, expand Empty fields. You are unable to create visualizations with full text, geographic, flattened, and object fields."}):u.i18n.translate("xpack.lens.indexPattern.allFieldsLabelHelp",{defaultMessage:"Drag and drop available fields to the workspace and create visualizations. To change the available fields, select a different data view, edit your queries, or use a different time range. Some field types cannot be visualized in Lens, including full text and geographic fields."}),isAffectedByGlobalFilter:!!o.length,isAffectedByTimeFilter:!0,hideDetails:E&&!i,defaultNoFieldsMessage:u.i18n.translate("xpack.lens.indexPatterns.noAvailableDataLabel",{defaultMessage:"There are no available fields that contain data."})},EmptyFields:{fields:t.emptyFields,fieldCount:t.emptyFields.length,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!0,hideDetails:!1,title:u.i18n.translate("xpack.lens.indexPattern.emptyFieldsLabel",{defaultMessage:"Empty fields"}),defaultNoFieldsMessage:u.i18n.translate("xpack.lens.indexPatterns.noEmptyDataLabel",{defaultMessage:"There are no empty fields."}),helpText:u.i18n.translate("xpack.lens.indexPattern.emptyFieldsLabelHelp",{defaultMessage:"Empty fields did not contain any values in the first 500 documents based on your filters."})},MetaFields:{fields:t.metaFields,fieldCount:t.metaFields.length,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!0,hideDetails:!1,title:u.i18n.translate("xpack.lens.indexPattern.metaFieldsLabel",{defaultMessage:"Meta fields"}),defaultNoFieldsMessage:u.i18n.translate("xpack.lens.indexPatterns.noMetaDataLabel",{defaultMessage:"There are no meta fields."})}};return E&&delete n.EmptyFields,n}),[C,m.uiSettings,E,o.length,i,w,v]),L=Object(l.useMemo)((()=>Object.fromEntries(Object.entries(A).map((([e,t])=>{return[e,{...t,fields:(a=t.fields,a.filter((e=>!(M.nameFilter.length&&!e.name.toLowerCase().includes(M.nameFilter.toLowerCase())&&!e.displayName.toLowerCase().includes(M.nameFilter.toLowerCase()))&&(!(M.typeFilter.length>0)||M.typeFilter.includes(e.type)))))}];var a})))),[A,M.nameFilter,M.typeFilter]),D=Object(l.useCallback)((e=>"document"===e.type||Ks(v,w.title,e.name)),[v,w.title]),{nameFilter:N,typeFilter:z}=M,B=Object(l.useMemo)((()=>({nameFilter:N,typeFilter:z})),[N,z]),V=Object(l.useRef)();Object(l.useEffect)((()=>()=>{V.current&&V.current()}),[]);const R=Object(l.useCallback)((async()=>{const e=await mu({indexPatternsService:b,cache:{},patterns:[w.id]});p(e[w.id]),g.search.session.start()}),[g,b,w,p]),H=Object(l.useMemo)((()=>P?async(e,t="edit")=>{Object(fn.e)(`open_field_editor_${t}`);const a=await b.get(w.id);V.current=x.openEditor({ctx:{dataView:a},fieldName:e,onSave:async()=>{Object(fn.e)(`save_field_${t}`),await R()}})}:void 0),[P,b,w.id,x,R]),G=Object(l.useMemo)((()=>P?async e=>{Object(fn.e)("open_field_delete_modal");const t=await b.get(w.id);V.current=x.openDeleteModal({ctx:{dataView:t},fieldName:e,onDelete:async()=>{Object(fn.e)("delete_field"),await R()}})}:void 0),[w.id,b,P,x,R]),q=Object(l.useMemo)((()=>({core:m,data:g,fieldFormats:h,indexPattern:w,highlight:M.nameFilter.toLowerCase(),dateRange:r,query:s,filters:o,chartsThemeService:j.theme})),[m,g,h,w,r,s,o,M.nameFilter,j.theme]);return Object(y.jsx)(jc.a,c,Object(y.jsx)(f.EuiFlexGroup,{gutterSize:"none",className:"lnsInnerIndexPatternDataPanel",direction:"column",responsive:!1},Object(y.jsx)(f.EuiFlexItem,{grow:!1},Object(y.jsx)(f.EuiFormControlLayout,{icon:"search",fullWidth:!0,clear:{title:u.i18n.translate("xpack.lens.indexPatterns.clearFiltersLabel",{defaultMessage:"Clear name and type filters"}),"aria-label":u.i18n.translate("xpack.lens.indexPatterns.clearFiltersLabel",{defaultMessage:"Clear name and type filters"}),onClick:()=>{Object(fn.e)("indexpattern_filters_cleared"),F((e=>({...e,nameFilter:"",typeFilter:[]})))}}},Object(y.jsx)("input",{className:"euiFieldText euiFieldText--fullWidth lnsInnerIndexPatternDataPanel__textField","data-test-subj":"lnsIndexPatternFieldSearch",placeholder:u.i18n.translate("xpack.lens.indexPatterns.filterByNameLabel",{defaultMessage:"Search field names",description:"Search the list of fields in the data view for the provided text"}),value:M.nameFilter,onChange:e=>{F({...M,nameFilter:e.target.value})},"aria-label":u.i18n.translate("xpack.lens.indexPatterns.filterByNameLabel",{defaultMessage:"Search field names",description:"Search the list of fields in the data view for the provided text"}),"aria-describedby":qc})),Object(y.jsx)(f.EuiSpacer,{size:"xs"}),Object(y.jsx)(f.EuiFilterGroup,null,Object(y.jsx)(f.EuiPopover,{id:"dataPanelTypeFilter",panelClassName:"euiFilterGroup__popoverPanel",panelPaddingSize:"none",anchorPosition:"rightUp",display:"block",isOpen:M.isTypeFilterOpen,closePopover:()=>F((()=>({...M,isTypeFilterOpen:!1}))),button:Object(y.jsx)(f.EuiFilterButton,{iconType:"arrowDown",isSelected:M.isTypeFilterOpen,numFilters:M.typeFilter.length,hasActiveFilters:!!M.typeFilter.length,numActiveFilters:M.typeFilter.length,"data-test-subj":"lnsIndexPatternFiltersToggle",onClick:()=>{F((e=>({...e,isTypeFilterOpen:!M.isTypeFilterOpen})))}},Gc)},Object(y.jsx)(f.EuiContextMenuPanel,{"data-test-subj":"lnsIndexPatternTypeFilterOptions",items:S.map((e=>Object(y.jsx)(f.EuiContextMenuItem,{className:"lnsInnerIndexPatternDataPanel__filterType",key:e,icon:M.typeFilter.includes(e)?"check":"empty","data-test-subj":`typeFilter-${e}`,onClick:()=>{Object(fn.e)("indexpattern_type_filter_toggled"),F((t=>({...t,typeFilter:M.typeFilter.includes(e)?M.typeFilter.filter((t=>t!==e)):[...M.typeFilter,e]})))}},Object(y.jsx)("span",{className:"lnsInnerIndexPatternDataPanel__filterTypeInner"},Object(y.jsx)(Xs,{type:e})," ",Vc[e]))))})))),Object(y.jsx)(f.EuiScreenReaderOnly,null,Object(y.jsx)("div",{"aria-live":"polite",id:qc},u.i18n.translate("xpack.lens.indexPatterns.fieldSearchLiveRegion",{defaultMessage:"{availableFields} available {availableFields, plural, one {field} other {fields}}. {emptyFields} empty {emptyFields, plural, one {field} other {fields}}. {metaFields} meta {metaFields, plural, one {field} other {fields}}.",values:{availableFields:L.AvailableFields.fields.length,emptyFields:(null===(T=L.EmptyFields)||void 0===T?void 0:T.fields.length)||0,metaFields:L.MetaFields.fields.length}}))),Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(Nc,{exists:D,fieldProps:q,fieldGroups:L,hasSyncedExistingFields:!!_,filter:B,currentIndexPatternId:e,existenceFetchFailed:n,existenceFetchTimeout:i,existFieldsInIndex:!!C.length,dropOntoWorkspace:O,hasSuggestionForField:k,editField:H,removeField:G,uiActions:I}))))},Wc=Object(l.memo)($c);function Uc({state:e,updatedLayer:t,layerId:a,label:n,changeType:i}){const l=t?{...e,layers:{...e.layers,[a]:t}}:e,s=Object(Se.mapValues)(l.layers,(e=>({...e,columns:Object(Se.pick)(e.columns,e.columnOrder)}))),r=s[a].columnOrder,o=s[a].columns,u=Object.values(o).some((e=>e.isBucketed));return{state:{...l,layers:s},table:{columns:r.filter((e=>!Fs(s[a],e))).map((e=>({columnId:e,operation:cd(o[e])}))),isMultiRow:u,layerId:a,changeType:i,label:n},keptLayerIds:Object.keys(e.layers)}}function Yc(e,t){return 0!==Object.keys(e.layers).filter((a=>e.layers[a].indexPatternId===t[0].indexPatternId)).length?[]:function(e,t){const a=[];for(let n=0;n<t.length;n++){const i=t[n],l=e.indexPatterns[i.indexPatternId];if(!l)return[];const s=Object(ea.a)();let r;if(l.timeFieldName&&(r=Xc(l,i)),r){const i=Uc({state:e,updatedLayer:r,layerId:s,changeType:"initial"}),l=Object.keys(i.state.layers)[0];t[n].layerId=l,a.push(i)}}return a}(e,t)}function Xc(e,t){const{timeFieldName:a,splitMode:n,splitFilters:i,metrics:l,timeInterval:s,dropPartialBuckets:r}=t,o=e.getFieldByName(a),u=t.splitFields?t.splitFields.map((t=>e.getFieldByName(t))).filter(Boolean):null;if("terms"===n&&null!=u&&u.length)return function(e,t,a,n){const{termsParams:i,metrics:l,timeInterval:s,splitWithDateHistogram:r,dropPartialBuckets:o}=n,u=[...l],c=Ds(1===l.length,u,e,n.format,n.label),[d,...p]=t,m=Object(ea.a)();let g=cs({op:r?"date_histogram":"terms",layer:cs({op:"date_histogram",layer:c,columnId:Object(ea.a)(),field:a,indexPattern:e,visualizationGroups:[],columnParams:{interval:s,dropPartials:o}}),columnId:m,field:d,indexPattern:e,visualizationGroups:[]});p.length&&(g=vs({layer:g,columnId:m,paramName:"secondaryFields",value:p.map((e=>e.name))}),g=Es(g,e));const f=i;if(f)for(const[t,a]of Object.entries(f)){let n=a;if("orderBy"===t){const[e]=Object.keys(g.columns).filter((e=>ns(g,e)));n="column"===f.orderBy.type&&e?{type:"column",columnId:e}:{type:"alphabetical",fallback:!0}}g=vs({layer:g,columnId:m,paramName:t,value:n}),g=Es(g,e)}return g}(e,u,o,t);if(null!=n&&n.includes("filter")&&i&&i.length)return function(e,t,a){const{splitFilters:n,metrics:i,timeInterval:l,dropPartialBuckets:s}=a,r=null==n?void 0:n.map((e=>{var t;return{input:{query:e.filter?e.filter.query:"",language:e.filter?e.filter.language:"kuery"},label:null!==(t=e.label)&&void 0!==t?t:""}})),o=[...i],u=Ds(1===i.length,o,e,a.format,a.label),c=Object(ea.a)();let d=cs({op:"filters",layer:cs({op:"date_histogram",layer:u,columnId:Object(ea.a)(),field:t,indexPattern:e,visualizationGroups:[],columnParams:{interval:l,dropPartials:s}}),columnId:c,field:void 0,indexPattern:e,visualizationGroups:[]});return r&&(d=vs({layer:d,columnId:c,paramName:"filters",value:r})),d}(e,o,t);{const a=[...l],n=Ds(1===l.length,a,e,t.format,t.label);return Object.values(n.columns)[0].isStaticValue?n:cs({op:"date_histogram",layer:n,columnId:Object(ea.a)(),field:o,indexPattern:e,visualizationGroups:[],columnParams:{interval:s,dropPartials:r}})}}function Kc(e,t,a){const n=Object.keys(e.layers).filter((a=>e.layers[a].indexPatternId===t)),i=e.indexPatterns[t].getFieldByName(a);if(0!==n.length||!i)return[];const l=Object(ea.a)();return Qc(e,l,t,i).concat(Qc({...e,layers:{}},l,t,i))}function Zc(e){if("number"!==e.type)return uu(e).find((e=>"date_histogram"===e||"terms"===e))}function Qc(e,t,a,n){const i=e.indexPatterns[a];let l;const s=Zc(n);s?l=function(e,t,a){return cs({op:a,layer:cs({op:"count",layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(ea.a)(),field:ml,indexPattern:e,visualizationGroups:[]}),columnId:Object(ea.a)(),field:t,indexPattern:e,visualizationGroups:[]})}(i,n,s):i.timeFieldName&&uu(n).length>0&&(l=function(e,t){const a=e.getFieldByName(e.timeFieldName),[n]=xs(t);if(n)return cs({op:"date_histogram",layer:cs({op:n.type,layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(ea.a)(),field:t,indexPattern:e,visualizationGroups:[]}),columnId:Object(ea.a)(),field:a,indexPattern:e,visualizationGroups:[]})}(i,n));const r=l?[Uc({state:e,updatedLayer:l,layerId:t,changeType:"initial"})]:[],o=ed(i,t,e,n);return o?r.concat(o):r}function Jc(e,t=(()=>!0)){const a=Object.entries(e.layers||{}).filter((([e])=>t(e)));return a.length>1?a.map((([t,n],i)=>{const l=a.some((([e,a])=>e!==t&&a.indexPatternId===n.indexPatternId))?u.i18n.translate("xpack.lens.indexPatternSuggestion.removeLayerPositionLabel",{defaultMessage:"Show only layer {layerNumber}",values:{layerNumber:i+1}}):u.i18n.translate("xpack.lens.indexPatternSuggestion.removeLayerLabel",{defaultMessage:"Show only {indexPatternTitle}",values:{indexPatternTitle:e.indexPatterns[n.indexPatternId].title}});return Uc({state:{...e,layers:{[t]:n}},layerId:t,changeType:"layers",label:l})})).concat([Uc({state:e,layerId:a[0][0],changeType:"unchanged"})]):Object(Se.flatten)(a.filter((([e,t])=>t.columnOrder.length&&t.indexPatternId)).map((([t,a])=>{const n=e.indexPatterns[a.indexPatternId],[i,l,s]=Is(a),r=a.columnOrder.find((e=>a.columns[e].isBucketed&&"date"===a.columns[e].dataType)),o=(null==n?void 0:n.timeFieldName)&&n.getFieldByName(n.timeFieldName),u=1===i.length&&i.some((e=>"number"===a.columns[e].dataType)),c=[];return c.push(Uc({state:e,layerId:t,changeType:"unchanged"})),!s.length&&l.length&&0===i.length?(o&&i.length<1&&!_s(a)&&c.push(ad(e,t,o)),n&&c.push(...function(e,t,a){const n=a.layers[t],i=[];return n.columnOrder.filter((e=>!Fs(n,e))).forEach((l=>{const s=n.columns[l];if(!vl(s))return;const r=e.getFieldByName(s.sourceField);if(!r)return;const o=xs(r).filter((({type:e})=>e!==s.operationType));if(o.length){const s=ds({layer:n,indexPattern:e,field:r,columnId:l,op:o[0].type,visualizationGroups:[]});s&&i.push(Uc({state:a,layerId:t,updatedLayer:s,changeType:"initial"}))}})),i}(n,t,e))):(c.push(...function(e,t){const a=e.layers[t],[n,i]=Object(Se.partition)(a.columnOrder,(e=>a.columns[e].isBucketed)),l=i.filter((e=>!Fs(a,e)));return Object(Se.flatten)(n.map(((e,t)=>{const s=n.slice(0,t+1),r={...a,columnOrder:[...s,...i],noBuckets:!1};return s.length>0&&l.length>1?[{...a,columnOrder:[...s,l[0],...Cs(a,l[0])],noBuckets:!1}]:n.length>1?r:[]}))).concat(n.length>0||l.length>1?l.map((e=>({...a,columnOrder:[e,...Cs(a,e)],noBuckets:!0}))):[]).map((({noBuckets:a,...n})=>Uc({state:e,layerId:t,updatedLayer:n,changeType:"reduced",label:a?nd(n,1===i.length):void 0})))}(e,t)),!r&&o&&i.length<2&&!u&&!_s(a)&&c.push(ad(e,t,o)),2===i.length&&c.push(function(e,t){var a,n;const i=e.layers[t],[l,s,...r]=i.columnOrder,o={...i,columnOrder:[s,l,...r]},u=e.indexPatterns[e.currentIndexPatternId],c=i.columns[l],d=vl(c)&&(null===(a=u.getFieldByName(c.sourceField))||void 0===a?void 0:a.displayName)||"",p=i.columns[s];return Uc({state:e,layerId:t,updatedLayer:o,label:td([vl(p)&&(null===(n=u.getFieldByName(p.sourceField))||void 0===n?void 0:n.displayName)||"",d]),changeType:"reorder"})}(e,t))),c})))}function ed(e,t,a,n){const[i]=xs(n);if(i)return Uc({layerId:t,state:a,changeType:"initial",updatedLayer:cs({layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(ea.a)(),op:i.type,field:"count"===i.type?ml:n,indexPattern:e,visualizationGroups:[]})})}function td([e,t]){return u.i18n.translate("xpack.lens.indexpattern.suggestions.nestingChangeLabel",{defaultMessage:"{innerOperation} for each {outerOperation}",values:{innerOperation:t,outerOperation:e}})}function ad(e,t,a){const n=e.layers[t];return Uc({state:e,layerId:t,updatedLayer:cs({layer:n,indexPattern:e.indexPatterns[n.indexPatternId],field:a,op:"date_histogram",columnId:Object(ea.a)(),visualizationGroups:[]}),label:u.i18n.translate("xpack.lens.indexpattern.suggestions.overTimeLabel",{defaultMessage:"Over time"}),changeType:"extended"})}function nd(e,t){const{operationType:a,label:n}=e.columns[e.columnOrder[0]];return u.i18n.translate("xpack.lens.indexpattern.suggestions.overallLabel",{defaultMessage:"{operation} overall",values:{operation:t?au[a].displayName:n},description:"Title of a suggested chart containing only a single numerical metric calculated over all available data"})}function id({indexPatternRefs:e,isMissingCurrent:t,indexPatternId:a,onChangeIndexPattern:n,trigger:r,selectableProps:o}){const[c,p]=Object(l.useState)(!1),m=t?{color:"danger"}:{};return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(f.EuiPopover,{panelClassName:"lnsChangeIndexPatternPopover",button:function(){const{label:e,title:t,...a}=r;return Object(y.jsx)(d.ToolbarButton,i()({title:t,onClick:()=>p(!c),fullWidth:!0},m,a),e)}(),panelProps:{"data-test-subj":"lnsChangeIndexPatternPopover"},isOpen:c,closePopover:()=>p(!1),display:"block",panelPaddingSize:"none",ownFocus:!0},Object(y.jsx)("div",null,Object(y.jsx)(f.EuiPopoverTitle,{paddingSize:"s"},u.i18n.translate("xpack.lens.indexPattern.changeDataViewTitle",{defaultMessage:"Data view"})),Object(y.jsx)(zl.DataViewsList,{dataViewsList:e,onChangeDataView:e=>{Object(fn.e)("indexpattern_changed"),n(e),p(!1)},currentDataViewId:a,selectableProps:o}))))}function ld({state:e,layerId:t,onChangeIndexPattern:a}){const n=e.layers[t],i=e.indexPatterns[n.indexPatternId],l=u.i18n.translate("xpack.lens.layerPanel.missingDataView",{defaultMessage:"Data view not found"});return Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(id,{"data-test-subj":"indexPattern-switcher",trigger:{label:(null==i?void 0:i.title)||l,title:(null==i?void 0:i.title)||l,"data-test-subj":"lns_layerIndexPatternLabel",size:"s",fontWeight:"normal"},indexPatternId:n.indexPatternId,indexPatternRefs:e.indexPatternRefs,isMissingCurrent:!i,onChangeIndexPattern:a}))}const sd=({title:e,titleId:t,...a})=>Object(y.jsx)("svg",{width:"176",height:"176",viewBox:"0 0 176 176",xmlns:"http://www.w3.org/2000/svg"},Object(y.jsx)("path",{d:"M88 152c35.346 0 64-28.654 64-64 0-13.35-4.087-25.745-11.079-36.002L51.998 140.92C62.255 147.913 74.65 152 88 152zm-58.277-.083l-5.64-5.64 15.93-15.929C30.047 119.064 24 104.238 24 88c0-35.346 28.654-64 64-64 16.238 0 31.064 6.047 42.348 16.013l15.929-15.93 5.64 5.64L29.723 151.917z",fill:"#F9B110"}),Object(y.jsx)("path",{d:"M87.992 151.961h-2.248a76.025 76.025 0 01-.679-.027v-36.978h-7.102l5.87-5.869h1.232v-1.233L90.92 102v7.087h28.52a121.923 121.923 0 001.806-21.048 122.722 122.722 0 00-.951-15.414l10.102-10.102H146.7a67.977 67.977 0 012.211 5.869h-23.228a132.499 132.499 0 011.432 19.647 132.001 132.001 0 01-1.65 21.048h22.963a64.832 64.832 0 01-2.366 5.838h-21.687c-2.957 13.793-8.126 25.36-14.758 33.315a63.132 63.132 0 01-4.943 1.567 63.66 63.66 0 01-7.399 1.526c9.248-5.54 16.955-19.087 20.982-36.377H90.919v36.979c-.22.01-.442.018-.663.026h-2.264zm35.642-93.956l-10.387 10.387 10.387-10.386zM90.919 90.721l-5.854 5.853 5.854-5.854zm0-11.28l-5.854 5.854V68.392h-28.77a122.988 122.988 0 00.25 40.695h4.728l-8.941 8.941a111.251 111.251 0 01-.707-3.072H29.94l-.22-.509c-.755-1.75-1.523-3.529-2.162-5.36H50.52a132.014 132.014 0 01-1.65-21.017 134.648 134.648 0 011.432-19.647H27.09a67.9 67.9 0 012.21-5.869h21.967c2.88-14.4 8.173-26.497 15.039-34.732a64.165 64.165 0 0112.454-3.114c-9.527 5.683-17.42 19.834-21.344 37.815h27.68V24.117c.966-.078 1.93-.078 2.912-.078.492 0 .98.02 1.467.039.483.02.963.039 1.444.039v38.375h16.949l-5.9 5.9h-11.05v11.049zm25.363-25.363l4.804-4.804c-2.947-8.592-6.862-15.903-11.486-21.483a64.417 64.417 0 00-12.454-3.114c7.985 4.762 14.822 15.473 19.136 29.401zM54.881 126.76l4.74-4.74-4.74 4.74zm11.802-11.803l5.87-5.869-5.87 5.869zm-4.036 15.316l-4.551 4.551c2.385 5.173 5.168 9.702 8.271 13.429a63.532 63.532 0 0012.27 3.068c-6.257-3.801-11.806-11.256-15.99-21.048z",fill:"#FEC514"}),Object(y.jsx)("path",{d:"M115.909 138.807c.444-.825.878-1.669 1.299-2.534a1.56 1.56 0 011.223.823c.156.498-.732 1.868-1.401 2.055a1.381 1.381 0 01-1.121-.344zm-5.488-2.505c-.226.416-.455.826-.687 1.23a5.47 5.47 0 01-1.048.171 1.03 1.03 0 01-.826-.342 1.284 1.284 0 010-1.043c.172-.249.701-.514.919-.421.439.311.975.454 1.51.405h.132zm3.41-7.241l-.084.207c-.191.429-.39.896-.578 1.352a.959.959 0 01-.293-.295.958.958 0 01-.143-.39.764.764 0 01.623-.872c.156-.038.319-.039.475-.002zm-28.766 20.867v2.004c-.352-.013-.705-.044-1.057-.074-.464-.04-.928-.08-1.392-.081l-.02-.002c.377-.244.81-.388 1.259-.419a1.83 1.83 0 01.902.125.99.99 0 01-.124-.296 1.715 1.715 0 01.432-1.257zm0-4.223v3.069a1.278 1.278 0 01-.12-.578v-.654a2.033 2.033 0 01-2.149.28 8.458 8.458 0 01-1.697-1.463 1.323 1.323 0 01.39-2.179 2.57 2.57 0 01-1.075-.779 2.03 2.03 0 01-.234.67c-.128.235-.31.437-.529.591-.273.225-.6.376-.95.436.078.027.15.064.219.109a1.402 1.402 0 01.155 1.884 1.438 1.438 0 01-.94.79 1.424 1.424 0 01-1.208-.23 1.415 1.415 0 01-.639-1.79 2.202 2.202 0 011.557-.825l-.249-.109a2.45 2.45 0 01-1.183-1.464c-.327-.327-.576-.685-.483-.856.183-.217.42-.383.685-.482.67-1.075 1.293-1.23 2.647-.576.431.189.79.511 1.028.918a2.477 2.477 0 011.043-1.728 14.152 14.152 0 011.946-.483c-.032-.669.373-1.058 1.198-1.058h.094a.682.682 0 01.494-.11v1.56a.449.449 0 01-.541-.002c-.348.373-.329.766-.307 1.21.005.112.011.227.011.346a2.085 2.085 0 01-1.043 2.024c.717.367 1.355.87 1.88 1.479zm0-3.296v.909a1.091 1.091 0 01-.136-.259.718.718 0 01.136-.65zm0-7.629v2.477a1.282 1.282 0 01-.875.557 1.276 1.276 0 01-1.005-.282 1.247 1.247 0 01-.545-1.759 2.208 2.208 0 012.289-.856l.136-.137zM65.94 147.731c.142.176.284.349.427.521a67.88 67.88 0 01-.447-.163v-.22c0-.037.011-.096.02-.138zm-5.292-7.889c.449.801.908 1.582 1.378 2.341a1.427 1.427 0 01-.325-.105 1.154 1.154 0 01-.81-.42.86.86 0 010-.296 1.87 1.87 0 01-.243-1.52zm-1.22-2.279c.247.485.5.963.755 1.435a.851.851 0 01-.413.569.85.85 0 01-.746.051 5.625 5.625 0 00-.7-.171 2.195 2.195 0 01-1.309 2.335 2.055 2.055 0 01-2.382-1.074v-.234a1.551 1.551 0 01-.778-.155 1.871 1.871 0 01-.716 1.323 62.51 62.51 0 01-1.112-.75l4.416-4.417a1.727 1.727 0 011.18.294 1.786 1.786 0 001.804.794zm-1.184-2.421c.125.269.251.535.379.8a1.056 1.056 0 01-.379-.8zm-13.376-9.65l-.904.904a.94.94 0 01.255-.54.76.76 0 01.65-.364zm2.423-2.423l-.1.099a.38.38 0 00-.077-.099h.177zm-16.669-8.113h4.681a.946.946 0 01-.005.127c-.23.447-.597.517-.97.588a5.091 5.091 0 00-.244.05l-.436.109h.109a2.026 2.026 0 011.557 1.464h.187a1.076 1.076 0 011.276.794 1.119 1.119 0 01-.685 1.354.981.981 0 01-1.152-.56 2.466 2.466 0 01-1.946.934 1.738 1.738 0 01-.723-.324 62.044 62.044 0 01-.78-1.42 3.119 3.119 0 01.009-.701 1.56 1.56 0 01.56-1.152 1.992 1.992 0 01-1.438-1.263zm48.905 35.918c.048.187.048.383.001.57a15.906 15.906 0 01-.217-.029l-.656-.105c-.292-.175-.584-.377-.876-.578l-.107-.074-.185-.127c.129-.249.323-.459.56-.607a1.017 1.017 0 010-.763 1.424 1.424 0 011.044-.716 1.082 1.082 0 011.122.95 1.09 1.09 0 01-.064.529 1.23 1.23 0 01-.653.561c.031.127.042.258.03.389zm-17.312-4.437c.01.053.014.108.012.162a63.978 63.978 0 01-6.015-3.039c.159-.192.366-.339.601-.423a3.55 3.55 0 011.059-.576c.421-.141.763.021 1.118.188.275.13.557.263.89.263a2.281 2.281 0 011.76.841c.309.4.468.895.45 1.401a4.07 4.07 0 010 .747c.055.141.097.287.125.436zm29.171 5.475a64.518 64.518 0 003.223-.249 1.388 1.388 0 00-1.133-.618 5.86 5.86 0 00-1.277.016c.228-.447.294-.959.187-1.448a1.852 1.852 0 00-1.463-1.355v3.659c.154 0 .309-.002.463-.005zm25.699-6.887c.331-.17.661-.342.989-.517l.139-.079c.074-.174.121-.358.14-.545a1.67 1.67 0 00-.576-1.479 4.637 4.637 0 01-.44-.319h-.001c-.337-.265-.656-.516-1.007-.428a1.035 1.035 0 00-.747.544c-.041.066-.09.127-.141.19-.143.177-.299.369-.31.713a2.223 2.223 0 00.747 1.806c.229.17.496.282.778.327l.228-.113.201-.1zm-72.85-92.93a1.65 1.65 0 00-1.558-2.896 1.697 1.697 0 00-.654 2.304 1.76 1.76 0 002.211.592zM38.77 55.8a2.07 2.07 0 00.98-2.522 1.977 1.977 0 00-2.428-1.12 2.008 2.008 0 00-1.417 2.303 2.6 2.6 0 002.865 1.34zm4.24-2.034c.115-.084.245-.144.383-.176a1.557 1.557 0 011.915.716 1.23 1.23 0 01-.7 1.556 1.774 1.774 0 01-1.993-.965 1.06 1.06 0 01.395-1.13zm-5.813 4.39a1.09 1.09 0 01.747-.13c.883.073.878.723.873 1.377v.149c1.82.14 2.226.42 2.226 1.323a2.322 2.322 0 01-1.106 1.635h-1.292a2.429 2.429 0 01-.7-2.008 13.872 13.872 0 00-.46-.39c-.275-.23-.539-.449-.77-.7a.825.825 0 010-.67 1.09 1.09 0 01.482-.586zm-6.4 13.32a.903.903 0 01.31-.311.951.951 0 011.292.685.638.638 0 010 .265c.087-.11.186-.21.296-.296a.606.606 0 01.856.171c.438.015.864.15 1.23.39a1.246 1.246 0 01.374 1.556 1.853 1.853 0 01-1.868.654 1.853 1.853 0 01-.748-1.37 1.168 1.168 0 01-.498-.607.778.778 0 01-.84.109 1.12 1.12 0 01-.53-.825.904.904 0 01.127-.42zm9.3 11.502c.233 0 .529-.265.575-.498.047-.234-.155-.608-.435-.623a.544.544 0 00-.577.39.81.81 0 00.436.73zm-.05 14.544c.186-.389.824-.436 1.65-.124a.795.795 0 01.576 1.105c-.28.483-1.168.919-1.557.732a1.774 1.774 0 01-.67-1.713zm2.163 8.672c.42-.281.903.015 1.043.529.11.374.14.732-.327.919a1.057 1.057 0 01-1.166-.312 1.073 1.073 0 01-.204-.373 3.21 3.21 0 01.654-.763zm31.225 18.686a1.095 1.095 0 01-.494.073.751.751 0 01-.434-.522.765.765 0 01.154-.661c.218-.187.888-.576 1.183-.358.296.218.156.965 0 1.183a1.093 1.093 0 01-.409.285zm.705 8.106a1.695 1.695 0 00-.514-2.024.948.948 0 00-1.338.343 1.462 1.462 0 00.218 1.915 1.18 1.18 0 001.634-.234zm.39-1.93a1.425 1.425 0 001.147.149 1.417 1.417 0 00.876-.756 1.714 1.714 0 00-.296-2.18 2.056 2.056 0 00-2.241.638 1.419 1.419 0 00.513 2.149zm-34.748-25.407c-.094.031-.327.062-.42-.125a.31.31 0 01.077-.42c.09-.045.164.015.245.082a.93.93 0 00.098.074c.124.077.093.358 0 .389zm.794-3.425c-.748-.561-1.261-.436-1.869.42-.607.856-.529 1.557 0 1.868a2.453 2.453 0 002.335-.342 1.387 1.387 0 00-.466-1.946zm26.805 26.793a2 2 0 01-.028 1.229c-.312.561-1.417.576-2.382-.062a1.353 1.353 0 01-.28-1.557 1.871 1.871 0 011.992-.623c.334.256.578.61.698 1.013zm4.33-2.196a1.56 1.56 0 00-.856-.171c.14-.257.183-.555.125-.841a1.886 1.886 0 00-2.024-1.183c-.592.14-1.043 1.214-.856 2.024a1.381 1.381 0 001.074 1.074 1.56 1.56 0 00.856 1.557c.654.389 1.355.109 1.868-.732a1.165 1.165 0 00-.186-1.728zm2.602 8.123c-.066.169-.134.346-.235.346-.203.031-.732.031-.794-.233-.062-.265.327-.592.451-.592.234.059.456.159.654.296-.026.052-.05.117-.076.183zM37.789 94.876c.156-.607.498-1.121 1.23-.934.733.198.657.846.58 1.502l-.004.039c-.27.135-.572.19-.872.156.031.31-.047 1.074-.374 1.183-.326.109-.871-.436-.965-.685a1.058 1.058 0 01.218-.934.56.56 0 01.327-.125c-.054-.062-.1-.13-.14-.202zm.47-5.461a.902.902 0 00.171 1.354 1.106 1.106 0 001.557-.124 1.043 1.043 0 00-.327-1.464.935.935 0 00-1.4.234zm45.032 41.572a.693.693 0 01.252-.258.628.628 0 01.607.264c.041.124-.026.281-.108.472a3.526 3.526 0 00-.125.322c-.106-.06-.219-.111-.322-.158-.216-.097-.394-.177-.394-.293a.698.698 0 01.09-.349zm.377-5.24a.704.704 0 00-.847-.192.704.704 0 00-.243.192c-.327.405-.311 1.199.125 1.339.435.14 1.23.327 1.556-.14.29-.414-.204-.853-.493-1.11l-.064-.058a.704.704 0 01-.034-.031zm9.512 1.51c.607-.202 1.666.218 1.448 1.074a2.55 2.55 0 01-3.083 1.51 2.92 2.92 0 01-.623-.467v-2.802a1.265 1.265 0 011.34.311c.148.115.234.214.3.29.15.17.198.224.618.084zm.218 5.075c-.218-.887-1.168-1.556-1.853-1.385a1.735 1.735 0 00-.623.389v2.273c.423.231.911.313 1.386.233a1.266 1.266 0 001.084-.992c.037-.17.04-.346.006-.518zm-1.775 2.6c.483.125.607.67.327 1.137-.265.404-.514.591-.965.404v-1.541c.21-.039.427-.039.638 0zm-11.645.841a1.559 1.559 0 001.915 0c-.202-1.043-.53-1.557-1.074-1.401-.545.155-.903.716-.84 1.401zm-2.989-2.491a2.33 2.33 0 01.343-1.09 2.006 2.006 0 012.475-.607 1.434 1.434 0 011.417-.95 1.798 1.798 0 011.385 1.37 1.417 1.417 0 01-1.09 1.542.947.947 0 01-.716-.281 2.64 2.64 0 01-.358.857 1.82 1.82 0 01-1.759 1.043v.109a2.008 2.008 0 010 2.101.378.378 0 01.171.094 1.066 1.066 0 01.49.713 1.072 1.072 0 01-.194.844 1.137 1.137 0 01-1.463.404.963.963 0 01-.374-1.214 2.446 2.446 0 01-2.008-.716.844.844 0 01-.078-.125.606.606 0 01-.498.234 1.058 1.058 0 01-.794-.529c-.078-.234.156-1.059.342-1.137.187-.078.514.125.763.358a2.649 2.649 0 01.996-1.557 1.552 1.552 0 011.215-.373 1.822 1.822 0 01-.267-1.047c-.028.248-.425.595-.605.595a.727.727 0 01-.623-.358c-.046-.202.25-.56.42-.607.172-.047.81.078.81.327zm3.503-15.615a.343.343 0 00-.14-.404c-.094 0-.327 0-.374.14a.652.652 0 00-.008.29c.004.033.008.061.008.083a.311.311 0 00.514-.109zm2.11 5.675a1.57 1.57 0 01-1.176-.241c-.716-.374-1.12-1.37-.763-1.9a2.105 2.105 0 012.522-.7 1.569 1.569 0 01-.582 2.841zm22.332 14.688a.82.82 0 00.593-.312.816.816 0 00.154-.653c0-.887-.405-1.432-.825-1.432a1.787 1.787 0 00-1.246 1.354c0 .467.794 1.043 1.324 1.043zm2.257-5.262c.234.919-.124 1.868-.763 2.009-.467.14-1.416-.592-1.557-1.153-.14-.56.483-1.307 1.246-1.463a.786.786 0 01.682.048.788.788 0 01.392.559zm.576-5.635c.134-.208-.076-.645-.263-1.034a9.273 9.273 0 01-.142-.305c0-.082-.128-.124-.295-.178a2.951 2.951 0 01-.281-.102c-.063.15-.176.308-.292.47-.256.357-.524.733-.299 1.086a.963.963 0 001.572.063zm-6.679.965c.032.218.016.809-.249.809-.264.047-.576-.358-.576-.482a2.01 2.01 0 01.312-.639c.062.037.137.059.21.081.145.044.283.086.303.231zm-4.763 11.489c.035.209.109.41.218.592a.947.947 0 00-.53.264c-.22.272-.325.618-.296.965.11.623.576.794 1.744.717a5.12 5.12 0 00.327-.888c.332.146.7.195 1.059.14a2.426 2.426 0 001.556-2.537 1.552 1.552 0 00-.513-.81 2.41 2.41 0 00.186-1.261 1.372 1.372 0 001.697.81 1.717 1.717 0 001.436-1.507 1.713 1.713 0 00-.081-.735 1.807 1.807 0 00-1.993-1.401c-.809.14-1.37 1.292-1.214 2.366a1.401 1.401 0 00-.607-.778 2.99 2.99 0 00-3.114.731 1.964 1.964 0 00.311 2.242 1.838 1.838 0 00-.186 1.09zm-.623-6.414c-.203.389-.452.607-.903.389a1.06 1.06 0 01-.579-1.111c.023-.148.077-.289.159-.414.33-.049.665-.049.996 0a.708.708 0 01.463.481.718.718 0 01-.136.655zm2.942.483a2.199 2.199 0 001.339-2.367 1.602 1.602 0 00-2.962-.028 1.605 1.605 0 00-.011 1.227c.249.872 1.027 1.37 1.634 1.168zm1.03-7.534a.744.744 0 01-.267.263c-.202.047-.545-.264-.592-.436-.046-.171.094-.809.343-.809.249 0 .623.436.623.623a.745.745 0 01-.106.359zm-21.61 14.197c0 .638 1.245 1.245 1.68.918.437-.327 0-1.759-.606-1.806a1.077 1.077 0 00-1.075.888zm-41.707-35.246c-.153.45-.455.835-.856 1.09a.983.983 0 01-.841-.234 1.794 1.794 0 01-1.464-.202 1.557 1.557 0 01-.186-1.822c.12-.376.162-.774.124-1.167a2.348 2.348 0 010-.327h-.109a2.043 2.043 0 01-.87-2.218c.07-.275.197-.533.372-.756.178-.24.421-.424.7-.53a1.338 1.338 0 011.168-1.867c.191-.029.385-.029.576 0 .507.177.722.483.928.777.281.401.546.78 1.516.78a.935.935 0 01.53.731c.342-.373 1.152-.638 1.556 0a2.553 2.553 0 01-.996 3.269 2.575 2.575 0 01-1.806 0 1.787 1.787 0 01-1.448 0l-.186-.155a.67.67 0 010 .171c.082.157.154.318.218.483a1.169 1.169 0 011.058.591c.163.447.169.936.016 1.386zm-2.74 2.382a1.748 1.748 0 00-1.977.06 1.742 1.742 0 00-.468.516 1.401 1.401 0 00-.155 1.043h3.69c.046-.623-.359-.981-1.09-1.619zm5.65-.218c.179.195.307.43.374.685.08.379.122.765.125 1.152h-2.942a1.448 1.448 0 01-.312-.981 1.556 1.556 0 01.748-1.105.952.952 0 01.825-.934 1.01 1.01 0 011.183.731c.03.149.03.303 0 .452zm29.206 25.749a2.209 2.209 0 002.413 1.277 1.595 1.595 0 10-1.198-2.958c.123-.109.224-.241.296-.389a.873.873 0 00-.405-1.277 1.152 1.152 0 00-1.463.405 1.12 1.12 0 00.466 1.432.93.93 0 00.576 0 1.323 1.323 0 00-.685 1.51zm7.771 8.671c-.383.198-.808.418-1.014.296a.976.976 0 01-.382-.806.978.978 0 01.429-.782c.323-.229.687.016 1.043.254.175.118.349.235.513.291-.043.098-.075.2-.104.291-.053.169-.095.301-.176.301-.096.044-.2.098-.308.154v.001zm29.141-.887c-.171-.405.218-.903 1.012-1.308a.793.793 0 011.168.39 1.56 1.56 0 01-.452 1.556 1.769 1.769 0 01-1.728-.638zm-22.48 7.146c-.98-.592-1.868-.576-2.258 0a1.932 1.932 0 00.436 2.039 1.988 1.988 0 002.087-.763.877.877 0 00.147-.696.885.885 0 00-.412-.58zm-12.75-7.566c.133.054.266.095.382.13.184.056.327.099.365.166.017.03-.025.139-.086.302-.163.429-.465 1.227-.194 1.893a2.384 2.384 0 003.118.885c.354-.181.658-.448.883-.776a1.963 1.963 0 00-.172-2.164c-.286-.286-.75-.45-1.13-.584-.323-.113-.586-.206-.629-.335-.031-.094.045-.269.143-.494.192-.444.468-1.081.169-1.67a1.555 1.555 0 00-1.247-.869c.15.013.302.012.453-.003a1 1 0 00.812-.909.996.996 0 00-.065-.429 1.37 1.37 0 00-1.557-1.028 1.356 1.356 0 00-.98 1.557 1.229 1.229 0 001.151.841c-.27.001-.539.048-.793.14a2.951 2.951 0 00-1.308 2.444.959.959 0 00-.779-.218c-.38.15-.698.424-.903.778a24.62 24.62 0 001.09 1.557c.237.037.479.037.716 0a.824.824 0 00.592-1.09.125.125 0 01-.031-.124zm-2.058-3.606a1.82 1.82 0 01-1.056.757 2.143 2.143 0 01-.591.062 65.347 65.347 0 01-3.379-6.772 1.744 1.744 0 011.557 1.355c.1.446.1.908 0 1.354a2.224 2.224 0 012.74-.498 2.1 2.1 0 01.872 2.133.73.73 0 01.14.342 1.82 1.82 0 01-.283 1.267zm25.659 7.513a1.135 1.135 0 00-.436-.918 1.292 1.292 0 001.276-1.199c0-.682-.381-1.081-.606-1.316-.11-.114-.182-.19-.156-.241l.014-.027c.113-.222.594-1.159-.014-1.529a1.558 1.558 0 00-1.043-.25 1.716 1.716 0 00-.857-1.307 1.273 1.273 0 00-.871-.249v3.923c.196.214.216.417.236.627.032.322.065.661.744 1.085.194.117.404.206.623.265-.278.067-.518.24-.67.483a1.098 1.098 0 00-.215.823 1.098 1.098 0 00.433.733h.187c-.16.307-.204.66-.124.997a.58.58 0 00.14.218 1.32 1.32 0 00-.576 1.432 1.108 1.108 0 001.36.57c.17-.059.323-.158.446-.29a1.463 1.463 0 00.233-1.23h.203a1.37 1.37 0 001.183-1.479 1.82 1.82 0 00-1.51-1.121zm-21.375 1.744a2.711 2.711 0 011.557-1.339 1.571 1.571 0 011.219.229 1.564 1.564 0 01.665 1.048 1.929 1.929 0 01-.654 2.039 1.284 1.284 0 01-.094.327c-.047.066-.1.129-.156.187a34.636 34.636 0 01-2.537-2.491zm39.807-.887a.573.573 0 000 .7.79.79 0 00.825.156c.218-.125.141-.561 0-.763a.608.608 0 00-.825-.093zm14.121-10.309a.99.99 0 01.404.516c.203.545-.373 1.293-1.261 1.744a4.745 4.745 0 01-.08.425c-.046.213-.091.421-.091.618-.552.444-1.17.398-1.759.353-.175-.013-.347-.026-.514-.026a.717.717 0 01-.389-1.261 20.077 20.077 0 011.697-1.152c.202-1.043.467-1.37 1.354-1.37a.994.994 0 01.639.153zm-5.558-1.57s-.327.389-.28.514c.046.125.389.576.653.529.265-.046.312-.622.249-.716a1.055 1.055 0 00-.622-.327zm-25.084 18.02c0-.097.029-.191.082-.272.186-.312.731-.14.794-.031a.873.873 0 01.217.451l-1.011.125a.5.5 0 01-.081-.273zm28.244-19.374c.374-.498-.592-1.557-1.277-1.557-.685 0-1.276.887-1.058 1.386.218.498 1.977.669 2.335.171zm-14.163.217c.122-.254.339-.449.603-.544a1.556 1.556 0 011.604.856c.124.389-.483 1.246-.981 1.37a1.202 1.202 0 01-1.277-.872 1.074 1.074 0 01.051-.81zm-10.434 12.159a1.806 1.806 0 00-2.367.639 2.116 2.116 0 00-.296 1.074 1.674 1.674 0 00-1.005.805 1.664 1.664 0 00-.131 1.281 2.102 2.102 0 002.366 1.557 2.225 2.225 0 001.557-1.9 1.29 1.29 0 00.358-.358 2.46 2.46 0 00-.483-3.098zm-1.448 6.663c-.25-.28-.405-.622-.25-.825a2.573 2.573 0 011.806-.28c-.499.396-1.018.765-1.556 1.105zm2.475-8.936a.964.964 0 00-.607.432.946.946 0 00-.11.736.899.899 0 00.738.792.905.905 0 00.384-.014 1.087 1.087 0 00.903-1.229 1.035 1.035 0 00-.504-.633 1.058 1.058 0 00-.804-.084zm1.885 4.474c.233-.382.582-.678.995-.846a2.119 2.119 0 011.588-1.65c.19-.04.386-.04.576 0a36.783 36.783 0 01-3.456 3.767c-.039-.445.065-.89.297-1.271zm1.275-6.669c-.404-.529-.84-1.043-1.556-.591-.717.451-.468 1.012-.125 1.557a1.204 1.204 0 001.681-.966zm-1.276 3.441c-.031-.218.233-.95.623-.856a.882.882 0 01.591.762.842.842 0 01-.576.592.789.789 0 01-.638-.498zM48.469 56.236c.124.078.093.39 0 .39a.358.358 0 01-.514-.11.311.311 0 01.171-.42c.093-.047.17.011.254.076.028.022.057.045.089.064zm-5.154 5.511c-.34.133-.617.389-.778.716h3.27a2.382 2.382 0 00-2.492-.716zm5.574.467c-.42.125-.7-.311-.7-.467a.794.794 0 01.342-.607c.062-.062.467.031.514.233.006.028.015.06.026.098.067.237.181.635-.182.743zm-14.89 57.962c.329-.39.793-.641 1.299-.703a1.933 1.933 0 011.557 1.915 3.114 3.114 0 01-.965 1.728c.28.244.494.554.622.903.12.557.03 1.138-.249 1.635a60.352 60.352 0 01-2.74-4.079 2.025 2.025 0 01.476-1.399zm-6.5-19.898c-.016-.218.015-.81.295-.81.327-.062.607.405.607.561a.748.748 0 01-.436.56c-.202.062-.451-.093-.466-.311zM39.5 126.759a1.12 1.12 0 00.56 2.148 1.337 1.337 0 00.701-1.556 1.045 1.045 0 00-1.261-.592zm-9.496-65.806c.294.122.576.274.84.452a1.417 1.417 0 01.608 1.105h-2.117l.15-.354c.168-.401.339-.807.519-1.203zm1.728-1.277c.623.265 1.059-.077 1.37-.7l-.066-.126c-.24-.465-.49-.947-1.133-.761a1.169 1.169 0 00-.576.84.872.872 0 00.405.747zm8.593 62.907a1.703 1.703 0 01-.218-.592 1.838 1.838 0 01.187-1.09 1.963 1.963 0 01-.311-2.242 2.995 2.995 0 013.114-.731c.29.177.505.454.607.778-.156-1.074.404-2.226 1.214-2.366a1.804 1.804 0 011.993 1.401 1.71 1.71 0 01-.666 1.971 1.718 1.718 0 01-.689.271 1.372 1.372 0 01-1.697-.81c.052.43-.012.865-.186 1.261.252.209.431.493.513.81a2.428 2.428 0 01-1.556 2.537 1.913 1.913 0 01-1.06-.14 5.15 5.15 0 01-.326.888c-1.168.077-1.635-.094-1.744-.717-.03-.347.077-.693.296-.965a.947.947 0 01.53-.264zM32.784 83.58a1.698 1.698 0 00-.514-2.024.951.951 0 00-1.339.343 1.464 1.464 0 00.218 1.914 1.183 1.183 0 001.635-.233zm.947-1.733a1.418 1.418 0 01-.558-.198 1.416 1.416 0 01-.514-2.148 2.055 2.055 0 012.242-.638 1.712 1.712 0 01.296 2.18 1.418 1.418 0 01-1.466.804zm-3.376-4.432a1.556 1.556 0 00-.856-.171c.139-.257.183-.555.125-.841A1.884 1.884 0 0027.6 75.22c-.592.14-1.043 1.214-.856 2.024a1.386 1.386 0 001.074 1.074 1.556 1.556 0 00.856 1.557c.654.389 1.355.109 1.868-.732a1.168 1.168 0 00-.187-1.728zm.537 10.57c.022-.385.14-.76.343-1.09a2.008 2.008 0 012.475-.606 1.432 1.432 0 011.417-.95 1.79 1.79 0 011.385 1.37 1.416 1.416 0 01-1.09 1.541.949.949 0 01-.716-.28 2.644 2.644 0 01-.358.856 1.821 1.821 0 01-1.759 1.043v.11a2.008 2.008 0 010 2.101.373.373 0 01.171.093 1.072 1.072 0 01.296 1.557 1.137 1.137 0 01-1.463.405.965.965 0 01-.374-1.214 2.444 2.444 0 01-2.008-.717.871.871 0 01-.078-.124.607.607 0 01-.498.234 1.06 1.06 0 01-.794-.53c-.078-.233.156-1.058.342-1.136.187-.078.514.124.763.358a2.646 2.646 0 01.997-1.557 1.554 1.554 0 011.214-.374 1.82 1.82 0 01-.266-1.046c-.03.248-.426.595-.606.595a.732.732 0 01-.623-.358c-.046-.203.25-.56.42-.607.172-.047.81.078.81.327zm9.178-14.29a1.57 1.57 0 001.759-2.6 2.102 2.102 0 00-2.522.7c-.358.53.047 1.526.763 1.9z",fill:"#EA9600"}));a(353);const rd={id:"lnsGeoFieldWorkspace",humanData:{label:u.i18n.translate("xpack.lens.geoFieldWorkspace.dropZoneLabel",{defaultMessage:"drop zone to open in maps"})}},od=[1,0,0,0];function ud(e){return Object(y.jsx)(f.EuiPageContentBody,{className:"lnsWorkspacePanelWrapper__pageContentBody"},Object(y.jsx)(f.EuiText,{className:"lnsWorkspacePanel__emptyContent",textAlign:"center",size:"s"},Object(y.jsx)("h2",null,Object(y.jsx)("strong",null,Object(Fc.getVisualizeGeoFieldMessage)(e.fieldType))),Object(y.jsx)(sd,{"aria-hidden":!0,className:"lnsWorkspacePanel__promptIllustration"}),Object(y.jsx)(jc.c,{className:"lnsVisualizeGeoFieldWorkspacePanel__dragDrop",dataTestSubj:"lnsGeoFieldWorkspace",draggable:!1,dropTypes:["field_add"],order:od,value:rd,onDrop:function(){e.uiActions.getTrigger(vc.VISUALIZE_GEO_FIELD_TRIGGER).exec({indexPatternId:e.indexPatternId,fieldName:e.fieldName,originatingApp:Tc.APP_ID})}},Object(y.jsx)("p",null,Object(y.jsx)("strong",null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.geoFieldWorkspace.dropMessage",defaultMessage:"Drop field here to open in Maps"}))))))}function cd(e,t,a){var n;const{dataType:i,label:l,isBucketed:s,scale:r,operationType:o,timeShift:u}=e,c="sourceField"in e?null==a||null===(n=a.getFieldByName(e.sourceField))||void 0===n?void 0:n.esTypes:void 0;return{dataType:yl(i),isBucketed:s,scale:r,label:t||l,isStaticValue:"static_value"===o,sortingHint:"string"===e.dataType&&null!=c&&c.includes(Ja.ES_FIELD_TYPES.VERSION)?"version":void 0,hasTimeShift:Boolean(u)}}function dd({core:e,storage:t,data:a,unifiedSearch:n,dataViews:l,fieldFormats:s,charts:o,dataViewFieldEditor:p,uiActions:m}){const g=e.uiSettings,f=t=>e.notifications.toasts.addError(t,{title:u.i18n.translate("xpack.lens.indexPattern.dataViewLoadError",{defaultMessage:"Error loading data view"})}),b=l,h=(e,a,n)=>{!async function({id:e,state:t,setState:a,onError:n,storage:i,indexPatternsService:l}){const s=await mu({indexPatternsService:l,cache:t.indexPatterns,patterns:[e]});if(null==s[e])return n(Error("Missing indexpatterns"));try{a((a=>({...a,layers:xu(t.layers)?Object(Se.mapValues)(t.layers,(t=>Ms(t,s[e]))):t.layers,indexPatterns:{...a.indexPatterns,[e]:s[e]},currentIndexPatternId:e})),{applyImmediately:!0}),gu(i,e)}catch(e){n(e)}}({id:e,state:a,setState:n,onError:f,storage:t,indexPatternsService:b})},x={id:"indexpattern",initialize:async(a,n,i,l)=>async function({persistedState:e,references:t,defaultIndexPatternId:a,storage:n,indexPatternsService:i,initialContext:l,options:s}){var r;const{isFullEditor:o}=null!=s?s:{},u=await(o?async function(e){return(await e.getIdsWithTitle()).sort(((e,t)=>e.title.localeCompare(t.title)))}(i):[]),c=((e,t)=>{var a;const n=Object(du.a)(e,"indexPatternId");return n&&(null===(a=t.find((e=>e.id===n)))||void 0===a?void 0:a.id)})(n,u),d=c||a||(null===(r=u[0])||void 0===r?void 0:r.id),p=[];if(l&&"isVisualizeAction"in l)for(let e=0;e<l.layers.length;e++){const t=l.layers[e];p.push(t.indexPatternId)}else l&&p.push(l.indexPatternId);const m=e&&t?bu(e,t):void 0,g=(l?p:Object(Se.uniq)(m?Object.values(m.layers).map((e=>e.indexPatternId)):[d])).filter(Boolean),f=Object(Se.difference)(Object(Se.uniq)(u.map((({id:e})=>e))),g),b=new Set(u.map((({id:e})=>e))),h=await mu({indexPatternsService:i,cache:{},patterns:g,notUsedPatterns:f}),x=[...p,...g,...f].filter((e=>null!=e&&b.has(e)&&h[e]))[0];return x&&gu(n,x),{layers:{},...m,currentIndexPatternId:x,indexPatternRefs:u,indexPatterns:h,existingFields:{},isFirstExistenceFetch:!0}}({persistedState:a,references:n,defaultIndexPatternId:e.uiSettings.get("defaultIndex"),storage:t,indexPatternsService:b,initialContext:i,options:l}),getPersistableState:e=>function({layers:e}){const t=[],a={};return Object.entries(e).forEach((([e,{indexPatternId:n,...i}])=>{t.push({type:"index-pattern",id:n,name:fu(e)}),a[e]=i})),{savedObjectReferences:t,state:{layers:a}}}(e),getCurrentIndexPatternId:e=>e.currentIndexPatternId,insertLayer:(e,t)=>({...e,layers:{...e.layers,[t]:pd(e.currentIndexPatternId)}}),removeLayer(e,t){const a={...e.layers};return delete a[t],{...e,layers:a}},clearLayer:(e,t)=>({...e,layers:{...e.layers,[t]:pd(e.currentIndexPatternId)}}),getLayers:e=>Object.keys(e.layers),removeColumn({prevState:e,layerId:t,columnId:a}){var n;const i=e.indexPatterns[null===(n=e.layers[t])||void 0===n?void 0:n.indexPatternId];return yu({state:e,layerId:t,newLayer:Os({layer:e.layers[t],columnId:a,indexPattern:i})})},initializeDimension(e,t,{columnId:a,groupId:n,staticValue:i}){var l;const s=e.indexPatterns[null===(l=e.layers[t])||void 0===l?void 0:l.indexPatternId];return null==i?e:yu({state:e,layerId:t,newLayer:cs({layer:e.layers[t],op:"static_value",columnId:a,field:void 0,indexPattern:s,visualizationGroups:[],initialParams:{params:{value:i}},targetGroup:n})})},toExpression:(e,t)=>function(e,t,a){return e.layers[t]?function(e,t,a){const{columnOrder:n}=e;if(0===n.length||!t)return null;const i={...e.columns};Object.keys(i).forEach((e=>{const t=i[e],a=au[t.operationType];"references"in t&&a.filterable&&"fullReference"===a.input&&t.filter&&t.references.forEach((e=>{const a=i[e];au[t.operationType].filterable&&(i[e]={...a,filter:t.filter})})),"references"in t&&a.shiftable&&"fullReference"===a.input&&t.timeShift&&t.references.forEach((e=>{const a=i[e];au[t.operationType].shiftable&&(i[e]={...a,timeShift:t.timeShift})}))}));const l=n.map((e=>[e,i[e]])),[s,r]=Object(Se.partition)(l,(([,e])=>{var t,a;return"fullReference"===(null===(t=au[e.operationType])||void 0===t?void 0:t.input)||"managedReference"===(null===(a=au[e.operationType])||void 0===a?void 0:a.input)}));if(s.length||r.length){const n=[],o=[];(function(e){const t={};e.forEach((([e,a])=>{t[e]="references"in a?a.references:[]})),e.forEach((([e])=>{t[e]=t[e].filter((e=>!!t[e]))}));const a=[];for(;a.length<e.length;)Object.keys(t).forEach((e=>{0===t[e].length&&(a.push(e),delete t[e],Object.keys(t).forEach((a=>{t[a]=t[a].filter((t=>t!==e))})))}));return a})(s).forEach((a=>{const n=i[a],l=au[n.operationType];"fullReference"!==l.input&&"managedReference"!==l.input||o.push(...l.toExpression(e,a,t))}));const u=r.map((([e])=>e));r.forEach((([i,l],s)=>{const r=au[l.operationType];if("fullReference"!==r.input&&"managedReference"!==r.input){const i=Boolean(r.filterable&&l.filter);let o=r.toEsAggsFn(l,i?`${s}-metric`:String(s),t,e,a,u);i&&(o=Object(me.buildExpressionFunction)("aggFilteredMetric",{id:String(s),enabled:!0,schema:"metric",customBucket:Object(me.buildExpression)([Object(me.buildExpressionFunction)("aggFilter",{id:`${s}-filter`,enabled:!0,schema:"bucket",filter:l.filter&&Object(mi.queryToAst)(l.filter)})]),customMetric:Object(me.buildExpression)({type:"expression",chain:[o]}),timeShift:l.timeShift}).toAst()),n.push(Object(me.buildExpression)({type:"expression",chain:[o]}))}})),window.ELASTIC_LENS_DELAY_SECONDS&&n.push(Object(me.buildExpression)({type:"expression",chain:[Object(me.buildExpressionFunction)("aggShardDelay",{id:"the-delay",enabled:!0,schema:"metric",delay:`${window.ELASTIC_LENS_DELAY_SECONDS}s`}).toAst()]}));const c=r.reduce(((e,[t,a],n)=>({...e,[window.ELASTIC_LENS_DELAY_SECONDS?`col-${n+(a.isBucketed?0:1)}-${n}`:`col-${n}-${n}`]:{...a,id:t}})),{}),d=l.filter((([,e])=>{var t,a;return Ml("range",e)&&(null===(t=e.params)||void 0===t?void 0:t.parentFormat)||Fl(e)&&(null===(a=e.params)||void 0===a?void 0:a.format)})).map((([e,t])=>{var a;const n="parentFormat"in t.params?t.params.parentFormat:void 0,i=t.params.format;return{type:"function",function:"lens_format_column",arguments:{format:i?[i.id]:[""],columnId:[e],decimals:"number"==typeof(null==i||null===(a=i.params)||void 0===a?void 0:a.decimals)?[i.params.decimals]:[],suffix:null!=i&&i.params&&"suffix"in i.params&&i.params.suffix?[i.params.suffix]:[],parentFormat:n?[JSON.stringify(n)]:[]}}})),p=l.find((([,e])=>"date_histogram"===e.operationType)),m=(p?l.filter((([,e])=>e.timeScale&&au[e.operationType].timeScalingMode&&"disabled"!==au[e.operationType].timeScalingMode)):[]).flatMap((([e,t])=>[{type:"function",function:"lens_time_scale",arguments:{dateColumnId:[p[0]],inputColumnId:[e],outputColumnId:[e],outputColumnName:[t.label],targetUnit:[t.timeScale]}},{type:"function",function:"lens_format_column",arguments:{format:[""],columnId:[e],parentFormat:[JSON.stringify({id:"suffix",params:{unit:t.timeScale}})]}}]));if(0===r.length)return{type:"expression",chain:[{type:"function",function:"createTable",arguments:{ids:[],names:[],rowCount:[1]}},...o,...d,...m]};const g=Object.values(i).map((e=>Ml("date_histogram",e)&&!e.params.ignoreTimeRange?e.sourceField:null)).filter((e=>Boolean(e)));return{type:"expression",chain:[{type:"function",function:"kibana",arguments:{}},Object(me.buildExpressionFunction)("esaggs",{index:Object(me.buildExpression)([Object(me.buildExpressionFunction)("indexPatternLoad",{id:t.id})]),aggs:n,metricsAtAllLevels:!1,partialRows:!1,timeFields:g}).toAst(),{type:"function",function:"lens_rename_columns",arguments:{idMap:[JSON.stringify(c)]}},...o,...d,...m]}}return null}(e.layers[t],e.indexPatterns[e.layers[t].indexPatternId],a):null}(e,t,g),renderDataPanel(t,n){Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(Rc,i()({changeIndexPattern:h,data:a,dataViews:l,fieldFormats:s,charts:o,indexPatternFieldEditor:p},n,{core:e,uiActions:m})))),t)},uniqueLabels(e){const t=e.layers,a={},n={};return Object.values(t).forEach((e=>{e.columns&&Object.entries(e.columns).forEach((([e,t])=>{a[e]=(e=>{let t=e;for(;n[t]>=0;){const a=++n[t];t=u.i18n.translate("xpack.lens.indexPattern.uniqueLabel",{defaultMessage:"{label} [{num}]",values:{label:e,num:a}})}return n[t]=0,t})(t.label)}))})),a},isValidColumn:(e,t,a)=>{const n=e.layers[t];return!vu(n,a,e.indexPatterns[n.indexPatternId])},renderDimensionTrigger:(n,l)=>{const o=x.uniqueLabels(l.state);Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(d.KibanaContextProvider,{services:{appName:"lens",storage:t,uiSettings:g,data:a,fieldFormats:s,savedObjects:e.savedObjects,docLinks:e.docLinks}},Object(y.jsx)(sc,i()({uniqueLabel:o[l.columnId]},l))))),n)},renderDimensionEditor:(o,u)=>{const p=x.uniqueLabels(u.state);Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(d.KibanaContextProvider,{services:{appName:"lens",storage:t,uiSettings:g,data:a,fieldFormats:s,savedObjects:e.savedObjects,docLinks:e.docLinks,http:e.http}},Object(y.jsx)(rc,i()({uiSettings:g,storage:t,savedObjectsClient:e.savedObjects.client,http:e.http,data:a,unifiedSearch:n,dataViews:l,uniqueLabel:p[u.columnId]},u))))),o)},renderLayerPanel:(a,n)=>{Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(y.jsx)(ld,i()({onChangeIndexPattern:e=>{!async function({indexPatternId:e,layerId:t,state:a,setState:n,onError:i,replaceIfPossible:l,storage:s,indexPatternsService:r}){const o=await mu({indexPatternsService:r,cache:a.indexPatterns,patterns:[e]});if(null==o[e])return i(Error("Missing indexpatterns"));try{n((a=>({...a,layers:{...a.layers,[t]:Ms(a.layers[t],o[e])},indexPatterns:{...a.indexPatterns,[e]:o[e]},currentIndexPatternId:l?e:a.currentIndexPatternId}))),gu(s,e)}catch(e){i(e)}}({indexPatternId:e,setState:n.setState,state:n.state,layerId:n.layerId,onError:f,replaceIfPossible:!0,storage:t,indexPatternsService:b})}},n))),a)},canCloseDimensionEditor:e=>!e.isDimensionClosePrevented,getDropProps:pc,onDrop:gc,getCustomWorkspaceRenderer:(e,t)=>{if(void 0===t.field||void 0===t.indexPatternId)return;const a=t,n=a.field.esTypes&&a.field.esTypes.find((e=>["geo_point","geo_shape"].includes(e)));return n?()=>Object(y.jsx)(ud,{uiActions:m,fieldType:n,indexPatternId:a.indexPatternId,fieldName:a.field.name}):void 0},updateCurrentIndexPatternId:({state:e,indexPatternId:t,setState:a})=>{h(t,e,a)},refreshIndexPatternsList:async({indexPatternId:e,setState:t})=>{const a=await mu({indexPatternsService:l,cache:{},patterns:[e]}),n=await l.getIdsWithTitle(),i=a[e];t((e=>({...e,indexPatterns:{...e.indexPatterns,[i.id]:i},indexPatternRefs:n})))},updateStateOnCloseDimension:({state:e,layerId:t})=>{const a=e.layers[t];if(Object.values(a.incompleteColumns||{}).length)return yu({state:e,layerId:t,newLayer:{...a,incompleteColumns:void 0}})},getPublicAPI({state:e,layerId:t}){const a=x.uniqueLabels(e),n=e.layers[t],i=n.columnOrder.filter((e=>!Fs(n,e)));return{datasourceId:"indexpattern",getTableSpec:()=>{const e={};return Object.keys(n.columns).forEach((t=>{const a=function(e,t){const a=ws(e);let n=t;for(;Fs(e,n);)n=a[n];return n}(n,t);e[a]=e[a]||[];const i=n.columns[t];var l;Ml("terms",i)&&e[a].push(...[i.sourceField].concat(null!==(l=i.params.secondaryFields)&&void 0!==l?l:[])),"sourceField"in i&&i.sourceField!==Tc.DOCUMENT_FIELD_NAME&&e[a].push(i.sourceField)})),i.map(((t,a)=>({columnId:t,fields:[...new Set(e[t]||[])]})))},getOperationForColumnId:t=>n&&n.columns[t]&&!Fs(n,t)?cd(n.columns[t],a[t],e.indexPatterns[n.indexPatternId]):null,getSourceId:()=>n.indexPatternId,getFilters:(a,l)=>function(e,t,a,n,i){const l=function(e,t){const a=Object.keys(e.columns).filter((t=>{const a=e.columns[t],n=au[null==a?void 0:a.operationType];return!(null!=a&&a.isBucketed)&&!Ml("formula",a)&&(null==n?void 0:n.filterable)})),{filtered:n=[],unfiltered:i=[]}=Object(Se.groupBy)(a,(t=>{var a;return null!==(a=e.columns[t])&&void 0!==a&&a.filter?"filtered":"unfiltered"})),l=n.map((t=>{var a;return null===(a=e.columns[t])||void 0===a?void 0:a.filter})).filter((e=>{var t;return null==e||null===(t=e.query)||void 0===t?void 0:t.trim()}));return{enabled:i.length?[]:l,disabled:i.length?l:[]}}(e),[s,r]=["enabled","disabled"].map((e=>Object(Se.groupBy)(l[e],"language"))),o=t.map((t=>{const l=e.columns[t];if(Ml("filters",l)){const e=Object(Se.groupBy)(l.params.filters,(({input:e})=>e.language));return{kuery:Ou(e.kuery),lucene:Ou(e.lucene)}}return Ml("range",l)&&l.sourceField?{kuery:ku(l)}:Ml("date_histogram",l)&&i&&l.sourceField&&!l.params.ignoreTimeRange&&n.timeFieldName!==l.sourceField?n.timeFieldName?{error:u.i18n.translate("xpack.lens.indexPattern.nonDefaultTimeFieldError",{defaultMessage:"Underlying data does not support date histograms on non-default time fields if time field is set on the data view"})}:{kuery:Iu(l,i)}:!Ml("terms",l)||l.params.otherBucket||l.params.missingBucket?void 0:!a||function(e,t){var a;const n=null==e||null===(a=e.columns.find((({id:e})=>Object(k.d)(e)===t)))||void 0===a?void 0:a.id;return!n||n!==t}(a,t)?{kuery:au[l.operationType].getCurrentFields(l).map((e=>({query:`${e}: *`,language:"kuery"})))}:{kuery:Tu(l,t,a)}})).filter(Boolean),c=o.filter((e=>e&&"error"in e));if(c.length)return{error:c.map((({error:e})=>e)).join(", ")};const d=o;return{enabled:{kuery:Mu(s,d,"kuery"),lucene:Mu(s,d,"lucene")},disabled:{kuery:[r.kuery||[]].filter((e=>e.length)),lucene:[r.lucene||[]].filter((e=>e.length))}}}(n,i,null==a?void 0:a[t],e.indexPatterns[n.indexPatternId],l),getVisualDefaults:()=>function(e){return Object.keys(e.columns).reduce(((t,a)=>{const n=e.columns[a];if(null!=n&&n.operationType){var i;const e=au[n.operationType],l=null===(i=e.getDefaultVisualSettings)||void 0===i?void 0:i.call(e,n);l&&(t[a]=l)}return t}),{})}(n)}},getDatasourceSuggestionsForField:(e,t,a)=>jl(t)?function(e,t,a,n){let i=Object.keys(e.layers).filter((a=>e.layers[a].indexPatternId===t));if(n&&(i=i.filter(n)),0===i.length){const n=Object(ea.a)();return Qc(e,n,t,a).concat(Qc({...e,layers:{}},n,t,a))}{const n=Object(Se.minBy)(i,(t=>e.layers[t].columnOrder.length));return 0===e.layers[n].columnOrder.length?Qc(e,n,t,a):function(e,t,a){const n=e.layers[t],i=e.indexPatterns[n.indexPatternId],l=uu(a),s=Zc(a),r=Object.values(n.columns).some((e=>vl(e)&&e.sourceField===a.name)),o=[];if(s&&!r)if("date_histogram"===s&&n.columnOrder.some((e=>"date_histogram"===n.columns[e].operationType))){const l=n.columnOrder.find((e=>"date_histogram"===n.columns[e].operationType));o.push(Uc({state:e,updatedLayer:ds({layer:n,indexPattern:i,field:a,op:s,columnId:l,visualizationGroups:[]}),layerId:t,changeType:"initial"}))}else o.push(Uc({state:e,updatedLayer:cs({layer:n,indexPattern:i,field:a,op:s,columnId:Object(ea.a)(),visualizationGroups:[]}),layerId:t,changeType:"extended"}));if(!s&&l.length>0&&!r){const[l]=xs(a);if(l){const s=cs({layer:n,indexPattern:i,field:a,columnId:Object(ea.a)(),op:l.type,visualizationGroups:[]});s&&o.push(Uc({state:e,layerId:t,updatedLayer:s,changeType:"extended"}));const[,r,u]=Is(n);if(1===r.length&&0===u.length){const s=ds({layer:n,indexPattern:i,field:a,columnId:r[0],op:l.type,visualizationGroups:[]});s&&o.push(Uc({state:e,layerId:t,updatedLayer:s,changeType:"extended"}))}}}if(!r){const n=ed(i,t,e,a);n&&o.push(n)}return o}(e,n,a)}}(e,t.indexPatternId,t.field,a):[],getDatasourceSuggestionsFromCurrentState:Jc,getDatasourceSuggestionsForVisualizeField:Kc,getDatasourceSuggestionsForVisualizeCharts:Yc,getErrorMessages(t){if(!t)return;const a=Object.entries(t.layers).filter((([e,a])=>!!t.indexPatterns[a.indexPatternId])).map((([a,n])=>{var i;return(null!==(i=function(e,t,a,n,i){const l=Object.entries(e.columns),s=l.filter((([t,a])=>!Fs(e,t)&&"managedReference"===au[a.operationType].input)).flatMap((([t])=>Ls(t,e.columns).map((([e])=>e)))),r=l.flatMap((([a,n])=>{if(s.includes(a))return;const i=au[n.operationType];return i.getErrorMessage?i.getErrorMessage(e,a,t,au):void 0})).map((e=>"object"!=typeof e?e:{...e,fixAction:e.fixAction?{...e.fixAction,newState:async t=>({...a,layers:{...a.layers,[n]:await e.fixAction.newState(i,t,n)}})}:void 0})).filter((e=>null!=e));return r.length?r:void 0}(n,t.indexPatterns[n.indexPatternId],t,a,e))&&void 0!==i?i:[]).map((e=>({shortMessage:"",longMessage:"string"==typeof e?e:e.message,fixAction:"object"==typeof e?e.fixAction:void 0})))}));var n;if(a.length<=1)return null!==(n=a[0])&&void 0!==n&&n.length?a[0]:void 0;const i=a.flatMap(((e,t)=>e.map((e=>{const{shortMessage:a,longMessage:n}=e;return{shortMessage:a?u.i18n.translate("xpack.lens.indexPattern.layerErrorWrapper",{defaultMessage:"Layer {position} error: {wrappedMessage}",values:{position:t+1,wrappedMessage:a}}):"",longMessage:n?u.i18n.translate("xpack.lens.indexPattern.layerErrorWrapper",{defaultMessage:"Layer {position} error: {wrappedMessage}",values:{position:t+1,wrappedMessage:n}}):""}}))));return i.length?i:void 0},getWarningMessages:(t,a,n)=>[...Ji(t,a)||[],...ju(t,a,e.docLinks,n)],checkIntegrity:e=>Object.values(e.layers||{}).map((({indexPatternId:e})=>e)).filter((t=>!e.indexPatterns[t])),isTimeBased:e=>{if(!e)return!1;const{layers:t,indexPatterns:a}=e;return Boolean(t)&&Object.values(t).some((e=>{var t;return Boolean(null===(t=a[e.indexPatternId])||void 0===t?void 0:t.timeFieldName)||e.columnOrder.filter((t=>e.columns[t].isBucketed)).some((t=>{const a=e.columns[t];return Ml("date_histogram",a)&&!a.params.ignoreTimeRange}))}))},isEqual:(e,t,a,n)=>Object(Se.isEqual)(bu(e,t),bu(a,n))};return x}function pd(e){return{indexPatternId:e,columns:{},columnOrder:[]}}const md=()=>{const e=new WeakMap;return{insertOrReplaceFormulaColumn:(t,{formula:a,label:n},i,l)=>{const s=(t=>{const a=e.get(t);if(a)return a;const n=pu(t);return e.set(t,n),n})(l);return fl(t,{label:null!=n?n:a,customLabel:Boolean(n),operationType:"formula",dataType:"number",references:[],isBucketed:!1,params:{formula:a}},{...i,indexPatternId:s.id},{indexPattern:s}).layer}}};var gd=a(25);class indexpattern_datasource_IndexPatternDatasource{setup(e,{fieldFormats:t,expressions:n,editorFrame:i,charts:l}){i.registerDatasource((async()=>{const{getIndexPatternDatasource:n,getSuffixFormatter:i,suffixFormatterId:s}=await Promise.resolve().then(a.bind(null,463));if(!t.has(s)){const a=Object(gd.createStartServicesGetter)(e.getStartServices),n=i((()=>a().plugins.fieldFormats.deserialize));t.register([n])}const[r,{dataViewFieldEditor:o,uiActions:u,data:c,fieldFormats:d,dataViews:p,unifiedSearch:m}]=await e.getStartServices();return n({core:r,fieldFormats:d,storage:new gd.Storage(localStorage),data:c,unifiedSearch:m,dataViews:p,charts:l,dataViewFieldEditor:o,uiActions:u})}))}}var fd=a(90);async function bd(e){const t=await Promise.all(e.map((e=>"function"==typeof e?e():e))),a={};return t.forEach((e=>{a[e.id]=e})),a}class service_EditorFrameService{constructor(){xr()(this,"datasources",[]),xr()(this,"visualizations",[]),xr()(this,"loadDatasources",(()=>bd(this.datasources))),xr()(this,"loadVisualizations",(()=>bd(this.visualizations))),xr()(this,"documentToExpression",(async e=>{const[t,n]=await Promise.all([this.loadDatasources(),this.loadVisualizations()]),{persistedStateToExpression:i}=await Promise.resolve().then(a.bind(null,463));return await i(t,n,e)}))}setup(){return{registerDatasource:e=>{this.datasources.push(e)},registerVisualization:e=>{this.visualizations.push(e)}}}start(e,t){return{createInstance:async()=>{const[n,i]=await Promise.all([this.loadDatasources(),this.loadVisualizations()]),{EditorFrame:l}=await Promise.resolve().then(a.bind(null,463));return{EditorFrameContainer:({showNoDataPopover:a,lensInspector:s})=>Object(y.jsx)("div",{className:"lnsApp__frame"},Object(y.jsx)(l,{"data-test-subj":"lnsEditorFrame",core:e,plugins:t,lensInspector:s,showNoDataPopover:a,datasourceMap:n,visualizationMap:i,ExpressionRenderer:t.expressions.ReactExpressionRenderer})),datasourceMap:n,visualizationMap:i}}}}}var hd=a(100),xd=a(50),yd=a(420),vd=a.n(yd),jd=a(51),Od=a(6),kd=a(118);function Id({errors:e,canEdit:t}){const a=e&&e.length>1,n=t&&(null==e?void 0:e.some((({type:e})=>"fixable"===e)));return Object(y.jsx)("div",{className:"lnsEmbeddedError"},Object(y.jsx)(f.EuiEmptyPrompt,{iconType:"alert",iconColor:"danger","data-test-subj":"embeddable-lens-failure",body:Object(y.jsx)(s.a.Fragment,null,e?Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)("p",null,e[0].longMessage),a&&!n?Object(y.jsx)("p",null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.embeddable.moreErrors",defaultMessage:"Edit in Lens editor to see more errors"})):null,n?Object(y.jsx)("p",null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.embeddable.fixErrors",defaultMessage:"Edit in Lens editor to fix the error"})):null):Object(y.jsx)("p",null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.embeddable.failure",defaultMessage:"Visualization couldn't be displayed"})))}))}function Td({ExpressionRenderer:e,expression:t,searchContext:a,variables:n,handleEvent:i,interactive:l,searchSessionId:s,onData$:r,onRender$:o,renderMode:u,syncColors:d,syncTooltips:p,hasCompatibleActions:m,style:g,className:b,errors:h,canEdit:v,onRuntimeError:j,executionContext:O,lensInspector:k}){return Object(y.jsx)(c.I18nProvider,null,h||null===t||""===t?Object(y.jsx)(Id,{errors:h,canEdit:v}):Object(y.jsx)("div",{className:x()("lnsExpressionRenderer",b),style:g},Object(y.jsx)(e,{className:"lnsExpressionRenderer__component",padding:"s",variables:n,expression:t,interactive:l,searchContext:a,searchSessionId:s,onData$:r,onRender$:o,inspectorAdapters:k.adapters,renderMode:u,syncColors:d,syncTooltips:p,executionContext:O,renderError:(e,t)=>(j(),Object(y.jsx)("div",{"data-test-subj":"expression-renderer-error"},Object(y.jsx)(f.EuiFlexGroup,{direction:"column",alignItems:"center",justifyContent:"center"},Object(y.jsx)(f.EuiFlexItem,null,Object(y.jsx)(f.EuiIcon,{type:"alert",color:"danger"})),Object(y.jsx)(f.EuiFlexItem,null,(Object(kd.d)(t)||[e]).map((e=>Object(y.jsx)(f.EuiText,{size:"s"},e))))))),onEvent:i,hasCompatibleActions:m})))}const Md=e=>{const t=Object(me.createDefaultInspectorAdapters)();let a;return{adapters:t,inspect:n=>(a=e.open(t,n),a.onClose.then((()=>{a&&(a=void 0)})),a),close:()=>{var e;return null===(e=a)||void 0===e?void 0:e.close()}}};function Fd(e){if(1===e.length&&1===e[0].length)return e[0][0].query;const t=e.filter((e=>e.length)).map((e=>e.length>1?`( ${e.map((({query:e})=>`( ${e} )`)).join(" OR ")} )`:`( ${e[0].query} )`)).join(" AND ");return e.length>1?`( ${t} )`:t}function wd(e,t,a,n,i){var l,s;const r=Boolean((null===(l=i.navLinks)||void 0===l?void 0:l.discover)&&(null===(s=i.discover)||void 0===s?void 0:s.show)),[o,...c]=Object.values(a||{});if(!o||!e||!t)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataNoData",{defaultMessage:"Visualization has no data available to show"}),isVisible:r};if(c.length)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataMultipleLayers",{defaultMessage:"Cannot show underlying data for visualizations with multiple layers"}),isVisible:r};const[d]=e.getLayers(t),p=e.getPublicAPI({layerId:d,state:t});if("indexpattern"!==p.datasourceId)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataUnsupportedDatasource",{defaultMessage:"Underlying data does not support the current datasource"}),isVisible:r};const m=p.getTableSpec(),g=m.filter((({columnId:e})=>{var t;return!(null!==(t=p.getOperationForColumnId(e))&&void 0!==t&&t.hasTimeShift)}));if(g.length<m.length)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataTimeShifts",{defaultMessage:"Cannot show underlying data when there's a time shift configured"}),isVisible:r};const f=p.getFilters(a,n);if("error"in f)return{meta:void 0,error:f.error,isVisible:r};const b=[...new Set(g.map((({fields:e})=>e)).flat())];return{meta:{id:p.getSourceId(),columns:b,filters:f},error:void 0,isVisible:r}}function Cd(e,t,a,n){var i,l;const s={kuery:[],lucene:[]},r=(Array.isArray(e)?e:e?[e]:[]).filter((e=>Boolean(e.query.trim())));[s.lucene,s.kuery]=Object(Se.partition)(r,(e=>"lucene"===e.language));const o=(null===(i=r[0])||void 0===i?void 0:i.language)||"kuery",c={language:o,query:Fd([...s[o].map((e=>[e])),...a.filters.enabled[o]||[]])},d="lucene"===o?"kuery":"lucene",p=[...t],m=null==n?void 0:n.find((({id:e})=>e===a.id));if(Boolean((null===(l=a.filters.enabled[d])||void 0===l?void 0:l.length)||s[d].length)){const e=Fd([...s[d].map((e=>[e])),...a.filters.enabled[d]||[]]);p.push(Object(pi.b)(a.id,Object(pi.c)(m,{language:d,query:e},[]),!1,!1,u.i18n.translate("xpack.lens.app.lensContext",{defaultMessage:"Lens context ({language})",values:{language:d}}),pi.a.APP_STATE))}for(const e of["lucene","kuery"]){const[t]=a.filters.disabled[e]||[];for(const n of t||[]){let t=n.query;"lucene"===e&&(t+=` (${e})`),p.push(Object(pi.b)(a.id,Object(pi.c)(m,n,[]),!0,!1,t,pi.a.APP_STATE))}}return{filters:p,query:c}}const _d=async(e,t)=>{const{ast:a,errors:n}=await t(e);return{expression:a?Object(hd.b)(a):null,errors:n}};class embeddable_Embeddable extends Od.Embeddable{logError(e){var t;null===(t=this.deps.usageCollection)||void 0===t||t.reportUiCounter(D.k,jd.METRIC_TYPE.COUNT,"runtime"===e?"embeddable_runtime_error":"embeddable_validation_error")}constructor(e,t,a){super(t,{editApp:"lens"},a),xr()(this,"type",D.e),xr()(this,"deferEmbeddableLoad",!0),xr()(this,"expressionRenderer",void 0),xr()(this,"savedVis",void 0),xr()(this,"expression",void 0),xr()(this,"domNode",void 0),xr()(this,"subscription",void 0),xr()(this,"isInitialized",!1),xr()(this,"errors",void 0),xr()(this,"inputReloadSubscriptions",void 0),xr()(this,"isDestroyed",void 0),xr()(this,"embeddableTitle",void 0),xr()(this,"lensInspector",void 0),xr()(this,"externalSearchContext",{}),xr()(this,"activeDataInfo",{}),xr()(this,"indexPatterns",[]),xr()(this,"viewUnderlyingDataArgs",void 0),xr()(this,"updateActiveData",((e,t)=>{var a;this.activeDataInfo.activeData=null==t||null===(a=t.tables)||void 0===a?void 0:a.tables,this.input.onLoad&&this.input.onLoad(!1)})),xr()(this,"onRender",(()=>{this.renderComplete.dispatchComplete()})),xr()(this,"hasCompatibleActions",(async e=>{if(Object(oc.e)(e)||Object(oc.d)(e)){const{getTriggerCompatibleActions:t}=this.deps;return!!t&&(await t(_.VIS_EVENT_TO_TRIGGER[e.name],{data:e.data,embeddable:this})).length>0}return!1})),xr()(this,"handleEvent",(async e=>{if(this.deps.getTrigger&&!this.input.disableTriggers&&(Object(oc.b)(e)&&(this.deps.getTrigger(_.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:{...e.data,timeFieldName:e.data.timeFieldName||Object(Fc.inferTimeField)(e.data)},embeddable:this}),this.input.onBrushEnd&&this.input.onBrushEnd(e.data)),Object(oc.d)(e)&&(this.deps.getTrigger(_.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:{...e.data,timeFieldName:e.data.timeFieldName||Object(Fc.inferTimeField)(e.data)},embeddable:this}),this.input.onFilter&&this.input.onFilter(e.data)),Object(oc.e)(e)&&(this.deps.getTrigger(_.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:e.data,embeddable:this},!0),this.input.onTableRowClick&&this.input.onTableRowClick(e.data)),Object(oc.c)(e)&&this.onEditAction)){if(!this.savedVis)return;const t=JSON.parse(JSON.stringify(this.savedVis));t.state.visualization=this.onEditAction(t.state.visualization,e),this.savedVis=t;const{expression:a,errors:n}=await _d(this.savedVis,this.deps.documentToExpression);this.expression=a,this.errors=n,this.reload()}})),xr()(this,"inputIsRefType",(e=>this.deps.attributeService.inputIsRefType(e))),xr()(this,"getInputAsRefType",(async()=>this.deps.attributeService.getInputAsRefType(this.getExplicitInput(),{showSaveModal:!0,saveModalTitle:this.getTitle()}))),xr()(this,"getInputAsValueType",(async()=>this.deps.attributeService.getInputAsValueType(this.getExplicitInput()))),this.deps=e,this.lensInspector=Md(e.inspector),this.expressionRenderer=e.expressionRenderer,this.initializeSavedVis(t).then((()=>this.onContainerStateChanged(t))),this.subscription=this.getUpdated$().subscribe((()=>this.onContainerStateChanged(this.input)));const n=this.getInput$();this.embeddableTitle=this.getTitle(),this.inputReloadSubscriptions=[],this.inputReloadSubscriptions.push(n.pipe(Object(xd.map)((e=>{var t;return null===(t=e.enhancements)||void 0===t?void 0:t.dynamicActions})),Object(xd.distinctUntilChanged)(((e,t)=>vd()(e,t))),Object(xd.skip)(1)).subscribe((e=>{this.reload()}))),this.inputReloadSubscriptions.push(n.pipe(Object(xd.map)((e=>e.viewMode)),Object(xd.distinctUntilChanged)(),Object(xd.skip)(1)).subscribe((e=>{var t;null!==(t=this.getInput().enhancements)&&void 0!==t&&t.dynamicActions&&this.reload()}))),this.inputReloadSubscriptions.push(n.pipe(Object(xd.distinctUntilChanged)(((e,t)=>vd()(["attributes"in e&&e.attributes,"savedObjectId"in e&&e.savedObjectId],["attributes"in t&&t.attributes,"savedObjectId"in t&&t.savedObjectId]))),Object(xd.skip)(1)).subscribe((async e=>{await this.initializeSavedVis(e),this.reload()}))),this.inputReloadSubscriptions.push(this.getUpdated$().pipe(Object(xd.map)((()=>this.getInput()))).pipe(Object(xd.distinctUntilChanged)(((e,t)=>vd()([e.filters,e.query,e.timeRange,e.searchSessionId],[t.filters,t.query,t.timeRange,t.searchSessionId]))),Object(xd.skip)(1)).subscribe((async e=>{this.onContainerStateChanged(e)})))}supportedTriggers(){var e;return this.savedVis&&this.savedVis.visualizationType&&(null===(e=this.deps.visualizationMap[this.savedVis.visualizationType])||void 0===e?void 0:e.triggers)||[]}getInspectorAdapters(){return this.lensInspector.adapters}maybeAddConflictError(e,t){const a=[...e||[]];return"conflict"===(null==t?void 0:t.outcome)&&this.deps.spaces&&a.push({shortMessage:u.i18n.translate("xpack.lens.embeddable.legacyURLConflict.shortMessage",{defaultMessage:"You've encountered a URL conflict"}),longMessage:Object(y.jsx)(this.deps.spaces.ui.components.getEmbeddableLegacyUrlConflict,{targetType:D.e,sourceId:t.sourceId})}),null!=a&&a.length?a:void 0}maybeAddTimeRangeError(e,t,a){return null==t.timeRange&&a.some((e=>e.isTimeBased()))?[...e||[],{shortMessage:u.i18n.translate("xpack.lens.embeddable.missingTimeRangeParam.shortMessage",{defaultMessage:"Missing timeRange property"}),longMessage:u.i18n.translate("xpack.lens.embeddable.missingTimeRangeParam.longMessage",{defaultMessage:"The timeRange property is required for the given configuration"})}]:e}async initializeSavedVis(e){const t=await this.deps.attributeService.unwrapAttributes(e).catch((e=>(this.onFatalError(e),!1)));if(!t||this.isDestroyed)return;const{metaInfo:a,attributes:n}=t;this.savedVis={...n,type:this.type,savedObjectId:null==e?void 0:e.savedObjectId};const{expression:i,errors:l}=await _d(this.savedVis,this.deps.documentToExpression);this.expression=i,this.errors=this.maybeAddConflictError(l,null==a?void 0:a.sharingSavedObjectProps),await this.initializeOutput(),this.isInitialized=!0}onContainerStateChanged(e){var t;(this.handleContainerStateChanged(e)||null!==(t=this.errors)&&void 0!==t&&t.length)&&this.reload()}handleContainerStateChanged(e){let t=!1;const a=e.filters?e.filters.filter((e=>!e.meta.disabled)):void 0;return Object(Se.isEqual)(e.timeRange,this.externalSearchContext.timeRange)&&Object(Se.isEqual)(e.query,this.externalSearchContext.query)&&Object(Se.isEqual)(a,this.externalSearchContext.filters)&&this.externalSearchContext.searchSessionId===e.searchSessionId&&this.embeddableTitle===this.getTitle()||(this.externalSearchContext={timeRange:e.timeRange,query:e.query,filters:a,searchSessionId:e.searchSessionId},this.embeddableTitle=this.getTitle(),t=!0),t}render(e){var t;if(this.domNode=e,super.render(e),!this.savedVis||!this.isInitialized||this.isDestroyed)return;this.input.onLoad&&this.input.onLoad(!0),this.domNode.setAttribute("data-shared-item",""),this.renderComplete.dispatchInProgress();const a=this.input.executionContext,n={type:"lens",name:null!==(t=this.savedVis.visualizationType)&&void 0!==t?t:"",id:this.id,description:this.savedVis.title||this.input.title||"",url:this.output.editUrl},i=a?{...a,child:n}:n,l=this.getInput();Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:this.deps.theme.theme$},Object(y.jsx)(Td,{ExpressionRenderer:this.expressionRenderer,expression:this.expression||null,errors:this.errors,lensInspector:this.lensInspector,searchContext:this.getMergedSearchContext(),variables:l.palette?{theme:{palette:l.palette},embeddableTitle:this.getTitle()}:{embeddableTitle:this.getTitle()},searchSessionId:this.externalSearchContext.searchSessionId,handleEvent:this.handleEvent,onData$:this.updateActiveData,onRender$:this.onRender,interactive:!l.disableTriggers,renderMode:l.renderMode,syncColors:l.syncColors,syncTooltips:l.syncTooltips,hasCompatibleActions:this.hasCompatibleActions,className:l.className,style:l.style,executionContext:i,canEdit:this.getIsEditable()&&"edit"===l.viewMode,onRuntimeError:()=>{this.logError("runtime")}})),e)}getMergedSearchContext(){var e;if(!this.savedVis)throw new Error("savedVis is required for getMergedSearchContext");const t={timeRange:this.externalSearchContext.timeRange,query:[this.savedVis.state.query],filters:this.deps.injectFilterReferences(this.savedVis.state.filters,this.savedVis.references)};return this.externalSearchContext.query&&(t.query=[this.externalSearchContext.query,...t.query]),null!==(e=this.externalSearchContext.filters)&&void 0!==e&&e.length&&(t.filters=[...this.externalSearchContext.filters,...t.filters]),t}get onEditAction(){var e;const t=null===(e=this.savedVis)||void 0===e?void 0:e.visualizationType;if(t)return this.deps.visualizationMap[t].onEditAction}reload(){this.savedVis&&this.isInitialized&&!this.isDestroyed&&(this.handleContainerStateChanged(this.input),this.domNode&&this.render(this.domNode))}async loadViewUnderlyingDataArgs(){var e;const t=this.getMergedSearchContext();if(!this.activeDataInfo.activeData||!t.timeRange)return!1;const a=Object(Fc.getActiveDatasourceIdFromDoc)(this.savedVis);if(!a)return!1;this.activeDataInfo.activeDatasource=this.deps.datasourceMap[a];const n=null===(e=this.savedVis)||void 0===e?void 0:e.state.datasourceStates[a];var i;this.activeDataInfo.activeDatasourceState||(this.activeDataInfo.activeDatasourceState=await this.activeDataInfo.activeDatasource.initialize(n,null===(i=this.savedVis)||void 0===i?void 0:i.references));const l=function({activeDatasource:e,activeDatasourceState:t,activeData:a,dataViews:n,capabilities:i,query:l,filters:s,timeRange:r}){const{error:o,meta:u}=wd(e,t,a,r,i);if(o||!u)return;const{filters:c,query:d}=Cd(l,s,u,n);return{indexPatternId:u.id,timeRange:r,filters:c,query:d,columns:u.columns}}({activeDatasource:this.activeDataInfo.activeDatasource,activeDatasourceState:this.activeDataInfo.activeDatasourceState,activeData:this.activeDataInfo.activeData,dataViews:this.indexPatterns,capabilities:this.deps.capabilities,query:t.query,filters:t.filters||[],timeRange:t.timeRange}),s=void 0!==l;return s&&(this.viewUnderlyingDataArgs=l),s}getViewUnderlyingDataArgs(){return this.viewUnderlyingDataArgs}canViewUnderlyingData(){return this.loadViewUnderlyingDataArgs()}async initializeOutput(){var e,t;if(!this.savedVis)return;const{indexPatterns:a}=await Object(Fc.getIndexPatternsObjects)((null===(e=this.savedVis)||void 0===e?void 0:e.references.map((({id:e})=>e)))||[],this.deps.indexPatternService);this.indexPatterns=Object(Se.uniqBy)(a,"id");const n=this.getInput();this.errors=this.maybeAddTimeRangeError(this.errors,n,this.indexPatterns),this.errors&&this.logError("validation");const i=n.hidePanelTitles?"":null!==(t=n.title)&&void 0!==t?t:this.savedVis.title,l=n.savedObjectId;this.updateOutput({...this.getOutput(),defaultTitle:this.savedVis.title,editable:this.getIsEditable(),title:i,editPath:Object(D.m)(l),editUrl:this.deps.basePath.prepend(`/app/lens${Object(D.m)(l)}`),indexPatterns:this.indexPatterns}),this.setInitializationFinished()}getIsEditable(){return this.deps.capabilities.canSaveVisualizations||!this.inputIsRefType(this.getInput())&&this.deps.capabilities.canSaveDashboards}getDescription(){return this.savedVis&&this.savedVis.description}getSavedVis(){return this.savedVis}destroy(){super.destroy(),this.isDestroyed=!0,this.inputReloadSubscriptions.length>0&&this.inputReloadSubscriptions.forEach((e=>{e.unsubscribe()})),this.domNode&&Object(r.unmountComponentAtNode)(this.domNode),this.subscription&&this.subscription.unsubscribe()}}var Sd=a(56),Ed=a(93),Pd=a(83),Ad=a(96),Ld=s.a.lazy((function(){return a.e(10).then(a.bind(null,465)).then((function(e){return{default:e.AnalyticsNoDataPage}}))})),Dd=Object(Pd.c)(Ld),Nd=(a(421),a(57)),zd=a(72),Bd=a(131);const Vd=document.createElement("div");let Rd=!1;function Hd({anchorElement:e,isOpen:t,onClose:a}){const n=Object(zd.R)(zd.q),i=Object(zd.Q)(),s=Object(l.useCallback)((()=>{Object(fn.e)("toggle_autoapply"),Object(du.b)(new gd.Storage(localStorage),Bd.a,String(n)),i(n?Object(zd.c)():Object(zd.e)())}),[i,n]);return Object(y.jsx)(f.EuiWrappingPopover,{"data-test-subj":"lnsApp__settingsMenu",ownFocus:!0,button:e,closePopover:a,isOpen:!0},Object(y.jsx)(f.EuiPopoverTitle,null,Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.settings.title",defaultMessage:"Lens settings"})),Object(y.jsx)(f.EuiSwitch,{label:u.i18n.translate("xpack.lens.settings.autoApply",{defaultMessage:"Auto-apply visualization changes"}),checked:n,onChange:()=>s(),"data-test-subj":"lnsToggleAutoApply"}))}function Gd(){o.a.unmountComponentAtNode(Vd),document.body.removeChild(Vd),Rd=!1}const qd=({setHeaderActionMenu:e,initialInput:t,indicateNoData:a,lensInspector:n,setIsSaveModalVisible:r,getIsByValueMode:p,runSave:m,onAppLeave:g,redirectToOrigin:f,datasourceMap:b,title:h,goBackToOriginatingApp:x,contextOriginatingApp:v,initialContextIsEmbedded:j,topNavMenuEntryGenerators:O,initialContext:k,theme$:I})=>{var T;const{data:M,fieldFormats:F,navigation:w,uiSettings:C,application:_,attributeService:S,discover:E,dashboardFeatureFlag:P,dataViewFieldEditor:A,dataViewEditor:L,dataViews:D}=Object(d.useKibana)().services,N=Object(zd.Q)(),z=s.a.useCallback((e=>N(Object(zd.I)(e))),[N]),[B,V]=Object(l.useState)([]),[R,H]=Object(l.useState)(),[G,q]=Object(l.useState)([]),$=Boolean(null==L?void 0:L.userPermissions.editDataView()),W=Object(l.useRef)(),U=Object(l.useRef)(),{isSaveable:Y,isLinkedToOriginatingApp:X,query:K,activeData:Z,savedQuery:Q,activeDatasourceId:J,datasourceStates:ee,visualization:te,filters:ae}=Object(zd.R)((e=>e.lens)),ne=Object.values(ee).every((({isLoading:e})=>!1===e));Object(l.useEffect)((()=>{if(!(b&&J&&!ee[J].isLoading?b[J]:void 0))return;const e=Object(Fc.getIndexPatternsIds)({activeDatasources:Object.keys(ee).reduce(((e,t)=>({...e,[t]:b[t]})),{}),datasourceStates:ee});(B.length+G.length!==e.length||e.some((e=>![...B.map((e=>e.id)),...G].find((t=>t===e)))))&&Object(Fc.getIndexPatternsObjects)(e,D).then((({indexPatterns:e,rejectedIds:t})=>{V(e),q(t)}))}),[ee,J,G,b,B,D]),Object(l.useEffect)((()=>{B.length>0&&H(B[0])}),[B]),Object(l.useEffect)((()=>()=>{var e,t;null===(e=W.current)||void 0===e||e.call(W),null===(t=U.current)||void 0===t||t.call(U)}),[]);const{TopNavMenu:ie}=w.ui,{from:le,to:se}=M.query.timefilter.timefilter.getTime(),re=Boolean(Y&&_.capabilities.visualize.save),oe=Boolean(Y&&(null===(T=_.capabilities.dashboard)||void 0===T?void 0:T.showWriteControls)),ue=u.i18n.translate("xpack.lens.app.unsavedFilename",{defaultMessage:"unsaved"}),ce=Object(l.useMemo)((()=>{if(!te.activeId)return;const e=te.activeId,t=O.flatMap((t=>{const a=t({datasourceStates:ee,visualizationId:e,visualizationState:te.state,query:K,filters:ae,initialContext:k});return a?[a]:[]}));return t.length>0?t:void 0}),[ee,O,te.activeId,te.state,K,ae,k]),de=Object(l.useMemo)((()=>{if(J&&E)return wd(b[J],ee[J].state,Z,M.query.timefilter.timefilter.getTime(),_.capabilities)}),[J,E,b,ee,Z,M.query.timefilter.timefilter,_.capabilities]),pe=Object(Ed.useStore)(),me=Object(l.useMemo)((()=>{const e=function(e){const{actions:t,showCancel:a,allowByValue:n,enableExportToCSV:i,showOpenInDiscover:l,showSaveAndReturn:s,savingToLibraryPermitted:r,savingToDashboardPermitted:o,tooltips:c,contextOriginatingApp:d,isSaveable:p}=e,m=[],g=r||n&&o&&!e.isByValueMode&&!e.showSaveAndReturn,f=e.isByValueMode?u.i18n.translate("xpack.lens.app.addToLibrary",{defaultMessage:"Save to library"}):e.showSaveAndReturn?u.i18n.translate("xpack.lens.app.saveAs",{defaultMessage:"Save as"}):u.i18n.translate("xpack.lens.app.save",{defaultMessage:"Save"});if(d&&m.push({label:u.i18n.translate("xpack.lens.app.goBackLabel",{defaultMessage:"Go back to {contextOriginatingApp}",values:{contextOriginatingApp:d}}),run:t.goBack,className:"lnsNavItem__goBack",testId:"lnsApp_goBackToAppButton",description:u.i18n.translate("xpack.lens.app.goBackLabel",{defaultMessage:"Go back to {contextOriginatingApp}",values:{contextOriginatingApp:d}}),disableButton:!1}),l){const e=u.i18n.translate("xpack.lens.app.exploreDataInDiscover",{defaultMessage:"Explore data in Discover"});m.push({label:e,run:()=>{},testId:"lnsApp_openInDiscover",description:e,disableButton:Boolean(c.showUnderlyingDataWarning()),tooltip:c.showUnderlyingDataWarning,target:"_blank",href:t.getUnderlyingDataUrl()})}return m.push({label:u.i18n.translate("xpack.lens.app.inspect",{defaultMessage:"Inspect"}),run:t.inspect,testId:"lnsApp_inspectButton",description:u.i18n.translate("xpack.lens.app.inspectAriaLabel",{defaultMessage:"inspect"}),disableButton:!1}),m.push({label:u.i18n.translate("xpack.lens.app.downloadCSV",{defaultMessage:"Download as CSV"}),run:t.exportToCSV,testId:"lnsApp_downloadCSVButton",description:u.i18n.translate("xpack.lens.app.downloadButtonAriaLabel",{defaultMessage:"Download the data as CSV file"}),disableButton:!i,tooltip:c.showExportWarning}),m.push({label:u.i18n.translate("xpack.lens.app.settings",{defaultMessage:"Settings"}),run:t.openSettings,testId:"lnsApp_settingsButton",description:u.i18n.translate("xpack.lens.app.settingsAriaLabel",{defaultMessage:"Open the Lens settings menu"})}),a&&m.push({label:u.i18n.translate("xpack.lens.app.cancel",{defaultMessage:"Cancel"}),run:t.cancel,testId:"lnsApp_cancelButton",description:u.i18n.translate("xpack.lens.app.cancelButtonAriaLabel",{defaultMessage:"Return to the last app without saving changes"})}),m.push({label:f,iconType:s?void 0:"save",emphasize:!s,run:t.showSaveModal,testId:"lnsApp_saveButton",description:u.i18n.translate("xpack.lens.app.saveButtonAriaLabel",{defaultMessage:"Save the current lens visualization"}),disableButton:!g}),s&&m.push({label:u.i18n.translate("xpack.lens.app.saveAndReturn",{defaultMessage:"Save and return"}),emphasize:!0,iconType:"checkInCircleFilled",run:t.saveAndReturn,testId:"lnsApp_saveAndReturnButton",disableButton:!p,description:u.i18n.translate("xpack.lens.app.saveAndReturnButtonAriaLabel",{defaultMessage:"Save the current lens visualization and return to the last app"})}),m}({showSaveAndReturn:Boolean(X&&(P.allowByValueEmbeddables||Boolean(t)))||Boolean(j),enableExportToCSV:Boolean(Y&&Z&&Object.keys(Z).length),showOpenInDiscover:Boolean(null==de?void 0:de.isVisible),isByValueMode:p(),allowByValue:P.allowByValueEmbeddables,showCancel:Boolean(X),savingToLibraryPermitted:re,savingToDashboardPermitted:oe,isSaveable:Y,contextOriginatingApp:v,tooltips:{showExportWarning:()=>{if(Z&&Object.values(Z).some((e=>Object(mi.tableHasFormulas)(e.columns,e.rows))))return u.i18n.translate("xpack.lens.app.downloadButtonFormulasWarning",{defaultMessage:"Your CSV contains characters that spreadsheet applications might interpret as formulas."})},showUnderlyingDataWarning:()=>null==de?void 0:de.error},actions:{inspect:()=>n.inspect({title:h}),exportToCSV:()=>{if(!Z)return;const e=Object.values(Z),t=e.reduce(((t,a,n)=>{if(a){const i=e.length>1?`-${n+1}`:"";t[`${h||ue}${i}.csv`]={content:Ja.exporters.datatableToCSV(a,{csvSeparator:C.get("csv:separator",","),quoteValues:C.get("csv:quoteValues",!0),formatFactory:F.deserialize,escapeFormulaValues:!1}),type:Ja.exporters.CSV_MIME_TYPE}}return t}),{});t&&Object(Nd.downloadMultipleAs)(t)},saveAndReturn:()=>{var e;Y&&(g((e=>e.default())),m({newTitle:h||"",newCopyOnSave:!1,isTitleDuplicateConfirmed:!1,returnToOrigin:!0},{saveToLibrary:null!==(e=t&&S.inputIsRefType(t))&&void 0!==e&&e}))},showSaveModal:()=>{(oe||re)&&r(!0)},goBack:()=>{v&&(null==x||x())},cancel:()=>{f&&f()},getUnderlyingDataUrl:()=>{if(!de)return;const{error:e,meta:t}=de;if(e||!E||!t)return;const{filters:a,query:n}=Cd(K,ae,t,B);return E.locator.getRedirectUrl({indexPatternId:t.id,timeRange:M.query.timefilter.timefilter.getTime(),filters:a,query:n,columns:t.columns})},openSettings:e=>function(e){if(Rd)return void Gd();Rd=!0,document.body.appendChild(Vd);const t=Object(y.jsx)(Ed.Provider,{store:e.lensStore},Object(y.jsx)(d.KibanaThemeProvider,{theme$:e.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(Hd,i()({},e,{isOpen:Rd,onClose:Gd})))));o.a.render(t,Vd)}({lensStore:pe,anchorElement:e,theme$:I})}});return[...ce||[],...e]}),[X,P.allowByValueEmbeddables,t,j,Y,Z,de,p,re,oe,v,ce,n,h,ue,C,F.deserialize,g,m,S,r,x,f,E,K,ae,B,M.query.timefilter.timefilter,pe,I]),ge=Object(l.useCallback)((e=>{const{dateRange:t,query:a}=e,n=M.query.timefilter.timefilter.getTime();t.from!==n.from||t.to!==n.to?(M.query.timefilter.timefilter.setTime(t),Object(fn.e)("app_date_change")):(z({searchSessionId:M.search.session.start(),resolvedDateRange:Object(Fc.getResolvedDateRange)(M.query.timefilter.timefilter)}),Object(fn.e)("app_query_change")),a&&(Object(Se.isEqual)(a,K)||z({query:a}))}),[M.query.timefilter.timefilter,M.search.session,z,K]),fe=Object(l.useCallback)((e=>{z({savedQuery:e})}),[z]),be=Object(l.useCallback)((e=>{const t=e.attributes.filters||[],a=M.query.filterManager.getGlobalFilters();M.query.filterManager.setFilters([...a,...t]),z({query:e.attributes.query,savedQuery:{...e}})}),[M.query.filterManager,z]),he=Object(l.useCallback)((()=>{M.query.filterManager.setFilters(M.query.filterManager.getGlobalFilters()),z({filters:M.query.filterManager.getGlobalFilters(),query:M.query.queryString.getDefaultQuery(),savedQuery:void 0})}),[M.query.filterManager,M.query.queryString,z]),xe=Object(l.useMemo)((()=>e=>{N(Object(zd.N)({updater:e,datasourceId:J,clearStagedPreview:!0}))}),[J,N]),ye=Object(l.useCallback)((async()=>{R&&R.id&&Object(Fc.refreshIndexPatternsList)({activeDatasources:Object.keys(ee).reduce(((e,t)=>({...e,[t]:b[t]})),{}),indexPatternId:R.id,setDatasourceState:xe}),M.search.session.start()}),[R,M.search.session,b,ee,xe]),ve=Object(l.useMemo)((()=>$?async(e,t="edit")=>{if(null!=R&&R.id){const t=await M.dataViews.get(null==R?void 0:R.id);W.current=A.openEditor({ctx:{dataView:t},fieldName:e,onSave:async()=>{ye()}})}}:void 0),[$,null==R?void 0:R.id,M.dataViews,A,ye]),je=Object(l.useMemo)((()=>$&&ve?()=>ve(void 0,"add"):void 0),[ve,$]),Oe=Object(l.useMemo)((()=>$?()=>{U.current=L.openEditor({onSave:async e=>{e.id&&(Object(Fc.handleIndexPatternChange)({activeDatasources:Object.keys(ee).reduce(((e,t)=>({...e,[t]:b[t]})),{}),datasourceStates:ee,indexPatternId:e.id,setDatasourceState:xe}),ye())}})}:void 0),[L,$,b,ee,ye,xe]),ke={trigger:{label:(null==R?void 0:R.title)||"","data-test-subj":"lns-dataView-switch-link",title:(null==R?void 0:R.title)||""},currentDataViewId:null==R?void 0:R.id,onAddField:je,onDataViewCreated:Oe,onChangeDataView:e=>{const t=B.find((t=>t.id===e));H(t),Object(Fc.handleIndexPatternChange)({activeDatasources:Object.keys(ee).reduce(((e,t)=>({...e,[t]:b[t]})),{}),datasourceStates:ee,indexPatternId:e,setDatasourceState:xe})}};return Object(y.jsx)(ie,{setMenuMountPoint:e,config:me,showSaveQuery:Boolean(_.capabilities.visualize.saveQuery),savedQuery:Q,onQuerySubmit:ge,onSaved:fe,onSavedQueryUpdated:be,onClearSavedQuery:he,indexPatterns:B,query:K,dateRangeFrom:le,dateRangeTo:se,indicateNoData:a,showSearchBar:!0,dataViewPickerComponentProps:ke,showDatePicker:B.some((e=>e.isTimeBased()))||Boolean(ne&&J&&b[J].isTimeBased(ee[J].state)),showQueryBar:!0,showFilterBar:!0,"data-test-subj":"lnsApp_topNav",screenTitle:"lens",appName:"lens",displayStyle:"detached"})};var $d=a(101);const Wd=e=>JSON.parse(JSON.stringify(e)),Ud=(e,t,a,n)=>{if(void 0===e||void 0===t)return e===t;const i=Wd(e),l=Wd(t);if((null==i?void 0:i.visualizationType)!==(null==l?void 0:l.visualizationType))return!1;if(!Object(Se.isEqual)(i.state.query,l.state.query))return!1;if(!Object(Se.isEqual)(i.state.visualization,l.state.visualization))return!1;const s=Object.keys(i.state.datasourceStates),r=Object.keys(l.state.datasourceStates);let o=Object(Se.intersection)(s,r).length===Object(Se.union)(s,r).length;if(o&&(o=s.map((e=>n[e].isEqual(i.state.datasourceStates[e],i.references,l.state.datasourceStates[e],l.references))).every((e=>e))),!o)return!1;const[u,c]=[i,l].map((e=>Object($d.removePinnedFilters)(function(e,t){var a;return t?{...t,state:{...t.state,filters:e((null===(a=t.state)||void 0===a?void 0:a.filters)||[],t.references)}}:void 0}(a,e))));return!!Object(Se.isEqual)(null==u?void 0:u.state.filters,null==c?void 0:c.state.filters)};function Yd({history:e,onAppLeave:t,redirectTo:a,editorFrame:n,initialInput:i,incomingState:r,redirectToOrigin:o,setHeaderActionMenu:c,datasourceMap:p,visualizationMap:m,contextOriginatingApp:g,topNavMenuEntryGenerators:b,initialContext:h,theme$:x}){const v=Object(d.useKibana)().services,{data:j,chrome:O,inspector:k,application:I,savedObjectsTagging:T,getOriginatingAppName:M,spaces:F,http:w,executionContext:C,dashboardFeatureFlag:_}=v,S=Object(zd.Q)(),E=Object(l.useCallback)((e=>S(Object(zd.I)(e))),[S]),{persistedDoc:P,sharingSavedObjectProps:A,isLinkedToOriginatingApp:L,searchSessionId:N,isLoading:z,isSaveable:B}=Object(zd.R)((e=>e.lens)),V=Object(l.useMemo)((()=>({datasourceMap:p,visualizationMap:m,extractFilterReferences:j.query.filterManager.extract.bind(j.query.filterManager)})),[p,m,j.query.filterManager]),R=Object(zd.R)((e=>Object(zd.B)(e,V))),[H,G]=Object(l.useState)(!1),[q,$]=Object(l.useState)(!1),[W,U]=Object(l.useState)(void 0),[Y,X]=Object(l.useState)(void 0),[K,Z]=Object(l.useState)(!1),Q=null==i?void 0:i.savedObjectId;Object(l.useEffect)((()=>{R&&U(R)}),[R]);const J=Object(l.useCallback)((()=>{G(!0)}),[G]);Object(d.useExecutionContext)(C,{type:"application",id:Q||"new",page:"editor"}),Object(l.useEffect)((()=>{H&&G(!1)}),[G,H,N]);const ee=Object(l.useCallback)((()=>Boolean(_.allowByValueEmbeddables&&L&&!Q)),[_.allowByValueEmbeddables,L,Q]);Object(l.useEffect)((()=>{t((e=>I.capabilities.visualize.save&&!Ud(P,W,j.query.filterManager.inject.bind(j.query.filterManager),p)&&(B||P)?e.confirm(u.i18n.translate("xpack.lens.app.unsavedWorkMessage",{defaultMessage:"Leave Lens with unsaved work?"}),u.i18n.translate("xpack.lens.app.unsavedWorkTitle",{defaultMessage:"Unsaved changes"}),void 0,u.i18n.translate("xpack.lens.app.unsavedWorkConfirmBtn",{defaultMessage:"Discard changes"}),"danger"):e.default()))}),[t,W,B,P,I.capabilities.visualize.save,j.query.filterManager,p]);const te=Object(l.useCallback)((()=>{if(F&&"conflict"===(null==A?void 0:A.outcome)&&null!=P&&P.savedObjectId){const t=P.savedObjectId,a=null==A?void 0:A.aliasTargetId,n=w.basePath.prepend(`${Object(D.m)(a)}${e.location.search}`);return F.ui.components.getLegacyUrlConflict({objectNoun:u.i18n.translate("xpack.lens.appName",{defaultMessage:"Lens visualization"}),currentObjectId:t,otherObjectId:a,otherObjectPath:n})}return null}),[P,A,F,w,e]);Object(l.useEffect)((()=>{const e=ee(),t=h&&"originatingApp"in h&&h.originatingApp,a=[];(L||t)&&M()&&o&&a.push({onClick:()=>{o()},text:M()}),e||a.push({href:I.getUrlForApp("visualize"),onClick:e=>{I.navigateToApp("visualize",{path:"/"}),e.preventDefault()},text:u.i18n.translate("xpack.lens.breadcrumbsTitle",{defaultMessage:"Visualize Library"})});let n=u.i18n.translate("xpack.lens.breadcrumbsCreate",{defaultMessage:"Create"});P&&(n=e?u.i18n.translate("xpack.lens.breadcrumbsByValue",{defaultMessage:"Edit visualization"}):P.title),a.push({text:n}),O.setBreadcrumbs(a)}),[_.allowByValueEmbeddables,M,o,ee,I,O,L,P,h]);const ae=Object(l.useCallback)(((e,n)=>(S(Object(zd.b)()),Object($d.runSaveLensVisualization)({lastKnownDoc:W,getIsByValueMode:ee,savedObjectsTagging:T,initialInput:i,redirectToOrigin:o,persistedDoc:P,onAppLeave:t,redirectTo:a,originatingApp:null==r?void 0:r.originatingApp,...v},e,n).then((e=>{e&&(E(e),$(!1))}),(()=>{})))),[null==r?void 0:r.originatingApp,W,P,ee,T,i,o,t,a,v,E,S,$]);Object(l.useEffect)((()=>{W&&!Y&&X(W)}),[W,Y]);const ne=Object(l.useCallback)((()=>{h&&"vizEditorOriginatingAppUrl"in h&&h.vizEditorOriginatingAppUrl&&(Ud(Y,W,j.query.filterManager.inject,p)?(t((e=>e.default())),I.navigateToApp("visualize",{path:h.vizEditorOriginatingAppUrl})):Z(!0))}),[I,j.query.filterManager.inject,p,h,Y,W,t]),ie=Object(l.useCallback)((()=>{Z(!1),h&&"vizEditorOriginatingAppUrl"in h&&h.vizEditorOriginatingAppUrl&&(t((e=>e.default())),I.navigateToApp("visualize",{path:h.vizEditorOriginatingAppUrl}))}),[I,h,t]),le=Object(l.useMemo)((()=>Boolean(h&&"originatingApp"in h&&h.originatingApp)),[h]);return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)("div",{className:"lnsApp","data-test-subj":"lnsApp"},Object(y.jsx)(qd,{initialInput:i,redirectToOrigin:o,getIsByValueMode:ee,onAppLeave:t,runSave:ae,setIsSaveModalVisible:$,setHeaderActionMenu:c,indicateNoData:H,datasourceMap:p,title:null==P?void 0:P.title,lensInspector:k,goBackToOriginatingApp:ne,contextOriginatingApp:g,initialContextIsEmbedded:le,topNavMenuEntryGenerators:b,initialContext:h,theme$:x}),te(),(!z||P)&&Object(y.jsx)(Xd,{editorFrame:n,showNoDataPopover:J,lensInspector:k})),q&&Object(y.jsx)($d.SaveModalContainer,{lensServices:v,originatingApp:L?null==r?void 0:r.originatingApp:void 0,isSaveable:B,runSave:ae,onClose:()=>{$(!1)},getAppNameFromId:()=>M(),lastKnownDoc:W,onAppLeave:t,persistedDoc:P,initialInput:i,redirectTo:a,redirectToOrigin:o,returnToOriginSwitchLabel:ee()&&i?u.i18n.translate("xpack.lens.app.updatePanel",{defaultMessage:"Update panel on {originatingAppName}",values:{originatingAppName:M()}}):void 0}),K&&Object(y.jsx)(f.EuiConfirmModal,{maxWidth:600,title:u.i18n.translate("xpack.lens.app.goBackModalTitle",{defaultMessage:"Discard changes?"}),onCancel:()=>Z(!1),onConfirm:ie,cancelButtonText:u.i18n.translate("xpack.lens.app.goBackModalCancelBtn",{defaultMessage:"Cancel"}),confirmButtonText:u.i18n.translate("xpack.lens.app.goBackModalTitle",{defaultMessage:"Discard changes?"}),buttonColor:"danger",defaultFocusedButton:"confirm"},u.i18n.translate("xpack.lens.app.goBackModalMessage",{defaultMessage:"The changes you have made here are not backwards compatible with your original {contextOriginatingApp} visualization. Are you sure you want to discard these unsaved changes and return to {contextOriginatingApp}?",values:{contextOriginatingApp:g}})))}const Xd=s.a.memo((function({editorFrame:e,showNoDataPopover:t,lensInspector:a}){const{EditorFrameContainer:n}=e;return Object(y.jsx)(n,{showNoDataPopover:t,lensInspector:a})}));var Kd=a(87);async function Zd(e,t,a){const{data:n,inspector:i,navigation:l,embeddable:s,savedObjectsTagging:r,usageCollection:o,fieldFormats:u,spaces:c,discover:d}=t,p=new gd.Storage(localStorage),m=null==s?void 0:s.getStateTransfer(),g=null==m?void 0:m.getIncomingEditorState(D.a);return{data:n,storage:p,inspector:Md(i),navigation:l,fieldFormats:u,stateTransfer:m,usageCollection:o,savedObjectsTagging:r,attributeService:a,executionContext:e.executionContext,http:e.http,chrome:e.chrome,overlays:e.overlays,uiSettings:e.uiSettings,application:e.application,notifications:e.notifications,savedObjectsClient:e.savedObjects.client,presentationUtil:t.presentationUtil,dataViewEditor:t.dataViewEditor,dataViewFieldEditor:t.dataViewFieldEditor,dashboard:t.dashboard,getOriginatingAppName:()=>null!=g&&g.originatingApp?null==m?void 0:m.getAppNameFromId(g.originatingApp):void 0,dataViews:t.dataViews,dashboardFeatureFlag:t.dashboard.dashboardFeatureFlagConfig,spaces:c,discover:d}}async function Qd(e,t,a){const{createEditorFrame:n,attributeService:o,getPresentationUtilContext:p,topNavMenuEntryGenerators:m}=a,[[g,b],h]=await Promise.all([e.getStartServices(),n()]),x=t.history.location.state,v=await Zd(g,b,o),{stateTransfer:j,data:O,storage:k}=v,I=null==j?void 0:j.getIncomingEditorState(D.a);var T,M;T=g.chrome,M=g.docLinks,T.setHelpExtension({appName:"Lens",links:[{linkType:"documentation",href:M.links.visualize.lensPanels},{linkType:"github",title:"[Lens]",labels:["Feature:Lens"]}]}),g.chrome.docTitle.change(u.i18n.translate("xpack.lens.pageTitle",{defaultMessage:"Lens"})),Object(fn.b)(new fn.a({http:e.http,storage:k}));const F=e=>{var t;const a=w&&"originatingApp"in w?w.originatingApp:null,n=null!==(t=null==I?void 0:I.originatingApp)&&void 0!==t?t:a;if(!n)throw new Error("redirectToOrigin called without an originating app");let i=null==I?void 0:I.embeddableId;if(w&&"embeddableId"in w&&(i=w.embeddableId),j&&null!=e&&e.input){const{input:t,isCopied:a}=e;j.navigateToWithEmbeddablePackage(n,{path:null==I?void 0:I.originatingPath,state:{embeddableId:a?void 0:i,type:D.h,input:t,searchSessionId:O.search.session.getSessionId()}})}else g.application.navigateToApp(n,{path:null==I?void 0:I.originatingPath})},w=!x||x.type!==vc.ACTION_VISUALIZE_LENS_FIELD&&x.type!==_.ACTION_CONVERT_TO_LENS?void 0:x.payload;null!=I&&I.searchSessionId&&O.search.session.continue(I.searchSessionId);const{datasourceMap:C,visualizationMap:S}=h,E={lensServices:v,datasourceMap:C,visualizationMap:S,embeddableEditorIncomingState:I,initialContext:w},P=Object(zd.i)(E,{lens:Object(Kd.b)(E)}),A=s.a.memo((a=>{const[n,i]=Object(l.useState)("loading");Object(l.useEffect)((()=>{const e=Object(gd.createKbnUrlStateStorage)({history:a.history,useHash:v.uiSettings.get("state:storeInSessionStorage"),...Object(gd.withNotifyOnErrors)(v.notifications.toasts)}),{stop:t}=Object(Ja.syncQueryStateWithUrl)(O.query,e);return()=>{t()}}),[a.history]);const s=Object(l.useCallback)((e=>{var t,n;t=a.history,(n=e)?t.push({pathname:`/edit/${n}`,search:t.location.search}):t.push({pathname:"/",search:t.location.search})}),[a.history]),r=Object(l.useMemo)((()=>{return e=a.id,a.editByValue?null==I?void 0:I.valueInput:e?{savedObjectId:e}:void 0;var e}),[a.editByValue,a.id]),o=Object(l.useCallback)((()=>{w||O.query.filterManager.setAppFilters([]),P.dispatch(Object(Kd.g)(Object(Kd.b)(E))),P.dispatch(Object(zd.h)({redirectCallback:s,initialInput:r,history:a.history}))}),[r,a.history,s]);if(Object(l.useEffect)((()=>{(async()=>{await O.dataViews.hasData.hasUserDataView().catch((()=>!1))?(i("data"),o()):i("no_data")})()}),[o,r,a.history,s]),Object(fn.e)("loaded"),"loading"===n)return Object(y.jsx)(f.EuiLoadingSpinner,null);if("no_data"===n){const e={coreStart:g,dataViews:O.dataViews,dataViewEditor:b.dataViewEditor};return Object(y.jsx)(Ad.a,e,Object(y.jsx)(Dd,{onDataViewCreated:()=>{i("data"),o()}}),";")}return Object(y.jsx)(Ed.Provider,{store:P},Object(y.jsx)(Yd,{incomingState:I,editorFrame:h,initialInput:r,redirectTo:s,redirectToOrigin:F,onAppLeave:t.onAppLeave,setHeaderActionMenu:t.setHeaderActionMenu,history:a.history,datasourceMap:C,visualizationMap:S,initialContext:w,contextOriginatingApp:null==x?void 0:x.originatingApp,topNavMenuEntryGenerators:m,theme$:e.theme.theme$}))})),L=e=>Object(y.jsx)(A,{id:e.match.params.id,history:e.history,editByValue:e.editByValue}),N=t.history.listen((()=>{window.dispatchEvent(new HashChangeEvent("hashchange"))}));t.element.classList.add("lnsAppWrapper");const z=p();return Object(r.render)(Object(y.jsx)(d.KibanaThemeProvider,{theme$:g.theme.theme$},Object(y.jsx)(c.I18nProvider,null,Object(y.jsx)(d.KibanaContextProvider,{services:v},Object(y.jsx)(z,null,Object(y.jsx)(Sd.HashRouter,null,Object(y.jsx)(Sd.Switch,null,Object(y.jsx)(Sd.Route,{exact:!0,path:"/edit/:id",component:L}),Object(y.jsx)(Sd.Route,{exact:!0,path:`/${D.g}`,render:e=>Object(y.jsx)(L,i()({},e,{editByValue:!0}))}),Object(y.jsx)(Sd.Route,{exact:!0,path:"/",component:L}),Object(y.jsx)(Sd.Route,{path:"/",component:function(){return Object(fn.e)("loaded_404"),Object(y.jsx)(c.FormattedMessage,{id:"xpack.lens.app404",defaultMessage:"404 Not Found"})}}))))))),t.element),()=>{O.search.session.clear(),Object(r.unmountComponentAtNode)(t.element),v.inspector.close(),N(),P.dispatch(Object(zd.j)())}}var Jd=a(171);function ep(e,t){const a=new Jd.a(e.savedObjects.client);return t.embeddable.getAttributeService(Tc.DOC_TYPE,{saveMethod:async(e,t)=>({id:(await a.save({...e,savedObjectId:t,type:Tc.DOC_TYPE})).savedObjectId}),unwrapMethod:async e=>{const{saved_object:t,outcome:n,alias_target_id:i,alias_purpose:l}=await a.load(e),{attributes:s,references:r,id:o}=t;return{attributes:{...{...s,references:r}},metaInfo:{sharingSavedObjectProps:{aliasTargetId:i,outcome:n,aliasPurpose:l,sourceId:o}}}},checkForDuplicateTitle:t=>{const a=e.savedObjects.client,n=e.overlays;return Object(Jd.b)({title:t.newTitle,copyOnSave:!1,lastSavedTitle:"",getEsType:()=>Tc.DOC_TYPE,getDisplayName:()=>Tc.DOC_TYPE},t.isTitleDuplicateConfirmed,t.onTitleDuplicate,{savedObjectsClient:a,overlays:n})}})}}])]);