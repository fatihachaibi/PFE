/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.maps_bundle_jsonpfunction=window.maps_bundle_jsonpfunction||[]).push([[6,1],{125:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var a=s(2),n=s(8);function i(){const e=Object(n.k)();return e.isIncludeElasticMapsService()?e.isEMSUrlSet()?e.hasOnPremLicense()?a.i18n.translate("xpack.maps.source.ems.noOnPremConnectionDescription",{defaultMessage:"Cannot connect to {host}.",values:{host:e.getEMSRoot()}}):a.i18n.translate("xpack.maps.source.ems.noOnPremLicenseDescription",{defaultMessage:"An enterprise license is required to connect to local Elastic Maps Server installations."}):a.i18n.translate("xpack.maps.source.ems.noAccessDescription",{defaultMessage:"Kibana is unable to access Elastic Maps Service. Contact your system administrator."}):a.i18n.translate("xpack.maps.source.ems.disabledDescription",{defaultMessage:'Access to Elastic Maps Service has been disabled. Ask your system administrator to set "map.includeElasticMapsService" in kibana.yml.'})}},138:function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return i}));var a=s(80);async function n(e){try{return i(e,await Object(a.getEmsFileLayers)())}catch(e){return null}}function i(e,t){const s=[];if(e.sampleValuesColumnName){const a=function(e,t,s){const a=[];return e.forEach((e=>{e.getFields().forEach((n=>{if(!n.alias||!n.alias.length)return;const i={layerId:e.getId(),field:n.id,displayName:e.getDisplayName()};n.alias.forEach((e=>{const l=new RegExp(e,"i"),o=!!t.match(l);let c;c=s?!(!n.values||!n.values.length)&&o&&r(s,n.values):o,c&&a.push(i)}))}))})),a}(t,e.sampleValuesColumnName,e.sampleValues);s.push(...a)}if(e.sampleValues&&e.sampleValues.length){const a=function(e,t){const s=[];return e.forEach((e=>{e.getFields().forEach((a=>{a.values&&a.values.length&&r(t,a.values)&&s.push({layerId:e.getId(),field:a.id,displayName:e.getDisplayName()})}))})),s}(t,e.sampleValues);s.push(...a)}const a=s.reduce(((e,t)=>{const s=e.find((e=>e.config.layerId===t.layerId&&e.config.field===t.layerId));return s?s.count+=1:e.push({config:t,count:1}),e}),[]);return a.sort(((e,t)=>t.count-e.count)),a.length?a[0].config:null}function r(e,t){for(let s=0;s<e.length;s++){const a=e[s].toString();if(!t.includes(a))return!1}return!0}},159:function(e,t,s){"use strict";s.d(t,"a",(function(){return EMSFileSelect}));var a=s(4),n=s.n(a),i=s(7),r=s(21),l=s(2),o=s(80),c=s(125),u=s(6);class EMSFileSelect extends i.Component{constructor(...e){super(...e),n()(this,"_isMounted",!1),n()(this,"state",{hasLoadedOptions:!1,emsFileOptions:[]}),n()(this,"_loadFileOptions",(async()=>{let e=[];try{e=await Object(o.getEmsFileLayers)()}catch(e){this._isMounted&&this.setState({hasLoadedOptions:!0,emsFileOptions:[]})}const t=e.map((e=>({value:e.getId(),label:e.getDisplayName()})));this._isMounted&&this.setState({hasLoadedOptions:!0,emsFileOptions:t})})),n()(this,"_onChange",(e=>{0!==e.length&&this.props.onChange(e[0].value)}))}componentWillUnmount(){this._isMounted=!1}componentDidMount(){this._isMounted=!0,this._loadFileOptions()}_renderSelect(){if(!this.state.hasLoadedOptions)return Object(u.jsx)(r.EuiSelect,{isLoading:!0});const e=this.state.emsFileOptions.find((e=>e.value===this.props.value));return Object(u.jsx)(r.EuiComboBox,{placeholder:l.i18n.translate("xpack.maps.emsFileSelect.selectPlaceholder",{defaultMessage:"Select EMS boundaries"}),options:this.state.emsFileOptions,selectedOptions:e?[e]:[],onChange:this._onChange,isClearable:!1,singleSelection:!0,isDisabled:0===this.state.emsFileOptions.length,"data-test-subj":"emsVectorComboBox"})}render(){return Object(u.jsx)(r.EuiFormRow,{label:l.i18n.translate("xpack.maps.source.emsFileSelect.selectLabel",{defaultMessage:"EMS boundaries"}),helpText:0===this.state.emsFileOptions.length?Object(c.a)():null,display:this.props.isColumnCompressed?"columnCompressed":"row"},this._renderSelect())}}},208:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var a=s(138);function n(e,t,s){const n=[];return t.rows.forEach((e=>{const t=e[s];t&&"__other__"!==t&&!n.includes(t)&&n.push(t)})),Object(a.a)({sampleValues:n},e)}},501:function(e,t,s){"use strict";s.r(t),s.d(t,"getVisualization",(function(){return j}));var a=s(7),n=s.n(a),i=s(2),r=s(56),l=s(13),o=s(57),c=s(74),u=s(0),d=s(32),p=s.n(d),m=s(6);const h=({title:e,titleId:t,...s})=>Object(m.jsx)("svg",p()({xmlns:"http://www.w3.org/2000/svg",width:"30",height:"22",viewBox:"0 0 30 22"},s),e?Object(m.jsx)("title",{id:t}):null,Object(m.jsx)("path",{className:"lensChartIcon__accent",d:"M.985.001L1.01 0H7c.325 0 .502.078.602.145.105.07.188.17.254.302A1.46 1.46 0 018 1.01v3.982a1.46 1.46 0 01-.144.562.758.758 0 01-.254.302C7.502 5.922 7.325 6 7 6c-.325 0-.502-.078-.602-.145a.758.758 0 01-.254-.302A1.46 1.46 0 016 4.99v-.012a1.984 1.984 0 00-.006-.135 3.457 3.457 0 00-.35-1.29 2.754 2.754 0 00-.933-1.073C4.248 2.172 3.675 2 3 2H1.009a1.46 1.46 0 01-.562-.144.758.758 0 01-.302-.254C.078 1.502 0 1.325 0 1 0 .675.078.498.145.398A.758.758 0 01.447.144 1.46 1.46 0 01.985.001zM0 21v-5.991l.001-.024a1.46 1.46 0 01.143-.538.757.757 0 01.254-.302C.498 14.078.675 14 1 14h8c.675 0 1.248-.172 1.71-.48.458-.305.75-.704.934-1.073A3.453 3.453 0 0012 11.056v-.046l.002-.025a1.464 1.464 0 01.143-.538.758.758 0 01.254-.302c.1-.067.277-.145.602-.145.325 0 .502.078.602.145.105.07.188.17.254.302a1.464 1.464 0 01.143.538l.001.024V21c0 .325-.078.502-.145.602a.758.758 0 01-.302.254 1.464 1.464 0 01-.538.143h-.013L12.99 22H1.009l-.024-.001a1.464 1.464 0 01-.538-.143.758.758 0 01-.302-.254C.078 21.502 0 21.325 0 21zM27.009 14l-.024.001a1.464 1.464 0 00-.538.143.757.757 0 00-.302.255c-.067.099-.145.276-.145.601v1.991l.001.024a1.464 1.464 0 00.143.538.757.757 0 00.254.302c.1.067.277.145.602.145h1.991l.024-.001a1.464 1.464 0 00.538-.143.757.757 0 00.302-.254c.067-.1.145-.277.145-.602v-1.991l-.001-.024a1.464 1.464 0 00-.143-.538.757.757 0 00-.254-.302c-.1-.067-.277-.145-.602-.145h-1.991z"}),Object(m.jsx)("path",{className:"lensChartIcon__subdued",d:"M18 3V.981.959a1.424 1.424 0 00-.128-.522.7.7 0 00-.242-.29C17.53.081 17.346 0 17 0h-6c-.325 0-.502.078-.602.145a.758.758 0 00-.254.302 1.464 1.464 0 00-.143.538L10 1.01v4.013a1.984 1.984 0 01-.006.135 3.457 3.457 0 01-.35 1.29 2.754 2.754 0 01-.933 1.073C8.248 7.828 7.675 8 7 8s-1.248-.172-1.711-.48a2.754 2.754 0 01-.933-1.073A3.457 3.457 0 014 5.022V5.01a1.46 1.46 0 00-.144-.563.758.758 0 00-.254-.302C3.502 4.078 3.325 4 3 4H1.009l-.024.001a1.46 1.46 0 00-.538.143.758.758 0 00-.302.254C.078 4.498 0 4.675 0 5v5.991l.001.024a1.46 1.46 0 00.143.538.758.758 0 00.254.303c.1.066.277.144.602.144h8c.325 0 .502-.078.602-.145a.757.757 0 00.254-.302 1.46 1.46 0 00.143-.538L10 10.99v-.025l.001-.02c0-.027.003-.061.005-.102a3.453 3.453 0 01.35-1.29c.184-.369.476-.768.933-1.073C11.752 8.172 12.325 8 13 8s1.248.172 1.71.48c.458.305.75.704.934 1.073A3.453 3.453 0 0116 10.978v4.013l.001.024a1.464 1.464 0 00.143.538.757.757 0 00.254.302c.1.067.277.145.602.145.325 0 .502-.078.602-.145a.758.758 0 00.254-.302 1.464 1.464 0 00.143-.538v-.012l.001-.012V11c0-.675.172-1.248.48-1.711.305-.457.704-.75 1.073-.933A3.456 3.456 0 0120.944 8H20.99l.025-.002a1.46 1.46 0 00.538-.143.758.758 0 00.302-.254c.067-.1.145-.277.145-.602 0-.325-.078-.502-.145-.602a.758.758 0 00-.302-.254 1.46 1.46 0 00-.538-.143h-.017L20.99 6c-.671-.002-1.24-.173-1.702-.48a2.754 2.754 0 01-.933-1.073A3.453 3.453 0 0118 3.022V3z"}),Object(m.jsx)("path",{className:"lensChartIcon__subdued",d:"M20 3V1.009l.001-.024a1.464 1.464 0 01.143-.538.758.758 0 01.254-.302C20.498.078 20.675 0 21 0h8c.325 0 .502.078.602.145.105.07.188.17.254.302a1.464 1.464 0 01.143.538L30 1.01V11c0 .325-.078.502-.145.602a.758.758 0 01-.302.254 1.464 1.464 0 01-.538.143H29L28.99 12h-7.982l-.024-.001a1.464 1.464 0 01-.538-.143.758.758 0 01-.302-.254c-.067-.1-.145-.277-.145-.602 0-.325.078-.502.145-.602a.758.758 0 01.302-.254 1.464 1.464 0 01.538-.143L21.01 10h.025l.02-.001c.027 0 .061-.003.102-.005a3.456 3.456 0 001.29-.35 2.755 2.755 0 001.073-.933C23.828 8.248 24 7.675 24 7s-.172-1.248-.48-1.711a2.755 2.755 0 00-1.073-.933A3.456 3.456 0 0021.022 4h-.012a1.46 1.46 0 01-.563-.144.757.757 0 01-.302-.254C20.078 3.502 20 3.325 20 3zM20.998 14l-.013.001a1.464 1.464 0 00-.538.143.757.757 0 00-.302.255c-.067.099-.145.276-.145.601 0 .675-.172 1.248-.48 1.71-.305.458-.704.75-1.073.934a3.453 3.453 0 01-1.425.356h-.012l-.025.001a1.464 1.464 0 00-.538.143.757.757 0 00-.302.254c-.067.1-.145.277-.145.602v1.991l.001.024a1.464 1.464 0 00.143.538.757.757 0 00.254.302c.1.067.277.145.602.145h11.991l.024-.001a1.464 1.464 0 00.538-.143.758.758 0 00.302-.254c.067-.1.145-.277.145-.602 0-.325-.078-.502-.145-.602a.758.758 0 00-.302-.254A1.464 1.464 0 0028.99 20H27c-.675 0-1.248-.172-1.71-.48a2.755 2.755 0 01-.934-1.073A3.453 3.453 0 0124 17.022V15c0-.325-.078-.502-.145-.601a.757.757 0 00-.302-.255A1.464 1.464 0 0022.99 14H20.998z"}));var g=s(208),y=s(21),f=s(159);function b(e){let t;const s=v(e.emsFileLayers,e.state.emsLayerId);if(s.length){let a;e.state.emsField&&(a=s.find((t=>e.state.emsField===t.value))),t=Object(m.jsx)(y.EuiFormRow,{label:i.i18n.translate("xpack.maps.choropleth.joinFieldLabel",{defaultMessage:"Join field"}),display:"columnCompressed"},Object(m.jsx)(y.EuiComboBox,{singleSelection:!0,isClearable:!1,options:s,selectedOptions:a?[a]:[],onChange:function(t){0!==t.length&&e.setState({...e.state,emsField:t[0].value})}}))}return Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(f.a,{isColumnCompressed:!0,value:e.state.emsLayerId?e.state.emsLayerId:null,onChange:function(t){const s=v(e.emsFileLayers,t);e.setState({...e.state,emsLayerId:t,emsField:s.length?s[0].value:void 0})}}),t)}function v(e,t){if(!t)return[];const s=e.find((e=>e.getId()===t));return s?s.getFieldsInLanguage().filter((e=>"id"===e.type)).map((e=>({value:e.name,label:e.description}))):[]}const L="region_key",I="metric",C=i.i18n.translate("xpack.maps.lens.choropleth.label",{defaultMessage:"Region map"}),j=({paletteService:e,theme:t,emsFileLayers:s})=>({id:"lnsChoropleth",visualizationTypes:[{id:"lnsChoropleth",icon:h,label:C,groupLabel:i.i18n.translate("xpack.maps.lens.groupLabel",{defaultMessage:"Map"}),sortPriority:1,showExperimentalBadge:!0}],getVisualizationTypeId:()=>"lnsChoropleth",clearLayer(e){const t={...e};return delete t.emsLayerId,delete t.emsField,delete t.regionAccessor,delete t.valueAccessor,t},getLayerIds:e=>[e.layerId],getDescription:()=>({icon:h,label:C}),getSuggestions:e=>function(e,t){const{activeData:s,keptLayerIds:a,state:n,table:r}=e;if(!s)return[];if(n&&"unchanged"===r.changeType||a.length>1||a.length&&r.layerId!==a[0])return[];const[l,o]=Object(u.partition)(r.columns,(e=>e.operation.isBucketed));if(1!==l.length||1!==o.length)return[];const c=o[0],d=[];return l.filter((e=>"string"===e.operation.dataType)).forEach((e=>{for(const a in s)if(s.hasOwnProperty(a)){const n=Object(g.a)(t,s[a],e.columnId);n&&d.push({title:i.i18n.translate("xpack.maps.lens.choroplethChart.suggestionLabel",{defaultMessage:"{emsLayerLabel} by {metricLabel}",values:{emsLayerLabel:n.displayName,metricLabel:c.operation.label.toLowerCase()}}),score:.7,state:{layerId:a,emsLayerId:n.layerId,emsField:n.field,valueAccessor:c.columnId,regionAccessor:e.columnId},previewIcon:h})}})),d}(e,s),initialize:(e,t)=>t||{layerId:e(),layerType:c.layerTypes.DATA},getConfiguration:({state:e})=>({groups:[{groupId:L,groupLabel:i.i18n.translate("xpack.maps.lens.choroplethChart.regionKeyLabel",{defaultMessage:"Region key"}),layerId:e.layerId,accessors:e.regionAccessor?[{columnId:e.regionAccessor}]:[],supportsMoreColumns:!e.regionAccessor,filterOperations:e=>e.isBucketed&&"string"===e.dataType,enableDimensionEditor:!0,required:!0,dataTestSubj:"lnsChoropleth_regionKeyDimensionPanel"},{groupId:I,groupLabel:i.i18n.translate("xpack.maps.lens.choroplethChart.metricValueLabel",{defaultMessage:"Metric"}),layerId:e.layerId,accessors:e.valueAccessor?[{columnId:e.valueAccessor}]:[],supportsMoreColumns:!e.valueAccessor,filterOperations:e=>!e.isBucketed&&"number"===e.dataType,enableDimensionEditor:!0,required:!0,dataTestSubj:"lnsChoropleth_valueDimensionPanel"}]}),getSupportedLayers:()=>[{type:c.layerTypes.DATA,label:i.i18n.translate("xpack.maps.lens.choroplethChart.addLayer",{defaultMessage:"Add visualization layer"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return c.layerTypes.DATA},toExpression:(e,t,s,a={})=>{if(!e.regionAccessor||!e.valueAccessor)return null;const n=a[e.layerId];return{type:"expression",chain:[...n?n.chain:[],{type:"function",function:"lens_choropleth_chart",arguments:{title:[(null==s?void 0:s.title)||""],layerId:[e.layerId],emsField:e.emsField?[e.emsField]:[],emsLayerId:e.emsLayerId?[e.emsLayerId]:[],regionAccessor:[e.regionAccessor],valueAccessor:[e.valueAccessor]}}]}},toPreviewExpression:(e,t)=>null,setDimension({columnId:e,groupId:t,prevState:s}){const a={};return t===L?a.regionAccessor=e:t===I&&(a.valueAccessor=e),{...s,...a}},removeDimension({prevState:e,layerId:t,columnId:s}){const a={...e};return e.regionAccessor===s?(delete a.regionAccessor,delete a.emsLayerId,delete a.emsField):e.valueAccessor===s&&delete a.valueAccessor,a},renderDimensionEditor(e,a){a.groupId===L&&Object(l.render)(Object(m.jsx)(o.KibanaThemeProvider,{theme$:t.theme$},Object(m.jsx)(r.I18nProvider,null,Object(m.jsx)(b,{emsFileLayers:s,state:a.state,setState:a.setState}))),e)},getErrorMessages(e){}})},80:function(e,t,s){"use strict";s.r(t),s.d(t,"getKibanaTileMap",(function(){return l})),s.d(t,"getEmsFileLayers",(function(){return o})),s.d(t,"getEmsTmsServices",(function(){return c})),s.d(t,"getGlyphUrl",(function(){return m})),s.d(t,"isRetina",(function(){return h})),s.d(t,"makePublicExecutionContext",(function(){return g}));var a=s(1),n=s(8),i=s(27),r=s(0);function l(){return Object(n.P)()}async function o(){return Object(n.k)().isEMSEnabled()?(await p()).getFileLayers():[]}async function c(){return Object(n.k)().isEMSEnabled()?(await p()).getTMSServices():[]}let u,d=null;async function p(){d||(d=new Promise((async(e,t)=>{try{e(await Object(n.A)().createEMSClient())}catch(e){t(e)}})));const e=await d,t=Object(i.c)();return u!==t&&(u=t,e.addQueryParams({license:t||""})),e}function m(){const e=Object(n.k)();return e.isEMSEnabled()?e.getEMSFontLibraryUrl():Object(n.q)().basePath.prepend(`/${a.G}/{fontstack}/{range}`)}function h(){return 2===window.devicePixelRatio}function g(e){const t=Object(n.n)().get(),s=function(e){return Object(r.omitBy)({name:a.e,type:"application",...e},r.isUndefined)}({url:window.location.pathname,description:e});return void 0!==t.name&&t.name!==s.name?{...t,child:s}:{...t,...s}}}}]);