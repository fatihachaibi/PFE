/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.osquery_bundle_jsonpfunction=window.osquery_bundle_jsonpfunction||[]).push([[3],{147:function(e,t,a){e.exports={ReactQueryDevtools:function(){return null},ReactQueryDevtoolsPanel:function(){return null}}},148:function(e,t,a){"use strict";const l=a(149),r=a(150),n=a(151);function i(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function s(e,t){return t.encode?t.strict?l(e):encodeURIComponent(e):e}function u(e,t){return t.decode?r(e):e}function c(e){return Array.isArray(e)?e.sort():"object"==typeof e?c(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function o(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function d(e){const t=(e=o(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function m(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function p(e,t){i((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const a=function(e){let t;switch(e.arrayFormat){case"index":return(e,a,l)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===l[e]&&(l[e]={}),l[e][t[1]]=a):l[e]=a};case"bracket":return(e,a,l)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==l[e]?l[e]=[].concat(l[e],a):l[e]=[a]:l[e]=a};case"comma":case"separator":return(t,a,l)=>{const r="string"==typeof a&&a.split("").indexOf(e.arrayFormatSeparator)>-1?a.split(e.arrayFormatSeparator).map((t=>u(t,e))):null===a?a:u(a,e);l[t]=r};default:return(e,t,a)=>{void 0!==a[e]?a[e]=[].concat(a[e],t):a[e]=t}}}(t),l=Object.create(null);if("string"!=typeof e)return l;if(!(e=e.trim().replace(/^[?#&]/,"")))return l;for(const r of e.split("&")){let[e,i]=n(t.decode?r.replace(/\+/g," "):r,"=");i=void 0===i?null:["comma","separator"].includes(t.arrayFormat)?i:u(i,t),a(u(e,t),i,l)}for(const e of Object.keys(l)){const a=l[e];if("object"==typeof a&&null!==a)for(const e of Object.keys(a))a[e]=m(a[e],t);else l[e]=m(a,t)}return!1===t.sort?l:(!0===t.sort?Object.keys(l).sort():Object.keys(l).sort(t.sort)).reduce(((e,t)=>{const a=l[t];return Boolean(a)&&"object"==typeof a&&!Array.isArray(a)?e[t]=c(a):e[t]=a,e}),Object.create(null))}t.extract=d,t.parse=p,t.stringify=(e,t)=>{if(!e)return"";i((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const a=a=>t.skipNull&&null==e[a]||t.skipEmptyString&&""===e[a],l=function(e){switch(e.arrayFormat){case"index":return t=>(a,l)=>{const r=a.length;return void 0===l||e.skipNull&&null===l||e.skipEmptyString&&""===l?a:null===l?[...a,[s(t,e),"[",r,"]"].join("")]:[...a,[s(t,e),"[",s(r,e),"]=",s(l,e)].join("")]};case"bracket":return t=>(a,l)=>void 0===l||e.skipNull&&null===l||e.skipEmptyString&&""===l?a:null===l?[...a,[s(t,e),"[]"].join("")]:[...a,[s(t,e),"[]=",s(l,e)].join("")];case"comma":case"separator":return t=>(a,l)=>null==l||0===l.length?a:0===a.length?[[s(t,e),"=",s(l,e)].join("")]:[[a,s(l,e)].join(e.arrayFormatSeparator)];default:return t=>(a,l)=>void 0===l||e.skipNull&&null===l||e.skipEmptyString&&""===l?a:null===l?[...a,s(t,e)]:[...a,[s(t,e),"=",s(l,e)].join("")]}}(t),r={};for(const t of Object.keys(e))a(t)||(r[t]=e[t]);const n=Object.keys(r);return!1!==t.sort&&n.sort(t.sort),n.map((a=>{const r=e[a];return void 0===r?"":null===r?s(a,t):Array.isArray(r)?r.reduce(l(a),[]).join("&"):s(a,t)+"="+s(r,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[a,l]=n(e,"#");return Object.assign({url:a.split("?")[0]||"",query:p(d(e),t)},t&&t.parseFragmentIdentifier&&l?{fragmentIdentifier:u(l,t)}:{})},t.stringifyUrl=(e,a)=>{a=Object.assign({encode:!0,strict:!0},a);const l=o(e.url).split("?")[0]||"",r=t.extract(e.url),n=t.parse(r,{sort:!1}),i=Object.assign(n,e.query);let u=t.stringify(i,a);u&&(u=`?${u}`);let c=function(e){let t="";const a=e.indexOf("#");return-1!==a&&(t=e.slice(a)),t}(e.url);return e.fragmentIdentifier&&(c=`#${s(e.fragmentIdentifier,a)}`),`${l}${u}${c}`}},149:function(e,t,a){"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},150:function(e,t,a){"use strict";var l="%[a-f0-9]{2}",r=new RegExp(l,"gi"),n=new RegExp("("+l+")+","gi");function i(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var a=e.slice(0,t),l=e.slice(t);return Array.prototype.concat.call([],i(a),i(l))}function s(e){try{return decodeURIComponent(e)}catch(l){for(var t=e.match(r),a=1;a<t.length;a++)t=(e=i(t,a).join("")).match(r);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},a=n.exec(e);a;){try{t[a[0]]=decodeURIComponent(a[0])}catch(e){var l=s(a[0]);l!==a[0]&&(t[a[0]]=l)}a=n.exec(e)}t["%C2"]="�";for(var r=Object.keys(t),i=0;i<r.length;i++){var u=r[i];e=e.replace(new RegExp(u,"g"),t[u])}return e}(e)}}},151:function(e,t,a){"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const a=e.indexOf(t);return-1===a?[e]:[e.slice(0,a),e.slice(a+t.length)]}},181:function(e,t,a){"use strict";a.r(t),a.d(t,"renderApp",(function(){return Oa}));var l=a(10),r=a(41),n=a(0),i=a.n(n),s=a(39),u=a.n(s),c=a(13),o=a(27),d=a(29),m=a.n(d),p=a(44),E=a(147),g=a(45);const y=m.a.div.withConfig({displayName:"Container",componentId:"sc-gz9q42-0"})(["min-height:calc( 100vh - ","px );background:",";display:flex;flex-direction:column;"],(e=>2*parseFloat(e.theme.eui.euiHeaderHeightCompensation)),(e=>e.theme.eui.euiColorEmptyShade)),b=m.a.div.withConfig({displayName:"Wrapper",componentId:"sc-gz9q42-1"})(["display:flex;flex-direction:column;flex:1;"]),v=m.a.nav.withConfig({displayName:"Nav",componentId:"sc-gz9q42-2"})(["background:",";border-bottom:",";padding:",";.euiTabs{padding-left:3px;margin-left:-3px;}"],(e=>e.theme.eui.euiColorEmptyShade),(e=>e.theme.eui.euiBorderThin),(e=>`${e.theme.eui.euiSize} ${e.theme.eui.euiSizeL} ${e.theme.eui.euiSize} ${e.theme.eui.euiSizeL}`));var f=a(3),k=a.n(f);const x=m.a.div.withConfig({displayName:"Container",componentId:"sc-399yyp-0"})(["border-bottom:",";background-color:",";"],(e=>e.theme.eui.euiBorderThin),(e=>e.theme.eui.euiPageBackgroundColor)),h=m.a.div.withConfig({displayName:"Wrapper",componentId:"sc-399yyp-1"})(["max-width:","px;margin-left:auto;margin-right:auto;padding-top:",";padding-left:",";padding-right:",";"],(e=>e.maxWidth||1200),(e=>e.theme.eui.paddingSizes.xl),(e=>e.theme.eui.paddingSizes.m),(e=>e.theme.eui.paddingSizes.m)),O=m()(l.EuiTabs).withConfig({displayName:"Tabs",componentId:"sc-399yyp-2"})(["top:1px;&:before{height:0px;}"]),j=Object(n.memo)((({leftColumn:e,rightColumn:t,rightColumnGrow:a})=>i.a.createElement(l.EuiFlexGroup,{alignItems:"center"},e?i.a.createElement(l.EuiFlexItem,null,e):null,t?i.a.createElement(l.EuiFlexItem,{grow:a},t):null)));j.displayName="HeaderColumns";const q=({children:e,leftColumn:t,rightColumn:a,rightColumnGrow:r,tabs:n,maxWidth:s,tabsClassName:u,"data-test-subj":c})=>i.a.createElement(x,{"data-test-subj":c},i.a.createElement(h,{maxWidth:s},i.a.createElement(j,{leftColumn:t,rightColumn:a,rightColumnGrow:r}),e,i.a.createElement(l.EuiFlexGroup,null,n?i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiSpacer,{size:"s"}),i.a.createElement(O,{className:u},n.map((e=>i.a.createElement(l.EuiTab,k()({},e,{key:e.id}),e.name))))):i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiSpacer,{size:"l"}))))),M=i.a.memo(q),C=m()(l.EuiPage).withConfig({displayName:"Page",componentId:"sc-18dk5bh-0"})(["background:",";width:100%;align-self:center;margin-left:0;margin-right:0;flex:1;"],(e=>e.theme.eui.euiColorEmptyShade)),F=m.a.div.withConfig({displayName:"ContentWrapper",componentId:"sc-18dk5bh-1"})(["height:100%;"]),S=({restrictWidth:e,restrictHeaderWidth:t,children:a,headerChildren:r,"data-test-subj":s,...u})=>i.a.createElement(n.Fragment,null,i.a.createElement(M,k()({maxWidth:t,"data-test-subj":s?`${s}_header`:void 0},u),r),i.a.createElement(C,{restrictWidth:e||1200,"data-test-subj":s?`${s}_page`:void 0},i.a.createElement(l.EuiPageBody,null,i.a.createElement(F,null,i.a.createElement(l.EuiSpacer,{size:"m"}),a))));var T=a(26),I=a(6),w=a(52),_=a(11);const P={href:w.a.overview(),text:T.i18n.translate("xpack.osquery.breadcrumbs.appTitle",{defaultMessage:"Osquery"})},Q={base:()=>[P],overview:()=>[P,{text:T.i18n.translate("xpack.osquery.breadcrumbs.overviewPageTitle",{defaultMessage:"Overview"})}],live_queries:()=>[P,{text:T.i18n.translate("xpack.osquery.breadcrumbs.liveQueriesPageTitle",{defaultMessage:"Live queries"})}],live_query_new:()=>[P,{href:w.a.live_queries(),text:T.i18n.translate("xpack.osquery.breadcrumbs.liveQueriesPageTitle",{defaultMessage:"Live queries"})},{text:T.i18n.translate("xpack.osquery.breadcrumbs.newLiveQueryPageTitle",{defaultMessage:"New"})}],live_query_details:({liveQueryId:e})=>[P,{href:w.a.live_queries(),text:T.i18n.translate("xpack.osquery.breadcrumbs.liveQueriesPageTitle",{defaultMessage:"Live queries"})},{text:e}],saved_queries:()=>[P,{text:T.i18n.translate("xpack.osquery.breadcrumbs.savedQueriesPageTitle",{defaultMessage:"Saved queries"})}],saved_query_new:()=>[P,{href:w.a.saved_queries(),text:T.i18n.translate("xpack.osquery.breadcrumbs.savedQueriesPageTitle",{defaultMessage:"Saved queries"})},{text:T.i18n.translate("xpack.osquery.breadcrumbs.newSavedQueryPageTitle",{defaultMessage:"New"})}],saved_query_edit:({savedQueryName:e})=>[P,{href:w.a.saved_queries(),text:T.i18n.translate("xpack.osquery.breadcrumbs.savedQueriesPageTitle",{defaultMessage:"Saved queries"})},{text:e}],packs:()=>[P,{text:T.i18n.translate("xpack.osquery.breadcrumbs.packsPageTitle",{defaultMessage:"Packs"})}],pack_add:()=>[P,{href:w.a.packs(),text:T.i18n.translate("xpack.osquery.breadcrumbs.packsPageTitle",{defaultMessage:"Packs"})},{text:T.i18n.translate("xpack.osquery.breadcrumbs.addpacksPageTitle",{defaultMessage:"Add"})}],pack_details:({packName:e})=>[P,{href:w.a.packs(),text:T.i18n.translate("xpack.osquery.breadcrumbs.packsPageTitle",{defaultMessage:"Packs"})},{text:e}],pack_edit:({packName:e,packId:t})=>[P,{href:w.a.packs(),text:T.i18n.translate("xpack.osquery.breadcrumbs.packsPageTitle",{defaultMessage:"Packs"})},{href:w.a.pack_details({packId:t}),text:e},{text:T.i18n.translate("xpack.osquery.breadcrumbs.editpacksPageTitle",{defaultMessage:"Edit"})}]};function L(e,t={}){var a;const{chrome:l,http:r,application:n}=Object(_.e)().services,i=(null===(a=Q[e])||void 0===a?void 0:a.call(Q,t).map((e=>{const t=e.href?r.basePath.prepend(`${I.a}${e.href}`):void 0;return{...e,href:t,onClick:t?e=>{e.metaKey||e.altKey||e.ctrlKey||e.shiftKey||(e.preventDefault(),n.navigateToUrl(t))}:void 0}})))||[],s=[...i].reverse().map((e=>e.text));l.docTitle.change(s),l.setBreadcrumbs(i)}var N=a(12),B=a(32),A=a(55),z=a(50),D=a(46);const R=({actionId:e})=>{const t=Object(_.f)(`live_queries/${e}`);return i.a.createElement(l.EuiButtonIcon,k()({iconType:"visTable"},t))};R.displayName="ActionTableResultsButton";const G=()=>{var e;const t=Object(_.e)().services.application.capabilities.osquery,{push:a}=Object(c.useHistory)(),[r,s]=Object(n.useState)(0),[u,o]=Object(n.useState)(20),{data:d}=(({activePage:e,direction:t,limit:a,sortField:l,filterQuery:r,skip:n=!1})=>{const{data:i}=Object(_.e)().services,s=Object(D.a)();return Object(p.useQuery)(["actions",{activePage:e,direction:t,limit:a,sortField:l}],(async()=>{const n=await Object(B.lastValueFrom)(i.search.search({factoryQueryType:z.b.actions,filterQuery:Object(A.a)(r),pagination:Object(A.b)(e,a),sort:{direction:t,field:l}},{strategy:"osquerySearchStrategy"}));return{...n,actions:n.edges,inspect:Object(A.c)(n,{})}}),{keepPreviousData:!0,enabled:!n,onSuccess:()=>s(),onError:e=>s(e,{title:T.i18n.translate("xpack.osquery.all_actions.fetchError",{defaultMessage:"Error while fetching actions"})})})})({activePage:r,limit:u,direction:z.a.desc,sortField:"@timestamp"}),m=Object(n.useCallback)((({page:e={}})=>{const{index:t,size:a}=e;s(t),o(a)}),[]),E=Object(n.useCallback)(((e,t)=>i.a.createElement(l.EuiCodeBlock,{language:"sql",fontSize:"s",paddingSize:"none",transparentBackground:!0},t._source.data.query)),[]),g=Object(n.useCallback)(((e,t)=>{var a,l;return i.a.createElement(i.a.Fragment,null,null!==(a=null===(l=t.fields.agents)||void 0===l?void 0:l.length)&&void 0!==a?a:0)}),[]),y=Object(n.useCallback)((e=>Object(N.isArray)(e)?e[0]:"-"),[]),b=Object(n.useCallback)(((e,t)=>i.a.createElement(i.a.Fragment,null,Object(l.formatDate)(t.fields["@timestamp"][0]))),[]),v=Object(n.useCallback)((e=>i.a.createElement(R,{actionId:e.fields.action_id[0]})),[]),f=Object(n.useCallback)((e=>a("/live_queries/new",{form:Object(N.pickBy)({agentIds:e.fields.agents,query:e._source.data.query,ecs_mapping:e._source.data.ecs_mapping,savedQueryId:e._source.data.saved_query_id},(e=>!Object(N.isEmpty)(e)))})),[a]),k=Object(n.useCallback)((()=>t.runSavedQueries||t.writeLiveQueries),[t.runSavedQueries,t.writeLiveQueries]),x=Object(n.useMemo)((()=>[{field:"query",name:T.i18n.translate("xpack.osquery.liveQueryActions.table.queryColumnTitle",{defaultMessage:"Query"}),truncateText:!0,render:E},{field:"agents",name:T.i18n.translate("xpack.osquery.liveQueryActions.table.agentsColumnTitle",{defaultMessage:"Agents"}),width:"100px",render:g},{field:"created_at",name:T.i18n.translate("xpack.osquery.liveQueryActions.table.createdAtColumnTitle",{defaultMessage:"Created at"}),width:"200px",render:b},{field:"fields.user_id",name:T.i18n.translate("xpack.osquery.liveQueryActions.table.createdByColumnTitle",{defaultMessage:"Run by"}),width:"200px",render:y},{name:T.i18n.translate("xpack.osquery.liveQueryActions.table.viewDetailsColumnTitle",{defaultMessage:"View details"}),actions:[{type:"icon",icon:"play",onClick:f,available:k},{render:v}]}]),[f,k,v,g,y,E,b]),h=Object(n.useMemo)((()=>{var e;return{pageIndex:r,pageSize:u,totalItemCount:null!==(e=null==d?void 0:d.totalCount)&&void 0!==e?e:0,pageSizeOptions:[20,50,100]}}),[null==d?void 0:d.totalCount,r,u]);return i.a.createElement(l.EuiBasicTable,{items:null!==(e=null==d?void 0:d.actions)&&void 0!==e?e:[],columns:x,pagination:h,onChange:m})},$=i.a.memo(G),U=()=>{L("live_queries");const e=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.liveQueriesHistory.pageTitle",defaultMessage:"Live queries history"})))))),[]);return i.a.createElement(S,{leftColumn:e,rightColumn:i.a.createElement(W,null),rightColumnGrow:!1},i.a.createElement($,null))},V=i.a.memo(U),W=i.a.memo((()=>{const e=Object(_.e)().services.application.capabilities.osquery,t=Object(_.f)("live_queries/new");return i.a.createElement(l.EuiButton,k()({fill:!0},t,{iconType:"plusInCircle",isDisabled:!(e.writeLiveQueries||e.runSavedQueries)}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.liveQueriesHistory.newLiveQueryButtonLabel",defaultMessage:"New live query"}))}));W.displayName="NewLiveQueryButton";var H=a(148),Y=a.n(H),K=a(86);const X=()=>{var e;L("live_query_new");const{replace:t}=Object(c.useHistory)(),a=Object(c.useLocation)(),r=Object(_.f)("live_queries"),[s,u]=Object(n.useState)({}),d=Object(n.useMemo)((()=>{const e=Y.a.parse(a.search);return null!=e&&e.agentPolicyId?[null==e?void 0:e.agentPolicyId]:void 0}),[a.search]);Object(n.useEffect)((()=>{var e,l;null!==(e=a.state)&&void 0!==e&&e.form&&(u(null===(l=a.state)||void 0===l?void 0:l.form),t({state:null}))}),[null===(e=a.state)||void 0===e?void 0:e.form,t]);const m=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,k()({iconType:"arrowLeft"},r,{flush:"left",size:"xs"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.newLiveQuery.viewLiveQueriesHistoryTitle",defaultMessage:"View live queries history"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.newLiveQuery.pageTitle",defaultMessage:"New live query"})))))),[r]);return i.a.createElement(S,{leftColumn:m},i.a.createElement(K.a,k()({agentPolicyIds:d},s)))},J=i.a.memo(X);var Z=a(105),ee=a(124);const te=()=>{var e,t,a,r;const{actionId:s}=Object(c.useParams)();L("live_query_details",{liveQueryId:s});const u=Object(_.f)("live_queries"),{data:d}=Object(Z.a)({actionId:s}),m=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,k()({iconType:"arrowLeft"},u,{flush:"left",size:"xs"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.liveQueryDetails.viewLiveQueriesHistoryTitle",defaultMessage:"View live queries history"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.liveQueryDetails.pageTitle",defaultMessage:"Live query details"})))))),[u]);return i.a.createElement(S,{leftColumn:m,rightColumnGrow:!1},i.a.createElement(l.EuiCodeBlock,{language:"sql",fontSize:"m",paddingSize:"m"},null==d||null===(e=d.actionDetails._source)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.query),i.a.createElement(l.EuiSpacer,null),i.a.createElement(ee.a,{actionId:s,agentIds:null==d||null===(a=d.actionDetails)||void 0===a||null===(r=a.fields)||void 0===r?void 0:r.agents,startDate:Object(N.get)(d,["actionDetails","fields","@timestamp","0"]),endDate:Object(N.get)(d,"actionDetails.fields.expiration[0]")}))},ae=i.a.memo(te);var le=a(66);const re=()=>{const e=Object(_.e)().services.application.capabilities.osquery;L("live_queries");const t=Object(c.useRouteMatch)();return e.readLiveQueries?i.a.createElement(c.Switch,null,i.a.createElement(c.Route,{path:`${t.url}/new`},e.runSavedQueries&&e.readSavedQueries||e.writeLiveQueries?i.a.createElement(J,null):i.a.createElement(le.a,null)),i.a.createElement(c.Route,{path:`${t.url}/:actionId`},i.a.createElement(ae,null)),i.a.createElement(c.Route,{path:`${t.url}`},i.a.createElement(V,null))):i.a.createElement(le.a,null)},ne=i.a.memo(re);var ie=a(37),se=a.n(ie),ue=a(60);const ce=({disabled:e=!1,savedQuery:t})=>{const{push:a}=Object(c.useHistory)(),r=Object(n.useCallback)((()=>a("/live_queries/new",{form:{savedQueryId:t.id,query:t.attributes.query,ecs_mapping:t.attributes.ecs_mapping}})),[a,t]);return i.a.createElement(l.EuiButtonIcon,{color:"primary",iconType:"play",isDisabled:e,onClick:r,"aria-label":T.i18n.translate("xpack.osquery.savedQueryList.queriesTable.runActionAriaLabel",{defaultMessage:"Run {savedQueryName}",values:{savedQueryName:t.attributes.name}})})},oe=i.a.memo(ce),de=({disabled:e=!1,savedQueryId:t,savedQueryName:a})=>{const r=Object(_.f)(`saved_queries/${t}`);return i.a.createElement(l.EuiButtonIcon,k()({color:"primary"},r,{iconType:"pencil",isDisabled:e,"aria-label":T.i18n.translate("xpack.osquery.savedQueryList.queriesTable.editActionAriaLabel",{defaultMessage:"Edit {savedQueryName}",values:{savedQueryName:a}})}))},me=i.a.memo(de),pe=()=>{const e=Object(_.e)().services.application.capabilities.osquery;L("saved_queries");const t=Object(_.f)("saved_queries/new"),[a,r]=Object(n.useState)(0),[s,u]=Object(n.useState)(20),[c,d]=Object(n.useState)("attributes.updated_at"),[m,p]=Object(n.useState)("desc"),{data:E}=Object(ue.a)({isLive:!0}),g=Object(n.useCallback)((e=>i.a.createElement(me,{savedQueryId:e.id,savedQueryName:e.attributes.name})),[]),y=Object(n.useCallback)((t=>e.runSavedQueries||e.writeLiveQueries?i.a.createElement(oe,{savedQuery:t,disabled:!1}):i.a.createElement(i.a.Fragment,null)),[e.runSavedQueries,e.writeLiveQueries]),b=Object(n.useCallback)(((e,t)=>{if(!e)return"-";const a=t.attributes.updated_by!==t.attributes.created_by?` @ ${t.attributes.updated_by}`:"";return e?`${se()(e).fromNow()}${a}`:"-"}),[]),v=Object(n.useCallback)((e=>{const t=e&&e.length>80?`${null==e?void 0:e.substring(0,80)}...`:e;return i.a.createElement(l.EuiToolTip,{content:i.a.createElement(l.EuiFlexItem,null,e)},i.a.createElement(l.EuiFlexItem,{grow:!1},t))}),[]),f=Object(n.useMemo)((()=>[{field:"attributes.id",name:T.i18n.translate("xpack.osquery.savedQueries.table.queryIdColumnTitle",{defaultMessage:"Query ID"}),sortable:e=>e.attributes.id.toLowerCase(),truncateText:!0,width:"15%"},{field:"attributes.description",name:T.i18n.translate("xpack.osquery.savedQueries.table.descriptionColumnTitle",{defaultMessage:"Description"}),render:v,width:"50%"},{field:"attributes.created_by",name:T.i18n.translate("xpack.osquery.savedQueries.table.createdByColumnTitle",{defaultMessage:"Created by"}),width:"15%",sortable:!0,truncateText:!0},{field:"attributes.updated_at",name:T.i18n.translate("xpack.osquery.savedQueries.table.updatedAtColumnTitle",{defaultMessage:"Last updated at"}),width:"10%",sortable:e=>e.attributes.updated_at?Date.parse(e.attributes.updated_at):0,truncateText:!0,render:b},{name:T.i18n.translate("xpack.osquery.savedQueries.table.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:y},{render:g}]}]),[v,g,y,b]),x=Object(n.useCallback)((({page:e={},sort:t={}})=>{r(e.index),u(e.size),d(t.field),p(t.direction)}),[]),h=Object(n.useMemo)((()=>{var e;return{pageIndex:a,pageSize:s,totalItemCount:null!==(e=null==E?void 0:E.total)&&void 0!==e?e:0,pageSizeOptions:[10,20,50,100]}}),[a,s,null==E?void 0:E.total]),O=Object(n.useMemo)((()=>({sort:{field:c,direction:m}})),[m,c]),j=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.savedQueryList.pageTitle",defaultMessage:"Saved queries"})))))),[]),q=Object(n.useMemo)((()=>i.a.createElement(l.EuiButton,k()({fill:!0},t,{iconType:"plusInCircle",isDisabled:!e.writeSavedQueries}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.savedQueryList.addSavedQueryButtonLabel",defaultMessage:"Add saved query"}))),[e.writeSavedQueries,t]);return i.a.createElement(S,{leftColumn:j,rightColumn:q,rightColumnGrow:!1},(null==E?void 0:E.saved_objects)&&i.a.createElement(l.EuiInMemoryTable,{items:null==E?void 0:E.saved_objects,itemId:"id",columns:f,pagination:h,sorting:O,onChange:x,rowHeader:"id"}))},Ee=i.a.memo(pe);var ge=a(87),ye=a(74);const be=({defaultValue:e,handleSubmit:t})=>{const a=Object(_.f)("saved_queries"),{form:r}=Object(ye.a)({defaultValue:e,handleSubmit:t}),{submit:n,isSubmitting:s,isValid:u}=r;return i.a.createElement(g.e,{form:r},i.a.createElement(ge.a,{hasPlayground:!0,isValid:u}),i.a.createElement(l.EuiBottomBar,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiFlexGroup,{gutterSize:"m"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButtonEmpty,k()({color:"ghost"},a),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.addSavedQuery.form.cancelButtonLabel",defaultMessage:"Cancel"}))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButton,{isLoading:s,color:"primary",fill:!0,size:"m",iconType:"save",onClick:n},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.addSavedQuery.form.saveQueryButtonLabel",defaultMessage:"Save query"}))))))),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}))},ve=i.a.memo(be);var fe=a(119);const ke=()=>{L("saved_query_new");const e=Object(_.f)("saved_queries"),{mutateAsync:t}=Object(fe.a)({withRedirect:!0}),a=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,k()({iconType:"arrowLeft"},e,{flush:"left",size:"xs"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.addSavedQuery.viewSavedQueriesListTitle",defaultMessage:"View all saved queries"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.addSavedQuery.pageTitle",defaultMessage:"Add saved query"})))))),[e]);return i.a.createElement(S,{leftColumn:a},i.a.createElement(ve,{handleSubmit:t}))},xe=i.a.memo(ke);var he=a(31);const Oe=({defaultValue:e,handleSubmit:t,viewMode:a})=>{const r=Object(_.f)("saved_queries"),{form:n}=Object(ye.a)({defaultValue:e,handleSubmit:t}),{submit:s,isSubmitting:u}=n;return i.a.createElement(g.e,{form:n},i.a.createElement(ge.a,{viewMode:a,hasPlayground:!0}),!a&&i.a.createElement(i.a.Fragment,null,i.a.createElement(l.EuiBottomBar,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiFlexGroup,{gutterSize:"m"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButtonEmpty,k()({color:"ghost"},r),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editSavedQuery.form.cancelButtonLabel",defaultMessage:"Cancel"}))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButton,{isLoading:u,color:"primary",fill:!0,size:"m",iconType:"save",onClick:s},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editSavedQuery.form.updateQueryButtonLabel",defaultMessage:"Update query"}))))))),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"})))},je=i.a.memo(Oe);var qe=a(125);const Me=m()(l.EuiCallOut).withConfig({displayName:"StyledEuiCallOut",componentId:"sc-hxtu8g-0"})(["margin:10px;"]),Ce=()=>{var e,t,a;const r=Object(_.e)().services.application.capabilities.osquery,[s,u]=Object(n.useState)(!1),{savedQueryId:d}=Object(c.useParams)(),m=Object(_.f)("saved_queries"),{isLoading:p,data:E}=Object(qe.c)({savedQueryId:d}),g=Object(qe.d)({savedQueryId:d}),y=Object(qe.b)({savedQueryId:d});L("saved_query_edit",{savedQueryName:null!==(e=null==E||null===(t=E.attributes)||void 0===t?void 0:t.id)&&void 0!==e?e:""});const b=Object(n.useMemo)((()=>{var e;return null==E||null===(e=E.attributes)||void 0===e?void 0:e.prebuilt}),[E]),v=Object(n.useMemo)((()=>!r.writeSavedQueries||b),[r.writeSavedQueries,b]),f=Object(n.useCallback)((()=>{u(!1)}),[]),x=Object(n.useCallback)((()=>{u(!0)}),[]),h=Object(n.useCallback)((()=>{y.mutateAsync().then((()=>{f()}))}),[y,f]),O=Object(n.useMemo)((()=>{var e,t,a,r;return i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,k()({iconType:"arrowLeft"},m,{flush:"left",size:"xs"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editSavedQuery.viewSavedQueriesListTitle",defaultMessage:"View all saved queries"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,v?i.a.createElement(i.a.Fragment,null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.viewSavedQuery.pageTitle",defaultMessage:'"{savedQueryId}" details',values:{savedQueryId:null!==(e=null==E||null===(t=E.attributes)||void 0===t?void 0:t.id)&&void 0!==e?e:""}}),b&&i.a.createElement(Me,{size:"s"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.viewSavedQuery.prebuiltInfo",defaultMessage:"This is a prebuilt Elastic query, and it cannot be edited."}))):i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editSavedQuery.pageTitle",defaultMessage:'Edit "{savedQueryId}"',values:{savedQueryId:null!==(a=null==E||null===(r=E.attributes)||void 0===r?void 0:r.id)&&void 0!==a?a:""}})))))}),[b,null==E||null===(a=E.attributes)||void 0===a?void 0:a.id,m,v]),j=Object(n.useMemo)((()=>i.a.createElement(l.EuiButton,{color:"danger",onClick:x,iconType:"trash"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editSavedQuery.deleteSavedQueryButtonLabel",defaultMessage:"Delete query"}))),[x]);return p?null:i.a.createElement(S,{leftColumn:O,rightColumn:v?void 0:j,rightColumnGrow:!1},!p&&!Object(he.isEmpty)(E)&&i.a.createElement(je,{defaultValue:null==E?void 0:E.attributes,handleSubmit:g.mutateAsync,viewMode:v}),s?i.a.createElement(l.EuiConfirmModal,{title:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deleteSavedQuery.confirmationModal.title",defaultMessage:"Are you sure you want to delete this query?"}),onCancel:f,onConfirm:h,cancelButtonText:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deleteSavedQuery.confirmationModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deleteSavedQuery.confirmationModal.confirmButtonLabel",defaultMessage:"Confirm"}),buttonColor:"danger",defaultFocusedButton:"confirm"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deleteSavedQuery.confirmationModal.body",defaultMessage:"You're about to delete this query. Are you sure you want to do this?"})):null)},Fe=i.a.memo(Ce),Se=()=>{const e=Object(_.e)().services.application.capabilities.osquery;L("saved_queries");const t=Object(c.useRouteMatch)();return e.readSavedQueries?i.a.createElement(c.Switch,null,i.a.createElement(c.Route,{path:`${t.url}/new`},e.writeSavedQueries?i.a.createElement(xe,null):i.a.createElement(le.a,null)),i.a.createElement(c.Route,{path:`${t.url}/:savedQueryId`},i.a.createElement(Fe,null)),i.a.createElement(c.Route,{path:`${t.url}`},i.a.createElement(Ee,null))):i.a.createElement(le.a,null)},Te=i.a.memo(Se),Ie="packList",we=({isLive:e=!1,pageIndex:t=0,pageSize:a=1e4,sortField:l="updated_at",sortDirection:r="desc"})=>{const{http:n}=Object(_.e)().services;return Object(p.useQuery)([Ie,{pageIndex:t,pageSize:a,sortField:l,sortDirection:r}],(async()=>n.get("/internal/osquery/packs",{query:{pageIndex:t,pageSize:a,sortField:l,sortDirection:r}})),{keepPreviousData:!0,refetchInterval:!!e&&1e4})};var _e=a(78);const Pe=({onConfirm:e,onCancel:t,agentCount:a,agentPolicyCount:r})=>i.a.createElement(l.EuiConfirmModal,{title:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalTitle",defaultMessage:"Save and deploy changes"}),onCancel:t,onConfirm:e,cancelButtonText:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalCancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalConfirmButtonLabel",defaultMessage:"Save and deploy changes"}),buttonColor:"primary"},i.a.createElement(l.EuiCallOut,{iconType:"iInCircle",title:T.i18n.translate("xpack.osquery.agentPolicy.confirmModalCalloutTitle",{defaultMessage:"This action will update {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:a}})},i.a.createElement("div",{className:"eui-textBreakWord"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalCalloutDescription",defaultMessage:"Fleet has detected that the selected {agentPolicyCount, plural, one {agent policy} other {agent policies}}, is already in use by some of your agents. As a result of this action, Fleet will deploy updates to all agents that use this {agentPolicyCount, plural, one {agent policy} other {agent policies}}.",values:{agentPolicyCount:r}}))),i.a.createElement(l.EuiSpacer,{size:"l"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalDescription",defaultMessage:"Are you sure you wish to continue?"})),Qe=i.a.memo(Pe);var Le=a(2);const Ne=({withRedirect:e,options:t})=>{const a=Object(p.useQueryClient)(),{application:{navigateToApp:l},http:r,notifications:{toasts:n}}=Object(_.e)().services,i=Object(D.a)();return Object(p.useMutation)((({id:e,...t})=>r.put(`/internal/osquery/packs/${e}`,{body:JSON.stringify(t)})),{onError:e=>{i(e,{title:e.body.error,toastMessage:e.body.message})},onSuccess:t=>{var r,i;a.invalidateQueries(Ie),e&&l(Le.PLUGIN_ID,{path:w.a.packs()}),n.addSuccess(T.i18n.translate("xpack.osquery.updatePack.successToastMessageText",{defaultMessage:'Successfully updated "{packName}" pack',values:{packName:null!==(r=null===(i=t.attributes)||void 0===i?void 0:i.name)&&void 0!==r?r:""}}))},...t})},Be=m()(l.EuiLoadingSpinner).withConfig({displayName:"StyledEuiLoadingSpinner",componentId:"sc-12idgjh-0"})(["margin-right:",";"],(({theme:e})=>e.eui.paddingSizes.s)),Ae=({item:e})=>{const t=Object(p.useQueryClient)(),{application:{capabilities:{osquery:a}},notifications:{toasts:r}}=Object(_.e)().services,s=Object(D.a)(),[u,c]=Object(n.useState)(!1),o=Object(n.useCallback)((()=>c(!1)),[]),{data:d}=Object(_e.a)(),m=Object(n.useMemo)((()=>e.policy_ids.reduce(((e,t)=>{var a;return e+((null==d||null===(a=d.agentPoliciesById[t])||void 0===a?void 0:a.agents)||0)}),0)),[null==d?void 0:d.agentPoliciesById,e.policy_ids]),{isLoading:E,mutateAsync:g}=Ne({options:{onSuccess:e=>{t.invalidateQueries(Ie),s(),r.addSuccess(e.attributes.enabled?T.i18n.translate("xpack.osquery.pack.table.activatedSuccessToastMessageText",{defaultMessage:'Successfully activated "{packName}" pack',values:{packName:e.attributes.name}}):T.i18n.translate("xpack.osquery.pack.table.deactivatedSuccessToastMessageText",{defaultMessage:'Successfully deactivated "{packName}" pack',values:{packName:e.attributes.name}}))},onError:e=>{s(e,{title:e.body.error,toastMessage:e.body.message})}}}),y=Object(n.useCallback)((()=>{g({id:e.id,enabled:!e.attributes.enabled}),o()}),[o,e,g]),b=Object(n.useCallback)((()=>{if(m)return c(!0);y()}),[m,y]);return i.a.createElement(i.a.Fragment,null,E&&i.a.createElement(Be,null),i.a.createElement(l.EuiSwitch,{checked:e.attributes.enabled,disabled:!a.writePacks||E,showLabel:!1,label:"",onChange:b}),u&&m&&i.a.createElement(Qe,{onConfirm:y,onCancel:o,agentCount:m,agentPolicyCount:e.policy_ids.length}))},ze=i.a.memo(Ae);var De=a(34),Re=a(33),Ge=a(79);const $e=m()(l.EuiLink).withConfig({displayName:"StyledEuiLink",componentId:"sc-n9jy5t-0"})(["white-space:nowrap;text-overflow:ellipsis;overflow:hidden;"]),Ue=({policyId:e})=>{var t;const{application:{getUrlForApp:a,navigateToApp:l}}=Object(_.e)().services,{data:r}=Object(Ge.a)({policyId:e}),s=Object(n.useMemo)((()=>a(De.PLUGIN_ID,{path:Re.pagePathGetters.policy_details({policyId:e})[1]})),[a,e]),u=Object(n.useCallback)((t=>{if(!Object(_.d)(t)&&Object(_.c)(t))return t.preventDefault(),l(De.PLUGIN_ID,{path:Re.pagePathGetters.policy_details({policyId:e})[1]})}),[l,e]);return i.a.createElement($e,{href:s,onClick:u},null!==(t=null==r?void 0:r.name)&&void 0!==t?t:e)},Ve=i.a.memo(Ue),We=m.a.span.withConfig({displayName:"UpdatedBy",componentId:"sc-mndcml-0"})(["white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"]),He=({id:e,name:t})=>i.a.createElement(l.EuiLink,Object(_.f)(`packs/${e}`),t),Ye=i.a.memo(He),Ke=(e,t)=>i.a.createElement(Ye,{id:t.id,name:t.attributes.name}),Xe=({agentPolicyIds:e})=>{const[t,a]=Object(n.useState)(!1),r=Object(n.useCallback)((()=>a((e=>!e))),[]),s=Object(n.useCallback)((()=>a(!1)),[]),u=Object(n.useMemo)((()=>{var t;return i.a.createElement(l.EuiButtonEmpty,{size:"s",flush:"both",onClick:r},i.a.createElement(i.a.Fragment,null,null!==(t=null==e?void 0:e.length)&&void 0!==t?t:0))}),[null==e?void 0:e.length,r]);var c;return null!=e&&e.length?i.a.createElement(l.EuiPopover,{button:u,isOpen:t,closePopover:s,initialFocus:!1},i.a.createElement(l.EuiText,{size:"s"},null==e?void 0:e.map((e=>i.a.createElement("div",{key:e},i.a.createElement(Ve,{policyId:e})))))):i.a.createElement(i.a.Fragment,null,null!==(c=null==e?void 0:e.length)&&void 0!==c?c:0)},Je=()=>{var e;const{data:t,isLoading:a}=we({}),r=Object(n.useCallback)((e=>i.a.createElement(Xe,{agentPolicyIds:e})),[]),s=Object(n.useCallback)((e=>{var t;return i.a.createElement(i.a.Fragment,null,null!==(t=e&&Object.keys(e).length)&&void 0!==t?t:0)}),[]),u=Object(n.useCallback)(((e,t)=>i.a.createElement(ze,{item:t})),[]),c=Object(n.useCallback)(((e,t)=>{if(!e)return"-";const a=t.attributes.updated_by!==t.attributes.created_by?` @ ${t.attributes.updated_by}`:"";return e?i.a.createElement(l.EuiToolTip,{content:`${se()(e).fromNow()}${a}`},i.a.createElement(We,null,`${se()(e).fromNow()}${a}`)):"-"}),[]),o=Object(n.useMemo)((()=>[{field:"attributes.name",name:T.i18n.translate("xpack.osquery.packs.table.nameColumnTitle",{defaultMessage:"Name"}),sortable:e=>e.attributes.name.toLowerCase(),render:Ke},{field:"policy_ids",name:T.i18n.translate("xpack.osquery.packs.table.policyColumnTitle",{defaultMessage:"Scheduled policies"}),truncateText:!0,render:r},{field:"attributes.queries",name:T.i18n.translate("xpack.osquery.packs.table.numberOfQueriesColumnTitle",{defaultMessage:"Number of queries"}),render:s,width:"150px"},{field:"attributes.created_by",name:T.i18n.translate("xpack.osquery.packs.table.createdByColumnTitle",{defaultMessage:"Created by"}),sortable:!0,truncateText:!0},{field:"attributes.updated_at",name:"Last updated",sortable:e=>e.updated_at?Date.parse(e.updated_at):0,truncateText:!0,render:c},{field:"attributes.enabled",name:T.i18n.translate("xpack.osquery.packs.table.activeColumnTitle",{defaultMessage:"Active"}),sortable:!0,align:"right",width:"80px",render:u}]),[u,r,s,c]),d=Object(n.useMemo)((()=>({sort:{field:"attributes.name",direction:"asc"}})),[]);return a?i.a.createElement(l.EuiLoadingContent,{lines:10}):i.a.createElement(l.EuiInMemoryTable,{items:null!==(e=null==t?void 0:t.saved_objects)&&void 0!==e?e:[],columns:o,pagination:!0,sorting:d})},Ze=i.a.memo(Je),et=({fill:e=!0})=>{const t=Object(_.e)().services.application.capabilities.osquery,a=Object(_.f)("packs/add");return i.a.createElement(l.EuiButton,k()({fill:!!e},a,{iconType:"plusInCircle",isDisabled:!t.writePacks}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packList.addPackButtonLabel",defaultMessage:"Add pack"}))},tt=i.a.memo(et),at="integrationAssetsStatus",lt=()=>{const{http:e}=Object(_.e)().services;return Object(p.useQuery)([at],(()=>e.get("/internal/osquery/assets")),{keepPreviousData:!0,retry:!1})},rt=T.i18n.translate("xpack.osquery.packList.prePackagedPacks.emptyPromptTitle",{defaultMessage:"Load Elastic prebuilt packs"}),nt=T.i18n.translate("xpack.osquery.packList.prePackagedPacks.loadButtonLabel",{defaultMessage:"Load Elastic prebuilt packs"}),it=T.i18n.translate("xpack.osquery.packList.prePackagedPacks.updateButtonLabel",{defaultMessage:"Update Elastic prebuilt packs"}),st=T.i18n.translate("xpack.osquery.packList.integrationAssets.loadSuccessToastMessageText",{defaultMessage:"Successfully loaded prebuilt packs"}),ut=T.i18n.translate("xpack.osquery.packList.integrationAssets.updateSuccessToastMessageText",{defaultMessage:"Successfully updated prebuilt packs"}),ct=T.i18n.translate("xpack.osquery.packList.prePackagedPacks.emptyPromptTitle.emptyPromptMessage",{defaultMessage:"A pack is a set of queries that you can schedule. Load prebuilt packs or create your own."}),ot=({fill:e})=>{var t;const{data:a}=lt(),{isLoading:r,mutateAsync:s}=(({successToastText:e})=>{const t=Object(p.useQueryClient)(),{http:a,notifications:{toasts:l}}=Object(_.e)().services,r=Object(D.a)();return Object(p.useMutation)((()=>a.post("/internal/osquery/assets/update")),{onSuccess:()=>{r(),t.invalidateQueries(Ie),t.invalidateQueries(at),l.addSuccess(e)},onError:e=>{r(e)}})})({successToastText:null!=a&&null!==(t=a.upToDate)&&void 0!==t&&t.length?ut:st}),u=Object(n.useCallback)((()=>s()),[s]);var c;return null!=a&&a.install.length||null!=a&&a.update.length?i.a.createElement(l.EuiButton,{fill:!!e,isLoading:r,onClick:u,iconType:"plusInCircle"},null!=a&&null!==(c=a.upToDate)&&void 0!==c&&c.length?it:nt):null},dt=i.a.memo(ot);var mt=a(62);const pt=()=>{const e=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(dt,{fill:!0})),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(tt,{fill:!1})))),[]);return i.a.createElement(l.EuiEmptyPrompt,{icon:i.a.createElement(mt.a,null),color:"transparent",title:i.a.createElement("h2",null,rt),body:i.a.createElement("p",null,ct),actions:e})},Et=i.a.memo(pt),gt=()=>{var e;const{data:t,isLoading:a}=lt(),{data:r,isLoading:s}=we({}),u=Object(n.useMemo)((()=>{var e;return!(null!=r&&r.total)&&(null==t||null===(e=t.install)||void 0===e?void 0:e.length)}),[null==t||null===(e=t.install)||void 0===e?void 0:e.length,null==r?void 0:r.total]),c=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packList.pageTitle",defaultMessage:"Packs"})))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,{color:"subdued"},i.a.createElement("p",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packList.pageSubtitle",defaultMessage:"Create packs to organize sets of queries and to schedule queries for agent policies."})))))),[]),d=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{direction:"row",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(dt,{fill:!!u})),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(tt,{fill:!u})))),[u]),m=Object(n.useMemo)((()=>a||s?i.a.createElement(l.EuiLoadingContent,{lines:10}):u?i.a.createElement(Et,null):i.a.createElement(Ze,null)),[a,s,u]);return i.a.createElement(S,{leftColumn:c,rightColumn:d,rightColumnGrow:!1},m)},yt=i.a.memo(gt),bt=m()(l.EuiFlexItem).withConfig({displayName:"AgentPolicyNameColumn",componentId:"sc-1xn7fsq-0"})(["max-width:",";overflow:hidden;"],(e=>e.grow/9*100+"%")),vt=m()(l.EuiFlexItem).withConfig({displayName:"AgentPolicyDescriptionColumn",componentId:"sc-1xn7fsq-1"})(["max-width:",";overflow:hidden;"],(e=>e.grow/9*100+"%")),ft=({euiFieldProps:e,field:t,agentPoliciesById:a})=>{const{value:r,setValue:s}=t,u=Object(n.useMemo)((()=>Object.entries(a).map((([e,t])=>({key:e,label:t.name})))),[a]),c=Object(n.useMemo)((()=>r.map((e=>{var t,l;return{key:e,label:null!==(t=null===(l=a[e])||void 0===l?void 0:l.name)&&void 0!==t?t:e}}))),[a,r]),d=Object(n.useCallback)((e=>{s(e.map((e=>e.key||e.label)))}),[s]),m=Object(n.useCallback)((e=>{var t,r,n,s,u;return i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(bt,{grow:2},i.a.createElement("span",{className:"eui-textTruncate"},null!==(t=e.key&&(null===(r=a[e.key])||void 0===r?void 0:r.name))&&void 0!==t?t:e.label)),i.a.createElement(vt,{grow:5},i.a.createElement(l.EuiTextColor,{className:"eui-textTruncate",color:"subdued"},null!==(n=e.key&&a[e.key].description)&&void 0!==n?n:"")),i.a.createElement(l.EuiFlexItem,{grow:2,className:"eui-textRight"},i.a.createElement(l.EuiTextColor,{color:"subdued"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.createScheduledQuery.agentPolicyAgentsCountText",defaultMessage:"{count, plural, one {# agent} other {# agents}} enrolled",values:{count:null!==(s=e.key&&(null===(u=a[e.key])||void 0===u?void 0:u.agents))&&void 0!==s?s:0}}))))}),[a]),p=Object(n.useMemo)((()=>{if(null==r||!r.length||!r[0].length||!a)return;const e=Object(N.reduce)(r,((e,t)=>{var l;const r=a&&a[t];return e+(null!==(l=null==r?void 0:r.agents)&&void 0!==l?l:0)}),0);return i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.createScheduledQuery.agentPolicyAgentsCountText",defaultMessage:"{count, plural, one {# agent} other {# agents}} enrolled",values:{count:e}})}),[a,r]),E=Object(n.useMemo)((()=>({onCreateOption:null,noSuggestions:!1,isClearable:!0,selectedOptions:c,options:u,renderOption:m,onChange:d,...e})),[e,d,u,m,c]);return i.a.createElement(g.a,{field:t,fullWidth:!0,helpText:p,euiFieldProps:E})},kt=i.a.memo(ft);var xt=a(61),ht=a(115),Ot=a(113);const jt=({platform:e})=>{const[t,a]=Object(n.useState)(ht.a);Object(n.useEffect)((()=>{a((t=>{if(e){let a;try{a=null==e?void 0:e.split(",").map((e=>e.trim()))}catch(e){return t}return a}return ht.a}))}),[e]);const r=Object(n.useMemo)((()=>t.map((e=>i.a.createElement(l.EuiFlexItem,{key:e,grow:!1},i.a.createElement(Ot.a,{platform:e}))))),[t]);return i.a.createElement(l.EuiFlexGroup,{gutterSize:"s"},r)},qt=i.a.memo(jt),Mt=({data:e,isReadOnly:t,onDeleteClick:a,onEditClick:r,selectedItems:s,setSelectedItems:u})=>{const c=Object(n.useCallback)((e=>i.a.createElement(l.EuiButtonIcon,{color:"danger",onClick:()=>a(e),iconType:"trash","aria-label":T.i18n.translate("xpack.osquery.pack.queriesTable.deleteActionAriaLabel",{defaultMessage:"Delete {queryName}",values:{queryName:e.id}})})),[a]),o=Object(n.useCallback)((e=>i.a.createElement(l.EuiButtonIcon,{color:"primary",onClick:()=>r(e),iconType:"pencil","aria-label":T.i18n.translate("xpack.osquery.pack.queriesTable.editActionAriaLabel",{defaultMessage:"Edit {queryName}",values:{queryName:e.id}})})),[r]),d=Object(n.useCallback)((e=>i.a.createElement(l.EuiCodeBlock,{language:"sql",fontSize:"s",paddingSize:"none",transparentBackground:!0},e)),[]),m=Object(n.useCallback)((e=>i.a.createElement(qt,{platform:e})),[]),p=Object(n.useCallback)((e=>e?`${e}`:T.i18n.translate("xpack.osquery.pack.queriesTable.osqueryVersionAllLabel",{defaultMessage:"ALL"})),[]),E=Object(n.useMemo)((()=>[{field:"id",name:T.i18n.translate("xpack.osquery.pack.queriesTable.idColumnTitle",{defaultMessage:"ID"}),width:"20%"},{field:"interval",name:T.i18n.translate("xpack.osquery.pack.queriesTable.intervalColumnTitle",{defaultMessage:"Interval (s)"}),width:"100px"},{field:"query",name:T.i18n.translate("xpack.osquery.pack.queriesTable.queryColumnTitle",{defaultMessage:"Query"}),render:d},{field:"platform",name:T.i18n.translate("xpack.osquery.pack.queriesTable.platformColumnTitle",{defaultMessage:"Platform"}),render:m},{field:"version",name:T.i18n.translate("xpack.osquery.pack.queriesTable.versionColumnTitle",{defaultMessage:"Min Osquery version"}),render:p},...t?[]:[{name:T.i18n.translate("xpack.osquery.pack.queriesTable.actionsColumnTitle",{defaultMessage:"Actions"}),width:"120px",actions:[{render:o},{render:c}]}]]),[t,c,o,m,d,p]),g=Object(n.useMemo)((()=>({sort:{field:"id",direction:"asc"}})),[]),y=Object(n.useCallback)((e=>Object(he.get)("id",e)),[]),b=Object(n.useMemo)((()=>({onSelectionChange:u,initialSelected:s})),[s,u]);return i.a.createElement(l.EuiBasicTable,k()({items:e,itemId:y,columns:E,sorting:g},t?{}:{selection:b,isSelectable:!0}))},Ct=i.a.memo(Mt);var Ft=a(117),St=a(112),Tt=a(111),It=a(106),wt=a.n(It),_t=a(70),Pt=a(109),Qt=a(120),Lt=a(77);const Nt=Object(g.l)({component:g.d}),Bt=({uniqueQueryIds:e,defaultValue:t,onSave:a,onClose:r})=>{const s=Object(_.e)().services.application.capabilities.osquery,[u]=Object(n.useState)(!!t),{form:c}=(({uniqueQueryIds:e,defaultValue:t,handleSubmit:a})=>{const l=Object(n.useMemo)((()=>new Set(Object(N.xor)(e,null!=t&&t.id?[t.id]:[]))),[e,t]),r=Object(n.useMemo)((()=>Object(Pt.a)(l)),[l]);return Object(g.m)({id:"editQueryFlyoutForm"+wt.a.v4(),onSubmit:async(e,t)=>{if(t&&a)return a(e,t)},options:{stripEmptyFields:!0},defaultValue:t||{id:"",query:"",interval:3600,ecs_mapping:[]},serializer:e=>Object(xt.produce)(e,(t=>(Object(N.isArray)(t.platform)&&t.platform.join(","),Object(N.isArray)(t.version)&&(t.version.length?t.version=t.version[0]:delete t.version),Object(N.isEmpty)(t.ecs_mapping)?delete t.ecs_mapping:t.ecs_mapping=Object(_t.a)(e.ecs_mapping),t))),deserializer:e=>e?{id:e.id,query:e.query,interval:e.interval,platform:e.platform,version:e.version?[e.version]:[],ecs_mapping:Object(N.isArray)(e.ecs_mapping)?e.ecs_mapping:Object(N.map)(e.ecs_mapping,((e,t)=>({key:t,result:{type:Object.keys(e)[0],value:Object.values(e)[0]}})))}:{},schema:r})})({uniqueQueryIds:e,defaultValue:t,handleSubmit:async(e,t)=>new Promise((l=>{t&&(a(e),r()),l()}))}),{submit:d,isSubmitting:m,updateFieldValues:p}=c,E=Object(n.useCallback)((e=>{var t;e&&p({id:e.id,query:e.query,description:e.description,platform:e.platform?e.platform:"linux,windows,darwin",version:e.version,interval:e.interval,ecs_mapping:null!==(t=Object(N.map)(e.ecs_mapping,((e,t)=>({key:t,result:{type:Object.keys(e)[0],value:Object.values(e)[0]}}))))&&void 0!==t?t:[]})}),[p]),y=Object(n.useMemo)((()=>({onClick:()=>({})})),[]);return i.a.createElement(l.EuiFlyout,{size:"m",onClose:r,"aria-labelledby":"flyoutTitle",outsideClickCloses:!1,maskProps:y},i.a.createElement(l.EuiFlyoutHeader,{hasBorder:!0},i.a.createElement(l.EuiTitle,{size:"s"},i.a.createElement("h2",{id:"flyoutTitle"},u?i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.editFormTitle",defaultMessage:"Edit query"}):i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.addFormTitle",defaultMessage:"Attach next query"})))),i.a.createElement(l.EuiFlyoutBody,null,i.a.createElement(g.e,{form:c},!u&&s.readSavedQueries?i.a.createElement(i.a.Fragment,null,i.a.createElement(Qt.a,{onChange:E}),i.a.createElement(l.EuiSpacer,null)):null,i.a.createElement(Nt,{path:"id"}),i.a.createElement(l.EuiSpacer,null),i.a.createElement(Nt,{path:"query",component:Ft.a}),i.a.createElement(l.EuiSpacer,null),i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(Nt,{path:"interval",euiFieldProps:{append:"s"}}),i.a.createElement(l.EuiSpacer,null),i.a.createElement(Nt,{path:"version",labelAppend:i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiText,{size:"xs",color:"subdued"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.versionFieldOptionalLabel",defaultMessage:"(optional)"}))),euiFieldProps:{noSuggestions:!1,singleSelection:{asPlainText:!0},placeholder:T.i18n.translate("xpack.osquery.queriesTable.osqueryVersionAllLabel",{defaultMessage:"ALL"}),options:Tt.a,onCreateOption:void 0}})),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(Nt,{path:"platform",component:St.a}))),i.a.createElement(l.EuiSpacer,null),i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(Lt.a,null))))),i.a.createElement(l.EuiFlyoutFooter,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"spaceBetween"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButtonEmpty,{iconType:"cross",onClick:r,flush:"left"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.cancelButtonLabel",defaultMessage:"Cancel"}))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButton,{isLoading:m,onClick:d,fill:!0},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.saveButtonLabel",defaultMessage:"Save"}))))))},At=i.a.memo(Bt),zt=["application/json","text/plain"],Dt=i.a.memo((()=>i.a.createElement(l.EuiLink,{href:"https://github.com/osquery/osquery/tree/master/packs",target:"_blank"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packUploader.examplePacksLinkLabel",defaultMessage:"Example packs"}))));Dt.displayName="ExamplePackLink";const Rt=({onChange:e})=>{const t=Object(n.useRef)(""),a=Object(n.useRef)(null),[r,s]=Object(n.useState)(null);let u;const c=()=>{var l,r;const n=u.result;let i;try{i=JSON.parse(n.replaceAll("\\\n",""),((e,t)=>"query"===e?t.replaceAll(/\s(?=\s)/gm,""):"interval"===e?`${t}`:t)),s(null)}catch(e){var c;s(e),null===(c=a.current)||void 0===c||c.removeFiles(new Event("fake"))}null!==(l=i)&&void 0!==l&&l.queries&&(e(i,t.current),null===(r=a.current)||void 0===r||r.removeFiles(new Event("fake")))},o=e=>{u=new FileReader,u.onloadend=c,u.readAsText(e)},d=Object(n.useCallback)((e=>{var l;if(e.length){var r;if(e.length&&(null!==(l=!!e[0].type.length&&!zt.includes(e[0].type))&&void 0!==l?l:!e[0].name.endsWith(".conf")))return t.current="",s(T.i18n.translate("xpack.osquery.packUploader.unsupportedFileTypeText",{defaultMessage:"File type {fileType} is not supported, please upload {supportedFileTypes} config file",values:{fileType:e[0].type,supportedFileTypes:zt.join(" or ")}})),void(null===(r=a.current)||void 0===r||r.removeFiles(new Event("fake")));t.current=Object(N.kebabCase)(e[0].name.split(".")[0]),o(e[0])}else t.current=""}),[o]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.EuiSpacer,{size:"xl"}),i.a.createElement(l.EuiFormRow,{fullWidth:!0,labelAppend:i.a.createElement(Dt,null),isInvalid:!!r,error:i.a.createElement(i.a.Fragment,null,`${r}`)},i.a.createElement(l.EuiFilePicker,{ref:a,id:"osquery_pack_picker",initialPromptText:T.i18n.translate("xpack.osquery.packUploader.initialPromptTextLabel",{defaultMessage:"Select or drag and drop osquery pack config file"}),onChange:d,display:"large",fullWidth:!0,isInvalid:!!r,accept:zt.join(",")})))},Gt=i.a.memo(Rt);var $t=a(114);const Ut=({field:e,handleNameChange:t,euiFieldProps:a})=>{var r;const s=!(null==a||!a.isDisabled),[u,c]=Object(n.useState)(!1),[d,m]=Object(n.useState)(-1),[p,E]=Object(n.useState)([]),g=Object(n.useCallback)((()=>c(!0)),[]),y=Object(n.useCallback)((()=>c(!1)),[]),b=Object(n.useCallback)((()=>m(-1)),[]),{setValue:v}=e,f=Object(n.useCallback)((t=>{const a=Object(N.findIndex)(e.value,["id",t.id]);a>-1&&v(Object(xt.produce)((e=>(Object(N.pullAt)(e,[a]),e))))}),[e.value,v]),k=Object(n.useCallback)((t=>{const a=Object(N.findIndex)(e.value,["id",t.id]);m(a)}),[e.value]),x=Object(n.useCallback)((e=>new Promise((t=>{d>=0&&v(Object(xt.produce)((t=>{var a,l;return t[d].id=e.id,t[d].interval=e.interval,t[d].query=e.query,null!==(a=e.platform)&&void 0!==a&&a.length?t[d].platform=e.platform:delete t[d].platform,null!==(l=e.version)&&void 0!==l&&l.length?t[d].version=e.version:delete t[d].version,e.ecs_mapping?t[d].ecs_mapping=e.ecs_mapping:delete t[d].ecs_mapping,t}))),b(),t()}))),[b,v,d]),h=Object(n.useCallback)((e=>new Promise((t=>{v(Object(xt.produce)((t=>(t.push(e),t)))),y(),t()}))),[y,v]),O=Object(n.useCallback)((()=>{v(Object(xt.produce)((e=>(Object(N.pullAllBy)(e,p,"id"),e)))),E([])}),[v,p]),j=Object(n.useCallback)(((e,a)=>{v(Object(xt.produce)((t=>(Object(N.forEach)(e.queries,((a,l)=>{var r,n,i,s;t.push(Object(N.pickBy)({id:l,interval:null!==(r=null!==(n=a.interval)&&void 0!==n?n:e.interval)&&void 0!==r?r:"3600",query:a.query,version:null!==(i=a.version)&&void 0!==i?i:e.version,platform:Object($t.b)(null!==(s=a.platform)&&void 0!==s?s:e.platform)},(e=>!Object(N.isEmpty)(e))))})),t)))),t(a)}),[t,v]),q=Object(n.useMemo)((()=>{var t;return null!==(t=e.value)&&void 0!==t&&t.length?e.value:[]}),[e.value]),M=Object(n.useMemo)((()=>e.value&&e.value.length?e.value.reduce(((e,t)=>(null!=t&&t.id&&e.push(t.id),e)),[]):[]),[e.value]);return i.a.createElement(i.a.Fragment,null,!s&&i.a.createElement(i.a.Fragment,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd"},i.a.createElement(l.EuiFlexItem,{grow:!1},p.length?i.a.createElement(l.EuiButton,{color:"danger",onClick:O,iconType:"trash"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.pack.table.deleteQueriesButtonLabel",defaultMessage:"Delete {queriesCount, plural, one {# query} other {# queries}}",values:{queriesCount:p.length}})):i.a.createElement(l.EuiButton,{fill:!0,onClick:g,iconType:"plusInCircle"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.pack.queriesForm.addQueryButtonLabel",defaultMessage:"Add query"})))),i.a.createElement(l.EuiSpacer,null)),null!==(r=e.value)&&void 0!==r&&r.length?i.a.createElement(Ct,{data:q,isReadOnly:s,onEditClick:k,onDeleteClick:f,selectedItems:p,setSelectedItems:E}):null,i.a.createElement(l.EuiSpacer,null),!s&&i.a.createElement(Gt,{onChange:j}),u&&i.a.createElement(At,{uniqueQueryIds:M,onSave:h,onClose:y}),null!=d&&d>=0&&i.a.createElement(At,{uniqueQueryIds:M,defaultValue:e.value[d],onSave:x,onClose:b}))},Vt=i.a.memo(Ut);var Wt=a(121),Ht=a(110);const Yt=()=>i.a.createElement(i.a.Fragment,null),Kt=Object(g.l)({component:g.d}),Xt=({defaultValue:e,editMode:t=!1,isReadOnly:a=!1})=>{const[r,s]=Object(n.useState)(!1),u=Object(n.useCallback)((()=>s(!1)),[]),{data:{agentPoliciesById:c}={}}=Object(Wt.a)(),d=Object(_.f)(`packs/${t?null==e?void 0:e.id:""}`),{mutateAsync:m}=(({withRedirect:e})=>{const t=Object(p.useQueryClient)(),{application:{navigateToApp:a},http:l,notifications:{toasts:r}}=Object(_.e)().services,n=Object(D.a)();return Object(p.useMutation)((e=>l.post("/internal/osquery/packs",{body:JSON.stringify(e)})),{onError:e=>{n(e,{title:e.body.error,toastMessage:e.body.message})},onSuccess:l=>{var n,i;t.invalidateQueries(Ie),e&&a(Le.PLUGIN_ID,{path:w.a.packs()}),r.addSuccess(T.i18n.translate("xpack.osquery.newPack.successToastMessageText",{defaultMessage:'Successfully created "{packName}" pack',values:{packName:null!==(n=null===(i=l.attributes)||void 0===i?void 0:i.name)&&void 0!==n?n:""}}))}})})({withRedirect:!0}),{mutateAsync:E}=Ne({withRedirect:!0}),{form:y}=Object(g.m)({id:"scheduledQueryForm",schema:{name:{type:g.c.TEXT,label:T.i18n.translate("xpack.osquery.pack.form.nameFieldLabel",{defaultMessage:"Name"}),validations:[{validator:Ht.b},{validator:g.j.emptyField(T.i18n.translate("xpack.osquery.pack.form.nameFieldRequiredErrorMessage",{defaultMessage:"Name is a required field"}))}]},description:{type:g.c.TEXT,label:T.i18n.translate("xpack.osquery.pack.form.descriptionFieldLabel",{defaultMessage:"Description (optional)"})},policy_ids:{defaultValue:[],type:g.c.COMBO_BOX,label:T.i18n.translate("xpack.osquery.pack.form.agentPoliciesFieldLabel",{defaultMessage:"Scheduled agent policies (optional)"}),helpText:T.i18n.translate("xpack.osquery.pack.form.agentPoliciesFieldHelpText",{defaultMessage:"Queries in this pack are scheduled for agents in the selected policies."})},enabled:{defaultValue:!0},queries:{defaultValue:[]}},onSubmit:async(a,l)=>{if(l)try{t?await E({id:null==e?void 0:e.id,...a}):await m(a)}catch(e){}},deserializer:e=>{var t,a;return{...e,policy_ids:null!==(t=e.policy_ids)&&void 0!==t?t:[],queries:(a=e.queries,Object(N.reduce)(a,((e,t,a)=>(e.push({id:a,...Object(N.pick)(t,["query","interval","platform","version","ecs_mapping"])}),e)),[]))}},serializer:e=>{return{...e,queries:(t=e.queries,Object(N.reduce)(t,((e,{id:t,...a})=>(e[t]=a,e)),{}))};var t},defaultValue:e}),{setFieldValue:b,submit:v,isSubmitting:f}=y,[{name:x,policy_ids:h}]=Object(g.o)({form:y,watch:["name","policy_ids"]}),O=Object(n.useMemo)((()=>Object(N.reduce)(h,((e,t)=>{var a;const l=c&&c[t];return e+(null!==(a=null==l?void 0:l.agents)&&void 0!==a?a:0)}),0)),[h,c]),j=Object(n.useCallback)((e=>Object(N.isEmpty)(x)&&b("name",e)),[x,b]),q=Object(n.useCallback)((()=>{O?s(!0):v()}),[O,v]),M=Object(n.useCallback)((()=>{v(),s(!1)}),[v]),C=Object(n.useMemo)((()=>({isDisabled:a})),[a]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(g.e,{form:y},i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(Kt,{path:"name",euiFieldProps:C}))),i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(Kt,{path:"description",euiFieldProps:C}))),i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(Kt,{path:"policy_ids",component:kt,agentPoliciesById:c}))),i.a.createElement(l.EuiHorizontalRule,null),i.a.createElement(Kt,{path:"queries",component:Vt,handleNameChange:j,euiFieldProps:C}),i.a.createElement(Kt,{path:"enabled",component:Yt})),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiBottomBar,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiFlexGroup,{gutterSize:"m"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButtonEmpty,k()({color:"ghost"},d),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.pack.form.cancelButtonLabel",defaultMessage:"Cancel"}))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButton,{isLoading:f,color:"primary",fill:!0,size:"m",iconType:"save",onClick:q},t?i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.pack.form.updatePackButtonLabel",defaultMessage:"Update pack"}):i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.pack.form.savePackButtonLabel",defaultMessage:"Save pack"}))))))),r&&i.a.createElement(Qe,{onCancel:u,onConfirm:M,agentCount:O,agentPolicyCount:h.length}))},Jt=i.a.memo(Xt),Zt=()=>{L("pack_add");const e=Object(_.f)("packs"),t=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,k()({iconType:"arrowLeft"},e,{flush:"left",size:"xs"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.addPack.viewPacksListTitle",defaultMessage:"View all packs"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.addPack.pageTitle",defaultMessage:"Add pack"})))))),[e]);return i.a.createElement(S,{leftColumn:t},i.a.createElement(Jt,null))},ea=i.a.memo(Zt),ta=({packId:e,skip:t=!1})=>{const{http:a}=Object(_.e)().services;return Object(p.useQuery)(["pack",{packId:e}],(()=>a.get(`/internal/osquery/packs/${e}`)),{keepPreviousData:!0,enabled:!t||!e})},aa=()=>{var e,t;const{packId:a}=Object(c.useParams)(),r=Object(_.f)(`packs/${a}`),[s,u]=Object(n.useState)(!1),{isLoading:d,data:m}=ta({packId:a}),E=(({packId:e,withRedirect:t})=>{const a=Object(p.useQueryClient)(),{application:{navigateToApp:l},http:r,notifications:{toasts:n}}=Object(_.e)().services,i=Object(D.a)();return Object(p.useMutation)((()=>r.delete(`/internal/osquery/packs/${e}`)),{onError:e=>{i(e,{title:e.body.error,toastMessage:e.body.message})},onSuccess:()=>{a.invalidateQueries(Ie),t&&l(Le.PLUGIN_ID,{path:w.a.packs()}),n.addSuccess(T.i18n.translate("xpack.osquery.deletePack.successToastMessageText",{defaultMessage:"Successfully deleted pack"}))}})})({packId:a,withRedirect:!0}),g=Object(n.useMemo)((()=>!(null==m||!m.read_only)),[m]);L("pack_edit",{packId:null!==(e=null==m?void 0:m.id)&&void 0!==e?e:"",packName:null!==(t=null==m?void 0:m.name)&&void 0!==t?t:""});const y=Object(n.useCallback)((()=>{u(!1)}),[]),b=Object(n.useCallback)((()=>{u(!0)}),[]),v=Object(n.useCallback)((()=>{E.mutateAsync().then((()=>{y()}))}),[E,y]),f=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,k()({iconType:"arrowLeft"},r,{flush:"left",size:"xs"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editPack.viewPackListTitle",defaultMessage:"View {queryName} details",values:{queryName:null==m?void 0:m.name}}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editPack.pageTitle",defaultMessage:"Edit {queryName}",values:{queryName:null==m?void 0:m.name}})))))),[null==m?void 0:m.name,r]),x=Object(n.useMemo)((()=>i.a.createElement(l.EuiButton,{color:"danger",onClick:b,iconType:"trash"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editPack.deletePackButtonLabel",defaultMessage:"Delete pack"}))),[b]),h=Object(n.useMemo)((()=>g?i.a.createElement(i.a.Fragment,null,i.a.createElement(l.EuiSpacer,null),i.a.createElement(l.EuiCallOut,null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editPack.prebuiltPackModeDescription",defaultMessage:"This is a prebuilt Elastic pack. You can modify the scheduled agent policies, but you cannot edit queries in the pack."}))):null),[g]);return d?null:i.a.createElement(S,{leftColumn:f,rightColumn:x,rightColumnGrow:!1,headerChildren:h},m?i.a.createElement(Jt,{editMode:!0,defaultValue:m,isReadOnly:g}):i.a.createElement(l.EuiLoadingContent,{lines:10}),s?i.a.createElement(l.EuiConfirmModal,{title:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deletePack.confirmationModal.title",defaultMessage:"Are you sure you want to delete this pack?"}),onCancel:y,onConfirm:v,confirmButtonDisabled:E.isLoading,cancelButtonText:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deletePack.confirmationModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deletePack.confirmationModal.confirmButtonLabel",defaultMessage:"Confirm"}),buttonColor:"danger",defaultFocusedButton:"confirm"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deletePack.confirmationModal.body",defaultMessage:"You're about to delete this pack. Are you sure you want to do this?"})):null)},la=i.a.memo(aa);var ra=a(126);const na=m.a.div.withConfig({displayName:"Divider",componentId:"sc-e3f879-0"})(["width:0;height:100%;border-left:",";"],(({theme:e})=>e.eui.euiBorderThin)),ia=()=>{var e;const t=Object(_.e)().services.application.capabilities.osquery,{packId:a}=Object(c.useParams)(),r=Object(_.f)("packs"),s=Object(_.f)(`packs/${a}/edit`),{data:u}=ta({packId:a}),{data:d}=(({agentPolicyId:e,silent:t,skip:a})=>{const{http:l}=Object(_.e)().services,r=Object(D.a)();return Object(p.useQuery)(["agentPolicyAgentIds",e],(()=>{const t=`${De.AGENTS_PREFIX}.policy_id:${e}`;return l.get("/internal/osquery/fleet_wrapper/agents",{query:{kuery:t,perPage:1e4}})}),{select:e=>Object(N.map)(null==e?void 0:e.agents,"id")||[],enabled:!a||!e,onSuccess:()=>r(),onError:e=>!t&&r(e,{title:T.i18n.translate("xpack.osquery.agents.fetchError",{defaultMessage:"Error while fetching agents"})}),refetchOnReconnect:!1,refetchOnWindowFocus:!1})})({agentPolicyId:null==u?void 0:u.policy_id,skip:!u});L("pack_details",{packName:null!==(e=null==u?void 0:u.name)&&void 0!==e?e:""});const m=Object(n.useMemo)((()=>{var e;return null!==(e=(null==u?void 0:u.queries)&&Object.entries(u.queries).map((([e,t])=>({...t,id:e}))))&&void 0!==e?e:[]}),[u]),E=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,k()({iconType:"arrowLeft"},r,{flush:"left",size:"xs"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packDetails.viewAllPackListTitle",defaultMessage:"View all packs"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packDetails.pageTitle",defaultMessage:"{queryName} details",values:{queryName:null==u?void 0:u.name}})))),(null==u?void 0:u.description)&&i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiSpacer,{size:"s"}),i.a.createElement(l.EuiText,{color:"subdued",size:"s"},u.description)))),[null==u?void 0:u.description,null==u?void 0:u.name,r]),g=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd",direction:"row"},i.a.createElement(l.EuiFlexItem,{grow:!1,key:"agents_failed_count"},i.a.createElement(l.EuiDescriptionList,{compressed:!0,textStyle:"reverse",style:{textAlign:"right"}},i.a.createElement(l.EuiDescriptionListTitle,{className:"eui-textNoWrap"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packDetailsPage.kpis.policiesLabelText",defaultMessage:"Policies"})),i.a.createElement(l.EuiDescriptionListDescription,{className:"eui-textNoWrap"},i.a.createElement(Xe,{agentPolicyIds:null==u?void 0:u.policy_ids})))),i.a.createElement(l.EuiFlexItem,{grow:!1,key:"agents_failed_count_divider"},i.a.createElement(na,null)),i.a.createElement(l.EuiFlexItem,{grow:!1,key:"edit_button"},i.a.createElement(l.EuiButton,k()({fill:!0},s,{iconType:"pencil",isDisabled:!t.writePacks}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packDetailsPage.editQueryButtonLabel",defaultMessage:"Edit"}))))),[null==u?void 0:u.policy_ids,s,t]);return i.a.createElement(S,{leftColumn:E,rightColumn:g,rightColumnGrow:!1},u&&i.a.createElement(ra.a,{agentIds:d,packName:u.name,data:m}))},sa=i.a.memo(ia),ua=()=>{const e=Object(_.e)().services.application.capabilities.osquery;L("packs");const t=Object(c.useRouteMatch)();return e.readPacks?i.a.createElement(c.Switch,null,i.a.createElement(c.Route,{path:`${t.url}/add`},e.writePacks?i.a.createElement(ea,null):i.a.createElement(le.a,null)),i.a.createElement(c.Route,{path:`${t.url}/:packId/edit`},e.writePacks?i.a.createElement(la,null):i.a.createElement(le.a,null)),i.a.createElement(c.Route,{path:`${t.url}/:packId`},i.a.createElement(sa,null)),i.a.createElement(c.Route,{path:`${t.url}`},i.a.createElement(yt,null))):i.a.createElement(le.a,null)},ca=i.a.memo(ua),oa=()=>(L("base"),i.a.createElement(c.Switch,null,i.a.createElement(c.Route,{path:"/packs"},i.a.createElement(ca,null)),i.a.createElement(c.Route,{path:"/saved_queries"},i.a.createElement(Te,null)),i.a.createElement(c.Route,{path:"/live_queries"},i.a.createElement(ne,null)),i.a.createElement(c.Redirect,{to:"/live_queries"}))),da=i.a.memo(oa);a(38);var ma=a(4);const pa=()=>{L("base");const{application:{getUrlForApp:e,navigateToApp:t}}=Object(_.e)().services,a=Object(n.useMemo)((()=>e(De.INTEGRATIONS_PLUGIN_ID,{path:Re.pagePathGetters.integration_details_overview({pkgkey:Le.OSQUERY_INTEGRATION_NAME})[1]})),[e]),r=Object(n.useCallback)((e=>{if(!Object(_.d)(e)&&Object(_.c)(e))return e.preventDefault(),t(De.INTEGRATIONS_PLUGIN_ID,{path:Re.pagePathGetters.integration_details_overview({pkgkey:Le.OSQUERY_INTEGRATION_NAME})[1]})}),[t]),s=Object(n.useMemo)((()=>({iconType:mt.a,pageTitle:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.emptyState.pageTitle",defaultMessage:"Add Osquery Manager"}),description:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.emptyState.pageDescription",defaultMessage:"Add this integration to run and schedule queries for Elastic Agent."}),rightSideItems:[i.a.createElement(l.EuiButton,{key:"button",fill:!0,href:a,onClick:r,iconType:"plusInCircleFilled"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.emptyState.addOsqueryManagerButton",defaultMessage:"Add Osquery Manager"}))]})),[r,a]);return i.a.createElement(ma.KibanaPageTemplate,{isEmptyState:!0,pageHeader:s})},Ea=i.a.memo(pa),ga=()=>{const{application:{getUrlForApp:e,navigateToApp:t}}=Object(_.e)().services,a=Object(n.useMemo)((()=>e(De.INTEGRATIONS_PLUGIN_ID,{path:Re.pagePathGetters.integration_details_policies({pkgkey:Le.OSQUERY_INTEGRATION_NAME})[1]})),[e]),r=Object(n.useCallback)((e=>{if(!Object(_.d)(e)&&Object(_.c)(e))return e.preventDefault(),t(De.INTEGRATIONS_PLUGIN_ID,{path:Re.pagePathGetters.integration_details_policies({pkgkey:Le.OSQUERY_INTEGRATION_NAME})[1]})}),[t]);return a?i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,{iconType:"gear",href:a,onClick:r},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.appNavigation.manageIntegrationButton",defaultMessage:"Manage integration"}))):null},ya=i.a.memo(ga);var ba;!function(e){e.LiveQueries="live_queries",e.Packs="packs",e.SavedQueries="saved_queries"}(ba||(ba={}));const va=()=>{const e=Object(c.useLocation)(),t=Object(n.useMemo)((()=>{var t;return null!==(t=e.pathname.split("/")[1])&&void 0!==t?t:"overview"}),[e.pathname]);return i.a.createElement(v,null,i.a.createElement(l.EuiFlexGroup,{gutterSize:"l",alignItems:"center"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiTabs,{display:"condensed"},i.a.createElement(l.EuiTab,k()({isSelected:t===ba.LiveQueries},Object(_.f)(ba.LiveQueries)),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.appNavigation.liveQueriesLinkText",defaultMessage:"Live queries"})),i.a.createElement(l.EuiTab,k()({isSelected:t===ba.Packs},Object(_.f)(ba.Packs)),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.appNavigation.packsLinkText",defaultMessage:"Packs"})),i.a.createElement(l.EuiTab,k()({isSelected:t===ba.SavedQueries},Object(_.f)(ba.SavedQueries)),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.appNavigation.savedQueriesLinkText",defaultMessage:"Saved queries"})))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiFlexGroup,{gutterSize:"s",direction:"row"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,{iconType:"popout",href:"https://ela.st/osquery-feedback",target:"_blank"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.appNavigation.sendFeedbackButton",defaultMessage:"Send feedback"}))),i.a.createElement(ya,null)))))},fa=()=>{const{data:e,isFetched:t}=(()=>{const{http:e}=Object(_.e)().services,t=Object(D.a)();return Object(p.useQuery)("integration",(()=>e.get("/internal/osquery/status")),{onError:e=>t(e,{title:T.i18n.translate("xpack.osquery.osquery_integration.fetchError",{defaultMessage:"Error while fetching osquery integration"})}),refetchOnReconnect:!1,refetchOnWindowFocus:!1})})();return t?t&&"installed"!==(null==e?void 0:e.install_status)?i.a.createElement(Ea,null):i.a.createElement(y,{id:"osquery-app"},i.a.createElement(b,null,i.a.createElement(va,null),i.a.createElement(da,null))):i.a.createElement(l.EuiPage,{paddingSize:"none"},i.a.createElement(l.EuiPageBody,null,i.a.createElement(l.EuiPageContent,{verticalPosition:"center",horizontalPosition:"center",paddingSize:"none",color:"subdued",hasShadow:!1},i.a.createElement(l.EuiLoadingElastic,{size:"xxl"}))))},ka=i.a.memo(fa);var xa=a(72);const ha=()=>{const[e]=Object(g.p)(Le.DEFAULT_DARK_MODE),t=Object(n.useMemo)((()=>({eui:e?r.euiDarkVars:r.euiLightVars,darkMode:e})),[e]);return i.a.createElement(d.ThemeProvider,{theme:t},i.a.createElement(ka,null))},Oa=(e,t,{element:a,history:r,theme$:n},s,d)=>(u.a.render(i.a.createElement(g.f,{theme$:n},i.a.createElement(_.b,{services:{appName:Le.PLUGIN_NAME,kibanaVersion:d,...e,...t,storage:s}},i.a.createElement(l.EuiErrorBoundary,null,i.a.createElement(c.Router,{history:r},i.a.createElement(o.I18nProvider,null,i.a.createElement(p.QueryClientProvider,{client:xa.a},i.a.createElement(ha,null),i.a.createElement(E.ReactQueryDevtools,{initialIsOpen:!1}))))))),a),()=>u.a.unmountComponentAtNode(a))},66:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var l=a(0),r=a.n(l),n=a(10),i=a(27),s=a(29);const u=a.n(s)()(n.EuiPanel).withConfig({displayName:"Panel",componentId:"sc-1msa277-0"})(["max-width:500px;margin-right:auto;margin-left:auto;"]),c=()=>r.a.createElement("div",null,r.a.createElement(n.EuiSpacer,null),r.a.createElement(u,null,r.a.createElement(n.EuiEmptyPrompt,{iconType:"securityApp",title:r.a.createElement("h2",null,r.a.createElement(i.FormattedMessage,{id:"xpack.osquery.permissionDeniedErrorTitle",defaultMessage:"Permission denied"})),body:r.a.createElement("p",null,r.a.createElement(i.FormattedMessage,{id:"xpack.osquery.permissionDeniedErrorMessage",defaultMessage:"You are not authorized to access this page."}))})),r.a.createElement(n.EuiSpacer,null)),o=r.a.memo(c)}}]);