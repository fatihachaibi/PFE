/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.osquery_bundle_jsonpfunction=window.osquery_bundle_jsonpfunction||[]).push([[6],{182:function(e,t,a){"use strict";a.r(t),a.d(t,"OsqueryAction",(function(){return A})),a.d(t,"default",(function(){return O}));var n=a(10),i=a(0),l=a.n(i),o=a(44),s=a(26);const r=s.i18n.translate("xpack.osquery.action.shortEmptyTitle",{defaultMessage:"Osquery is not available"}),c=s.i18n.translate("xpack.osquery.action.empty",{defaultMessage:"An Elastic Agent is not installed on this host. To run queries, install Elastic Agent on the host, and then add the Osquery Manager integration to the agent policy in Fleet."}),u=s.i18n.translate("xpack.osquery.action.permissionDenied",{defaultMessage:"Permission denied"}),d=s.i18n.translate("xpack.osquery.action.unavailable",{defaultMessage:"The Osquery Manager integration is not added to the agent policy. To run queries on the host, add the Osquery Manager integration to the agent policy in Fleet."}),m=s.i18n.translate("xpack.osquery.action.agentStatus",{defaultMessage:"To run queries on this host, the Elastic Agent must be active. Check the status of this agent in Fleet."});var p=a(11),g=a(86),E=a(72),y=a(62),h=a(45),b=a(12),f=a(104),v=a(121),T=a(2);const q=({agentId:e,formType:t="simple",hideAgentsField:a,addToTimeline:o})=>{const s=Object(p.e)().services.application.capabilities.osquery,E=Object(i.useMemo)((()=>l.a.createElement(n.EuiEmptyPrompt,{icon:l.a.createElement(y.a,null),title:l.a.createElement("h2",null,r),titleSize:"xs",body:l.a.createElement("p",null,c)})),[]),{osqueryAvailable:h,agentFetched:q,isLoading:A,policyFetched:F,policyLoading:O,agentData:k}=(e=>{const{data:t,isFetched:a,isLoading:n}=Object(f.a)({agentId:e,silent:!0,skip:!e}),{data:l,isFetched:o,isError:s,isLoading:r}=Object(v.b)({policyId:null==t?void 0:t.policy_id,skip:!t,silent:!0});return{osqueryAvailable:Object(i.useMemo)((()=>{if(s)return!1;const e=Object(b.find)(null==l?void 0:l.package_policies,["package.name",T.OSQUERY_INTEGRATION_NAME]);return null==e?void 0:e.enabled}),[null==l?void 0:l.package_policies,s]),agentFetched:a,isLoading:n,policyFetched:o,policyLoading:r,agentData:t}})(e);return!e||q&&!k?E:s.runSavedQueries&&s.readSavedQueries||s.writeLiveQueries?A||!F&&O?l.a.createElement(n.EuiLoadingContent,{lines:10}):h?"online"!==(null==k?void 0:k.status)?l.a.createElement(n.EuiEmptyPrompt,{icon:l.a.createElement(y.a,null),title:l.a.createElement("h2",null,r),titleSize:"xs",body:l.a.createElement("p",null,m)}):l.a.createElement(g.a,{formType:t,agentId:e,hideAgentsField:a,addToTimeline:o}):l.a.createElement(n.EuiEmptyPrompt,{icon:l.a.createElement(y.a,null),title:l.a.createElement("h2",null,r),titleSize:"xs",body:l.a.createElement("p",null,d)}):l.a.createElement(n.EuiEmptyPrompt,{icon:l.a.createElement(y.a,null),title:l.a.createElement("h2",null,u),titleSize:"xs",body:l.a.createElement("p",null,"To access this page, ask your administrator for ",l.a.createElement(n.EuiCode,null,"osquery")," Kibana privileges.")})},A=l.a.memo(q),F=({services:e,agentId:t,formType:a,hideAgentsField:i=!1,addToTimeline:s})=>l.a.createElement(h.f,{theme$:e.theme.theme$},l.a.createElement(p.b,{services:e},l.a.createElement(n.EuiErrorBoundary,null,l.a.createElement(o.QueryClientProvider,{client:E.a},l.a.createElement(A,{agentId:t,formType:a,hideAgentsField:i,addToTimeline:s}))))),O=l.a.memo(F)}}]);