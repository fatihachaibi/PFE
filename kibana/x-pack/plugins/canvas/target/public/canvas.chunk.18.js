/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.canvas_bundle_jsonpfunction=window.canvas_bundle_jsonpfunction||[]).push([[18],{435:function(e,t,r){"use strict";r.r(t),r.d(t,"customElementServiceFactory",(function(){return i})),r.d(t,"embeddablesServiceFactory",(function(){return a})),r.d(t,"expressionsServiceFactory",(function(){return g})),r.d(t,"filtersServiceFactory",(function(){return A})),r.d(t,"labsServiceFactory",(function(){return p})),r.d(t,"notifyServiceFactory",(function(){return m})),r.d(t,"platformServiceFactory",(function(){return w})),r.d(t,"reportingServiceFactory",(function(){return x})),r.d(t,"visualizationsServiceFactory",(function(){return O})),r.d(t,"workpadServiceFactory",(function(){return j})),r.d(t,"pluginServiceProviders",(function(){return I})),r.d(t,"pluginServiceRegistry",(function(){return R}));var s=r(20),n=r(0);const i=({coreStart:e})=>{const{http:t}=e,r=`${n.b}`;return{create:e=>t.post(r,{body:JSON.stringify(e)}),get:e=>t.get(`${r}/${e}`).then((({data:e})=>e)),update:(e,s)=>t.put(`${r}/${e}`,{body:JSON.stringify(s)}),remove:e=>t.delete(`${r}/${e}`),find:async e=>t.get(`${r}/find`,{query:{name:e,perPage:1e4}})}},a=({startPlugins:e})=>({getEmbeddableFactories:e.embeddable.getEmbeddableFactories,getStateTransfer:e.embeddable.getStateTransfer});var o=r(1),c=r.n(o),l=r(60),u=r(27),d=r(97);class expressions_ExpressionsService{constructor(e,{filters:t,notify:r}){c()(this,"filters",void 0),c()(this,"notify",void 0),this.expressions=e,this.filters=t,this.notify=r}async interpretAst(e,t,r=null){const s=await this.getGlobalContext();return await this.interpretAstWithContext(e,r,{...null!=s?s:{},variables:t})}async interpretAstWithContext(e,t=null,r){return await this.expressions.execute(e,t,{...r,namespace:"canvas"}).getData().pipe(Object(u.pluck)("result")).toPromise()}async runInterpreter(e,t,r,s={}){const n=await this.getGlobalContext(),i={...null!=n?n:{},variables:r};try{const r=await this.interpretAstWithContext(e,t,i);if("render"===Object(l.e)(r))return r;if(s.castToRender)return this.runInterpreter(Object(l.d)("render"),r,i,{castToRender:!1});throw new Error(`Ack! I don't know how to render a '${Object(l.e)(r)}'`)}catch(e){throw this.notify.error(e),e}}getRenderer(e){return this.expressions.getRenderer(e)}getFunctions(){return this.expressions.getFunctions()}async getFilters(){const e=this.filters.getFilters(),t=this.filters.getFiltersContext(),r=e.join(" | "),s=Object(l.d)(r);return await this.interpretAstWithContext(s,null,t)}async getGlobalContext(){const e=await this.getFilters();return{searchContext:{...Object(d.a)(e?e.and:[])}}}}const g=({startPlugins:e},t)=>new expressions_ExpressionsService(e.expressions,t);r(5);const p=({startPlugins:e,coreStart:t})=>({projectIDs:s.projectIDs,isLabsEnabled:()=>t.uiSettings.get("labs:canvas:enable_ui"),...e.presentationUtil.labsService});var v=r(7),b=r(19),f=r.n(b),h=r(3);const y=f.a.has;function S(e,t=""){let r="";t&&(r+=t+": ");const s=(e=>{const t=(e=>f.a.get(e,"resp.error.root_cause"))(e);if(Array.isArray(t))return t.map((e=>e.reason)).join("\n")})(e);return"string"==typeof e?r+=e:s?r+=s:e instanceof Error?r+=S.describeError(e):y(e,"status")&&y(e,"data")&&(-1===e.status?r+=h.i18n.translate("xpack.canvas.formatMsg.toaster.unavailableServerErrorMessage",{defaultMessage:"An HTTP request has failed to connect. Please check if the Kibana server is running and that your browser has a working connection, or contact your system administrator."}):r+=h.i18n.translate("xpack.canvas.formatMsg.toaster.errorStatusMessage",{defaultMessage:"Error {errStatus} {errStatusText}: {errMessage}",values:{errStatus:e.status,errStatusText:e.statusText,errMessage:e.data.message}})),r}S.describeError=function(e){if(e)return e.shortMessage?e.shortMessage:e.body&&e.body.message?e.body.message:e.message?e.message:""+e};const P=(e,t={})=>{const r=Object(b.get)(e,"response")||e,s=S(void 0!==Object(b.get)(e,"body",void 0)?e:r),{title:n,...i}=t;let a;return n&&(a=s),{...i,title:n||s,text:a}},m=({coreStart:e})=>{const t=e.notifications.toasts;return{error(e,r){t.addDanger(P(e,r))},warning(e,r){t.addWarning(P(e,r))},info(e,r){t.add(P(e,r))},success(e,r){t.addSuccess(P(e,r))}}},w=({coreStart:e,initContext:t,startPlugins:r})=>{var s,n;if(!t)throw new Error("Canvas platform service requires init context");return{getBasePath:e.http.basePath.get,getBasePathInterface:()=>e.http.basePath,getElasticWebsiteUrl:()=>e.docLinks.ELASTIC_WEBSITE_URL,getDocLinkVersion:()=>e.docLinks.DOC_LINK_VERSION,getKibanaVersion:()=>t.env.packageInfo.version,getHasWriteAccess:()=>e.application.capabilities.canvas.save,getUISetting:e.uiSettings.get.bind(e.uiSettings),hasHeaderBanner$:e.chrome.hasHeaderBanner$,setBreadcrumbs:e.chrome.setBreadcrumbs,setRecentlyAccessed:e.chrome.recentlyAccessed.add,setFullscreen:e.chrome.setIsVisible,redirectLegacyUrl:null===(s=r.spaces)||void 0===s?void 0:s.ui.redirectLegacyUrl,getLegacyUrlConflict:null===(n=r.spaces)||void 0===n?void 0:n.ui.components.getLegacyUrlConflict,getSavedObjects:()=>e.savedObjects,getSavedObjectsClient:()=>e.savedObjects.client,getUISettings:()=>e.uiSettings}},x=({startPlugins:e,coreStart:t})=>{const{reporting:r}=e,s=()=>({getReportingPanelPDFComponent:()=>(null==r?void 0:r.components.ReportingPanelPDFV2)||null});return r?r.usesUiCapabilities()?!0===(null===(n=t.application.capabilities.canvas)||void 0===n?void 0:n.generatePdf)?s():{getReportingPanelPDFComponent:()=>null}:s():{getReportingPanelPDFComponent:()=>null};var n},O=({startPlugins:e})=>({showNewVisModal:e.visualizations.showNewVisModal,getByGroup:e.visualizations.getByGroup,getAliases:e.visualizations.getAliases}),$=["@created","@timestamp","assets","colors","css","variables","height","id","isWriteable","name","page","pages","width"],F=function(e){const t=Object.keys(e);for(const r of t)$.includes(r)||delete e[r];return e},j=({coreStart:e,startPlugins:t})=>{const r=function(){return`${n.g}`};return{get:async t=>{const s=await e.http.get(`${r()}/${t}`);return{css:n.s,variables:[],...s}},export:async t=>{var s,i;const a=await e.http.get(`${r()}/export/${t}`),{attributes:o}=a;return{...a,attributes:{...o,css:null!==(s=o.css)&&void 0!==s?s:n.s,variables:null!==(i=o.variables)&&void 0!==i?i:[]}}},resolve:async t=>{const{workpad:s,...i}=await e.http.get(`${r()}/resolve/${t}`);return{...i,workpad:{css:n.s,variables:[],...s}}},create:t=>e.http.post(r(),{body:JSON.stringify({...F({...t}),assets:t.assets||{},variables:t.variables||[]})}),import:t=>e.http.post(`${r()}/import`,{body:JSON.stringify({...F({...t}),assets:t.assets||{},variables:t.variables||[]})}),createFromTemplate:t=>e.http.post(r(),{body:JSON.stringify({templateId:t})}),findTemplates:async()=>e.http.get(n.f),find:t=>{const s="string"==typeof t&&t.length>0;return e.http.get(`${r()}/find`,{query:{perPage:1e4,name:s?t:""}})},remove:t=>e.http.delete(`${r()}/${t}`),update:(t,s)=>e.http.put(`${r()}/${t}`,{body:JSON.stringify({...F({...s})})}),updateWorkpad:(t,r)=>e.http.put(`${n.i}/${t}`,{body:JSON.stringify({...F({...r})})}),updateAssets:(t,r)=>e.http.put(`${n.h}/${t}`,{body:JSON.stringify(r)}),getRuntimeZip:t=>e.http.post(n.e,{body:JSON.stringify(t)})}};var C=r(159),E=r(59),k=r(62);class filters_FiltersService{constructor(){}getFilters(e=Object(C.d)()){return Object(E.h)(e)}updateFilter(e,t){const{dispatch:r}=Object(C.e)();r(Object(k.o)(t,e,!0))}getFiltersContext(e=Object(C.d)()){return{variables:Object(E.A)(e)}}}const A=()=>new filters_FiltersService,I={customElement:new s.PluginServiceProvider(i),embeddables:new s.PluginServiceProvider(a),expressions:new s.PluginServiceProvider(g,["filters","notify"]),filters:new s.PluginServiceProvider(A),labs:new s.PluginServiceProvider(p),navLink:new s.PluginServiceProvider((({coreStart:e,appUpdater:t})=>({updatePath:r=>{null==t||t.next((()=>({defaultPath:`${r}`}))),Object(v.b)().set(`${n.D}:${e.http.basePath.get()}`,r)}}))),notify:new s.PluginServiceProvider(m),platform:new s.PluginServiceProvider(w),reporting:new s.PluginServiceProvider(x),visualizations:new s.PluginServiceProvider(O),workpad:new s.PluginServiceProvider(j)},R=new s.PluginServiceRegistry(I)}}]);