/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */!function(e){function t(t){for(var n,s,r=t[0],o=t[1],a=0,u=[];a<r.length;a++)s=r[a],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&u.push(i[s][0]),i[s]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);for(c&&c(t);u.length;)u.shift()()}var n={},i={2:0};function s(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise((function(t,s){n=i[e]=[t,s]}));t.push(n[2]=r);var o,a=document.createElement("script");a.charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.src=function(e){return s.p+"security.chunk."+e+".js"}(e);var c=new Error;o=function(t){a.onerror=a.onload=null,clearTimeout(u);var n=i[e];if(0!==n){if(n){var s=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+s+": "+r+")",c.name="ChunkLoadError",c.type=s,c.request=r,n[1](c)}i[e]=void 0}};var u=setTimeout((function(){o({type:"timeout",target:a})}),12e4);a.onerror=a.onload=o,document.head.appendChild(a)}return Promise.all(t)},s.m=e,s.c=n,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s.oe=function(e){throw console.error(e),e};var r=window.security_bundle_jsonpfunction=window.security_bundle_jsonpfunction||[],o=r.push.bind(r);r.push=t,r=r.slice();for(var a=0;a<r.length;a++)t(r[a]);var c=o;s(s.s=32)}([function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t,n){e.exports=n(21)(2)},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t){e.exports=__kbnSharedDeps__.ReactRouterDom},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return l}));var i=n(3),s=n(7),r=n(0);const o=Object(i.createContext)(void 0),a=({children:e,...t})=>{const n=Object(i.useContext)(o),s=Object(r.jsx)(u,{breadcrumb:t},e);return n?s:Object(r.jsx)(c,null,s)},c=({children:e,onChange:t})=>{const{services:n}=Object(s.useKibana)(),a=Object(i.useRef)([]),c=e=>{const i=e.map(((t,n)=>n===e.length-1?{...t,href:void 0}:t));t?t(i):n.chrome&&l(n.chrome)(i)};return Object(r.jsx)(o.Provider,{value:{parents:[],onMount:e=>{e.length>a.current.length&&(a.current=e,c(e))},onUnmount:e=>{e.length<a.current.length&&(a.current=e,c(e))}}},e)},u=({breadcrumb:e,children:t})=>{const{parents:n,onMount:s,onUnmount:a}=Object(i.useContext)(o),c=[...n,e];return Object(i.useEffect)((()=>(s(c),()=>a(n))),[e.text,e.href]),Object(r.jsx)(o.Provider,{value:{parents:c,onMount:s,onUnmount:a}},t)};function l(e,t=e.setBreadcrumbs){return n=>{t(n),0===n.length?e.docTitle.reset():e.docTitle.change(function(e,t=2){return e.slice(0,t).reverse().map((({text:e})=>e))}(n))}}},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t){e.exports=__kbnSharedDeps__.ReactDom},function(e,t){e.exports=__kbnSharedDeps__.KbnI18nReact},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return a})),n.d(t,"h",(function(){return c})),n.d(t,"g",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"l",(function(){return h})),n.d(t,"j",(function(){return d})),n.d(t,"i",(function(){return p})),n.d(t,"k",(function(){return f})),n.d(t,"m",(function(){return b}));const i="*",s="auth_provider_hint",r="auth_url_hash",o="provider",a="msg",c="next",u=/^(?! )[a-zA-Z0-9 !"#$%&'()*+,\-./\\:;<=>?@\[\]^_`{|}~]*[a-zA-Z0-9!"#$%&'()*+,\-./\\:;<=>?@\[\]^_`{|}~]$/,l=1024,h=5e3,d=3e5,p=1e3,f=6e4,b="/internal/security/session"},function(e,t){e.exports=__kbnSharedDeps__.RxjsOperators},function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i=e=>{try{return decodeURIComponent(e)}catch{return e}}},function(e,t,n){"use strict";n.r(t),n.d(t,"UserAPIClient",(function(){return i.UserAPIClient})),n.d(t,"usersManagementApp",(function(){return p}));var i=n(16),s=(n(3),n(8)),r=n(5),o=n(2),a=n(9),c=n(7),u=n(6),l=n(17),h=n(13),d=n(0);const p=Object.freeze({id:"users",create({authc:e,getStartServices:t}){const i=o.i18n.translate("xpack.security.management.usersTitle",{defaultMessage:"Users"});return{id:this.id,order:10,title:i,async mount({element:i,theme$:a,setBreadcrumbs:c,history:l}){const[[p],{UsersGridPage:b},{CreateUserPage:m,EditUserPage:g},{UserAPIClient:v},{RolesAPIClient:y}]=await Promise.all([t(),n.e(12).then(n.bind(null,245)),n.e(9).then(n.bind(null,241)),Promise.resolve().then(n.bind(null,16)),Promise.resolve().then(n.bind(null,20))]);return Object(s.render)(Object(d.jsx)(f,{services:p,theme$:a,history:l,authc:e,onChange:Object(u.c)(p.chrome,c)},Object(d.jsx)(u.a,{text:o.i18n.translate("xpack.security.users.breadcrumb",{defaultMessage:"Users"}),href:"/"},Object(d.jsx)(r.Switch,null,Object(d.jsx)(r.Route,{path:["/",""],exact:!0},Object(d.jsx)(b,{notifications:p.notifications,userAPIClient:new v(p.http),rolesAPIClient:new y(p.http),history:l,navigateToApp:p.application.navigateToApp})),Object(d.jsx)(r.Route,{path:"/create"},Object(d.jsx)(u.a,{text:o.i18n.translate("xpack.security.users.editUserPage.createBreadcrumb",{defaultMessage:"Create"}),href:"/create"},Object(d.jsx)(m,null))),Object(d.jsx)(r.Route,{path:"/edit/:username",render:e=>{const t=Object(h.a)(e.match.params.username);return Object(d.jsx)(u.a,{text:t,href:`/edit/${encodeURIComponent(t)}`},Object(d.jsx)(g,{username:t}))}}),Object(d.jsx)(r.Route,{path:"/edit"},Object(d.jsx)(r.Redirect,{to:"/create"}))))),i),()=>{Object(s.unmountComponentAtNode)(i)}}}}}),f=({services:e,theme$:t,history:n,authc:i,onChange:s,children:o})=>Object(d.jsx)(c.KibanaContextProvider,{services:e},Object(d.jsx)(l.a,{authc:i},Object(d.jsx)(a.I18nProvider,null,Object(d.jsx)(c.KibanaThemeProvider,{theme$:t},Object(d.jsx)(r.Router,{history:n},Object(d.jsx)(u.b,{onChange:s},o))))))},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t,n){"use strict";n.r(t),n.d(t,"UserAPIClient",(function(){return UserAPIClient}));const i="/internal/security/users";class UserAPIClient{constructor(e){this.http=e}async getUsers(){return await this.http.get(i)}async getUser(e){return await this.http.get(`${i}/${encodeURIComponent(e)}`)}async deleteUser(e){await this.http.delete(`${i}/${encodeURIComponent(e)}`)}async saveUser(e){await this.http.post(`${i}/${encodeURIComponent(e.username)}`,{body:JSON.stringify(e)})}async changePassword(e,t,n){const s={newPassword:t};n&&(s.password=n),await this.http.post(`${i}/${encodeURIComponent(e)}/password`,{body:JSON.stringify(s)})}async disableUser(e){await this.http.post(`${i}/${encodeURIComponent(e)}/_disable`)}async enableUser(e){await this.http.post(`${i}/${encodeURIComponent(e)}/_enable`)}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return u}));var i=n(28),s=n.n(i),r=n(29),o=n.n(r);const[a,c]=s()((({authc:e})=>e));function u(){const e=c();return o()(e.getCurrentUser,[e])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(19),s=n(3),r=i.__importDefault(n(34));t.default=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={loading:!1});var o=s.useRef(0),a=r.default(),c=s.useState(n),u=c[0],l=c[1],h=s.useCallback((function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var s=++o.current;return l((function(e){return i.__assign(i.__assign({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return a()&&s===o.current&&l({value:e,loading:!1}),e}),(function(e){return a()&&s===o.current&&l({error:e,loading:!1}),e}))}),t);return[u,h]}},function(e,t){e.exports=__kbnSharedDeps__.TsLib},function(e,t,n){"use strict";n.r(t),n.d(t,"rolesManagementApp",(function(){return l})),n.d(t,"RolesAPIClient",(function(){return h.RolesAPIClient})),n(3);var i=n(8),s=n(5),r=n(2),o=n(7),a=n(6),c=n(13),u=n(0);const l=Object.freeze({id:"roles",create({license:e,fatalErrors:t,getStartServices:l}){const h=r.i18n.translate("xpack.security.management.rolesTitle",{defaultMessage:"Roles"});return{id:this.id,order:20,title:h,async mount({element:d,theme$:p,setBreadcrumbs:f,history:b}){const[[m,{dataViews:g,features:v,spaces:y}],{RolesGridPage:j},{EditRolePage:S},{RolesAPIClient:_},{IndicesAPIClient:x},{PrivilegesAPIClient:O},{UserAPIClient:w}]=await Promise.all([l(),n.e(14).then(n.bind(null,244)),n.e(3).then(n.bind(null,238)),Promise.resolve().then(n.bind(null,26)),n.e(19).then(n.bind(null,236)),n.e(20).then(n.bind(null,237)),Promise.resolve().then(n.bind(null,14))]),{application:P,docLinks:C,http:A,i18n:M,notifications:k,chrome:E}=m;E.docTitle.change(h);const R=new _(A),T=({action:n})=>{const{roleName:i}=Object(s.useParams)(),o=i?Object(c.a)(i):void 0,l="edit"===n&&i&&o?{text:o,href:`/edit/${encodeURIComponent(i)}`}:{text:r.i18n.translate("xpack.security.roles.createBreadcrumb",{defaultMessage:"Create"})},h=null==y?void 0:y.ui;return Object(u.jsx)(a.a,{text:l.text,href:l.href},Object(u.jsx)(S,{action:n,roleName:o,rolesAPIClient:R,userAPIClient:new w(A),indicesAPIClient:new x(A),privilegesAPIClient:new O(A),getFeatures:v.getFeatures,http:A,notifications:k,fatalErrors:t,license:e,docLinks:C,uiCapabilities:P.capabilities,dataViews:g,history:b,spacesApiUi:h}))};return Object(i.render)(Object(u.jsx)(o.KibanaContextProvider,{services:m},Object(u.jsx)(M.Context,null,Object(u.jsx)(o.KibanaThemeProvider,{theme$:p},Object(u.jsx)(s.Router,{history:b},Object(u.jsx)(a.b,{onChange:Object(a.c)(E,f)},Object(u.jsx)(a.a,{text:h,href:"/"},Object(u.jsx)(s.Route,{path:["/",""],exact:!0},Object(u.jsx)(j,{notifications:k,rolesAPIClient:R,history:b})),Object(u.jsx)(s.Route,{path:"/edit/:roleName?"},Object(u.jsx)(T,{action:"edit"})),Object(u.jsx)(s.Route,{path:"/clone/:roleName"},Object(u.jsx)(T,{action:"clone"})))))))),d),()=>{Object(i.unmountComponentAtNode)(d)}}}}});var h=n(26)},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,n){"use strict";var i,s=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),r=[];function o(e){for(var t=-1,n=0;n<r.length;n++)if(r[n].identifier===e){t=n;break}return t}function a(e,t){for(var n={},i=[],s=0;s<e.length;s++){var a=e[s],c=t.base?a[0]+t.base:a[0],u=n[c]||0,l="".concat(c," ").concat(u);n[c]=u+1;var h=o(l),d={css:a[1],media:a[2],sourceMap:a[3]};-1!==h?(r[h].references++,r[h].updater(d)):r.push({identifier:l,updater:b(d,t),references:1}),i.push(l)}return i}function c(e){var t=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var r=n.nc;r&&(i.nonce=r)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(t);else{var o=s(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var u,l=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function h(e,t,n,i){var s=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=l(t,s);else{var r=document.createTextNode(s),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(r,o[t]):e.appendChild(r)}}function d(e,t,n){var i=n.css,s=n.media,r=n.sourceMap;if(s?e.setAttribute("media",s):e.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var p=null,f=0;function b(e,t){var n,i,s;if(t.singleton){var r=f++;n=p||(p=c(t)),i=h.bind(null,n,r,!1),s=h.bind(null,n,r,!0)}else n=c(t),i=d.bind(null,n,t),s=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else s()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i));var n=a(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<n.length;i++){var s=o(n[i]);r[s].references--}for(var c=a(e,t),u=0;u<n.length;u++){var l=o(n[u]);0===r[l].references&&(r[l].updater(),r.splice(l,1))}n=c}}}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n,i,s,r=e[1]||"",o=e[3];if(!o)return r;if(t&&"function"==typeof btoa){var a=(n=o,i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),"/*# ".concat(s," */")),c=o.sources.map((function(e){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(e," */")}));return[r].concat(c).concat([a]).join("\n")}return[r].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,i){"string"==typeof e&&(e=[[null,e,""]]);var s={};if(i)for(var r=0;r<this.length;r++){var o=this[r][0];null!=o&&(s[o]=!0)}for(var a=0;a<e.length;a++){var c=[].concat(e[a]);i&&s[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},function(e,t,n){e.exports=n(21)(3)},function(e,t,n){"use strict";function i(e){return e.full_name||e.username}n.d(t,"d",(function(){return i})),n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return b})),n.d(t,"f",(function(){return l})),n.d(t,"h",(function(){return f})),n.d(t,"i",(function(){return u})),n.d(t,"j",(function(){return h})),n.d(t,"e",(function(){return d})),n.d(t,"g",(function(){return c})),n.d(t,"k",(function(){return m})),n.d(t,"c",(function(){return p}));const s=["reserved","native"];function r(e){return s.includes(e.authentication_realm.type)&&"anonymous"!==e.authentication_provider.type}var o=n(15),a=n(2);function c(e){var t,n;return null===(t=null===(n=e.transient_metadata)||void 0===n?void 0:n.enabled)||void 0===t||t}function u(e){var t,n;return null!==(t=null===(n=e.metadata)||void 0===n?void 0:n._reserved)&&void 0!==t&&t}function l(e){var t,n;return null!==(t=null===(n=e.metadata)||void 0===n?void 0:n._deprecated)&&void 0!==t&&t}function h(e){var t,n;return null!==(t=u(e)&&(null===(n=e.name)||void 0===n?void 0:n.endsWith("_system")))&&void 0!==t&&t}function d(e){var t,n;return null!==(t=u(e)&&((null===(n=e.name)||void 0===n?void 0:n.endsWith("_admin"))||"superuser"===e.name))&&void 0!==t&&t}function p(e){return a.i18n.translate("xpack.security.common.extendedRoleDeprecationNotice",{defaultMessage:"The {roleName} role is deprecated. {reason}",values:{roleName:e.name,reason:g(e)}})}function f(e){var t,n;return u(e)||(null!==(t=null===(n=e._transform_error)||void 0===n?void 0:n.length)&&void 0!==t?t:0)>0}function b(e){return Object(o.cloneDeep)(e)}function m(e){const t=b(e);return t.name="",t}function g(e){var t,n;return null!==(t=null===(n=e.metadata)||void 0===n?void 0:n._deprecated_reason)&&void 0!==t?t:""}},function(e,t,n){"use strict";n.r(t),n.d(t,"RolesAPIClient",(function(){return RolesAPIClient}));var i=n(25);class RolesAPIClient{constructor(e){this.http=e}async getRoles(){return await this.http.get("/api/security/role")}async getRole(e){return await this.http.get(`/api/security/role/${encodeURIComponent(e)}`)}async deleteRole(e){await this.http.delete(`/api/security/role/${encodeURIComponent(e)}`)}async saveRole({role:e,createOnly:t=!1}){await this.http.put(`/api/security/role/${encodeURIComponent(e.name)}`,{body:JSON.stringify(this.transformRoleForSave(Object(i.b)(e))),query:{createOnly:t}})}transformRoleForSave(e){return e.elasticsearch.indices=e.elasticsearch.indices.filter((e=>!(e=>0===e.names.length)(e))),e.elasticsearch.indices.forEach((e=>e.query||delete e.query)),e.kibana.forEach((e=>{e.base.length>0&&(e.feature={})})),delete e.name,delete e.transient_metadata,delete e._unrecognized_applications,delete e._transform_error,e}}},function(e,t,n){n.r(t);var i=__kbnBundles__.get("entry/core/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s="_NP_";function r(e){return function(){return i.useContext(e)}}t.default=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var a=i.createContext(s),c=function(t){var s=e(t),r=n[0],o=r&&r(s),c=Array.isArray(o)?i.useMemo((function(){return s}),o):s;return i.createElement(a.Provider,{value:c},t.children)},u=r(a);u.Context=a,u.Provider=c;var l=[];if(n.length){var h=[],d=function(t){for(var s=e(t),r=t.children,o=0;o<h.length;o+=1){var a=h[o],c=n[o];r=i.createElement(a.Provider,{value:c(s)},r)}return r};l.push(d);for(var p=0;p<n.length;p+=1){var f=i.createContext(s);h.push(f),l.push(r(f))}}else l.push(c,r(a));for(var b=0;b<l.length;b+=1)u[b]=l[b];return"function"==typeof Symbol&&Symbol.iterator&&(u[Symbol.iterator]=function(){return l[Symbol.iterator]()}),u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(19),s=n(3),r=i.__importDefault(n(18));t.default=function(e,t){void 0===t&&(t=[]);var n=r.default(e,t,{loading:!0}),i=n[0],o=n[1];return s.useEffect((function(){o()}),[o]),i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(19),s=n(3),r=i.__importDefault(n(40));t.default=function(e,t){var n=s.useState(t),i=n[0],o=n[1];return r.default((function(){var t=e.subscribe(o);return function(){return t.unsubscribe()}}),[e]),i}},function(e,t,n){"use strict";n.r(t),n.d(t,"ManagementService",(function(){return management_service_ManagementService})),n.d(t,"UserAPIClient",(function(){return y.UserAPIClient}));var i=n(1),s=n.n(i),r=(n(3),n(8)),o=n(5),a=n(2),c=n(9),u=n(7),l=n(6),h=n(17),d=n(0);const p=Object.freeze({id:"api_keys",create({authc:e,getStartServices:t}){return{id:this.id,order:30,title:a.i18n.translate("xpack.security.management.apiKeysTitle",{defaultMessage:"API keys"}),async mount({element:i,theme$:s,setBreadcrumbs:o,history:c}){const[[u],{APIKeysGridPage:h},{APIKeysAPIClient:p}]=await Promise.all([t(),n.e(10).then(n.bind(null,240)),n.e(17).then(n.bind(null,94))]);return Object(r.render)(Object(d.jsx)(f,{services:u,theme$:s,history:c,authc:e,onChange:Object(l.c)(u.chrome,o)},Object(d.jsx)(l.a,{text:a.i18n.translate("xpack.security.management.apiKeysTitle",{defaultMessage:"API keys"}),href:"/"},Object(d.jsx)(h,{history:c,notifications:u.notifications,apiKeysAPIClient:new p(u.http)}))),i),()=>{Object(r.unmountComponentAtNode)(i)}}}}}),f=({services:e,theme$:t,history:n,authc:i,onChange:s,children:r})=>Object(d.jsx)(u.KibanaContextProvider,{services:e},Object(d.jsx)(h.a,{authc:i},Object(d.jsx)(c.I18nProvider,null,Object(d.jsx)(u.KibanaThemeProvider,{theme$:t},Object(d.jsx)(o.Router,{history:n},Object(d.jsx)(l.b,{onChange:s},r))))));var b=n(13);const m=Object.freeze({id:"role_mappings",create({getStartServices:e}){const t=a.i18n.translate("xpack.security.management.roleMappingsTitle",{defaultMessage:"Role Mappings"});return{id:this.id,order:40,title:t,async mount({element:i,theme$:s,setBreadcrumbs:c,history:h}){const[[p],{RoleMappingsGridPage:f},{EditRoleMappingPage:m},{RoleMappingsAPIClient:g},{RolesAPIClient:v}]=await Promise.all([e(),n.e(11).then(n.bind(null,243)),n.e(7).then(n.bind(null,239)),n.e(18).then(n.bind(null,235)),Promise.resolve().then(n.bind(null,20))]);p.chrome.docTitle.change(t);const y=new g(p.http),j=({action:e})=>{const{name:t}=Object(o.useParams)(),n=t?Object(b.a)(t):void 0,i="edit"===e&&t&&n?{text:n,href:`/edit/${encodeURIComponent(t)}`}:{text:a.i18n.translate("xpack.security.roleMappings.createBreadcrumb",{defaultMessage:"Create"})};return Object(d.jsx)(l.a,{text:i.text,href:i.href},Object(d.jsx)(m,{action:e,name:n,roleMappingsAPI:y,rolesAPIClient:new v(p.http),notifications:p.notifications,docLinks:p.docLinks,history:h}))};return Object(r.render)(Object(d.jsx)(u.KibanaContextProvider,{services:p},Object(d.jsx)(p.i18n.Context,null,Object(d.jsx)(u.KibanaThemeProvider,{theme$:s},Object(d.jsx)(o.Router,{history:h},Object(d.jsx)(l.b,{onChange:Object(l.c)(p.chrome,c)},Object(d.jsx)(l.a,{text:t,href:"/"},Object(d.jsx)(o.Route,{path:["/",""],exact:!0},Object(d.jsx)(f,{notifications:p.notifications,rolesAPIClient:new v(p.http),roleMappingsAPI:y,docLinks:p.docLinks,history:h,navigateToApp:p.application.navigateToApp})),Object(d.jsx)(o.Route,{path:"/edit/:name?"},Object(d.jsx)(j,{action:"edit"})),Object(d.jsx)(o.Route,{path:"/clone/:name"},Object(d.jsx)(j,{action:"clone"})))))))),i),()=>{Object(r.unmountComponentAtNode)(i)}}}}});var g=n(20),v=n(14);class management_service_ManagementService{constructor(){s()(this,"license",void 0),s()(this,"licenseFeaturesSubscription",void 0),s()(this,"securitySection",void 0)}setup({getStartServices:e,management:t,authc:n,license:i,fatalErrors:s}){this.license=i,this.securitySection=t.sections.section.security,this.securitySection.registerApp(v.usersManagementApp.create({authc:n,getStartServices:e})),this.securitySection.registerApp(g.rolesManagementApp.create({fatalErrors:s,license:i,getStartServices:e})),this.securitySection.registerApp(p.create({authc:n,getStartServices:e})),this.securitySection.registerApp(m.create({getStartServices:e}))}start({capabilities:e}){this.licenseFeaturesSubscription=this.license.features$.subscribe((async t=>{const n=this.securitySection,i=[[n.getApp(v.usersManagementApp.id),t.showLinks],[n.getApp(g.rolesManagementApp.id),t.showLinks],[n.getApp(p.id),t.showLinks],[n.getApp(m.id),t.showLinks&&t.showRoleMappingsManagement]];for(const[t,n]of i)!0===e.management.security[t.id]?t.enabled!==n&&(n?t.enable():t.disable()):t.disable()}))}stop(){this.licenseFeaturesSubscription&&(this.licenseFeaturesSubscription.unsubscribe(),this.licenseFeaturesSubscription=void 0)}}var y=n(16)},function(e,t,n){n(33),__kbnBundles__.define("plugin/security/public",n,41)},function(e,t,n){n.p=window.__kbnPublicPath__.security},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3);t.default=function(){var e=i.useRef(!1),t=i.useCallback((function(){return e.current}),[]);return i.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}},function(e,t,n){switch(window.__kbnThemeTag__){case"v8dark":return n(36);case"v8light":return n(38)}},function(e,t,n){var i=n(22),s=n(37);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[e.i,s,""]]);i(s,{insert:"head",singleton:!1}),e.exports=s.locals||{}},function(e,t,n){(t=n(23)(!1)).push([e.i,".chrNavControl__userMenu .euiContextMenuPanelTitle{text-transform:none}.chrNavControl__userMenu .euiContextMenuItem{line-height:normal}\n",""]),e.exports=t},function(e,t,n){var i=n(22),s=n(39);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[e.i,s,""]]);i(s,{insert:"head",singleton:!1}),e.exports=s.locals||{}},function(e,t,n){(t=n(23)(!1)).push([e.i,".chrNavControl__userMenu .euiContextMenuPanelTitle{text-transform:none}.chrNavControl__userMenu .euiContextMenuItem{line-height:normal}\n",""]),e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s="undefined"!=typeof window?i.useLayoutEffect:i.useEffect;t.default=s},function(e,t,n){"use strict";n.r(t),n.d(t,"plugin",(function(){return W}));var i=n(1),s=n.n(i),r=n(2),o=n(11);class license_service_SecurityLicenseService{constructor(){s()(this,"licenseSubscription",void 0)}setup({license$:e}){let t;return this.licenseSubscription=e.subscribe((e=>{t=e})),{license:Object.freeze({isLicenseAvailable:()=>{var e,n;return null!==(e=null===(n=t)||void 0===n?void 0:n.isAvailable)&&void 0!==e&&e},isEnabled:()=>this.isSecurityEnabledFromRawLicense(t),hasAtLeast:e=>{var n;return null===(n=t)||void 0===n?void 0:n.hasAtLeast(e)},getFeatures:()=>this.calculateFeaturesFromRawLicense(t),features$:e.pipe(Object(o.map)((e=>this.calculateFeaturesFromRawLicense(e))))})}}stop(){this.licenseSubscription&&(this.licenseSubscription.unsubscribe(),this.licenseSubscription=void 0)}isSecurityEnabledFromRawLicense(e){if(!e)return!1;const t=e.getFeature("security");return void 0!==t&&t.isAvailable&&t.isEnabled}calculateFeaturesFromRawLicense(e){if(null==e||!e.isAvailable)return{showLogin:!0,allowLogin:!1,showLinks:!1,showRoleMappingsManagement:!1,allowAccessAgreement:!1,allowAuditLogging:!1,allowRoleDocumentLevelSecurity:!1,allowRoleFieldLevelSecurity:!1,allowRbac:!1,allowSubFeaturePrivileges:!1,layout:void 0===e||null!=e&&e.isAvailable?"error-es-unavailable":"error-xpack-unavailable"};if(!this.isSecurityEnabledFromRawLicense(e))return{showLogin:!1,allowLogin:!1,showLinks:!1,showRoleMappingsManagement:!1,allowAccessAgreement:!1,allowAuditLogging:!1,allowRoleDocumentLevelSecurity:!1,allowRoleFieldLevelSecurity:!1,allowRbac:!1,allowSubFeaturePrivileges:!1};const t=e.hasAtLeast("gold"),n=e.hasAtLeast("platinum");return{showLogin:!0,allowLogin:!0,showLinks:!0,showRoleMappingsManagement:t,allowAccessAgreement:t,allowAuditLogging:t,allowSubFeaturePrivileges:t,allowRoleDocumentLevelSecurity:n,allowRoleFieldLevelSecurity:n,allowRbac:!0}}}var a=n(27);const c=Object.freeze({id:"security_account",create({application:e,authc:t,getStartServices:i}){const s=r.i18n.translate("xpack.security.account.breadcrumb",{defaultMessage:"Account Management"});e.register({id:this.id,title:s,navLinkStatus:a.AppNavLinkStatus.hidden,appRoute:"/security/account",async mount({element:e,theme$:r}){const[[o],{renderAccountManagementPage:a},{UserAPIClient:c}]=await Promise.all([i(),n.e(13).then(n.bind(null,246)),Promise.resolve().then(n.bind(null,31))]);return o.chrome.setBreadcrumbs([{text:s}]),a(o.i18n,{element:e,theme$:r},{authc:t,notifications:o.notifications,userAPIClient:new c(o.http)})}})}});var u=n(12);class analytics_service_AnalyticsService{constructor(){s()(this,"securityLicense",void 0),s()(this,"securityFeaturesSubscription",void 0)}setup({securityLicense:e}){this.securityLicense=e}start({http:e}){this.securityFeaturesSubscription=this.securityLicense.features$.pipe(Object(u.filter)((({allowLogin:e})=>e)),Object(o.throttleTime)(5e3)).subscribe((async()=>{try{await analytics_service_AnalyticsService.recordAuthTypeAnalytics(e)}catch{}}))}stop(){this.securityFeaturesSubscription&&(this.securityFeaturesSubscription.unsubscribe(),this.securityFeaturesSubscription=void 0)}static async recordAuthTypeAnalytics(e){localStorage.setItem(analytics_service_AnalyticsService.AuthTypeInfoStorageKey,JSON.stringify(await e.post("/internal/security/analytics/_record_auth_type",{body:localStorage.getItem(analytics_service_AnalyticsService.AuthTypeInfoStorageKey)})))}}s()(analytics_service_AnalyticsService,"AuthTypeInfoStorageKey","kibana.security.userAuthType");const l=Object.freeze({isEnabled:!1,accessURLParameters:null});class anonymous_access_service_AnonymousAccessService{constructor(){s()(this,"internalService",void 0)}setup({share:e}){e.setAnonymousAccessServiceProvider((()=>this.internalService))}start({http:e}){this.internalService={getCapabilities:()=>e.get("/internal/security/anonymous_access/capabilities"),getState:()=>e.anonymousPaths.isAnonymous(window.location.pathname)?Promise.resolve(l):e.get("/internal/security/anonymous_access/state").catch((()=>l))}}}const h=Object.freeze({id:"security_access_agreement",create({application:e,getStartServices:t}){e.register({id:this.id,title:r.i18n.translate("xpack.security.accessAgreementAppTitle",{defaultMessage:"Access Agreement"}),chromeless:!0,appRoute:"/security/access_agreement",async mount({element:e,theme$:i}){const[[s],{renderAccessAgreementPage:r}]=await Promise.all([t(),Promise.all([n.e(0),n.e(1),n.e(4)]).then(n.bind(null,232))]);return r(s.i18n,{element:e,theme$:i},{http:s.http,notifications:s.notifications,fatalErrors:s.fatalErrors})}})}});var d=n(10);const p=Object.freeze({id:"security_capture_url",create({application:e,fatalErrors:t,http:i}){i.anonymousPaths.register("/internal/security/capture-url"),e.register({id:this.id,title:"Capture URL",chromeless:!0,appRoute:"/internal/security/capture-url",async mount(){try{const{parseNext:e}=await n.e(0).then(n.bind(null,84)),t=new URL(e(window.location.href,i.basePath.serverBasePath),window.location.origin);t.searchParams.append(d.c,window.location.hash),window.location.replace(t.toString())}catch(e){t.add(new Error(`Cannot parse current URL: ${e&&e.message}.`))}return()=>{}}})}}),f=Object.freeze({id:"security_logged_out",create({application:e,http:t,getStartServices:i}){t.anonymousPaths.register("/security/logged_out"),e.register({id:this.id,title:r.i18n.translate("xpack.security.loggedOutAppTitle",{defaultMessage:"Logged out"}),chromeless:!0,appRoute:"/security/logged_out",async mount({element:e,theme$:t}){const[[s],{renderLoggedOutPage:r}]=await Promise.all([i(),Promise.all([n.e(0),n.e(5)]).then(n.bind(null,233))]);return r(s.i18n,{element:e,theme$:t},{basePath:s.http.basePath})}})}}),b=Object.freeze({id:"security_login",create({application:e,http:t,getStartServices:i,config:s}){t.anonymousPaths.register("/login"),e.register({id:this.id,title:r.i18n.translate("xpack.security.loginAppTitle",{defaultMessage:"Login"}),chromeless:!0,appRoute:"/login",async mount({element:e,theme$:t}){const[[r],{renderLoginPage:o}]=await Promise.all([i(),Promise.all([n.e(1),n.e(8)]).then(n.bind(null,242))]);return o(r.i18n,{element:e,theme$:t},{http:r.http,notifications:r.notifications,fatalErrors:r.fatalErrors,loginAssistanceMessage:s.loginAssistanceMessage,sameSiteCookies:s.sameSiteCookies})}})}}),m=Object.freeze({id:"security_logout",create({application:e,http:t}){t.anonymousPaths.register("/logout"),e.register({id:this.id,title:r.i18n.translate("xpack.security.logoutAppTitle",{defaultMessage:"Logout"}),chromeless:!0,appRoute:"/logout",mount:async()=>(window.sessionStorage.clear(),window.localStorage.removeItem(analytics_service_AnalyticsService.AuthTypeInfoStorageKey),window.location.href=t.basePath.prepend(`/api/security/logout${window.location.search}`),()=>{})})}}),g=Object.freeze({id:"security_overwritten_session",create({application:e,authc:t,getStartServices:i}){e.register({id:this.id,title:r.i18n.translate("xpack.security.overwrittenSessionAppTitle",{defaultMessage:"Overwritten Session"}),chromeless:!0,appRoute:"/security/overwritten_session",async mount({element:e,theme$:s}){const[[r],{renderOverwrittenSessionPage:o}]=await Promise.all([i(),Promise.all([n.e(0),n.e(6)]).then(n.bind(null,234))]);return o(r.i18n,{element:e,theme$:s},{authc:t,basePath:r.http.basePath})}})}});class authentication_service_AuthenticationService{setup({application:e,fatalErrors:t,config:n,getStartServices:i,http:s}){const r=async()=>await s.get("/internal/security/me",{asSystemRequest:!0});return h.create({application:e,getStartServices:i}),p.create({application:e,fatalErrors:t,http:s}),b.create({application:e,config:n,getStartServices:i,http:s}),m.create({application:e,http:s}),f.create({application:e,getStartServices:i,http:s}),g.create({application:e,authc:{getCurrentUser:r},getStartServices:i}),{getCurrentUser:r,areAPIKeysEnabled:async()=>(await s.get("/internal/security/api_key/_enabled")).apiKeysEnabled}}}var v=n(31),y=n(15),j=n(3),S=n.n(j),_=n(8),x=n.n(_),O=n(7),w=(n(35),n(4)),P=n(9),C=n(0);class nav_control_component_SecurityNavControl extends j.Component{constructor(e){super(e),s()(this,"subscription",void 0),s()(this,"onMenuButtonClick",(()=>{this.state.authenticatedUser&&this.setState({isOpen:!this.state.isOpen})})),s()(this,"closeMenu",(()=>{this.setState({isOpen:!1})})),this.state={isOpen:!1,authenticatedUser:null,userMenuLinks:[]},e.user.then((e=>{this.setState({authenticatedUser:e})}))}componentDidMount(){this.subscription=this.props.userMenuLinks$.subscribe((async e=>{this.setState({userMenuLinks:e})}))}componentWillUnmount(){this.subscription&&this.subscription.unsubscribe()}render(){const{editProfileUrl:e,logoutUrl:t}=this.props,{authenticatedUser:n,userMenuLinks:i}=this.state,s=n&&(n.full_name||n.username)||"",o=n?Object(C.jsx)(w.EuiAvatar,{name:s,size:"s","data-test-subj":"userMenuAvatar"}):Object(C.jsx)(w.EuiLoadingSpinner,{size:"m"}),a=Object(C.jsx)(w.EuiHeaderSectionItemButton,{"aria-controls":"headerUserMenu","aria-expanded":this.state.isOpen,"aria-haspopup":"true","aria-label":r.i18n.translate("xpack.security.navControlComponent.accountMenuAriaLabel",{defaultMessage:"Account menu"}),onClick:this.onMenuButtonClick,"data-test-subj":"userMenuButton"},o),c="anonymous"===(null==n?void 0:n.authentication_provider.type),u=[];if(i.length){const e=i.sort((({order:e=1/0},{order:t=1/0})=>e-t)).map((({label:e,iconType:t,href:n})=>({name:e,icon:Object(C.jsx)(w.EuiIcon,{type:t,size:"m"}),href:n,"data-test-subj":`userMenuLink__${e}`})));u.push(...e)}if(!c){const t=i.some((({setAsProfile:e})=>!0===e)),n={name:Object(C.jsx)(P.FormattedMessage,{id:"xpack.security.navControlComponent.editProfileLinkText",defaultMessage:"{profileOverridden, select, true{Preferences} other{Profile}}",values:{profileOverridden:t}}),icon:Object(C.jsx)(w.EuiIcon,{type:t?"controlsHorizontal":"user",size:"m"}),href:e,"data-test-subj":"profileLink"};t?u.push(n):u.unshift(n)}const l={name:c?Object(C.jsx)(P.FormattedMessage,{id:"xpack.security.navControlComponent.loginLinkText",defaultMessage:"Log in"}):Object(C.jsx)(P.FormattedMessage,{id:"xpack.security.navControlComponent.logoutLinkText",defaultMessage:"Log out"}),icon:Object(C.jsx)(w.EuiIcon,{type:"exit",size:"m"}),href:t,"data-test-subj":"logoutLink"};u.push(l);const h=[{id:0,title:s,items:u}];return Object(C.jsx)(w.EuiPopover,{id:"headerUserMenu",ownFocus:!0,button:a,isOpen:this.state.isOpen,anchorPosition:"downRight",repositionOnScroll:!0,closePopover:this.closeMenu,panelPaddingSize:"none",buffer:0},Object(C.jsx)("div",{"data-test-subj":"userMenu"},Object(C.jsx)(w.EuiContextMenu,{className:"chrNavControl__userMenu",initialPanelId:0,panels:h})))}}class nav_control_service_SecurityNavControlService{constructor(){s()(this,"securityLicense",void 0),s()(this,"authc",void 0),s()(this,"logoutUrl",void 0),s()(this,"navControlRegistered",void 0),s()(this,"securityFeaturesSubscription",void 0),s()(this,"stop$",new u.ReplaySubject(1)),s()(this,"userMenuLinks$",new u.BehaviorSubject([]))}setup({securityLicense:e,authc:t,logoutUrl:n}){this.securityLicense=e,this.authc=t,this.logoutUrl=n}start({core:e}){return this.securityFeaturesSubscription=this.securityLicense.features$.subscribe((({showLinks:t})=>{!e.http.anonymousPaths.isAnonymous(window.location.pathname)&&t&&!this.navControlRegistered&&this.registerSecurityNavControl(e)})),{getUserMenuLinks$:()=>this.userMenuLinks$.pipe(Object(o.map)(this.sortUserMenuLinks),Object(o.takeUntil)(this.stop$)),addUserMenuLinks:e=>{const t=this.userMenuLinks$.value,n=t.find((({setAsProfile:e})=>!0===e)),i=e.filter((({setAsProfile:e})=>!0===e)).length;if(n&&i>0)throw new Error(`Only one custom profile link can be set. A custom profile link named ${n.label} (${n.href}) already exists`);if(i>1)throw new Error(`Only one custom profile link can be passed at a time (found ${i})`);const s=[...t,...e];this.userMenuLinks$.next(s)}}}stop(){this.securityFeaturesSubscription&&(this.securityFeaturesSubscription.unsubscribe(),this.securityFeaturesSubscription=void 0),this.navControlRegistered=!1,this.stop$.next()}registerSecurityNavControl(e){const{theme$:t}=e.theme,n=this.authc.getCurrentUser();e.chrome.navControls.registerRight({order:2e3,mount:i=>{const s=e.i18n.Context,r={user:n,editProfileUrl:e.http.basePath.prepend("/security/account"),logoutUrl:this.logoutUrl,userMenuLinks$:this.userMenuLinks$};return x.a.render(Object(C.jsx)(s,null,Object(C.jsx)(O.KibanaThemeProvider,{theme$:t},Object(C.jsx)(nav_control_component_SecurityNavControl,r))),i),()=>x.a.unmountComponentAtNode(i)}}),this.navControlRegistered=!0}sortUserMenuLinks(e){return Object(y.sortBy)(e,"order")}}const A=r.i18n.translate("xpack.security.checkup.insecureClusterTitle",{defaultMessage:"Your data is not secure"}),M=(e,t)=>n=>(Object(_.render)(Object(C.jsx)((()=>{const[n,i]=Object(j.useState)(!1),s=`${e.links.security.elasticsearchEnableSecurity}?blade=kibanasecuritymessage`;return Object(C.jsx)(P.I18nProvider,null,Object(C.jsx)("div",{"data-test-subj":"insecureClusterAlertText"},Object(C.jsx)(w.EuiText,{size:"s"},Object(C.jsx)(P.FormattedMessage,{id:"xpack.security.checkup.insecureClusterMessage",defaultMessage:"Don’t lose one bit. Enable our free security features."})),Object(C.jsx)(w.EuiSpacer,null),Object(C.jsx)(w.EuiCheckbox,{id:"persistDismissedAlertPreference",checked:n,onChange:e=>i(e.target.checked),label:r.i18n.translate("xpack.security.checkup.dontShowAgain",{defaultMessage:"Don't show again"})}),Object(C.jsx)(w.EuiSpacer,null),Object(C.jsx)(w.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(C.jsx)(w.EuiFlexItem,{grow:!1},Object(C.jsx)(w.EuiButton,{size:"s",color:"primary",fill:!0,href:s,target:"_blank","data-test-subj":"learnMoreButton"},r.i18n.translate("xpack.security.checkup.enableButtonText",{defaultMessage:"Enable security"}))),Object(C.jsx)(w.EuiFlexItem,{grow:!1},Object(C.jsx)(w.EuiButton,{size:"s",onClick:()=>t(n),"data-test-subj":"dismissAlertButton"},r.i18n.translate("xpack.security.checkup.dismissButtonText",{defaultMessage:"Dismiss"}))))))}),null),n),()=>Object(_.unmountComponentAtNode)(n)),k=Object.freeze({displayAlert:!1});class security_checkup_service_SecurityCheckupService{constructor(e,t){s()(this,"enabled",void 0),s()(this,"alertVisibility$",void 0),s()(this,"storage",void 0),s()(this,"alertToast",void 0),s()(this,"storageKey",void 0),this.storage=t,this.enabled=e.showInsecureClusterWarning,this.alertVisibility$=new u.BehaviorSubject(this.enabled)}setup({http:e}){const t=e.basePath.serverBasePath;this.storageKey=`insecureClusterWarningVisibility${t}`,this.enabled=this.enabled&&this.getPersistedVisibilityPreference(),this.alertVisibility$.next(this.enabled)}start(e){this.enabled&&this.initializeAlert(e)}initializeAlert({http:e,notifications:t,docLinks:n}){const i=Object(u.from)(this.getSecurityCheckupState(e));Object(u.combineLatest)([i,this.alertVisibility$]).pipe(Object(o.map)((([{displayAlert:e},t])=>e&&t)),Object(o.distinctUntilChanged)()).subscribe((e=>{e&&!this.alertToast?this.alertToast=t.toasts.addWarning({title:A,text:M(n,(e=>this.setAlertVisibility(!1,e))),iconType:"alert"},{toastLifeTimeMs:864e6}):!e&&this.alertToast&&(t.toasts.remove(this.alertToast),this.alertToast=void 0)}))}getSecurityCheckupState(e){return e.anonymousPaths.isAnonymous(window.location.pathname)?Promise.resolve(k):e.get("/internal/security/security_checkup/state").catch((()=>k))}setAlertVisibility(e,t){this.enabled&&(this.alertVisibility$.next(e),t&&this.setPersistedVisibilityPreference(e))}getPersistedVisibilityPreference(){var e;const t=null!==(e=this.storage.getItem(this.storageKey))&&void 0!==e?e:"{}";try{const{show:e=!0}=JSON.parse(t);return e}catch(e){return!0}}setPersistedVisibilityPreference(e){this.storage.setItem(this.storageKey,JSON.stringify({show:e}))}}class session_expired_SessionExpired{constructor(e,t,n){this.application=e,this.logoutUrl=t,this.tenant=n}logout(e){const t=(()=>{const{location:e}=window,t=encodeURIComponent(`${e.pathname}${e.search}${e.hash}`);return`&${d.h}=${t}`})(),n=(e=>{const t=`${this.tenant}/session_provider`,n=sessionStorage.getItem(t);return n?`&${d.d}=${encodeURIComponent(n)}`:""})();this.application.navigateToUrl(`${this.logoutUrl}?${d.e}=${e}${t}${n}`,{forceRedirect:!0,skipAppLeave:!0})}}let E;!function(e){e.SESSION_EXPIRED="SESSION_EXPIRED",e.AUTHENTICATION_ERROR="AUTHENTICATION_ERROR",e.LOGGED_OUT="LOGGED_OUT",e.UNAUTHENTICATED="UNAUTHENTICATED"}(E||(E={}));var R=n(18),T=n.n(R),I=n(30),L=n.n(I);const $=({sessionState$:e,onExtend:t})=>{const n=L()(e),[{loading:i},s]=T()(t);if(!n||!n.expiresInMs)return null;const r=Object(C.jsx)(P.FormattedMessage,{id:"xpack.security.sessionExpirationToast.body",defaultMessage:"You will be logged out {timeout}.",values:{timeout:Object(C.jsx)(P.FormattedRelative,{value:Math.max(n.expiresInMs-d.l,0)+Date.now(),updateInterval:1e3})}});return n.canBeExtended?Object(C.jsx)(S.a.Fragment,null,r,Object(C.jsx)(w.EuiSpacer,{size:"m"}),Object(C.jsx)(w.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"s"},Object(C.jsx)(w.EuiFlexItem,{grow:!1},Object(C.jsx)(w.EuiButton,{size:"s",color:"warning",isLoading:i,onClick:s},Object(C.jsx)(P.FormattedMessage,{id:"xpack.security.sessionExpirationToast.extendButton",defaultMessage:"Stay logged in"}))))):r};class session_timeout_SessionTimeout{constructor(e,t,n,i){s()(this,"channel",void 0),s()(this,"isVisible","hidden"!==document.visibilityState),s()(this,"isFetchingSessionInfo",!1),s()(this,"consecutiveErrorCount",0),s()(this,"snoozedWarningState",void 0),s()(this,"sessionState$",new u.BehaviorSubject({lastExtensionTime:0,expiresInMs:null,canBeExtended:!1})),s()(this,"subscription",void 0),s()(this,"warningToast",void 0),s()(this,"stopActivityMonitor",void 0),s()(this,"stopVisibilityMonitor",void 0),s()(this,"removeHttpInterceptor",void 0),s()(this,"stopRefreshTimer",void 0),s()(this,"stopWarningTimer",void 0),s()(this,"stopLogoutTimer",void 0),s()(this,"handleChannelMessage",(e=>{this.isSessionState(e.data)&&this.sessionState$.next(e.data)})),s()(this,"isSessionState",(e=>"object"==typeof e&&Object.hasOwn(null!=e?e:{},"canBeExtended"))),s()(this,"handleHttpRequest",(e=>{if(-1===e.path.indexOf("://")&&!e.path.startsWith("//"))return e.asSystemRequest?void 0:{...e,asSystemRequest:!this.isVisible}})),s()(this,"handleUserActivity",(()=>{this.shouldExtend()&&this.fetchSessionInfo(!0)})),s()(this,"handleVisibilityChange",(e=>{this.isVisible=e,e&&this.handleUserActivity()})),s()(this,"resetTimers",(({lastExtensionTime:e,expiresInMs:t})=>{var n,i,s;if(this.stopRefreshTimer=null===(n=this.stopRefreshTimer)||void 0===n?void 0:n.call(this),this.stopWarningTimer=null===(i=this.stopWarningTimer)||void 0===i?void 0:i.call(this),this.stopLogoutTimer=null===(s=this.stopLogoutTimer)||void 0===s?void 0:s.call(this),null!==t){const n=Math.max(t-d.l,0),i=Math.max(n-d.j,this.snoozedWarningState?this.snoozedWarningState.lastExtensionTime+this.snoozedWarningState.expiresInMs-d.l-e:0,0),s=i-d.i;this.stopLogoutTimer=U((()=>this.sessionExpired.logout(E.SESSION_EXPIRED)),n),i>0&&this.hideWarning(),i<n&&(this.stopWarningTimer=U(this.showWarning,i)),s>0&&s<n&&(this.stopRefreshTimer=U(this.fetchSessionInfo,s))}})),s()(this,"toggleEventHandlers",(({expiresInMs:e,canBeExtended:t})=>{var n,i,s;null!==e?(t&&!this.stopActivityMonitor&&(this.stopActivityMonitor=function(e){const t=["mousemove","mousedown","wheel","touchstart","keydown"];for(const n of t)window.addEventListener(n,e);return()=>{for(const n of t)window.removeEventListener(n,e)}}(this.handleUserActivity)),this.removeHttpInterceptor||(this.removeHttpInterceptor=this.http.intercept({request:this.handleHttpRequest})),this.stopVisibilityMonitor||(this.stopVisibilityMonitor=function(e){const t=()=>e("hidden"!==document.visibilityState);return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}}(this.handleVisibilityChange))):(this.removeHttpInterceptor=null===(n=this.removeHttpInterceptor)||void 0===n?void 0:n.call(this),this.stopActivityMonitor=null===(i=this.stopActivityMonitor)||void 0===i?void 0:i.call(this),this.stopVisibilityMonitor=null===(s=this.stopVisibilityMonitor)||void 0===s?void 0:s.call(this))})),s()(this,"fetchSessionInfo",(async(e=!1)=>{this.isFetchingSessionInfo=!0;try{const t=await this.http.fetch(d.m,{method:e?"POST":"GET",asSystemRequest:!e});if(this.consecutiveErrorCount=0,t){const{expiresInMs:e,canBeExtended:n}=t,i={lastExtensionTime:Date.now(),expiresInMs:e,canBeExtended:n};return this.sessionState$.next(i),this.channel&&this.channel.postMessage(i),i}}catch(e){this.consecutiveErrorCount++}finally{this.isFetchingSessionInfo=!1}})),s()(this,"showWarning",(()=>{if(!this.warningToast){const e=async()=>{const{canBeExtended:e}=this.sessionState$.getValue();e&&await this.fetchSessionInfo(!0)},t=()=>(this.hideWarning(!0),e()),n=((e,t,n)=>({color:"warning",iconType:"clock",title:r.i18n.translate("xpack.security.sessionExpirationToast.title",{defaultMessage:"Session timeout"}),text:Object(O.toMountPoint)(Object(C.jsx)($,{sessionState$:e,onExtend:t})),onClose:n,toastLifeTimeMs:2147483647}))(this.sessionState$,e,t);this.warningToast=this.notifications.toasts.add(n)}})),s()(this,"hideWarning",((e=!1)=>{this.warningToast&&(this.notifications.toasts.remove(this.warningToast),this.warningToast=void 0,e&&(this.snoozedWarningState=this.sessionState$.getValue()))})),this.notifications=e,this.sessionExpired=t,this.http=n,this.tenant=i}async start(){if(!this.http.anonymousPaths.isAnonymous(window.location.pathname)){this.subscription=this.sessionState$.pipe(Object(o.skip)(1),Object(o.throttleTime)(1e3),Object(o.tap)(this.toggleEventHandlers)).subscribe(this.resetTimers);try{this.channel=new BroadcastChannel(`${this.tenant}/session_timeout`),this.channel.onmessage=e=>this.handleChannelMessage(e)}catch(e){console.warn("Failed to load broadcast channel. Session management will not be kept in sync when multiple tabs are loaded.",e)}return this.fetchSessionInfo()}}stop(){var e,t;const n={lastExtensionTime:0,expiresInMs:null,canBeExtended:!1};this.toggleEventHandlers(n),this.resetTimers(n),null===(e=this.subscription)||void 0===e||e.unsubscribe(),null===(t=this.channel)||void 0===t||t.close()}shouldExtend(){const{lastExtensionTime:e}=this.sessionState$.getValue();return!this.isFetchingSessionInfo&&!this.warningToast&&Date.now()>e+d.k*Math.exp(this.consecutiveErrorCount)}}function U(e,t,n){var i;const s=2147483647;let r;return(n=null!==(i=n)&&void 0!==i?i:e=>r=e)(t>s?window.setTimeout((()=>U(e,t-s,n)),s):window.setTimeout(e,t)),()=>clearTimeout(r)}class unauthorized_response_http_interceptor_UnauthorizedResponseHttpInterceptor{constructor(e,t){this.sessionExpired=e,this.anonymousPaths=t}responseError(e,t){if(this.anonymousPaths.isAnonymous(window.location.pathname))return;if("omit"===e.request.credentials)return;const{response:n}=e;n&&401===n.status&&(this.sessionExpired.logout(E.AUTHENTICATION_ERROR),t.halt())}}var F=n(24),N=n.n(F),B=n(14);const D=async()=>{const{PersonalInfo:e}=await n.e(16).then(n.bind(null,72));return t=>Object(C.jsx)(e,t)};class suspense_error_boundary_SuspenseErrorBoundary extends j.Component{constructor(...e){super(...e),s()(this,"state",{error:null})}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e){const{notifications:t}=this.props;if(t){const n=r.i18n.translate("xpack.security.uiApi.errorBoundaryToastTitle",{defaultMessage:"Failed to load Kibana asset"}),i=r.i18n.translate("xpack.security.uiApi.errorBoundaryToastMessage",{defaultMessage:"Reload page to continue."});t.toasts.addError(e,{title:n,toastMessage:i})}}render(){const{children:e,notifications:t}=this.props,{error:n}=this.state;return!t||n?null:Object(C.jsx)(j.Suspense,{fallback:Object(C.jsx)(w.EuiLoadingSpinner,null)},e)}}const z=({fn:e,core:t,props:n})=>{const{notifications:i}=t,s=Object(j.useMemo)((()=>Object(j.lazy)((()=>e().then((e=>({default:e})))))),[e]);return i?Object(C.jsx)(suspense_error_boundary_SuspenseErrorBoundary,{notifications:i},Object(C.jsx)(s,n)):null},K=({core:e})=>{function t(t){return n=>Object(C.jsx)(z,{fn:t,core:e,props:n})}return{getPersonalInfo:t(D),getChangePassword:t((()=>(async e=>{const{ChangePassword:t}=await n.e(15).then(n.bind(null,71));return n=>Object(C.jsx)(t,N()({notifications:e.notifications,userAPIClient:new B.UserAPIClient(e.http)},n))})(e)))}},V=({core:e})=>({components:K({core:e})});class plugin_SecurityPlugin{constructor(e){s()(this,"config",void 0),s()(this,"sessionTimeout",void 0),s()(this,"authenticationService",new authentication_service_AuthenticationService),s()(this,"navControlService",new nav_control_service_SecurityNavControlService),s()(this,"securityLicenseService",new license_service_SecurityLicenseService),s()(this,"managementService",new v.ManagementService),s()(this,"securityCheckupService",void 0),s()(this,"anonymousAccessService",new anonymous_access_service_AnonymousAccessService),s()(this,"analyticsService",new analytics_service_AnalyticsService),s()(this,"authc",void 0),this.initializerContext=e,this.config=this.initializerContext.config.get(),this.securityCheckupService=new security_checkup_service_SecurityCheckupService(this.config,localStorage)}setup(e,{home:t,licensing:n,management:i,share:s}){const{license:o}=this.securityLicenseService.setup({license$:n.license$});return this.securityCheckupService.setup({http:e.http}),this.authc=this.authenticationService.setup({application:e.application,fatalErrors:e.fatalErrors,config:this.config,getStartServices:e.getStartServices,http:e.http}),this.navControlService.setup({securityLicense:o,authc:this.authc,logoutUrl:H(e.http)}),this.analyticsService.setup({securityLicense:o}),c.create({authc:this.authc,application:e.application,getStartServices:e.getStartServices}),i&&this.managementService.setup({license:o,management:i,authc:this.authc,fatalErrors:e.fatalErrors,getStartServices:e.getStartServices}),i&&t&&t.featureCatalogue.register({id:"security",title:r.i18n.translate("xpack.security.registerFeature.securitySettingsTitle",{defaultMessage:"Manage permissions"}),description:r.i18n.translate("xpack.security.registerFeature.securitySettingsDescription",{defaultMessage:"Control who has access and what tasks they can perform."}),icon:"securityApp",path:"/app/management/security/roles",showOnHomePage:!0,category:"admin",order:600}),s&&this.anonymousAccessService.setup({share:s}),{authc:this.authc,license:o}}start(e,{management:t,share:n}){const{application:i,http:s,notifications:r,docLinks:o}=e,{anonymousPaths:a}=s,c=H(s),u=s.basePath.serverBasePath,l=new session_expired_SessionExpired(i,c,u);return s.intercept(new unauthorized_response_http_interceptor_UnauthorizedResponseHttpInterceptor(l,a)),this.sessionTimeout=new session_timeout_SessionTimeout(r,l,s,u),this.sessionTimeout.start(),this.securityCheckupService.start({http:s,notifications:r,docLinks:o}),t&&this.managementService.start({capabilities:i.capabilities}),n&&this.anonymousAccessService.start({http:s}),this.analyticsService.start({http:e.http}),{uiApi:V({core:e}),navControlService:this.navControlService.start({core:e}),authc:this.authc}}stop(){var e;null===(e=this.sessionTimeout)||void 0===e||e.stop(),this.navControlService.stop(),this.securityLicenseService.stop(),this.managementService.stop(),this.analyticsService.stop()}}function H(e){return`${e.basePath.serverBasePath}/logout`}const W=e=>new plugin_SecurityPlugin(e)},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/features/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/spaces/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t){e.exports=__kbnSharedDeps__.Classnames},function(e,t){e.exports=__kbnSharedDeps__.MomentTimezone},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/esUiShared/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t){e.exports=__kbnSharedDeps__.KbnUiTheme},function(e,t){e.exports=__kbnSharedDeps__.KbnMonaco},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/spaces/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t){e.exports=__kbnSharedDeps__.KbnStd}]);