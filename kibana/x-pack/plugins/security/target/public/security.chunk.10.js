/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.security_bundle_jsonpfunction=window.security_bundle_jsonpfunction||[]).push([[10,17],{240:function(e,t,a){"use strict";a.r(t),a.d(t,"APIKeysGridPage",(function(){return api_keys_grid_page_APIKeysGridPage}));var s=a(24),i=a.n(s),n=a(1),r=a.n(n),o=a(4),c=a(0),l=a(45),u=a.n(l),d=a(3),p=a.n(d),m=a(5),y=a(27),j=a(46),g=a(2),b=a(9),x=a(7),O=a(6),f=a(47);const h=e=>Object(c.jsx)(o.EuiFormControlLayout,i()({},e,{append:Object(c.jsx)(o.EuiCopy,{textToCopy:e.value},(e=>Object(c.jsx)(o.EuiButtonIcon,{"aria-label":g.i18n.translate("xpack.security.copyTokenField.copyButton",{defaultMessage:"Copy to clipboard"}),iconType:"copyClipboard",color:"success",style:{backgroundColor:"transparent"},onClick:e}))),style:{backgroundColor:"transparent"},readOnly:!0}),Object(c.jsx)("input",{type:"text","aria-label":g.i18n.translate("xpack.security.copyTokenField.tokenLabel",{defaultMessage:"Token"}),className:"euiFieldText euiFieldText--inGroup",value:e.value,style:{fontFamily:f.euiThemeVars.euiCodeFontFamily,fontSize:f.euiThemeVars.euiFontSizeXS},onFocus:e=>e.currentTarget.select(),readOnly:!0})),k=e=>{const{options:t,...a}=e,[s,n]=p.a.useState(!1),[r,l]=p.a.useState(t[0]),u=t.findIndex((e=>e.key===r.key)),d=()=>n(!1);return Object(c.jsx)(h,i()({},a,{prepend:Object(c.jsx)(o.EuiPopover,{button:Object(c.jsx)(o.EuiButtonEmpty,{size:"xs",iconType:"arrowDown",iconSide:"right",color:"success",onClick:()=>n(!s)},r.label),isOpen:s,panelPaddingSize:"none",closePopover:d},Object(c.jsx)(o.EuiContextMenuPanel,{initialFocusedItemIndex:2*u,items:t.reduce(((e,a,s)=>(e.push(Object(c.jsx)(o.EuiContextMenuItem,{key:a.key,icon:a.icon,layoutAlign:"top",onClick:()=>{d(),l(a)}},Object(c.jsx)("strong",null,a.label),Object(c.jsx)(o.EuiSpacer,{size:"xs"}),Object(c.jsx)(o.EuiText,{size:"s",color:"subdued"},Object(c.jsx)("p",null,a.description)))),s<t.length-1&&e.push(Object(c.jsx)(o.EuiHorizontalRule,{key:`${a.key}-seperator`,margin:"none"})),e)),[])})),value:r.value}))};var E=a(68),K=a(69);const M=({error:e,children:t})=>{const a=Object(K.a)("apiKeysEmptyPrompt","accordion");if(e){if(function(e){var t;return-1!==((null===(t=e.body)||void 0===t?void 0:t.message)||"").indexOf('disabled.feature="api_keys"')}(e))return Object(c.jsx)(o.EuiEmptyPrompt,{iconType:"alert",body:Object(c.jsx)(p.a.Fragment,null,Object(c.jsx)("p",null,Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.disabledErrorMessage",defaultMessage:"API keys are disabled."})),Object(c.jsx)("p",null,Object(c.jsx)(E.a,{app:"elasticsearch",doc:"security-settings.html#api-key-service-settings"},Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.docsLinkText",defaultMessage:"Learn how to enable API keys."}))))});if(function(e){var t;return 403===(null===(t=e.body)||void 0===t?void 0:t.statusCode)}(e))return Object(c.jsx)(o.EuiEmptyPrompt,{iconType:"lock",body:Object(c.jsx)("p",null,Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.forbiddenErrorMessage",defaultMessage:"Not authorized to manage API keys."}))});const s=()=>{throw e};return Object(c.jsx)(o.EuiEmptyPrompt,{iconType:"alert",body:Object(c.jsx)("p",null,Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.errorMessage",defaultMessage:"Could not load API keys."})),actions:Object(c.jsx)(p.a.Fragment,null,t,Object(c.jsx)(o.EuiSpacer,{size:"xl"}),Object(c.jsx)(o.EuiAccordion,{id:a,buttonClassName:"euiButtonEmpty euiButtonEmpty--primary euiButtonEmpty--xSmall",buttonContent:Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.technicalDetailsButton",defaultMessage:"Technical details"}),buttonProps:{style:{display:"flex",justifyContent:"center"}},arrowDisplay:"right",paddingSize:"m"},Object(c.jsx)(o.EuiText,{textAlign:"left"},Object(c.jsx)(o.EuiErrorBoundary,null,Object(c.jsx)(s,null)))))})}return Object(c.jsx)(o.EuiEmptyPrompt,{iconType:"gear",title:Object(c.jsx)("h1",null,Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.emptyTitle",defaultMessage:"Create your first API key"})),body:Object(c.jsx)("p",null,Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.emptyMessage",defaultMessage:"Allow applications to access Elastic on your behalf."})),actions:t})};var v=a(18),A=a.n(v),P=a(79),I=a(17),C=a(70),F=a(80),S=a(26),T=a(94);const w={name:"",expiration:"",customExpiration:!1,customPrivileges:!1,includeMetadata:!1,role_descriptors:"{}",metadata:"{}"},L=({onSuccess:e,onCancel:t,defaultValues:a=w})=>{var s;const{services:n}=Object(x.useKibana)(),{value:r,loading:l}=Object(I.b)(),[{value:u,loading:m},y]=A()((()=>new S.RolesAPIClient(n.http).getRoles()),[n.http]),[j,O]=Object(C.a)({onSubmit:async t=>{try{const a=await new T.APIKeysAPIClient(n.http).createApiKey(function(e){return{name:e.name,expiration:e.customExpiration&&e.expiration?`${e.expiration}d`:void 0,role_descriptors:e.customPrivileges&&e.role_descriptors?JSON.parse(e.role_descriptors):void 0,metadata:e.includeMetadata&&e.metadata?JSON.parse(e.metadata):void 0}}(t));null==e||e(a)}catch(e){throw e}},validate:B,defaultValues:a}),f=l||m;Object(d.useEffect)((()=>{y()}),[]),Object(d.useEffect)((()=>{if(r&&u){const e=r.roles.reduce(((e,t)=>{const a=u.find((e=>e.name===t));return a&&(e[a.name]=a.elasticsearch),e}),{});j.touched.role_descriptors||j.setValue("role_descriptors",JSON.stringify(e,null,2))}}),[r,u]);const h=Object(F.a)([f]);return Object(c.jsx)(P.a,{title:g.i18n.translate("xpack.security.accountManagement.createApiKey.title",{defaultMessage:"Create API key"}),onCancel:t,onSubmit:j.submit,submitButtonText:g.i18n.translate("xpack.security.accountManagement.createApiKey.submitButton",{defaultMessage:"{isSubmitting, select, true{Creating API key…} other{Create API key}}",values:{isSubmitting:j.isSubmitting}}),isLoading:j.isSubmitting,isDisabled:f||j.isSubmitted&&j.isInvalid,size:"s",ownFocus:!0},j.submitError&&Object(c.jsx)(p.a.Fragment,null,Object(c.jsx)(o.EuiCallOut,{title:g.i18n.translate("xpack.security.accountManagement.createApiKey.errorMessage",{defaultMessage:"Could not create API key"}),color:"danger"},(null===(s=j.submitError.body)||void 0===s?void 0:s.message)||j.submitError.message),Object(c.jsx)(o.EuiSpacer,null)),f?Object(c.jsx)(o.EuiLoadingContent,null):Object(c.jsx)(o.EuiForm,i()({component:"form",isInvalid:j.isInvalid,error:Object.values(j.errors),invalidCallout:!j.submitError&&j.isSubmitted?"above":"none"},O),Object(c.jsx)(o.EuiFormRow,{label:g.i18n.translate("xpack.security.management.users.changePasswordFlyout.userLabel",{defaultMessage:"User"})},Object(c.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(c.jsx)(o.EuiFlexItem,{grow:!1},Object(c.jsx)(o.EuiIcon,{type:"user"})),Object(c.jsx)(o.EuiFlexItem,{style:{overflow:"hidden"}},Object(c.jsx)(o.EuiSpacer,{size:"xs"}),Object(c.jsx)(o.EuiText,{style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}},null==r?void 0:r.username),Object(c.jsx)(o.EuiSpacer,{size:"xs"})))),Object(c.jsx)(o.EuiFormRow,{label:g.i18n.translate("xpack.security.accountManagement.createApiKey.nameLabel",{defaultMessage:"Name"}),helpText:g.i18n.translate("xpack.security.accountManagement.createApiKey.nameHelpText",{defaultMessage:"What is this key used for?"}),error:j.errors.name,isInvalid:j.touched.name&&!!j.errors.name},Object(c.jsx)(o.EuiFieldText,{name:"name",defaultValue:j.values.name,isInvalid:j.touched.name&&!!j.errors.name,inputRef:h,fullWidth:!0,"data-test-subj":"apiKeyNameInput"})),Object(c.jsx)(o.EuiSpacer,null),Object(c.jsx)(o.EuiFormFieldset,null,Object(c.jsx)(o.EuiSwitch,{label:g.i18n.translate("xpack.security.accountManagement.createApiKey.customPrivilegesLabel",{defaultMessage:"Restrict privileges"}),checked:!!j.values.customPrivileges,onChange:e=>j.setValue("customPrivileges",e.target.checked)}),j.values.customPrivileges&&Object(c.jsx)(p.a.Fragment,null,Object(c.jsx)(o.EuiSpacer,{size:"m"}),Object(c.jsx)(o.EuiFormRow,{helpText:Object(c.jsx)(E.a,{app:"elasticsearch",doc:"security-api-create-api-key.html#security-api-create-api-key-request-body"},Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.accountManagement.createApiKey.roleDescriptorsHelpText",defaultMessage:"Learn how to structure role descriptors."})),error:j.errors.role_descriptors,isInvalid:j.touched.role_descriptors&&!!j.errors.role_descriptors},Object(c.jsx)(x.CodeEditorField,{value:j.values.role_descriptors,onChange:e=>j.setValue("role_descriptors",e),languageId:"xjson",height:200})),Object(c.jsx)(o.EuiSpacer,{size:"s"}))),Object(c.jsx)(o.EuiSpacer,null),Object(c.jsx)(o.EuiFormFieldset,null,Object(c.jsx)(o.EuiSwitch,{label:g.i18n.translate("xpack.security.accountManagement.createApiKey.customExpirationLabel",{defaultMessage:"Expire after time"}),checked:!!j.values.customExpiration,onChange:e=>j.setValue("customExpiration",e.target.checked),"data-test-subj":"apiKeyCustomExpirationSwitch"}),j.values.customExpiration&&Object(c.jsx)(p.a.Fragment,null,Object(c.jsx)(o.EuiSpacer,{size:"m"}),Object(c.jsx)(o.EuiFormRow,{error:j.errors.expiration,isInvalid:j.touched.expiration&&!!j.errors.expiration,label:g.i18n.translate("xpack.security.accountManagement.createApiKey.customExpirationInputLabel",{defaultMessage:"Lifetime (days)"})},Object(c.jsx)(o.EuiFieldNumber,{append:g.i18n.translate("xpack.security.accountManagement.createApiKey.expirationUnit",{defaultMessage:"days"}),name:"expiration",min:0,defaultValue:j.values.expiration,isInvalid:j.touched.expiration&&!!j.errors.expiration,fullWidth:!0,"data-test-subj":"apiKeyCustomExpirationInput"})),Object(c.jsx)(o.EuiSpacer,{size:"s"}))),Object(c.jsx)(o.EuiSpacer,null),Object(c.jsx)(o.EuiFormFieldset,null,Object(c.jsx)(o.EuiSwitch,{label:g.i18n.translate("xpack.security.accountManagement.createApiKey.includeMetadataLabel",{defaultMessage:"Include metadata"}),checked:!!j.values.includeMetadata,onChange:e=>j.setValue("includeMetadata",e.target.checked)}),j.values.includeMetadata&&Object(c.jsx)(p.a.Fragment,null,Object(c.jsx)(o.EuiSpacer,{size:"m"}),Object(c.jsx)(o.EuiFormRow,{helpText:Object(c.jsx)(E.a,{app:"elasticsearch",doc:"security-api-create-api-key.html#security-api-create-api-key-request-body"},Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.accountManagement.createApiKey.metadataHelpText",defaultMessage:"Learn how to structure metadata."})),error:j.errors.metadata,isInvalid:j.touched.metadata&&!!j.errors.metadata},Object(c.jsx)(x.CodeEditorField,{value:j.values.metadata,onChange:e=>j.setValue("metadata",e),languageId:"xjson",height:200})),Object(c.jsx)(o.EuiSpacer,{size:"s"}))),Object(c.jsx)("input",{type:"submit",hidden:!0})))};function B(e){const t={};if(e.name||(t.name=g.i18n.translate("xpack.security.management.apiKeys.createApiKey.nameRequired",{defaultMessage:"Enter a name."})),e.customExpiration){const a=parseFloat(e.expiration);(isNaN(a)||a<=0)&&(t.expiration=g.i18n.translate("xpack.security.management.apiKeys.createApiKey.expirationRequired",{defaultMessage:"Enter a valid duration or disable this option."}))}if(e.customPrivileges)if(e.role_descriptors)try{JSON.parse(e.role_descriptors)}catch(e){t.role_descriptors=g.i18n.translate("xpack.security.management.apiKeys.createApiKey.invalidJsonError",{defaultMessage:"Enter valid JSON."})}else t.role_descriptors=g.i18n.translate("xpack.security.management.apiKeys.createApiKey.roleDescriptorsRequired",{defaultMessage:"Enter role descriptors or disable this option."});if(e.includeMetadata)if(e.metadata)try{JSON.parse(e.metadata)}catch(e){t.metadata=g.i18n.translate("xpack.security.management.apiKeys.createApiKey.invalidJsonError",{defaultMessage:"Enter valid JSON."})}else t.metadata=g.i18n.translate("xpack.security.management.apiKeys.createApiKey.metadataRequired",{defaultMessage:"Enter metadata or disable this option."});return t}const D=({isAdmin:e,children:t,notifications:a,apiKeysAPIClient:s})=>{const[i,n]=Object(d.useState)([]),[r,l]=Object(d.useState)(!1),u=Object(d.useRef)(null),p=()=>{l(!1),n([])},m=async()=>{let t,n,r;try{t=await s.invalidateApiKeys(i,e)}catch(e){n=e}if(p(),t){const{itemsInvalidated:e}=t;if(({errors:r}=t),e&&e.length){const t=e.length>1?g.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.successMultipleNotificationTitle",{defaultMessage:"Deleted {count} API keys",values:{count:e.length}}):g.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.successSingleNotificationTitle",{defaultMessage:"Deleted API key '{name}'",values:{name:e[0].name}});a.toasts.addSuccess(t),u.current&&u.current([...e])}}if(n||r&&r.length){const e=r&&r.length>1||n&&i.length>1?g.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.errorMultipleNotificationTitle",{defaultMessage:"Error deleting {count} apiKeys",values:{count:r&&r.length||i.length}}):g.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.errorSingleNotificationTitle",{defaultMessage:"Error deleting API key '{name}'",values:{name:r&&r[0].name||i[0].name}});a.toasts.addDanger(e)}};return Object(c.jsx)(d.Fragment,null,t(((e,t=(()=>{}))=>{if(!e||!e.length)throw new Error("No API key IDs specified for deletion");l(!0),n(e),u.current=t})),(()=>{if(!r)return null;const e=1===i.length;return Object(c.jsx)(o.EuiConfirmModal,{role:"dialog",title:e?g.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.deleteSingleTitle",{defaultMessage:"Delete API key '{name}'?",values:{name:i[0].name}}):g.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.deleteMultipleTitle",{defaultMessage:"Delete {count} API keys?",values:{count:i.length}}),onCancel:p,onConfirm:m,cancelButtonText:g.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.cancelButtonLabel",{defaultMessage:"Cancel"}),confirmButtonText:g.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.confirmButtonLabel",{defaultMessage:"Delete {count, plural, one {API key} other {API keys}}",values:{count:i.length}}),buttonColor:"danger","data-test-subj":"invalidateApiKeyConfirmationModal"},e?null:Object(c.jsx)(d.Fragment,null,Object(c.jsx)("p",null,g.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.deleteMultipleListDescription",{defaultMessage:"You are about to delete these API keys:"})),Object(c.jsx)("ul",null,i.map((({name:e,id:t})=>Object(c.jsx)("li",{key:t},e))))))})())},_=()=>{const e=Object(x.useKibana)().services.docLinks;return Object(c.jsx)(o.EuiEmptyPrompt,{title:Object(c.jsx)("h2",null,Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysDisabledErrorTitle",defaultMessage:"API keys not enabled in Elasticsearch"})),color:"danger",iconType:"alert",body:Object(c.jsx)("p",null,Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysDisabledErrorDescription",defaultMessage:"Contact your system administrator and refer to the {link} to enable API keys.",values:{link:Object(c.jsx)(o.EuiLink,{href:`${e.links.security.apiKeyServiceSettings}`,target:"_blank"},Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysDisabledErrorLinkText",defaultMessage:"docs"}))}}))})},N=()=>Object(c.jsx)(o.EuiPageContent,{verticalPosition:"center",horizontalPosition:"center",color:"danger"},Object(c.jsx)(o.EuiEmptyPrompt,{iconType:"securityApp",title:Object(c.jsx)("h2",{"data-test-subj":"apiKeysPermissionDeniedMessage"},Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.deniedPermissionTitle",defaultMessage:"You need permission to manage API keys"})),body:Object(c.jsx)("p",{"data-test-subj":"permissionDeniedMessage"},Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.noPermissionToManageRolesDescription",defaultMessage:"Contact your system administrator."}))})),z="MMMM Do YYYY HH:mm:ss";var R={name:"d3v9zr",styles:"overflow:hidden"};class api_keys_grid_page_APIKeysGridPage extends d.Component{constructor(e){super(e),r()(this,"renderTable",(()=>{var e,t;const{apiKeys:a,selectedItems:s,isLoadingTable:i,isAdmin:n,error:r}=this.state,l=i?Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysTableLoadingMessage",defaultMessage:"Loading API keys…"}):void 0,u={sort:{field:"creation",direction:"desc"}},d={initialPageSize:20,pageSizeOptions:[10,20,50]},m={onSelectionChange:e=>{this.setState({selectedItems:e})}},y={toolsLeft:s.length?Object(c.jsx)(D,{isAdmin:n,notifications:this.props.notifications,apiKeysAPIClient:this.props.apiKeysAPIClient},(e=>Object(c.jsx)(o.EuiButton,{onClick:()=>e(s.map((({name:e,id:t})=>({name:e,id:t}))),this.onApiKeysInvalidated),color:"danger","data-test-subj":"bulkInvalidateActionButton"},Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.invalidateApiKeyButton",defaultMessage:"Delete {count, plural, one {API key} other {API keys}}",values:{count:s.length}})))):void 0,box:{incremental:!0},filters:n?[{type:"field_value_selection",field:"username",name:g.i18n.translate("xpack.security.management.apiKeys.table.userFilterLabel",{defaultMessage:"User"}),multiSelect:!1,options:Object.keys(null!==(e=null==a?void 0:a.reduce(((e,t)=>(e[t.username]=!0,e)),{}))&&void 0!==e?e:{}).map((e=>({value:e,view:Object(c.jsx)(o.EuiToolTip,{delay:"long",position:"left",content:e},Object(c.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(c.jsx)(o.EuiFlexItem,{grow:!1},Object(c.jsx)(o.EuiIcon,{type:"user"})),Object(c.jsx)(o.EuiFlexItem,{css:R,grow:!1},Object(c.jsx)(o.EuiText,{className:"eui-textTruncate"},e))))})))},{type:"field_value_selection",field:"realm",name:g.i18n.translate("xpack.security.management.apiKeys.table.realmFilterLabel",{defaultMessage:"Realm"}),multiSelect:!1,options:Object.keys(null!==(t=null==a?void 0:a.reduce(((e,t)=>(e[t.realm]=!0,e)),{}))&&void 0!==t?t:{}).map((e=>({value:e,view:e})))}]:void 0};return Object(c.jsx)(p.a.Fragment,null,n?void 0:Object(c.jsx)(p.a.Fragment,null,Object(c.jsx)(o.EuiCallOut,{title:Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.manageOwnKeysWarning",defaultMessage:"You only have permission to manage your own API keys."}),color:"primary",iconType:"user"}),Object(c.jsx)(o.EuiSpacer,null)),Object(c.jsx)(D,{isAdmin:n,notifications:this.props.notifications,apiKeysAPIClient:this.props.apiKeysAPIClient},(e=>Object(c.jsx)(o.EuiInMemoryTable,{items:null!=a?a:[],itemId:"id",columns:this.getColumnConfig(e),search:y,sorting:u,selection:m,pagination:d,loading:i,error:r&&g.i18n.translate("xpack.security.management.apiKeysEmptyPrompt.errorMessage",{defaultMessage:"Could not load API keys."}),message:l,isSelectable:!0}))))})),r()(this,"getColumnConfig",(e=>{const{isAdmin:t,createdApiKey:a}=this.state;let s=[];return s=s.concat([{field:"name",name:g.i18n.translate("xpack.security.management.apiKeys.table.nameColumnName",{defaultMessage:"Name"}),sortable:!0}]),t&&(s=s.concat([{field:"username",name:g.i18n.translate("xpack.security.management.apiKeys.table.userNameColumnName",{defaultMessage:"User"}),sortable:!0,render:e=>Object(c.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(c.jsx)(o.EuiFlexItem,{grow:!1},Object(c.jsx)(o.EuiIcon,{type:"user"})),Object(c.jsx)(o.EuiFlexItem,{grow:!1},Object(c.jsx)(o.EuiText,null,e)))},{field:"realm",name:g.i18n.translate("xpack.security.management.apiKeys.table.realmColumnName",{defaultMessage:"Realm"}),sortable:!0}])),s=s.concat([{field:"creation",name:g.i18n.translate("xpack.security.management.apiKeys.table.creationDateColumnName",{defaultMessage:"Created"}),sortable:!0,mobileOptions:{show:!1},render:(e,t)=>Object(c.jsx)(o.EuiToolTip,{content:u()(e).format(z)},t.id===(null==a?void 0:a.id)?Object(c.jsx)(o.EuiBadge,{color:"success"},Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.createdBadge",defaultMessage:"Just now"})):Object(c.jsx)("span",null,u()(e).fromNow()))},{name:g.i18n.translate("xpack.security.management.apiKeys.table.statusColumnName",{defaultMessage:"Status"}),render:({expiration:e})=>e?Date.now()>e?Object(c.jsx)(o.EuiHealth,{color:"subdued"},Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.statusExpired",defaultMessage:"Expired"})):Object(c.jsx)(o.EuiHealth,{color:"warning"},Object(c.jsx)(o.EuiToolTip,{content:u()(e).format(z)},Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.statusExpires",defaultMessage:"Expires {timeFromNow}",values:{timeFromNow:u()(e).fromNow()}}))):Object(c.jsx)(o.EuiHealth,{color:"primary"},Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.statusActive",defaultMessage:"Active"}))},{actions:[{name:g.i18n.translate("xpack.security.management.apiKeys.table.deleteAction",{defaultMessage:"Delete"}),description:g.i18n.translate("xpack.security.management.apiKeys.table.deleteDescription",{defaultMessage:"Delete this API key"}),icon:"trash",type:"icon",color:"danger",onClick:t=>e([{id:t.id,name:t.name}],this.onApiKeysInvalidated),"data-test-subj":"apiKeysTableDeleteAction"}]}]),s})),r()(this,"onApiKeysInvalidated",(e=>{e.length&&this.reloadApiKeys()})),r()(this,"reloadApiKeys",(()=>{this.setState({isLoadingApp:!1,isLoadingTable:!0,createdApiKey:void 0,error:void 0}),this.loadApiKeys()})),r()(this,"loadApiKeys",(async()=>{try{const{isAdmin:e}=this.state,{apiKeys:t}=await this.props.apiKeysAPIClient.getApiKeys(e);this.setState({apiKeys:t})}catch(e){this.setState({error:e})}this.setState({isLoadingApp:!1,isLoadingTable:!1})})),this.state={isLoadingApp:!0,isLoadingTable:!1,isAdmin:!1,canManage:!1,areApiKeysEnabled:!1,apiKeys:void 0,selectedItems:[],error:void 0}}componentDidMount(){this.checkPrivileges()}render(){return Object(c.jsx)("div",{className:y.APP_WRAPPER_CLASS},Object(c.jsx)(m.Route,{path:"/create"},Object(c.jsx)(O.a,{text:g.i18n.translate("xpack.security.management.apiKeys.createBreadcrumb",{defaultMessage:"Create"}),href:"/create"},Object(c.jsx)(L,{onSuccess:e=>{this.props.history.push({pathname:"/"}),this.reloadApiKeys(),this.setState({createdApiKey:e})},onCancel:()=>this.props.history.push({pathname:"/"})}))),this.renderContent())}renderContent(){var e,t;const{isLoadingApp:a,isLoadingTable:s,areApiKeysEnabled:n,isAdmin:r,canManage:l,error:u,apiKeys:d}=this.state;if(!d){if(a)return Object(c.jsx)(o.EuiPageContent,{verticalPosition:"center",horizontalPosition:"center",color:"subdued"},Object(c.jsx)(j.SectionLoading,null,Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.loadingApiKeysDescription",defaultMessage:"Loading API keys…"})));if(!l)return Object(c.jsx)(N,null);if(u)return Object(c.jsx)(o.EuiPageContent,{verticalPosition:"center",horizontalPosition:"center",color:"danger"},Object(c.jsx)(M,{error:u},Object(c.jsx)(o.EuiButton,{iconType:"refresh",onClick:this.reloadApiKeys},Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.accountManagement.apiKeys.retryButton",defaultMessage:"Try again"}))));if(!n)return Object(c.jsx)(o.EuiPageContent,{verticalPosition:"center",horizontalPosition:"center",color:"danger"},Object(c.jsx)(_,null))}if(!s&&d&&0===d.length)return Object(c.jsx)(o.EuiPageContent,{verticalPosition:"center",horizontalPosition:"center",color:"subdued"},Object(c.jsx)(M,null,Object(c.jsx)(o.EuiButton,i()({},Object(x.reactRouterNavigate)(this.props.history,"/create"),{fill:!0,iconType:"plusInCircleFilled","data-test-subj":"apiKeysCreatePromptButton"}),Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.createButton",defaultMessage:"Create API key"}))));const m=`${null===(e=this.state.createdApiKey)||void 0===e?void 0:e.id}:${null===(t=this.state.createdApiKey)||void 0===t?void 0:t.api_key}`;return Object(c.jsx)(p.a.Fragment,null,Object(c.jsx)(o.EuiPageHeader,{bottomBorder:!0,pageTitle:Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysTitle",defaultMessage:"API Keys"}),description:Object(c.jsx)(p.a.Fragment,null,r?Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysAllDescription",defaultMessage:"View and delete API keys. An API key sends requests on behalf of a user."}):Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysOwnDescription",defaultMessage:"View and delete your API keys. An API key sends requests on your behalf."})),rightSideItems:[Object(c.jsx)(o.EuiButton,i()({},Object(x.reactRouterNavigate)(this.props.history,"/create"),{fill:!0,iconType:"plusInCircleFilled","data-test-subj":"apiKeysCreateTableButton"}),Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.table.createButton",defaultMessage:"Create API key"}))]}),Object(c.jsx)(o.EuiSpacer,{size:"l"}),this.state.createdApiKey&&!this.state.isLoadingTable&&Object(c.jsx)(p.a.Fragment,null,Object(c.jsx)(o.EuiCallOut,{color:"success",iconType:"check",title:g.i18n.translate("xpack.security.management.apiKeys.createSuccessMessage",{defaultMessage:"Created API key '{name}'",values:{name:this.state.createdApiKey.name}})},Object(c.jsx)("p",null,Object(c.jsx)(b.FormattedMessage,{id:"xpack.security.management.apiKeys.successDescription",defaultMessage:"Copy this key now. You will not be able to view it again."})),Object(c.jsx)(k,{options:[{key:"base64",value:btoa(m),icon:"empty",label:g.i18n.translate("xpack.security.management.apiKeys.base64Label",{defaultMessage:"Base64"}),description:g.i18n.translate("xpack.security.management.apiKeys.base64Description",{defaultMessage:"Format used to authenticate with Elasticsearch."})},{key:"json",value:JSON.stringify(this.state.createdApiKey),icon:"empty",label:g.i18n.translate("xpack.security.management.apiKeys.jsonLabel",{defaultMessage:"JSON"}),description:g.i18n.translate("xpack.security.management.apiKeys.jsonDescription",{defaultMessage:"Full API response."})},{key:"beats",value:m,icon:"logoBeats",label:g.i18n.translate("xpack.security.management.apiKeys.beatsLabel",{defaultMessage:"Beats"}),description:g.i18n.translate("xpack.security.management.apiKeys.beatsDescription",{defaultMessage:"Format used to configure Beats."})},{key:"logstash",value:m,icon:"logoLogstash",label:g.i18n.translate("xpack.security.management.apiKeys.logstashLabel",{defaultMessage:"Logstash"}),description:g.i18n.translate("xpack.security.management.apiKeys.logstashDescription",{defaultMessage:"Format used to configure Logstash."})}]})),Object(c.jsx)(o.EuiSpacer,null)),Object(c.jsx)(o.EuiPageContentBody,null,this.renderTable()))}async checkPrivileges(){try{const{isAdmin:e,canManage:t,areApiKeysEnabled:a}=await this.props.apiKeysAPIClient.checkPrivileges();this.setState({isAdmin:e,canManage:t,areApiKeysEnabled:a}),t&&a?this.loadApiKeys():this.setState({isLoadingApp:!1})}catch(a){var e,t;this.props.notifications.toasts.addDanger(g.i18n.translate("xpack.security.management.apiKeys.table.fetchingApiKeysErrorMessage",{defaultMessage:"Error checking privileges: {message}",values:{message:null!==(e=null===(t=a.body)||void 0===t?void 0:t.message)&&void 0!==e?e:""}}))}}}},68:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var s=a(4),i=a(3),n=a(7),r=a(0);const o=({app:e,doc:t,children:a})=>{const[,o]=function(){const{services:e}=Object(n.useKibana)(),{links:t,ELASTIC_WEBSITE_URL:a,DOC_LINK_VERSION:s}=e.docLinks;return[t,Object(i.useCallback)(((e,t)=>`${a}guide/en/${e}/reference/${s}/${t}`),[a,s])]}();return Object(r.jsx)(s.EuiLink,{href:o(e,t),target:"_blank",external:!0},a)}},69:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var s=a(4),i=a(3);function n(e,t){return Object(i.useMemo)((()=>Object(s.htmlIdGenerator)(e)(t)),[e,t])}},70:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var s=a(15),i=a(3),n=a(18),r=a.n(n);function o(e){const t=function({onSubmit:e,validate:t,defaultValues:a}){const[n,o]=Object(i.useState)(a),[l,u]=Object(i.useState)({}),[d,p]=Object(i.useState)({}),[m,y]=Object(i.useState)(0),[j,g]=r()((async e=>{const a=await t(e);return u(a),0===Object.keys(a).length&&y(0),a}),[t]),[b,x]=r()((async t=>{const a=await g(t);if(p(function(e,t){return Object(s.cloneDeepWith)(e,(e=>{if("object"!=typeof e&&null!==e)return true}))}(t)),y(m+1),0===Object.keys(a).length)return e(t)}),[g,e]);return{setValue:async(e,t)=>{const a=c(n,e,t);o(a),await g(a)},setTouched:async(e,t=!0)=>{p(c(d,e,t)),await g(n)},setError:(e,t)=>{u(c(l,e,t)),p(c(d,e,!0))},reset:e=>{o(e),u({}),p({}),y(0)},submit:()=>x(n),values:n,errors:l,touched:d,isValidating:j.loading,isSubmitting:b.loading,submitError:b.error,isInvalid:Object.keys(l).length>0,isSubmitted:m>0}}(e),a={onSubmit:e=>{e.preventDefault(),t.submit()},onChange:e=>{const{name:a,type:s,checked:i,value:n}=e.target;a&&t.setValue(a,"checkbox"===s?i:n)},onBlur:e=>{const{name:a}=e.target;a&&t.setTouched(e.target.name)}};return[t,a]}function c(e,t,a){return Object(s.get)(e,t)!==a?Object(s.set)(Object(s.cloneDeep)(e),t,a):e}},79:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var s=a(24),i=a.n(s),n=a(4),r=a(3),o=a(9),c=a(69),l=a(0);const u=({title:e,submitButtonText:t,submitButtonColor:a,onCancel:s,onSubmit:u,isLoading:d,isDisabled:p,children:m,initialFocus:y,...j})=>{Object(r.useEffect)((()=>{y&&y.current&&y.current.focus()}),[y]);const g=Object(c.a)("formFlyout","title");return Object(l.jsx)(n.EuiPortal,null,Object(l.jsx)(n.EuiFlyout,i()({onClose:s,"aria-labelledby":g},j),Object(l.jsx)(n.EuiFlyoutHeader,{hasBorder:!0},Object(l.jsx)(n.EuiTitle,{size:"m"},Object(l.jsx)("h2",{id:g},e))),Object(l.jsx)(n.EuiFlyoutBody,null,m),Object(l.jsx)(n.EuiFlyoutFooter,null,Object(l.jsx)(n.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(l.jsx)(n.EuiFlexItem,{grow:!1},Object(l.jsx)(n.EuiButtonEmpty,{"data-test-subj":"formFlyoutCancelButton",flush:"right",isDisabled:d,onClick:s},Object(l.jsx)(o.FormattedMessage,{id:"xpack.security.formFlyout.cancelButton",defaultMessage:"Cancel"}))),Object(l.jsx)(n.EuiFlexItem,{grow:!1},Object(l.jsx)(n.EuiButton,{"data-test-subj":"formFlyoutSubmitButton",isLoading:d,isDisabled:p,color:a,fill:!0,onClick:u},t))))))}},80:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var s=a(3);function i(e=[]){const t=Object(s.useRef)(null);return Object(s.useEffect)((()=>{t.current&&t.current.focus()}),e),t}},94:function(e,t,a){"use strict";a.r(t),a.d(t,"APIKeysAPIClient",(function(){return APIKeysAPIClient}));const s="/internal/security/api_key";class APIKeysAPIClient{constructor(e){this.http=e}async checkPrivileges(){return await this.http.get(`${s}/privileges`)}async getApiKeys(e=!1){return await this.http.get(s,{query:{isAdmin:e}})}async invalidateApiKeys(e,t=!1){return await this.http.post(`${s}/invalidate`,{body:JSON.stringify({apiKeys:e,isAdmin:t})})}async createApiKey(e){return await this.http.post(s,{body:JSON.stringify(e)})}}}}]);